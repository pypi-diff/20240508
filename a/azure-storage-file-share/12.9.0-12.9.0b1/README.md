# Comparing `tmp/azure-storage-file-share-12.9.0.zip` & `tmp/azure-storage-file-share-12.9.0b1.zip`

## zipinfo {}

```diff
@@ -1,141 +1,140 @@
-Zip file size: 370926 bytes, number of entries: 139
-drwxrwxr-x  2.0 unx        0 b- stor 22-Jul-07 20:23 azure-storage-file-share-12.9.0/
-drwxrwxr-x  2.0 unx        0 b- stor 22-Jul-07 20:23 azure-storage-file-share-12.9.0/azure/
-drwxrwxr-x  2.0 unx        0 b- stor 22-Jul-07 20:23 azure-storage-file-share-12.9.0/tests/
-drwxrwxr-x  2.0 unx        0 b- stor 22-Jul-07 20:23 azure-storage-file-share-12.9.0/azure_storage_file_share.egg-info/
-drwxrwxr-x  2.0 unx        0 b- stor 22-Jul-07 20:23 azure-storage-file-share-12.9.0/samples/
--rw-rw-r--  2.0 unx     2453 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/setup.py
--rw-rw-r--  2.0 unx    19283 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/CHANGELOG.md
--rw-rw-r--  2.0 unx      195 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/MANIFEST.in
--rw-rw-r--  2.0 unx    20777 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/README.md
--rw-rw-r--  2.0 unx       38 b- defN 22-Jul-07 20:23 azure-storage-file-share-12.9.0/setup.cfg
--rw-rw-r--  2.0 unx    46984 b- defN 22-Jul-07 20:23 azure-storage-file-share-12.9.0/PKG-INFO
--rw-rw-r--  2.0 unx     1073 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/LICENSE
-drwxrwxr-x  2.0 unx        0 b- stor 22-Jul-07 20:23 azure-storage-file-share-12.9.0/azure/storage/
--rw-rw-r--  2.0 unx       80 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/__init__.py
-drwxrwxr-x  2.0 unx        0 b- stor 22-Jul-07 20:23 azure-storage-file-share-12.9.0/azure/storage/fileshare/
--rw-rw-r--  2.0 unx       80 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/__init__.py
-drwxrwxr-x  2.0 unx        0 b- stor 22-Jul-07 20:23 azure-storage-file-share-12.9.0/azure/storage/fileshare/aio/
-drwxrwxr-x  2.0 unx        0 b- stor 22-Jul-07 20:23 azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/
-drwxrwxr-x  2.0 unx        0 b- stor 22-Jul-07 20:23 azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/
--rw-rw-r--  2.0 unx    72157 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_file_client.py
--rw-rw-r--  2.0 unx      330 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_version.py
--rw-rw-r--  2.0 unx     1790 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_parser.py
--rw-rw-r--  2.0 unx    10623 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_lease.py
--rw-rw-r--  2.0 unx    18156 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_share_service_client.py
--rw-rw-r--  2.0 unx    40145 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_directory_client.py
--rw-rw-r--  2.0 unx    18894 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_download.py
--rw-rw-r--  2.0 unx    24403 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared_access_signature.py
--rw-rw-r--  2.0 unx    38608 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_share_client.py
--rw-rw-r--  2.0 unx     2795 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_deserialize.py
--rw-rw-r--  2.0 unx        0 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/py.typed
--rw-rw-r--  2.0 unx    46268 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_models.py
--rw-rw-r--  2.0 unx     2106 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/__init__.py
--rw-rw-r--  2.0 unx     6908 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_serialize.py
--rw-rw-r--  2.0 unx    35555 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/aio/_directory_client_async.py
--rw-rw-r--  2.0 unx    10214 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/aio/_lease_async.py
--rw-rw-r--  2.0 unx    32666 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/aio/_share_client_async.py
--rw-rw-r--  2.0 unx    63867 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/aio/_file_client_async.py
--rw-rw-r--  2.0 unx    18226 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/aio/_download_async.py
--rw-rw-r--  2.0 unx    16143 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/aio/_share_service_client_async.py
--rw-rw-r--  2.0 unx     8560 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/aio/_models.py
--rw-rw-r--  2.0 unx      701 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/aio/__init__.py
-drwxrwxr-x  2.0 unx        0 b- stor 22-Jul-07 20:23 azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/models/
-drwxrwxr-x  2.0 unx        0 b- stor 22-Jul-07 20:23 azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/aio/
-drwxrwxr-x  2.0 unx        0 b- stor 22-Jul-07 20:23 azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/operations/
--rw-rw-r--  2.0 unx     4693 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/_azure_file_storage.py
--rw-rw-r--  2.0 unx     1529 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/_patch.py
--rw-rw-r--  2.0 unx     3302 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/_configuration.py
--rw-rw-r--  2.0 unx      779 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/__init__.py
--rw-rw-r--  2.0 unx     1197 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/_vendor.py
--rw-rw-r--  2.0 unx    62090 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/models/_models_py3.py
--rw-rw-r--  2.0 unx     6226 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/models/_azure_file_storage_enums.py
--rw-rw-r--  2.0 unx    58450 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/models/_models.py
--rw-rw-r--  2.0 unx     5299 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/models/__init__.py
-drwxrwxr-x  2.0 unx        0 b- stor 22-Jul-07 20:23 azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/aio/operations/
--rw-rw-r--  2.0 unx     4545 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/aio/_azure_file_storage.py
--rw-rw-r--  2.0 unx     1529 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/aio/_patch.py
--rw-rw-r--  2.0 unx     3134 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/aio/_configuration.py
--rw-rw-r--  2.0 unx      779 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/aio/__init__.py
--rw-rw-r--  2.0 unx    13048 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/aio/operations/_service_operations.py
--rw-rw-r--  2.0 unx    48859 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/aio/operations/_directory_operations.py
--rw-rw-r--  2.0 unx    76511 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/aio/operations/_share_operations.py
--rw-rw-r--  2.0 unx   106594 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/aio/operations/_file_operations.py
--rw-rw-r--  2.0 unx      778 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/aio/operations/__init__.py
--rw-rw-r--  2.0 unx    18367 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/operations/_service_operations.py
--rw-rw-r--  2.0 unx    70698 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/operations/_directory_operations.py
--rw-rw-r--  2.0 unx   111057 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/operations/_share_operations.py
--rw-rw-r--  2.0 unx   154194 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/operations/_file_operations.py
--rw-rw-r--  2.0 unx      778 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/operations/__init__.py
--rw-rw-r--  2.0 unx     9737 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/request_handlers.py
--rw-rw-r--  2.0 unx     5369 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/authentication.py
--rw-rw-r--  2.0 unx     9989 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/shared_access_signature.py
--rw-rw-r--  2.0 unx    20689 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/models.py
--rw-rw-r--  2.0 unx      617 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/parser.py
--rw-rw-r--  2.0 unx    14602 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/uploads_async.py
--rw-rw-r--  2.0 unx    27475 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/policies.py
--rw-rw-r--  2.0 unx    22184 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/uploads.py
--rw-rw-r--  2.0 unx     6792 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/base_client_async.py
--rw-rw-r--  2.0 unx     8641 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/response_handlers.py
--rw-rw-r--  2.0 unx    17647 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/base_client.py
--rw-rw-r--  2.0 unx      668 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/constants.py
--rw-rw-r--  2.0 unx     1529 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/__init__.py
--rw-rw-r--  2.0 unx     9993 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/policies_async.py
-drwxrwxr-x  2.0 unx        0 b- stor 22-Jul-07 20:23 azure-storage-file-share-12.9.0/tests/settings/
-drwxrwxr-x  2.0 unx        0 b- stor 22-Jul-07 20:23 azure-storage-file-share-12.9.0/tests/perfstress_tests/
--rw-rw-r--  2.0 unx     8106 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/tests/test_file_service_properties_async.py
--rw-rw-r--  2.0 unx     8907 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/tests/test_file_api_version_async.py
--rw-rw-r--  2.0 unx    64997 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/tests/test_get_file_async.py
--rw-rw-r--  2.0 unx   100301 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/tests/test_file.py
--rw-rw-r--  2.0 unx    22148 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/tests/test_file_client_async.py
--rw-rw-r--  2.0 unx     7817 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/tests/test_handle.py
--rw-rw-r--  2.0 unx    55215 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/tests/test_share_async.py
--rw-rw-r--  2.0 unx     1498 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/tests/conftest.py
--rw-rw-r--  2.0 unx    37553 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/tests/test_directory_async.py
--rw-rw-r--  2.0 unx     7450 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/tests/test_file_service_properties.py
--rw-rw-r--  2.0 unx     3201 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/tests/encryption_test_helper.py
--rw-rw-r--  2.0 unx    23287 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/tests/test_file_client.py
--rw-rw-r--  2.0 unx    58955 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/tests/test_get_file.py
--rw-rw-r--  2.0 unx    32208 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/tests/test_directory.py
--rw-rw-r--  2.0 unx      804 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/tests/test_helpers.py
--rw-rw-r--  2.0 unx     4714 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/tests/test_handle_async.py
--rw-rw-r--  2.0 unx    48499 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/tests/test_share.py
--rw-rw-r--  2.0 unx   115976 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/tests/test_file_async.py
--rw-rw-r--  2.0 unx      810 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/tests/test_helpers_async.py
--rw-rw-r--  2.0 unx     8755 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/tests/test_file_api_version.py
--rw-rw-r--  2.0 unx     3066 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/tests/settings/testcase.py
--rw-rw-r--  2.0 unx      825 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/tests/settings/settings_fake.py
--rw-rw-r--  2.0 unx        0 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/tests/settings/__init__.py
-drwxrwxr-x  2.0 unx        0 b- stor 22-Jul-07 20:23 azure-storage-file-share-12.9.0/tests/perfstress_tests/T1_legacy_tests/
--rw-rw-r--  2.0 unx     1228 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/tests/perfstress_tests/upload.py
--rw-rw-r--  2.0 unx     1489 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/tests/perfstress_tests/download_to_file.py
--rw-rw-r--  2.0 unx     1528 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/tests/perfstress_tests/download.py
--rw-rw-r--  2.0 unx     3409 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/tests/perfstress_tests/_test_base.py
--rw-rw-r--  2.0 unx        0 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/tests/perfstress_tests/__init__.py
--rw-rw-r--  2.0 unx     1342 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/tests/perfstress_tests/upload_from_file.py
--rw-rw-r--  2.0 unx     1173 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/tests/perfstress_tests/T1_legacy_tests/upload.py
--rw-rw-r--  2.0 unx     1496 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/tests/perfstress_tests/T1_legacy_tests/download_to_file.py
--rw-rw-r--  2.0 unx     1397 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/tests/perfstress_tests/T1_legacy_tests/download.py
--rw-rw-r--  2.0 unx     2370 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/tests/perfstress_tests/T1_legacy_tests/_test_base.py
--rw-rw-r--  2.0 unx        0 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/tests/perfstress_tests/T1_legacy_tests/__init__.py
--rw-rw-r--  2.0 unx     1528 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/tests/perfstress_tests/T1_legacy_tests/upload_from_file.py
--rw-rw-r--  2.0 unx       61 b- defN 22-Jul-07 20:23 azure-storage-file-share-12.9.0/azure_storage_file_share.egg-info/requires.txt
--rw-rw-r--  2.0 unx     5019 b- defN 22-Jul-07 20:23 azure-storage-file-share-12.9.0/azure_storage_file_share.egg-info/SOURCES.txt
--rw-rw-r--  2.0 unx        1 b- defN 22-Jul-07 20:23 azure-storage-file-share-12.9.0/azure_storage_file_share.egg-info/not-zip-safe
--rw-rw-r--  2.0 unx        6 b- defN 22-Jul-07 20:23 azure-storage-file-share-12.9.0/azure_storage_file_share.egg-info/top_level.txt
--rw-rw-r--  2.0 unx        1 b- defN 22-Jul-07 20:23 azure-storage-file-share-12.9.0/azure_storage_file_share.egg-info/dependency_links.txt
--rw-rw-r--  2.0 unx    46984 b- defN 22-Jul-07 20:23 azure-storage-file-share-12.9.0/azure_storage_file_share.egg-info/PKG-INFO
--rw-rw-r--  2.0 unx     3434 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/samples/file_samples_authentication_async.py
--rw-rw-r--  2.0 unx     3303 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/samples/file_samples_hello_world_async.py
--rw-rw-r--  2.0 unx     4102 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/samples/file_samples_service.py
--rw-rw-r--  2.0 unx     4552 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/samples/file_samples_service_async.py
--rw-rw-r--  2.0 unx     6176 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/samples/file_samples_share.py
--rw-rw-r--  2.0 unx     4634 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/samples/file_samples_client.py
--rw-rw-r--  2.0 unx     2862 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/samples/file_samples_hello_world.py
--rw-rw-r--  2.0 unx     4307 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/samples/file_samples_client_async.py
--rw-rw-r--  2.0 unx     6409 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/samples/file_samples_share_async.py
--rw-rw-r--  2.0 unx     4242 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/samples/README.md
--rw-rw-r--  2.0 unx     5554 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/samples/file_samples_directory_async.py
--rw-rw-r--  2.0 unx     4836 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/samples/file_samples_directory.py
--rw-rw-r--  2.0 unx     3259 b- defN 22-Jul-07 20:22 azure-storage-file-share-12.9.0/samples/file_samples_authentication.py
-139 files, 2212240 bytes uncompressed, 340728 bytes compressed:  84.6%
+Zip file size: 378840 bytes, number of entries: 138
+drwxrwxr-x  2.0 unx        0 b- stor 22-Jun-15 22:08 azure-storage-file-share-12.9.0b1/
+drwxrwxr-x  2.0 unx        0 b- stor 22-Jun-15 22:08 azure-storage-file-share-12.9.0b1/azure_storage_file_share.egg-info/
+drwxrwxr-x  2.0 unx        0 b- stor 22-Jun-15 22:08 azure-storage-file-share-12.9.0b1/azure/
+drwxrwxr-x  2.0 unx        0 b- stor 22-Jun-15 22:08 azure-storage-file-share-12.9.0b1/tests/
+drwxrwxr-x  2.0 unx        0 b- stor 22-Jun-15 22:08 azure-storage-file-share-12.9.0b1/samples/
+-rw-rw-r--  2.0 unx     1073 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/LICENSE
+-rw-rw-r--  2.0 unx     2453 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/setup.py
+-rw-rw-r--  2.0 unx       38 b- defN 22-Jun-15 22:08 azure-storage-file-share-12.9.0b1/setup.cfg
+-rw-rw-r--  2.0 unx    46725 b- defN 22-Jun-15 22:08 azure-storage-file-share-12.9.0b1/PKG-INFO
+-rw-rw-r--  2.0 unx      195 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/MANIFEST.in
+-rw-rw-r--  2.0 unx    19070 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/CHANGELOG.md
+-rw-rw-r--  2.0 unx    20777 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/README.md
+-rw-rw-r--  2.0 unx    46725 b- defN 22-Jun-15 22:08 azure-storage-file-share-12.9.0b1/azure_storage_file_share.egg-info/PKG-INFO
+-rw-rw-r--  2.0 unx        1 b- defN 22-Jun-15 22:08 azure-storage-file-share-12.9.0b1/azure_storage_file_share.egg-info/not-zip-safe
+-rw-rw-r--  2.0 unx       61 b- defN 22-Jun-15 22:08 azure-storage-file-share-12.9.0b1/azure_storage_file_share.egg-info/requires.txt
+-rw-rw-r--  2.0 unx        1 b- defN 22-Jun-15 22:08 azure-storage-file-share-12.9.0b1/azure_storage_file_share.egg-info/dependency_links.txt
+-rw-rw-r--  2.0 unx     5015 b- defN 22-Jun-15 22:08 azure-storage-file-share-12.9.0b1/azure_storage_file_share.egg-info/SOURCES.txt
+-rw-rw-r--  2.0 unx        6 b- defN 22-Jun-15 22:08 azure-storage-file-share-12.9.0b1/azure_storage_file_share.egg-info/top_level.txt
+drwxrwxr-x  2.0 unx        0 b- stor 22-Jun-15 22:08 azure-storage-file-share-12.9.0b1/azure/storage/
+-rw-rw-r--  2.0 unx       80 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/__init__.py
+drwxrwxr-x  2.0 unx        0 b- stor 22-Jun-15 22:08 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/
+-rw-rw-r--  2.0 unx       80 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/__init__.py
+drwxrwxr-x  2.0 unx        0 b- stor 22-Jun-15 22:08 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/
+drwxrwxr-x  2.0 unx        0 b- stor 22-Jun-15 22:08 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/aio/
+drwxrwxr-x  2.0 unx        0 b- stor 22-Jun-15 22:08 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/
+-rw-rw-r--  2.0 unx      332 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_version.py
+-rw-rw-r--  2.0 unx    72288 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_file_client.py
+-rw-rw-r--  2.0 unx    39912 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_directory_client.py
+-rw-rw-r--  2.0 unx    24403 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared_access_signature.py
+-rw-rw-r--  2.0 unx        0 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/py.typed
+-rw-rw-r--  2.0 unx    38608 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_share_client.py
+-rw-rw-r--  2.0 unx    20838 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_download.py
+-rw-rw-r--  2.0 unx     2795 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_deserialize.py
+-rw-rw-r--  2.0 unx     2106 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/__init__.py
+-rw-rw-r--  2.0 unx    18156 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_share_service_client.py
+-rw-rw-r--  2.0 unx     6908 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_serialize.py
+-rw-rw-r--  2.0 unx    10623 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_lease.py
+-rw-rw-r--  2.0 unx    46268 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_models.py
+-rw-rw-r--  2.0 unx     1790 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_parser.py
+-rw-rw-r--  2.0 unx     6792 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/base_client_async.py
+-rw-rw-r--  2.0 unx    17861 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/base_client.py
+-rw-rw-r--  2.0 unx    27475 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/policies.py
+-rw-rw-r--  2.0 unx      668 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/constants.py
+-rw-rw-r--  2.0 unx    22645 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/uploads.py
+-rw-rw-r--  2.0 unx      617 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/parser.py
+-rw-rw-r--  2.0 unx    40207 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/encryption.py
+-rw-rw-r--  2.0 unx    20689 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/models.py
+-rw-rw-r--  2.0 unx     1529 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/__init__.py
+-rw-rw-r--  2.0 unx     8641 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/response_handlers.py
+-rw-rw-r--  2.0 unx     5369 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/authentication.py
+-rw-rw-r--  2.0 unx     9737 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/request_handlers.py
+-rw-rw-r--  2.0 unx     9989 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/shared_access_signature.py
+-rw-rw-r--  2.0 unx    15223 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/uploads_async.py
+-rw-rw-r--  2.0 unx     9993 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/policies_async.py
+-rw-rw-r--  2.0 unx    32666 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/aio/_share_client_async.py
+-rw-rw-r--  2.0 unx    63801 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/aio/_file_client_async.py
+-rw-rw-r--  2.0 unx    10214 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/aio/_lease_async.py
+-rw-rw-r--  2.0 unx    34981 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/aio/_directory_client_async.py
+-rw-rw-r--  2.0 unx      701 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/aio/__init__.py
+-rw-rw-r--  2.0 unx    16143 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/aio/_share_service_client_async.py
+-rw-rw-r--  2.0 unx    19276 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/aio/_download_async.py
+-rw-rw-r--  2.0 unx     8560 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/aio/_models.py
+drwxrwxr-x  2.0 unx        0 b- stor 22-Jun-15 22:08 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/aio/
+drwxrwxr-x  2.0 unx        0 b- stor 22-Jun-15 22:08 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/models/
+drwxrwxr-x  2.0 unx        0 b- stor 22-Jun-15 22:08 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/operations/
+-rw-rw-r--  2.0 unx     4693 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/_azure_file_storage.py
+-rw-rw-r--  2.0 unx     3302 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/_configuration.py
+-rw-rw-r--  2.0 unx      779 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/__init__.py
+-rw-rw-r--  2.0 unx     1197 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/_vendor.py
+-rw-rw-r--  2.0 unx     1529 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/_patch.py
+drwxrwxr-x  2.0 unx        0 b- stor 22-Jun-15 22:08 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/aio/operations/
+-rw-rw-r--  2.0 unx     4545 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/aio/_azure_file_storage.py
+-rw-rw-r--  2.0 unx     3134 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/aio/_configuration.py
+-rw-rw-r--  2.0 unx      779 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/aio/__init__.py
+-rw-rw-r--  2.0 unx     1529 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/aio/_patch.py
+-rw-rw-r--  2.0 unx    48859 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/aio/operations/_directory_operations.py
+-rw-rw-r--  2.0 unx    13048 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/aio/operations/_service_operations.py
+-rw-rw-r--  2.0 unx      778 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/aio/operations/__init__.py
+-rw-rw-r--  2.0 unx   106594 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/aio/operations/_file_operations.py
+-rw-rw-r--  2.0 unx    76511 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/aio/operations/_share_operations.py
+-rw-rw-r--  2.0 unx    62090 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/models/_models_py3.py
+-rw-rw-r--  2.0 unx     5299 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/models/__init__.py
+-rw-rw-r--  2.0 unx    58450 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/models/_models.py
+-rw-rw-r--  2.0 unx     6226 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/models/_azure_file_storage_enums.py
+-rw-rw-r--  2.0 unx    70698 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/operations/_directory_operations.py
+-rw-rw-r--  2.0 unx    18367 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/operations/_service_operations.py
+-rw-rw-r--  2.0 unx      778 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/operations/__init__.py
+-rw-rw-r--  2.0 unx   154194 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/operations/_file_operations.py
+-rw-rw-r--  2.0 unx   111057 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/operations/_share_operations.py
+drwxrwxr-x  2.0 unx        0 b- stor 22-Jun-15 22:08 azure-storage-file-share-12.9.0b1/tests/settings/
+drwxrwxr-x  2.0 unx        0 b- stor 22-Jun-15 22:08 azure-storage-file-share-12.9.0b1/tests/perfstress_tests/
+-rw-rw-r--  2.0 unx     8755 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/tests/test_file_api_version.py
+-rw-rw-r--  2.0 unx    48499 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/tests/test_share.py
+-rw-rw-r--  2.0 unx    37553 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/tests/test_directory_async.py
+-rw-rw-r--  2.0 unx    61162 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/tests/test_get_file_async.py
+-rw-rw-r--  2.0 unx    22148 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/tests/test_file_client_async.py
+-rw-rw-r--  2.0 unx     7817 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/tests/test_handle.py
+-rw-rw-r--  2.0 unx     1498 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/tests/conftest.py
+-rw-rw-r--  2.0 unx    55332 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/tests/test_get_file.py
+-rw-rw-r--  2.0 unx     3201 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/tests/encryption_test_helper.py
+-rw-rw-r--  2.0 unx    55215 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/tests/test_share_async.py
+-rw-rw-r--  2.0 unx     7450 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/tests/test_file_service_properties.py
+-rw-rw-r--  2.0 unx    23287 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/tests/test_file_client.py
+-rw-rw-r--  2.0 unx     4714 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/tests/test_handle_async.py
+-rw-rw-r--  2.0 unx     8907 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/tests/test_file_api_version_async.py
+-rw-rw-r--  2.0 unx    98875 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/tests/test_file.py
+-rw-rw-r--  2.0 unx   114371 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/tests/test_file_async.py
+-rw-rw-r--  2.0 unx     8106 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/tests/test_file_service_properties_async.py
+-rw-rw-r--  2.0 unx    32208 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/tests/test_directory.py
+-rw-rw-r--  2.0 unx      825 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/tests/settings/settings_fake.py
+-rw-rw-r--  2.0 unx        0 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/tests/settings/__init__.py
+-rw-rw-r--  2.0 unx     3066 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/tests/settings/testcase.py
+drwxrwxr-x  2.0 unx        0 b- stor 22-Jun-15 22:08 azure-storage-file-share-12.9.0b1/tests/perfstress_tests/T1_legacy_tests/
+-rw-rw-r--  2.0 unx     1342 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/tests/perfstress_tests/upload_from_file.py
+-rw-rw-r--  2.0 unx     3409 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/tests/perfstress_tests/_test_base.py
+-rw-rw-r--  2.0 unx     1528 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/tests/perfstress_tests/download.py
+-rw-rw-r--  2.0 unx     1489 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/tests/perfstress_tests/download_to_file.py
+-rw-rw-r--  2.0 unx     1228 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/tests/perfstress_tests/upload.py
+-rw-rw-r--  2.0 unx        0 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/tests/perfstress_tests/__init__.py
+-rw-rw-r--  2.0 unx     1528 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/tests/perfstress_tests/T1_legacy_tests/upload_from_file.py
+-rw-rw-r--  2.0 unx     2370 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/tests/perfstress_tests/T1_legacy_tests/_test_base.py
+-rw-rw-r--  2.0 unx     1397 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/tests/perfstress_tests/T1_legacy_tests/download.py
+-rw-rw-r--  2.0 unx     1496 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/tests/perfstress_tests/T1_legacy_tests/download_to_file.py
+-rw-rw-r--  2.0 unx     1173 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/tests/perfstress_tests/T1_legacy_tests/upload.py
+-rw-rw-r--  2.0 unx        0 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/tests/perfstress_tests/T1_legacy_tests/__init__.py
+-rw-rw-r--  2.0 unx     4634 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/samples/file_samples_client.py
+-rw-rw-r--  2.0 unx     3259 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/samples/file_samples_authentication.py
+-rw-rw-r--  2.0 unx     5554 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/samples/file_samples_directory_async.py
+-rw-rw-r--  2.0 unx     6409 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/samples/file_samples_share_async.py
+-rw-rw-r--  2.0 unx     4307 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/samples/file_samples_client_async.py
+-rw-rw-r--  2.0 unx     4552 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/samples/file_samples_service_async.py
+-rw-rw-r--  2.0 unx     2862 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/samples/file_samples_hello_world.py
+-rw-rw-r--  2.0 unx     4836 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/samples/file_samples_directory.py
+-rw-rw-r--  2.0 unx     3434 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/samples/file_samples_authentication_async.py
+-rw-rw-r--  2.0 unx     4242 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/samples/README.md
+-rw-rw-r--  2.0 unx     4102 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/samples/file_samples_service.py
+-rw-rw-r--  2.0 unx     6176 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/samples/file_samples_share.py
+-rw-rw-r--  2.0 unx     3303 b- defN 22-Jun-15 22:07 azure-storage-file-share-12.9.0b1/samples/file_samples_hello_world_async.py
+138 files, 2243159 bytes uncompressed, 348236 bytes compressed:  84.5%
```

## zipnote {}

```diff
@@ -1,418 +1,415 @@
-Filename: azure-storage-file-share-12.9.0/
+Filename: azure-storage-file-share-12.9.0b1/
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/
+Filename: azure-storage-file-share-12.9.0b1/azure_storage_file_share.egg-info/
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/tests/
+Filename: azure-storage-file-share-12.9.0b1/azure/
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure_storage_file_share.egg-info/
+Filename: azure-storage-file-share-12.9.0b1/tests/
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/samples/
+Filename: azure-storage-file-share-12.9.0b1/samples/
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/setup.py
+Filename: azure-storage-file-share-12.9.0b1/LICENSE
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/CHANGELOG.md
+Filename: azure-storage-file-share-12.9.0b1/setup.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/MANIFEST.in
+Filename: azure-storage-file-share-12.9.0b1/setup.cfg
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/README.md
+Filename: azure-storage-file-share-12.9.0b1/PKG-INFO
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/setup.cfg
+Filename: azure-storage-file-share-12.9.0b1/MANIFEST.in
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/PKG-INFO
+Filename: azure-storage-file-share-12.9.0b1/CHANGELOG.md
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/LICENSE
+Filename: azure-storage-file-share-12.9.0b1/README.md
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/
+Filename: azure-storage-file-share-12.9.0b1/azure_storage_file_share.egg-info/PKG-INFO
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/__init__.py
+Filename: azure-storage-file-share-12.9.0b1/azure_storage_file_share.egg-info/not-zip-safe
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/
+Filename: azure-storage-file-share-12.9.0b1/azure_storage_file_share.egg-info/requires.txt
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/__init__.py
+Filename: azure-storage-file-share-12.9.0b1/azure_storage_file_share.egg-info/dependency_links.txt
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/aio/
+Filename: azure-storage-file-share-12.9.0b1/azure_storage_file_share.egg-info/SOURCES.txt
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/
+Filename: azure-storage-file-share-12.9.0b1/azure_storage_file_share.egg-info/top_level.txt
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_file_client.py
+Filename: azure-storage-file-share-12.9.0b1/azure/__init__.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_version.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_parser.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/__init__.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_lease.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_share_service_client.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/aio/
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_directory_client.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_download.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_version.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared_access_signature.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_file_client.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_share_client.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_directory_client.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_deserialize.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared_access_signature.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/py.typed
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/py.typed
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_models.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_share_client.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/__init__.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_download.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_serialize.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_deserialize.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/aio/_directory_client_async.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/__init__.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/aio/_lease_async.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_share_service_client.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/aio/_share_client_async.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_serialize.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/aio/_file_client_async.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_lease.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/aio/_download_async.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_models.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/aio/_share_service_client_async.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_parser.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/aio/_models.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/base_client_async.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/aio/__init__.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/base_client.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/models/
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/policies.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/aio/
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/constants.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/operations/
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/uploads.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/_azure_file_storage.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/parser.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/_patch.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/encryption.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/_configuration.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/models.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/__init__.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/__init__.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/_vendor.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/response_handlers.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/models/_models_py3.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/authentication.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/models/_azure_file_storage_enums.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/request_handlers.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/models/_models.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/shared_access_signature.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/models/__init__.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/uploads_async.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/aio/operations/
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/policies_async.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/aio/_azure_file_storage.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/aio/_share_client_async.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/aio/_patch.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/aio/_file_client_async.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/aio/_configuration.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/aio/_lease_async.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/aio/__init__.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/aio/_directory_client_async.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/aio/operations/_service_operations.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/aio/__init__.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/aio/operations/_directory_operations.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/aio/_share_service_client_async.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/aio/operations/_share_operations.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/aio/_download_async.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/aio/operations/_file_operations.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/aio/_models.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/aio/operations/__init__.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/aio/
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/operations/_service_operations.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/models/
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/operations/_directory_operations.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/operations/
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/operations/_share_operations.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/_azure_file_storage.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/operations/_file_operations.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/_configuration.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/operations/__init__.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/__init__.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/request_handlers.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/_vendor.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/authentication.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/_patch.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/shared_access_signature.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/aio/operations/
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/models.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/aio/_azure_file_storage.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/parser.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/aio/_configuration.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/uploads_async.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/aio/__init__.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/policies.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/aio/_patch.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/uploads.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/aio/operations/_directory_operations.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/base_client_async.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/aio/operations/_service_operations.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/response_handlers.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/aio/operations/__init__.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/base_client.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/aio/operations/_file_operations.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/constants.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/aio/operations/_share_operations.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/__init__.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/models/_models_py3.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/policies_async.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/models/__init__.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/tests/settings/
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/models/_models.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/tests/perfstress_tests/
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/models/_azure_file_storage_enums.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/tests/test_file_service_properties_async.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/operations/_directory_operations.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/tests/test_file_api_version_async.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/operations/_service_operations.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/tests/test_get_file_async.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/operations/__init__.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/tests/test_file.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/operations/_file_operations.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/tests/test_file_client_async.py
+Filename: azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/operations/_share_operations.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/tests/test_handle.py
+Filename: azure-storage-file-share-12.9.0b1/tests/settings/
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/tests/test_share_async.py
+Filename: azure-storage-file-share-12.9.0b1/tests/perfstress_tests/
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/tests/conftest.py
+Filename: azure-storage-file-share-12.9.0b1/tests/test_file_api_version.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/tests/test_directory_async.py
+Filename: azure-storage-file-share-12.9.0b1/tests/test_share.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/tests/test_file_service_properties.py
+Filename: azure-storage-file-share-12.9.0b1/tests/test_directory_async.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/tests/encryption_test_helper.py
+Filename: azure-storage-file-share-12.9.0b1/tests/test_get_file_async.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/tests/test_file_client.py
+Filename: azure-storage-file-share-12.9.0b1/tests/test_file_client_async.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/tests/test_get_file.py
+Filename: azure-storage-file-share-12.9.0b1/tests/test_handle.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/tests/test_directory.py
+Filename: azure-storage-file-share-12.9.0b1/tests/conftest.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/tests/test_helpers.py
+Filename: azure-storage-file-share-12.9.0b1/tests/test_get_file.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/tests/test_handle_async.py
+Filename: azure-storage-file-share-12.9.0b1/tests/encryption_test_helper.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/tests/test_share.py
+Filename: azure-storage-file-share-12.9.0b1/tests/test_share_async.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/tests/test_file_async.py
+Filename: azure-storage-file-share-12.9.0b1/tests/test_file_service_properties.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/tests/test_helpers_async.py
+Filename: azure-storage-file-share-12.9.0b1/tests/test_file_client.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/tests/test_file_api_version.py
+Filename: azure-storage-file-share-12.9.0b1/tests/test_handle_async.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/tests/settings/testcase.py
+Filename: azure-storage-file-share-12.9.0b1/tests/test_file_api_version_async.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/tests/settings/settings_fake.py
+Filename: azure-storage-file-share-12.9.0b1/tests/test_file.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/tests/settings/__init__.py
+Filename: azure-storage-file-share-12.9.0b1/tests/test_file_async.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/tests/perfstress_tests/T1_legacy_tests/
+Filename: azure-storage-file-share-12.9.0b1/tests/test_file_service_properties_async.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/tests/perfstress_tests/upload.py
+Filename: azure-storage-file-share-12.9.0b1/tests/test_directory.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/tests/perfstress_tests/download_to_file.py
+Filename: azure-storage-file-share-12.9.0b1/tests/settings/settings_fake.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/tests/perfstress_tests/download.py
+Filename: azure-storage-file-share-12.9.0b1/tests/settings/__init__.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/tests/perfstress_tests/_test_base.py
+Filename: azure-storage-file-share-12.9.0b1/tests/settings/testcase.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/tests/perfstress_tests/__init__.py
+Filename: azure-storage-file-share-12.9.0b1/tests/perfstress_tests/T1_legacy_tests/
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/tests/perfstress_tests/upload_from_file.py
+Filename: azure-storage-file-share-12.9.0b1/tests/perfstress_tests/upload_from_file.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/tests/perfstress_tests/T1_legacy_tests/upload.py
+Filename: azure-storage-file-share-12.9.0b1/tests/perfstress_tests/_test_base.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/tests/perfstress_tests/T1_legacy_tests/download_to_file.py
+Filename: azure-storage-file-share-12.9.0b1/tests/perfstress_tests/download.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/tests/perfstress_tests/T1_legacy_tests/download.py
+Filename: azure-storage-file-share-12.9.0b1/tests/perfstress_tests/download_to_file.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/tests/perfstress_tests/T1_legacy_tests/_test_base.py
+Filename: azure-storage-file-share-12.9.0b1/tests/perfstress_tests/upload.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/tests/perfstress_tests/T1_legacy_tests/__init__.py
+Filename: azure-storage-file-share-12.9.0b1/tests/perfstress_tests/__init__.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/tests/perfstress_tests/T1_legacy_tests/upload_from_file.py
+Filename: azure-storage-file-share-12.9.0b1/tests/perfstress_tests/T1_legacy_tests/upload_from_file.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure_storage_file_share.egg-info/requires.txt
+Filename: azure-storage-file-share-12.9.0b1/tests/perfstress_tests/T1_legacy_tests/_test_base.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure_storage_file_share.egg-info/SOURCES.txt
+Filename: azure-storage-file-share-12.9.0b1/tests/perfstress_tests/T1_legacy_tests/download.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure_storage_file_share.egg-info/not-zip-safe
+Filename: azure-storage-file-share-12.9.0b1/tests/perfstress_tests/T1_legacy_tests/download_to_file.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure_storage_file_share.egg-info/top_level.txt
+Filename: azure-storage-file-share-12.9.0b1/tests/perfstress_tests/T1_legacy_tests/upload.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure_storage_file_share.egg-info/dependency_links.txt
+Filename: azure-storage-file-share-12.9.0b1/tests/perfstress_tests/T1_legacy_tests/__init__.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/azure_storage_file_share.egg-info/PKG-INFO
+Filename: azure-storage-file-share-12.9.0b1/samples/file_samples_client.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/samples/file_samples_authentication_async.py
+Filename: azure-storage-file-share-12.9.0b1/samples/file_samples_authentication.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/samples/file_samples_hello_world_async.py
+Filename: azure-storage-file-share-12.9.0b1/samples/file_samples_directory_async.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/samples/file_samples_service.py
+Filename: azure-storage-file-share-12.9.0b1/samples/file_samples_share_async.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/samples/file_samples_service_async.py
+Filename: azure-storage-file-share-12.9.0b1/samples/file_samples_client_async.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/samples/file_samples_share.py
+Filename: azure-storage-file-share-12.9.0b1/samples/file_samples_service_async.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/samples/file_samples_client.py
+Filename: azure-storage-file-share-12.9.0b1/samples/file_samples_hello_world.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/samples/file_samples_hello_world.py
+Filename: azure-storage-file-share-12.9.0b1/samples/file_samples_directory.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/samples/file_samples_client_async.py
+Filename: azure-storage-file-share-12.9.0b1/samples/file_samples_authentication_async.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/samples/file_samples_share_async.py
+Filename: azure-storage-file-share-12.9.0b1/samples/README.md
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/samples/README.md
+Filename: azure-storage-file-share-12.9.0b1/samples/file_samples_service.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/samples/file_samples_directory_async.py
+Filename: azure-storage-file-share-12.9.0b1/samples/file_samples_share.py
 Comment: 
 
-Filename: azure-storage-file-share-12.9.0/samples/file_samples_directory.py
-Comment: 
-
-Filename: azure-storage-file-share-12.9.0/samples/file_samples_authentication.py
+Filename: azure-storage-file-share-12.9.0b1/samples/file_samples_hello_world_async.py
 Comment: 
 
 Zip file comment:
```

## Comparing `azure-storage-file-share-12.9.0/setup.py` & `azure-storage-file-share-12.9.0b1/setup.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/CHANGELOG.md` & `azure-storage-file-share-12.9.0b1/CHANGELOG.md`

 * *Files 0% similar despite different names*

```diff
@@ -1,15 +1,9 @@
 # Release History
 
-## 12.9.0 (2022-07-07)
-
-### Features Added
-- Stable release of features from 12.9.0b1.
-- Added support for progress tracking to `upload_file()` and `download_file()` via a new optional callback, `progress_hook`.
-
 ## 12.9.0b1 (2022-06-15)
 
 ### Features Added
 - Added support for `file_change_time` to `start_copy_from_url` API
 
 ## 12.8.0 (2022-05-09)
```

## Comparing `azure-storage-file-share-12.9.0/README.md` & `azure-storage-file-share-12.9.0b1/README.md`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/PKG-INFO` & `azure-storage-file-share-12.9.0b1/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: azure-storage-file-share
-Version: 12.9.0
+Version: 12.9.0b1
 Summary: Microsoft Azure Azure File Share Storage Client Library for Python
 Home-page: https://github.com/Azure/azure-sdk-for-python/tree/main/sdk/storage/azure-storage-file-share
 Author: Microsoft Corporation
 Author-email: ascl@microsoft.com
 License: MIT License
 Description: # Azure Storage File Share client library for Python
         Azure File Share storage offers fully managed file shares in the cloud that are accessible via the industry standard [Server Message Block (SMB) protocol](https://docs.microsoft.com/windows/desktop/FileIO/microsoft-smb-protocol-and-cifs-protocol-overview). Azure file shares can be mounted concurrently by cloud or on-premises deployments of Windows, Linux, and macOS. Additionally, Azure file shares can be cached on Windows Servers with Azure File Sync for fast access near where the data is being used.
@@ -390,20 +390,14 @@
         When you submit a pull request, a CLA-bot will automatically determine whether you need to provide a CLA and decorate the PR appropriately (e.g., label, comment). Simply follow the instructions provided by the bot. You will only need to do this once across all repos using our CLA.
         
         This project has adopted the [Microsoft Open Source Code of Conduct](https://opensource.microsoft.com/codeofconduct/). For more information see the [Code of Conduct FAQ](https://opensource.microsoft.com/codeofconduct/faq/) or contact [opencode@microsoft.com](mailto:opencode@microsoft.com) with any additional questions or comments.
         
         
         # Release History
         
-        ## 12.9.0 (2022-07-07)
-        
-        ### Features Added
-        - Stable release of features from 12.9.0b1.
-        - Added support for progress tracking to `upload_file()` and `download_file()` via a new optional callback, `progress_hook`.
-        
         ## 12.9.0b1 (2022-06-15)
         
         ### Features Added
         - Added support for `file_change_time` to `start_copy_from_url` API
         
         ## 12.8.0 (2022-05-09)
```

## Comparing `azure-storage-file-share-12.9.0/LICENSE` & `azure-storage-file-share-12.9.0b1/LICENSE`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_file_client.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_file_client.py`

 * *Files 2% similar despite different names*

```diff
@@ -62,15 +62,14 @@
         max_concurrency,
         file_settings,
         file_attributes="none",
         file_creation_time="now",
         file_last_write_time="now",
         file_permission=None,
         file_permission_key=None,
-        progress_hook=None,
         **kwargs):
     try:
         if size is None or size < 0:
             raise ValueError("A content size must be specified for a File.")
         response = client.create_file(
             size,
             content_settings=content_settings,
@@ -90,15 +89,14 @@
             service=client,
             uploader_class=FileChunkUploader,
             total_size=size,
             chunk_size=file_settings.max_range_size,
             stream=stream,
             max_concurrency=max_concurrency,
             validate_content=validate_content,
-            progress_hook=progress_hook,
             timeout=timeout,
             **kwargs
         )
         return sorted(responses, key=lambda r: r.get('last_modified'))[-1]
     except HttpResponseError as error:
         process_storage_error(error)
 
@@ -385,14 +383,17 @@
                 :dedent: 12
                 :caption: Create a file.
         """
         access_conditions = get_access_conditions(kwargs.pop('lease', None))
         content_settings = kwargs.pop('content_settings', None)
         metadata = kwargs.pop('metadata', None)
         timeout = kwargs.pop('timeout', None)
+        if self.require_encryption and not self.key_encryption_key:
+            raise ValueError("Encryption required but no key was provided.")
+
         headers = kwargs.pop('headers', {})
         headers.update(add_metadata_headers(metadata))
         file_http_headers = None
         if content_settings:
             file_http_headers = FileHTTPHeaders(
                 file_cache_control=content_settings.cache_control,
                 file_content_type=content_settings.content_type,
@@ -487,19 +488,14 @@
         :keyword lease:
             Required if the file has an active lease. Value can be a ShareLeaseClient object
             or the lease ID as a string.
 
             .. versionadded:: 12.1.0
 
         :paramtype lease: ~azure.storage.fileshare.ShareLeaseClient or str
-        :keyword progress_hook:
-            A callback to track the progress of a long running upload. The signature is
-            function(current: int, total: Optional[int]) where current is the number of bytes transferred
-            so far, and total is the size of the blob or None if the size is unknown.
-        :paramtype progress_hook: Callable[[int, Optional[int]], None]
         :keyword int timeout:
             The timeout parameter is expressed in seconds.
         :keyword str encoding:
             Defaults to UTF-8.
         :returns: File-updated property dict (Etag and last modified).
         :rtype: dict(str, Any)
 
@@ -512,17 +508,18 @@
                 :dedent: 12
                 :caption: Upload a file.
         """
         metadata = kwargs.pop('metadata', None)
         content_settings = kwargs.pop('content_settings', None)
         max_concurrency = kwargs.pop('max_concurrency', 1)
         validate_content = kwargs.pop('validate_content', False)
-        progress_hook = kwargs.pop('progress_hook', None)
         timeout = kwargs.pop('timeout', None)
         encoding = kwargs.pop('encoding', 'UTF-8')
+        if self.require_encryption or (self.key_encryption_key is not None):
+            raise ValueError("Encryption not supported.")
 
         if isinstance(data, six.text_type):
             data = data.encode(encoding)
         if length is None:
             length = get_length(data)
         if isinstance(data, bytes):
             data = data[:length]
@@ -546,15 +543,14 @@
             max_concurrency,
             self._config,
             file_attributes=file_attributes,
             file_creation_time=file_creation_time,
             file_last_write_time=file_last_write_time,
             file_permission=file_permission,
             file_permission_key=permission_key,
-            progress_hook=progress_hook,
             **kwargs)
 
     @distributed_trace
     def start_copy_from_url(self, source_url, **kwargs):
         # type: (str, Any) -> Any
         """Initiates the copying of data from a source URL into the file
         referenced by the client.
@@ -745,47 +741,45 @@
         :keyword lease:
             Required if the file has an active lease. Value can be a ShareLeaseClient object
             or the lease ID as a string.
 
             .. versionadded:: 12.1.0
 
         :paramtype lease: ~azure.storage.fileshare.ShareLeaseClient or str
-        :keyword progress_hook:
-            A callback to track the progress of a long running download. The signature is
-            function(current: int, total: int) where current is the number of bytes transferred
-            so far, and total is the total size of the download.
-        :paramtype progress_hook: Callable[[int, int], None]
         :keyword int timeout:
             The timeout parameter is expressed in seconds.
         :returns: A streaming object (StorageStreamDownloader)
         :rtype: ~azure.storage.fileshare.StorageStreamDownloader
 
         .. admonition:: Example:
 
             .. literalinclude:: ../samples/file_samples_client.py
                 :start-after: [START download_file]
                 :end-before: [END download_file]
                 :language: python
                 :dedent: 12
                 :caption: Download a file.
         """
+        if self.require_encryption or (self.key_encryption_key is not None):
+            raise ValueError("Encryption not supported.")
         if length is not None and offset is None:
             raise ValueError("Offset value must not be None if length is set.")
 
         range_end = None
         if length is not None:
             range_end = offset + length - 1  # Service actually uses an end-range inclusive index
 
         access_conditions = get_access_conditions(kwargs.pop('lease', None))
 
         return StorageStreamDownloader(
             client=self._client.file,
             config=self._config,
             start_range=offset,
             end_range=range_end,
+            encryption_options=None,
             name=self.file_name,
             path='/'.join(self.file_path),
             share=self.share_name,
             lease_access_conditions=access_conditions,
             cls=deserialize_file_stream,
             **kwargs)
 
@@ -900,15 +894,16 @@
         else:
             new_file_sas = self._query_str.strip('?')
 
         new_file_client = ShareFileClient(
             '{}://{}'.format(self.scheme, self.primary_hostname), self.share_name, new_file_path,
             credential=new_file_sas or self.credential, api_version=self.api_version,
             _hosts=self._hosts, _configuration=self._config, _pipeline=self._pipeline,
-            _location_mode=self._location_mode
+            _location_mode=self._location_mode, require_encryption=self.require_encryption,
+            key_encryption_key=self.key_encryption_key, key_resolver_function=self.key_resolver_function
         )
 
         kwargs.update(get_rename_smb_properties(kwargs))
 
         file_http_headers = None
         content_type = kwargs.pop('content_type', None)
         if content_type:
@@ -1149,14 +1144,16 @@
         :returns: File-updated property dict (Etag and last modified).
         :rtype: Dict[str, Any]
         """
         validate_content = kwargs.pop('validate_content', False)
         timeout = kwargs.pop('timeout', None)
         encoding = kwargs.pop('encoding', 'UTF-8')
         file_last_write_mode = kwargs.pop('file_last_write_mode', None)
+        if self.require_encryption or (self.key_encryption_key is not None):
+            raise ValueError("Encryption not supported.")
         if isinstance(data, six.text_type):
             data = data.encode(encoding)
 
         end_range = offset + length - 1  # Reformat to an inclusive range index
         content_range = 'bytes={0}-{1}'.format(offset, end_range)
         access_conditions = get_access_conditions(kwargs.pop('lease', None))
         try:
@@ -1295,14 +1292,16 @@
     def _get_ranges_options( # type: ignore
             self, offset=None, # type: Optional[int]
             length=None, # type: Optional[int]
             previous_sharesnapshot=None,  # type: Optional[Union[str, Dict[str, Any]]]
             **kwargs
         ):
         # type: (...) -> Dict[str, Any]
+        if self.require_encryption or (self.key_encryption_key is not None):
+            raise ValueError("Unsupported method for encryption.")
         access_conditions = get_access_conditions(kwargs.pop('lease', None))
 
         content_range = None
         if offset is not None:
             if length is not None:
                 end_range = offset + length - 1  # Reformat to an inclusive range index
                 content_range = 'bytes={0}-{1}'.format(offset, end_range)
@@ -1430,14 +1429,16 @@
         :keyword int timeout:
             The timeout parameter is expressed in seconds.
         :returns: File-updated property dict (Etag and last modified).
         :rtype: Dict[str, Any]
         """
         access_conditions = get_access_conditions(kwargs.pop('lease', None))
         timeout = kwargs.pop('timeout', None)
+        if self.require_encryption or (self.key_encryption_key is not None):
+            raise ValueError("Unsupported method for encryption.")
 
         if offset is None or offset % 512 != 0:
             raise ValueError("offset must be an integer that aligns with 512 bytes file size")
         if length is None or length % 512 != 0:
             raise ValueError("length must be an integer that aligns with 512 bytes file size")
         end_range = length + offset - 1  # Reformat to an inclusive range index
         content_range = 'bytes={0}-{1}'.format(offset, end_range)
```

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_parser.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_parser.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_lease.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_lease.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_share_service_client.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_share_service_client.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_directory_client.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_directory_client.py`

 * *Files 0% similar despite different names*

```diff
@@ -437,15 +437,16 @@
         else:
             new_dir_sas = self._query_str.strip('?')
 
         new_directory_client = ShareDirectoryClient(
             '{}://{}'.format(self.scheme, self.primary_hostname), self.share_name, new_dir_path,
             credential=new_dir_sas or self.credential, api_version=self.api_version,
             _hosts=self._hosts, _configuration=self._config, _pipeline=self._pipeline,
-            _location_mode=self._location_mode
+            _location_mode=self._location_mode, require_encryption=self.require_encryption,
+            key_encryption_key=self.key_encryption_key, key_resolver_function=self.key_resolver_function
         )
 
         kwargs.update(get_rename_smb_properties(kwargs))
 
         timeout = kwargs.pop('timeout', None)
         overwrite = kwargs.pop('overwrite', None)
         metadata = kwargs.pop('metadata', None)
@@ -841,19 +842,14 @@
             service checks the hash of the content that has arrived with the hash
             that was sent. This is primarily valuable for detecting bitflips on
             the wire if using http instead of https as https (the default) will
             already validate. Note that this MD5 hash is not stored with the
             file.
         :keyword int max_concurrency:
             Maximum number of parallel connections to use.
-        :keyword progress_hook:
-            A callback to track the progress of a long running upload. The signature is
-            function(current: int, total: Optional[int]) where current is the number of bytes transferred
-            so far, and total is the size of the blob or None if the size is unknown.
-        :paramtype progress_hook: Callable[[int, Optional[int]], None]
         :keyword int timeout:
             The timeout parameter is expressed in seconds.
         :keyword str encoding:
             Defaults to UTF-8.
         :returns: ShareFileClient
         :rtype: ~azure.storage.fileshare.ShareFileClient
```

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_download.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_download.py`

 * *Files 11% similar despite different names*

```diff
@@ -8,41 +8,78 @@
 import threading
 import warnings
 from io import BytesIO
 from typing import Iterator
 
 from azure.core.exceptions import HttpResponseError, ResourceModifiedError
 from azure.core.tracing.common import with_current_context
+from ._shared.encryption import decrypt_blob
 from ._shared.request_handlers import validate_and_format_range_headers
 from ._shared.response_handlers import process_storage_error, parse_length_from_content_range
 
 
-def process_content(data):
+def process_range_and_offset(start_range, end_range, length, encryption):
+    start_offset, end_offset = 0, 0
+    if encryption.get("key") is not None or encryption.get("resolver") is not None:
+        if start_range is not None:
+            # Align the start of the range along a 16 byte block
+            start_offset = start_range % 16
+            start_range -= start_offset
+
+            # Include an extra 16 bytes for the IV if necessary
+            # Because of the previous offsetting, start_range will always
+            # be a multiple of 16.
+            if start_range > 0:
+                start_offset += 16
+                start_range -= 16
+
+        if length is not None:
+            # Align the end of the range along a 16 byte block
+            end_offset = 15 - (end_range % 16)
+            end_range += end_offset
+
+    return (start_range, end_range), (start_offset, end_offset)
+
+
+def process_content(data, start_offset, end_offset, encryption):
     if data is None:
         raise ValueError("Response cannot be None.")
-
     try:
-        return b"".join(list(data))
+        content = b"".join(list(data))
     except Exception as error:
         raise HttpResponseError(message="Download stream interrupted.", response=data.response, error=error)
+    if content and encryption.get("key") is not None or encryption.get("resolver") is not None:
+        try:
+            return decrypt_blob(
+                encryption.get("required"),
+                encryption.get("key"),
+                encryption.get("resolver"),
+                content,
+                start_offset,
+                end_offset,
+                data.response.headers,
+            )
+        except Exception as error:
+            raise HttpResponseError(message="Decryption failed.", response=data.response, error=error)
+    return content
 
 
 class _ChunkDownloader(object):  # pylint: disable=too-many-instance-attributes
     def __init__(
         self,
         client=None,
         total_size=None,
         chunk_size=None,
         current_progress=None,
         start_range=None,
         end_range=None,
         stream=None,
         parallel=None,
         validate_content=None,
-        progress_hook=None,
+        encryption_options=None,
         etag=None,
         **kwargs
     ):
         self.client = client
         self.etag = etag
         # Information on the download range/chunk size
         self.chunk_size = chunk_size
@@ -50,23 +87,25 @@
         self.start_index = start_range
         self.end_index = end_range
 
         # The destination that we will write to
         self.stream = stream
         self.stream_lock = threading.Lock() if parallel else None
         self.progress_lock = threading.Lock() if parallel else None
-        self.progress_hook = progress_hook
 
         # For a parallel download, the stream is always seekable, so we note down the current position
         # in order to seek to the right place when out-of-order chunks come in
         self.stream_start = stream.tell() if parallel else None
 
         # Download progress so far
         self.progress_total = current_progress
 
+        # Encryption
+        self.encryption_options = encryption_options
+
         # Parameters for each get operation
         self.validate_content = validate_content
         self.request_options = kwargs
 
     def _calculate_range(self, chunk_start):
         if chunk_start + self.chunk_size > self.end_index:
             chunk_end = self.end_index
@@ -95,28 +134,28 @@
     def _update_progress(self, length):
         if self.progress_lock:
             with self.progress_lock:  # pylint: disable=not-context-manager
                 self.progress_total += length
         else:
             self.progress_total += length
 
-        if self.progress_hook:
-            self.progress_hook(self.progress_total, self.total_size)
-
     def _write_to_stream(self, chunk_data, chunk_start):
         if self.stream_lock:
             with self.stream_lock:  # pylint: disable=not-context-manager
                 self.stream.seek(self.stream_start + (chunk_start - self.start_index))
                 self.stream.write(chunk_data)
         else:
             self.stream.write(chunk_data)
 
     def _download_chunk(self, chunk_start, chunk_end):
+        download_range, offset = process_range_and_offset(
+            chunk_start, chunk_end, chunk_end, self.encryption_options
+        )
         range_header, range_validation = validate_and_format_range_headers(
-            chunk_start, chunk_end, check_content_md5=self.validate_content
+            download_range[0], download_range[1], check_content_md5=self.validate_content
         )
 
         try:
             _, response = self.client.download(
                 range=range_header,
                 range_get_content_md5=range_validation,
                 validate_content=self.validate_content,
@@ -126,15 +165,15 @@
             )
             if response.properties.etag != self.etag:
                 raise ResourceModifiedError(message="The file has been modified while downloading.")
 
         except HttpResponseError as error:
             process_storage_error(error)
 
-        chunk_data = process_content(response)
+        chunk_data = process_content(response, offset[0], offset[1], self.encryption_options)
         return chunk_data
 
 
 class _ChunkIterator(object):
     """Async iterator for chunks in blob download stream."""
 
     def __init__(self, size, content, downloader, chunk_size):
@@ -208,14 +247,15 @@
     def __init__(
         self,
         client=None,
         config=None,
         start_range=None,
         end_range=None,
         validate_content=None,
+        encryption_options=None,
         max_concurrency=1,
         name=None,
         path=None,
         share=None,
         encoding=None,
         **kwargs
     ):
@@ -228,15 +268,15 @@
         self._client = client
         self._config = config
         self._start_range = start_range
         self._end_range = end_range
         self._max_concurrency = max_concurrency
         self._encoding = encoding
         self._validate_content = validate_content
-        self._progress_hook = kwargs.pop('progress_hook', None)
+        self._encryption_options = encryption_options or {}
         self._request_options = kwargs
         self._location_mode = None
         self._download_complete = False
         self._current_content = None
         self._file_size = None
         self._response = None
         self._etag = None
@@ -249,15 +289,17 @@
         )
         initial_request_start = self._start_range if self._start_range is not None else 0
         if self._end_range is not None and self._end_range - self._start_range < self._first_get_size:
             initial_request_end = self._end_range
         else:
             initial_request_end = initial_request_start + self._first_get_size - 1
 
-        self._initial_range = (initial_request_start, initial_request_end)
+        self._initial_range, self._initial_offset = process_range_and_offset(
+            initial_request_start, initial_request_end, self._end_range, self._encryption_options
+        )
 
         self._response = self._initial_request()
         self.properties = self._response.properties
         self.properties.name = self.name
         self.properties.path = self.path
         self.properties.share = self.share
 
@@ -276,15 +318,20 @@
         # of the stored MD5
         # TODO: Set to the stored MD5 when the service returns this
         self.properties.content_md5 = None
 
         if self.size == 0:
             self._current_content = b""
         else:
-            self._current_content = process_content(self._response)
+            self._current_content = process_content(
+                self._response,
+                self._initial_offset[0],
+                self._initial_offset[1],
+                self._encryption_options
+            )
 
     def __len__(self):
         return self.size
 
     def _initial_request(self):
         range_header, range_validation = validate_and_format_range_headers(
             self._initial_range[0],
@@ -366,14 +413,15 @@
                 chunk_size=self._config.max_chunk_get_size,
                 current_progress=self._first_get_size,
                 start_range=self._initial_range[1] + 1,  # start where the first download ended
                 end_range=data_end,
                 stream=None,
                 parallel=False,
                 validate_content=self._validate_content,
+                encryption_options=self._encryption_options,
                 use_location=self._location_mode,
                 etag=self._etag,
                 **self._request_options
             )
         return _ChunkIterator(
             size=self.size,
             content=self._current_content,
@@ -448,17 +496,14 @@
             try:
                 stream.seek(stream.tell())
             except (NotImplementedError, AttributeError):
                 raise ValueError(error_message)
 
         # Write the content to the user stream
         stream.write(self._current_content)
-        if self._progress_hook:
-            self._progress_hook(len(self._current_content), self.size)
-
         if self._download_complete:
             return self.size
 
         data_end = self._file_size
         if self._end_range is not None:
             # Use the length unless it is over the end of the file
             data_end = min(self._file_size, self._end_range + 1)
@@ -469,16 +514,16 @@
             chunk_size=self._config.max_chunk_get_size,
             current_progress=self._first_get_size,
             start_range=self._initial_range[1] + 1,  # Start where the first download ended
             end_range=data_end,
             stream=stream,
             parallel=parallel,
             validate_content=self._validate_content,
+            encryption_options=self._encryption_options,
             use_location=self._location_mode,
-            progress_hook=self._progress_hook,
             etag=self._etag,
             **self._request_options
         )
         if parallel:
             import concurrent.futures
             with concurrent.futures.ThreadPoolExecutor(self._max_concurrency) as executor:
                 list(executor.map(
```

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared_access_signature.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared_access_signature.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_share_client.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_share_client.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_deserialize.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_deserialize.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_models.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_models.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/__init__.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/__init__.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_serialize.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_serialize.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/aio/_directory_client_async.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/aio/_directory_client_async.py`

 * *Files 2% similar despite different names*

```diff
@@ -286,21 +286,14 @@
         :paramtype file_attributes:~azure.storage.fileshare.NTFSAttributes or str
         :keyword file_creation_time:
             Creation time for the directory.
         :paramtype file_creation_time:~datetime.datetime or str
         :keyword file_last_write_time:
             Last write time for the file.
         :paramtype file_last_write_time:~datetime.datetime or str
-        :keyword file_change_time:
-            Change time for the directory. If not specified, change time will be set to the current date/time.
-
-            .. versionadded:: 12.8.0
-                This parameter was introduced in API version '2021-06-08'.
-
-        :paramtype file_change_time: str or ~datetime.datetime
         :keyword Dict[str,str] metadata:
             A name-value pair to associate with a file storage object.
         :keyword destination_lease:
             Required if the destination file has an active lease. Value can be a ShareLeaseClient object
             or the lease ID as a string.
         :paramtype destination_lease: ~azure.storage.fileshare.ShareLeaseClient or str
         :returns: The new Directory Client.
@@ -317,15 +310,16 @@
         else:
             new_dir_sas = self._query_str.strip('?')
 
         new_directory_client = ShareDirectoryClient(
             '{}://{}'.format(self.scheme, self.primary_hostname), self.share_name, new_dir_path,
             credential=new_dir_sas or self.credential, api_version=self.api_version,
             _hosts=self._hosts, _configuration=self._config, _pipeline=self._pipeline,
-            _location_mode=self._location_mode
+            _location_mode=self._location_mode, require_encryption=self.require_encryption,
+            key_encryption_key=self.key_encryption_key, key_resolver_function=self.key_resolver_function
         )
 
         kwargs.update(get_rename_smb_properties(kwargs))
 
         timeout = kwargs.pop('timeout', None)
         overwrite = kwargs.pop('overwrite', None)
         metadata = kwargs.pop('metadata', None)
@@ -721,19 +715,14 @@
             service checks the hash of the content that has arrived with the hash
             that was sent. This is primarily valuable for detecting bitflips on
             the wire if using http instead of https as https (the default) will
             already validate. Note that this MD5 hash is not stored with the
             file.
         :keyword int max_concurrency:
             Maximum number of parallel connections to use.
-        :keyword progress_hook:
-            An async callback to track the progress of a long running upload. The signature is
-            function(current: int, total: Optional[int]) where current is the number of bytes transferred
-            so far, and total is the size of the blob or None if the size is unknown.
-        :paramtype progress_hook: Callable[[int, Optional[int]], Awaitable[None]]
         :keyword int timeout:
             The timeout parameter is expressed in seconds.
         :keyword str encoding:
             Defaults to UTF-8.
         :returns: ShareFileClient
         :rtype: ~azure.storage.fileshare.aio.ShareFileClient
```

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/aio/_lease_async.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/aio/_lease_async.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/aio/_share_client_async.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/aio/_share_client_async.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/aio/_file_client_async.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/aio/_file_client_async.py`

 * *Files 2% similar despite different names*

```diff
@@ -55,15 +55,14 @@
     max_concurrency,
     file_settings,
     file_attributes="none",
     file_creation_time="now",
     file_last_write_time="now",
     file_permission=None,
     file_permission_key=None,
-    progress_hook=None,
     **kwargs
 ):
     try:
         if size is None or size < 0:
             raise ValueError("A content size must be specified for a File.")
         response = await client.create_file(
             size, content_settings=content_settings, metadata=metadata,
@@ -82,15 +81,14 @@
             service=client,
             uploader_class=FileChunkUploader,
             total_size=size,
             chunk_size=file_settings.max_range_size,
             stream=stream,
             max_concurrency=max_concurrency,
             validate_content=validate_content,
-            progress_hook=progress_hook,
             timeout=timeout,
             **kwargs
         )
         return sorted(responses, key=lambda r: r.get('last_modified'))[-1]
     except HttpResponseError as error:
         process_storage_error(error)
 
@@ -253,14 +251,17 @@
                 :dedent: 16
                 :caption: Create a file.
         """
         access_conditions = get_access_conditions(kwargs.pop('lease', None))
         content_settings = kwargs.pop('content_settings', None)
         metadata = kwargs.pop('metadata', None)
         timeout = kwargs.pop('timeout', None)
+        if self.require_encryption and not self.key_encryption_key:
+            raise ValueError("Encryption required but no key was provided.")
+
         headers = kwargs.pop("headers", {})
         headers.update(add_metadata_headers(metadata))
         file_http_headers = None
         if content_settings:
             file_http_headers = FileHTTPHeaders(
                 file_cache_control=content_settings.cache_control,
                 file_content_type=content_settings.content_type,
@@ -358,19 +359,14 @@
         :keyword lease:
             Required if the file has an active lease. Value can be a ShareLeaseClient object
             or the lease ID as a string.
 
             .. versionadded:: 12.1.0
 
         :paramtype lease: ~azure.storage.fileshare.aio.ShareLeaseClient or str
-        :keyword progress_hook:
-            An async callback to track the progress of a long running upload. The signature is
-            function(current: int, total: Optional[int]) where current is the number of bytes transferred
-            so far, and total is the size of the blob or None if the size is unknown.
-        :paramtype progress_hook: Callable[[int, Optional[int]], Awaitable[None]]
         :keyword int timeout:
             The timeout parameter is expressed in seconds.
         :returns: File-updated property dict (Etag and last modified).
         :rtype: dict(str, Any)
 
         .. admonition:: Example:
 
@@ -381,17 +377,18 @@
                 :dedent: 16
                 :caption: Upload a file.
         """
         metadata = kwargs.pop('metadata', None)
         content_settings = kwargs.pop('content_settings', None)
         max_concurrency = kwargs.pop('max_concurrency', 1)
         validate_content = kwargs.pop('validate_content', False)
-        progress_hook = kwargs.pop('progress_hook', None)
         timeout = kwargs.pop('timeout', None)
         encoding = kwargs.pop('encoding', 'UTF-8')
+        if self.require_encryption or (self.key_encryption_key is not None):
+            raise ValueError("Encryption not supported.")
 
         if isinstance(data, six.text_type):
             data = data.encode(encoding)
         if length is None:
             length = get_length(data)
         if isinstance(data, bytes):
             data = data[:length]
@@ -415,15 +412,14 @@
             max_concurrency,
             self._config,
             file_attributes=file_attributes,
             file_creation_time=file_creation_time,
             file_last_write_time=file_last_write_time,
             file_permission=file_permission,
             file_permission_key=permission_key,
-            progress_hook=progress_hook,
             **kwargs
         )
 
     @distributed_trace_async
     async def start_copy_from_url(self, source_url, **kwargs):
         # type: (str, Any) -> Any
         """Initiates the copying of data from a source URL into the file
@@ -618,47 +614,45 @@
         :keyword lease:
             Required if the file has an active lease. Value can be a ShareLeaseClient object
             or the lease ID as a string.
 
             .. versionadded:: 12.1.0
 
         :paramtype lease: ~azure.storage.fileshare.aio.ShareLeaseClient or str
-        :keyword progress_hook:
-            An async callback to track the progress of a long running download. The signature is
-            function(current: int, total: int) where current is the number of bytes transferred
-            so far, and total is the size of the blob or None if the size is unknown.
-        :paramtype progress_hook: Callable[[int, int], Awaitable[None]]
         :keyword int timeout:
             The timeout parameter is expressed in seconds.
         :returns: A streaming object (StorageStreamDownloader)
         :rtype: ~azure.storage.fileshare.aio.StorageStreamDownloader
 
         .. admonition:: Example:
 
             .. literalinclude:: ../samples/file_samples_client_async.py
                 :start-after: [START download_file]
                 :end-before: [END download_file]
                 :language: python
                 :dedent: 16
                 :caption: Download a file.
         """
+        if self.require_encryption or (self.key_encryption_key is not None):
+            raise ValueError("Encryption not supported.")
         if length is not None and offset is None:
             raise ValueError("Offset value must not be None if length is set.")
 
         range_end = None
         if length is not None:
             range_end = offset + length - 1  # Service actually uses an end-range inclusive index
 
         access_conditions = get_access_conditions(kwargs.pop('lease', None))
 
         downloader = StorageStreamDownloader(
             client=self._client.file,
             config=self._config,
             start_range=offset,
             end_range=range_end,
+            encryption_options=None,
             name=self.file_name,
             path='/'.join(self.file_path),
             share=self.share_name,
             lease_access_conditions=access_conditions,
             cls=deserialize_file_stream,
             **kwargs
         )
@@ -776,15 +770,16 @@
         else:
             new_file_sas = self._query_str.strip('?')
 
         new_file_client = ShareFileClient(
             '{}://{}'.format(self.scheme, self.primary_hostname), self.share_name, new_file_path,
             credential=new_file_sas or self.credential, api_version=self.api_version,
             _hosts=self._hosts, _configuration=self._config, _pipeline=self._pipeline,
-            _location_mode=self._location_mode
+            _location_mode=self._location_mode, require_encryption=self.require_encryption,
+            key_encryption_key=self.key_encryption_key, key_resolver_function=self.key_resolver_function
         )
 
         kwargs.update(get_rename_smb_properties(kwargs))
 
         file_http_headers = None
         content_type = kwargs.pop('content_type', None)
         if content_type:
@@ -1025,14 +1020,16 @@
         :returns: File-updated property dict (Etag and last modified).
         :rtype: Dict[str, Any]
         """
         validate_content = kwargs.pop('validate_content', False)
         timeout = kwargs.pop('timeout', None)
         encoding = kwargs.pop('encoding', 'UTF-8')
         file_last_write_mode = kwargs.pop('file_last_write_mode', None)
+        if self.require_encryption or (self.key_encryption_key is not None):
+            raise ValueError("Encryption not supported.")
         if isinstance(data, six.text_type):
             data = data.encode(encoding)
         end_range = offset + length - 1  # Reformat to an inclusive range index
         content_range = 'bytes={0}-{1}'.format(offset, end_range)
         access_conditions = get_access_conditions(kwargs.pop('lease', None))
         try:
             return await self._client.file.upload_range(  # type: ignore
@@ -1237,14 +1234,16 @@
         :keyword int timeout:
             The timeout parameter is expressed in seconds.
         :returns: File-updated property dict (Etag and last modified).
         :rtype: Dict[str, Any]
         """
         access_conditions = get_access_conditions(kwargs.pop('lease', None))
         timeout = kwargs.pop('timeout', None)
+        if self.require_encryption or (self.key_encryption_key is not None):
+            raise ValueError("Unsupported method for encryption.")
 
         if offset is None or offset % 512 != 0:
             raise ValueError("offset must be an integer that aligns with 512 bytes file size")
         if length is None or length % 512 != 0:
             raise ValueError("length must be an integer that aligns with 512 bytes file size")
         end_range = length + offset - 1  # Reformat to an inclusive range index
         content_range = "bytes={0}-{1}".format(offset, end_range)
```

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/aio/_download_async.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/aio/_download_async.py`

 * *Files 5% similar despite different names*

```diff
@@ -2,33 +2,49 @@
 # Copyright (c) Microsoft Corporation. All rights reserved.
 # Licensed under the MIT License. See License.txt in the project root for
 # license information.
 # --------------------------------------------------------------------------
 # pylint: disable=invalid-overridden-method
 import asyncio
 import sys
-import warnings
 from io import BytesIO
 from itertools import islice
-from typing import AsyncIterator
+import warnings
 
+from typing import AsyncIterator
 from azure.core.exceptions import HttpResponseError, ResourceModifiedError
-from .._download import _ChunkDownloader
+from .._shared.encryption import decrypt_blob
 from .._shared.request_handlers import validate_and_format_range_headers
 from .._shared.response_handlers import process_storage_error, parse_length_from_content_range
+from .._download import process_range_and_offset, _ChunkDownloader
 
 
-async def process_content(data):
+async def process_content(data, start_offset, end_offset, encryption):
     if data is None:
         raise ValueError("Response cannot be None.")
-
     try:
-        return data.response.body()
+        content = data.response.body()
     except Exception as error:
         raise HttpResponseError(message="Download stream interrupted.", response=data.response, error=error)
+    if encryption.get('key') is not None or encryption.get('resolver') is not None:
+        try:
+            return decrypt_blob(
+                encryption.get('required'),
+                encryption.get('key'),
+                encryption.get('resolver'),
+                content,
+                start_offset,
+                end_offset,
+                data.response.headers)
+        except Exception as error:
+            raise HttpResponseError(
+                message="Decryption failed.",
+                response=data.response,
+                error=error)
+    return content
 
 
 class _AsyncChunkDownloader(_ChunkDownloader):
     def __init__(self, **kwargs):
         super(_AsyncChunkDownloader, self).__init__(**kwargs)
         self.stream_lock = asyncio.Lock() if kwargs.get('parallel') else None
         self.progress_lock = asyncio.Lock() if kwargs.get('parallel') else None
@@ -48,29 +64,29 @@
     async def _update_progress(self, length):
         if self.progress_lock:
             async with self.progress_lock:  # pylint: disable=not-async-context-manager
                 self.progress_total += length
         else:
             self.progress_total += length
 
-        if self.progress_hook:
-            await self.progress_hook(self.progress_total, self.total_size)
-
     async def _write_to_stream(self, chunk_data, chunk_start):
         if self.stream_lock:
             async with self.stream_lock:  # pylint: disable=not-async-context-manager
                 self.stream.seek(self.stream_start + (chunk_start - self.start_index))
                 self.stream.write(chunk_data)
         else:
             self.stream.write(chunk_data)
 
     async def _download_chunk(self, chunk_start, chunk_end):
+        download_range, offset = process_range_and_offset(
+            chunk_start, chunk_end, chunk_end, self.encryption_options
+        )
         range_header, range_validation = validate_and_format_range_headers(
-            chunk_start,
-            chunk_end,
+            download_range[0],
+            download_range[1],
             check_content_md5=self.validate_content
         )
         try:
             _, response = await self.client.download(
                 range=range_header,
                 range_get_content_md5=range_validation,
                 validate_content=self.validate_content,
@@ -79,15 +95,15 @@
                 **self.request_options
             )
             if response.properties.etag != self.etag:
                 raise ResourceModifiedError(message="The file has been modified while downloading.")
         except HttpResponseError as error:
             process_storage_error(error)
 
-        chunk_data = await process_content(response)
+        chunk_data = await process_content(response, offset[0], offset[1], self.encryption_options)
         return chunk_data
 
 
 class _AsyncChunkIterator(object):
     """Async iterator for chunks in blob download stream."""
 
     def __init__(self, size, content, downloader, chunk_size):
@@ -163,14 +179,15 @@
     def __init__(
             self,
             client=None,
             config=None,
             start_range=None,
             end_range=None,
             validate_content=None,
+            encryption_options=None,
             max_concurrency=1,
             name=None,
             path=None,
             share=None,
             encoding=None,
             **kwargs
     ):
@@ -183,15 +200,15 @@
         self._client = client
         self._config = config
         self._start_range = start_range
         self._end_range = end_range
         self._max_concurrency = max_concurrency
         self._encoding = encoding
         self._validate_content = validate_content
-        self._progress_hook = kwargs.pop('progress_hook', None)
+        self._encryption_options = encryption_options or {}
         self._request_options = kwargs
         self._location_mode = None
         self._download_complete = False
         self._current_content = None
         self._file_size = None
         self._response = None
         self._etag = None
@@ -203,15 +220,17 @@
             else self._config.max_chunk_get_size
         initial_request_start = self._start_range if self._start_range is not None else 0
         if self._end_range is not None and self._end_range - self._start_range < self._first_get_size:
             initial_request_end = self._end_range
         else:
             initial_request_end = initial_request_start + self._first_get_size - 1
 
-        self._initial_range = (initial_request_start, initial_request_end)
+        self._initial_range, self._initial_offset = process_range_and_offset(
+            initial_request_start, initial_request_end, self._end_range, self._encryption_options
+        )
 
     def __len__(self):
         return self.size
 
     async def _setup(self):
         self._response = await self._initial_request()
         self.properties = self._response.properties
@@ -234,15 +253,20 @@
         # of the stored MD5
         # TODO: Set to the stored MD5 when the service returns this
         self.properties.content_md5 = None
 
         if self.size == 0:
             self._current_content = b""
         else:
-            self._current_content = await process_content(self._response)
+            self._current_content = await process_content(
+                self._response,
+                self._initial_offset[0],
+                self._initial_offset[1],
+                self._encryption_options
+            )
 
     async def _initial_request(self):
         range_header, range_validation = validate_and_format_range_headers(
             self._initial_range[0],
             self._initial_range[1],
             start_range_required=False,
             end_range_required=False,
@@ -318,14 +342,15 @@
                 chunk_size=self._config.max_chunk_get_size,
                 current_progress=self._first_get_size,
                 start_range=self._initial_range[1] + 1,  # Start where the first download ended
                 end_range=data_end,
                 stream=None,
                 parallel=False,
                 validate_content=self._validate_content,
+                encryption_options=self._encryption_options,
                 use_location=self._location_mode,
                 etag=self._etag,
                 **self._request_options)
         return _AsyncChunkIterator(
             size=self.size,
             content=self._current_content,
             downloader=iter_downloader,
@@ -400,17 +425,14 @@
             try:
                 stream.seek(stream.tell())
             except (NotImplementedError, AttributeError):
                 raise ValueError(error_message)
 
         # Write the content to the user stream
         stream.write(self._current_content)
-        if self._progress_hook:
-            await self._progress_hook(len(self._current_content), self.size)
-
         if self._download_complete:
             return self.size
 
         data_end = self._file_size
         if self._end_range is not None:
             # Use the length unless it is over the end of the file
             data_end = min(self._file_size, self._end_range + 1)
@@ -421,16 +443,16 @@
             chunk_size=self._config.max_chunk_get_size,
             current_progress=self._first_get_size,
             start_range=self._initial_range[1] + 1,  # start where the first download ended
             end_range=data_end,
             stream=stream,
             parallel=parallel,
             validate_content=self._validate_content,
+            encryption_options=self._encryption_options,
             use_location=self._location_mode,
-            progress_hook=self._progress_hook,
             etag=self._etag,
             **self._request_options)
 
         dl_tasks = downloader.get_chunk_offsets()
         running_futures = [
             asyncio.ensure_future(downloader.process_chunk(d))
             for d in islice(dl_tasks, 0, self._max_concurrency)
```

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/aio/_share_service_client_async.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/aio/_share_service_client_async.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/aio/_models.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/aio/_models.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/aio/__init__.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/aio/__init__.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/_azure_file_storage.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/_azure_file_storage.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/_patch.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/_patch.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/_configuration.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/_configuration.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/__init__.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/__init__.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/_vendor.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/_vendor.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/models/_models_py3.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/models/_models_py3.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/models/_azure_file_storage_enums.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/models/_azure_file_storage_enums.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/models/_models.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/models/_models.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/models/__init__.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/models/__init__.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/aio/_azure_file_storage.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/aio/_azure_file_storage.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/aio/_patch.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/aio/_patch.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/aio/_configuration.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/aio/_configuration.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/aio/__init__.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/aio/__init__.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/aio/operations/_service_operations.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/aio/operations/_service_operations.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/aio/operations/_directory_operations.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/aio/operations/_directory_operations.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/aio/operations/_share_operations.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/aio/operations/_share_operations.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/aio/operations/_file_operations.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/aio/operations/_file_operations.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/aio/operations/__init__.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/aio/operations/__init__.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/operations/_service_operations.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/operations/_service_operations.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/operations/_directory_operations.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/operations/_directory_operations.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/operations/_share_operations.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/operations/_share_operations.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/operations/_file_operations.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/operations/_file_operations.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_generated/operations/__init__.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_generated/operations/__init__.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/request_handlers.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/request_handlers.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/authentication.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/authentication.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/shared_access_signature.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/shared_access_signature.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/models.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/models.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/parser.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/parser.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/uploads_async.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/uploads_async.py`

 * *Files 2% similar despite different names*

```diff
@@ -2,27 +2,33 @@
 # Copyright (c) Microsoft Corporation. All rights reserved.
 # Licensed under the MIT License. See License.txt in the project root for
 # license information.
 # --------------------------------------------------------------------------
 # pylint: disable=no-self-use
 
 import asyncio
-import threading
 from asyncio import Lock
 from itertools import islice
+import threading
+
 from math import ceil
 
 import six
 
 from . import encode_base64, url_quote
 from .request_handlers import get_length
 from .response_handlers import return_response_headers
+from .encryption import get_blob_encryptor_and_padder
 from .uploads import SubStream, IterStreamer  # pylint: disable=unused-import
 
 
+_LARGE_BLOB_UPLOAD_MAX_READ_BUFFER_SIZE = 4 * 1024 * 1024
+_ERROR_VALUE_SHOULD_BE_SEEKABLE_STREAM = '{0} should be a seekable file-like/io.IOBase type stream object.'
+
+
 async def _parallel_uploads(uploader, pending, running):
     range_ids = []
     while True:
         # Wait for some download to finish before adding a new one
         done, running = await asyncio.wait(running, return_when=asyncio.FIRST_COMPLETED)
         range_ids.extend([chunk.result() for chunk in done])
         try:
@@ -42,17 +48,26 @@
 async def upload_data_chunks(
         service=None,
         uploader_class=None,
         total_size=None,
         chunk_size=None,
         max_concurrency=None,
         stream=None,
+        encryption_options=None,
         progress_hook=None,
         **kwargs):
 
+    if encryption_options:
+        encryptor, padder = get_blob_encryptor_and_padder(
+            encryption_options.get('cek'),
+            encryption_options.get('vector'),
+            uploader_class is not PageBlobChunkUploader)
+        kwargs['encryptor'] = encryptor
+        kwargs['padder'] = padder
+
     parallel = max_concurrency > 1
     if parallel and 'modified_access_conditions' in kwargs:
         # Access conditions do not work with parallelism
         kwargs['modified_access_conditions'] = None
 
     uploader = uploader_class(
         service=service,
@@ -133,14 +148,15 @@
         self.service = service
         self.total_size = total_size
         self.chunk_size = chunk_size
         self.stream = stream
         self.parallel = parallel
 
         # Stream management
+        self.stream_start = stream.tell() if parallel else None
         self.stream_lock = threading.Lock() if parallel else None
 
         # Progress feedback
         self.progress_total = 0
         self.progress_lock = Lock() if parallel else None
         self.progress_hook = progress_hook
 
@@ -197,15 +213,15 @@
         if self.progress_lock is not None:
             async with self.progress_lock:
                 self.progress_total += length
         else:
             self.progress_total += length
 
         if self.progress_hook:
-            await self.progress_hook(self.progress_total, self.total_size)
+            self.progress_hook(self.progress_total, self.total_size)
 
     async def _upload_chunk(self, chunk_offset, chunk_data):
         raise NotImplementedError("Must be implemented by child class.")
 
     async def _upload_chunk_with_progress(self, chunk_offset, chunk_data):
         range_id = await self._upload_chunk(chunk_offset, chunk_data)
         await self._update_progress(len(chunk_data))
```

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/policies.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/policies.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/uploads.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/uploads.py`

 * *Files 2% similar despite different names*

```diff
@@ -2,25 +2,27 @@
 # Copyright (c) Microsoft Corporation. All rights reserved.
 # Licensed under the MIT License. See License.txt in the project root for
 # license information.
 # --------------------------------------------------------------------------
 # pylint: disable=no-self-use
 
 from concurrent import futures
-from io import BytesIO, IOBase, SEEK_CUR, SEEK_END, SEEK_SET, UnsupportedOperation
+from io import (BytesIO, IOBase, SEEK_CUR, SEEK_END, SEEK_SET, UnsupportedOperation)
+from threading import Lock
 from itertools import islice
 from math import ceil
-from threading import Lock
 
 import six
+
 from azure.core.tracing.common import with_current_context
 
 from . import encode_base64, url_quote
 from .request_handlers import get_length
 from .response_handlers import return_response_headers
+from .encryption import get_blob_encryptor_and_padder
 
 
 _LARGE_BLOB_UPLOAD_MAX_READ_BUFFER_SIZE = 4 * 1024 * 1024
 _ERROR_VALUE_SHOULD_BE_SEEKABLE_STREAM = "{0} should be a seekable file-like/io.IOBase type stream object."
 
 
 def _parallel_uploads(executor, uploader, pending, running):
@@ -46,17 +48,26 @@
         service=None,
         uploader_class=None,
         total_size=None,
         chunk_size=None,
         max_concurrency=None,
         stream=None,
         validate_content=None,
+        encryption_options=None,
         progress_hook=None,
         **kwargs):
 
+    if encryption_options:
+        encryptor, padder = get_blob_encryptor_and_padder(
+            encryption_options.get('cek'),
+            encryption_options.get('vector'),
+            uploader_class is not PageBlobChunkUploader)
+        kwargs['encryptor'] = encryptor
+        kwargs['padder'] = padder
+
     parallel = max_concurrency > 1
     if parallel and 'modified_access_conditions' in kwargs:
         # Access conditions do not work with parallelism
         kwargs['modified_access_conditions'] = None
 
     uploader = uploader_class(
         service=service,
@@ -134,14 +145,15 @@
         self.service = service
         self.total_size = total_size
         self.chunk_size = chunk_size
         self.stream = stream
         self.parallel = parallel
 
         # Stream management
+        self.stream_start = stream.tell() if parallel else None
         self.stream_lock = Lock() if parallel else None
 
         # Progress feedback
         self.progress_total = 0
         self.progress_lock = Lock() if parallel else None
         self.progress_hook = progress_hook
```

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/base_client_async.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/base_client_async.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/response_handlers.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/response_handlers.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/base_client.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/base_client.py`

 * *Files 1% similar despite different names*

```diff
@@ -99,14 +99,17 @@
             if len(account) > 1:
                 secondary_hostname = parsed_url.netloc.replace(account[0], account[0] + "-secondary")
             if kwargs.get("secondary_hostname"):
                 secondary_hostname = kwargs["secondary_hostname"]
             primary_hostname = (parsed_url.netloc + parsed_url.path).rstrip('/')
             self._hosts = {LocationMode.PRIMARY: primary_hostname, LocationMode.SECONDARY: secondary_hostname}
 
+        self.require_encryption = kwargs.get("require_encryption", False)
+        self.key_encryption_key = kwargs.get("key_encryption_key")
+        self.key_resolver_function = kwargs.get("key_resolver_function")
         self._config, self._pipeline = self._create_pipeline(self.credential, storage_sdk=service, **kwargs)
 
     def __enter__(self):
         self._client.__enter__()
         return self
 
     def __exit__(self, *args):
```

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/constants.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/constants.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/__init__.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/__init__.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure/storage/fileshare/_shared/policies_async.py` & `azure-storage-file-share-12.9.0b1/azure/storage/fileshare/_shared/policies_async.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/tests/test_file_service_properties_async.py` & `azure-storage-file-share-12.9.0b1/tests/test_file_service_properties_async.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/tests/test_file_api_version_async.py` & `azure-storage-file-share-12.9.0b1/tests/test_file_api_version_async.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/tests/test_get_file_async.py` & `azure-storage-file-share-12.9.0b1/tests/test_get_file_async.py`

 * *Files 1% similar despite different names*

```diff
@@ -3,37 +3,35 @@
 # -------------------------------------------------------------------------
 # Copyright (c) Microsoft Corporation. All rights reserved.
 # Licensed under the MIT License. See License.txt in the project root for
 # license information.
 # --------------------------------------------------------------------------
 import base64
 import os
+import unittest
+import asyncio
 import uuid
-from io import BytesIO
 
 import pytest
-from azure.core.exceptions import HttpResponseError, ResourceModifiedError
 from azure.core.pipeline.transport import AioHttpTransport
+from multidict import CIMultiDict, CIMultiDictProxy
+from azure.core.exceptions import HttpResponseError, ResourceModifiedError
 from azure.storage.fileshare import FileProperties
 from azure.storage.fileshare.aio import (
     ShareFileClient,
     ShareServiceClient,
 )
-from multidict import CIMultiDict, CIMultiDictProxy
-
-from devtools_testutils.storage.aio import AsyncStorageTestCase
 from settings.testcase import FileSharePreparer
-from test_helpers_async import ProgressTracker
-
+from devtools_testutils.storage.aio import AsyncStorageTestCase
 # ------------------------------------------------------------------------------
 TEST_FILE_PREFIX = 'file'
 FILE_PATH = 'file_output.temp.{}.dat'.format(str(uuid.uuid4()))
-# ------------------------------------------------------------------------------
 
 
+# ------------------------------------------------------------------------------
 class AiohttpTestTransport(AioHttpTransport):
     """Workaround to vcrpy bug: https://github.com/kevin1024/vcrpy/pull/461
     """
     async def send(self, request, **config):
         response = await super(AiohttpTestTransport, self).send(request, **config)
         if not isinstance(response.headers, CIMultiDictProxy):
             response.headers = CIMultiDictProxy(CIMultiDict(response.internal_response.headers))
@@ -1445,118 +1443,7 @@
 
         # Act
         props = await file_client.get_file_properties()
 
         # Assert
         self.assertTrue(props.server_encrypted)
 
-    @FileSharePreparer()
-    async def test_get_file_progress_single_get(self, storage_account_name, storage_account_key):
-        # Arrange
-        await self._setup(storage_account_name, storage_account_key)
-
-        file_name = self._get_file_reference()
-        file = ShareFileClient(
-            self.account_url(storage_account_name, "file"),
-            share_name=self.share_name,
-            file_path=self.directory_name + '/' + file_name,
-            credential=storage_account_key)
-
-        data = b'a' * 512
-        await file.upload_file(data)
-
-        progress = ProgressTracker(len(data), len(data))
-
-        # Act
-        await (await file.download_file(progress_hook=progress.assert_progress)).readall()
-
-        # Assert
-        progress.assert_complete()
-
-    @FileSharePreparer()
-    async def test_get_file_progress_chunked(self, storage_account_name, storage_account_key):
-        # Arrange
-        await self._setup(storage_account_name, storage_account_key)
-
-        file_name = self._get_file_reference()
-        file = ShareFileClient(
-            self.account_url(storage_account_name, "file"),
-            share_name=self.share_name,
-            file_path=self.directory_name + '/' + file_name,
-            credential=storage_account_key,
-            max_single_get_size=1024,
-            max_chunk_get_size=1024)
-
-        data = b'a' * 5120
-        await file.upload_file(data)
-
-        progress = ProgressTracker(len(data), 1024)
-
-        # Act
-        await (await file.download_file(progress_hook=progress.assert_progress)).readall()
-
-        # Assert
-        progress.assert_complete()
-
-    @pytest.mark.live_test_only
-    @FileSharePreparer()
-    async def test_get_file_progress_chunked_parallel(self, storage_account_name, storage_account_key):
-        # parallel tests introduce random order of requests, can only run live
-        # Arrange
-        await self._setup(storage_account_name, storage_account_key)
-
-        file_name = self._get_file_reference()
-        file = ShareFileClient(
-            self.account_url(storage_account_name, "file"),
-            share_name=self.share_name,
-            file_path=self.directory_name + '/' + file_name,
-            credential=storage_account_key,
-            max_single_get_size=1024,
-            max_chunk_get_size=1024)
-
-        data = b'a' * 5120
-        await file.upload_file(data)
-
-        progress = ProgressTracker(len(data), 1024)
-
-        # Act
-        await (await file.download_file(max_concurrency=3, progress_hook=progress.assert_progress)).readall()
-
-        # Assert
-        progress.assert_complete()
-
-    @pytest.mark.live_test_only
-    @FileSharePreparer()
-    async def test_get_file_progress_range_readinto(self, storage_account_name, storage_account_key):
-        # parallel tests introduce random order of requests, can only run live
-        # Arrange
-        await self._setup(storage_account_name, storage_account_key)
-
-        file_name = self._get_file_reference()
-        file = ShareFileClient(
-            self.account_url(storage_account_name, "file"),
-            share_name=self.share_name,
-            file_path=self.directory_name + '/' + file_name,
-            credential=storage_account_key,
-            max_single_get_size=1024,
-            max_chunk_get_size=1024)
-
-        data = b'a' * 5120
-        await file.upload_file(data)
-
-        length = 4096
-        progress = ProgressTracker(length, 1024)
-        result = BytesIO()
-
-        # Act
-        stream = await file.download_file(
-            offset=512,
-            length=length,
-            max_concurrency=3,
-            progress_hook=progress.assert_progress
-        )
-        read = await stream.readinto(result)
-
-        # Assert
-        progress.assert_complete()
-        self.assertEqual(length, read)
-
```

## Comparing `azure-storage-file-share-12.9.0/tests/test_file.py` & `azure-storage-file-share-12.9.0b1/tests/test_file.py`

 * *Files 0% similar despite different names*

```diff
@@ -3,56 +3,58 @@
 # -------------------------------------------------------------------------
 # Copyright (c) Microsoft Corporation. All rights reserved.
 # Licensed under the MIT License. See License.txt in the project root for
 # license information.
 # --------------------------------------------------------------------------
 import base64
 import os
+import unittest
 from datetime import datetime, timedelta
 
-import pytest
 import requests
+import pytest
 import uuid
 from azure.core import MatchConditions
 from azure.core.credentials import AzureSasCredential
+
 from azure.core.exceptions import HttpResponseError, ResourceNotFoundError, ResourceExistsError
 from azure.storage.blob import BlobServiceClient
+from devtools_testutils import ResourceGroupPreparer, StorageAccountPreparer
 from azure.storage.fileshare import (
     generate_account_sas,
     generate_file_sas,
     generate_share_sas,
     ShareFileClient,
     ShareServiceClient,
     ContentSettings,
     FileSasPermissions,
     ShareSasPermissions,
     AccessPolicy,
     ResourceTypes,
     AccountSasPermissions,
     StorageErrorCode,
     NTFSAttributes)
-
-from settings.testcase import FileSharePreparer
+from azure.storage.fileshare._parser import _datetime_to_str
 from devtools_testutils.storage import StorageTestCase
-from test_helpers import ProgressTracker
-
+from settings.testcase import FileSharePreparer
 # ------------------------------------------------------------------------------
 TEST_SHARE_PREFIX = 'share'
 TEST_BLOB_PREFIX = 'blob'
 TEST_DIRECTORY_PREFIX = 'dir'
 TEST_FILE_PREFIX = 'file'
 INPUT_FILE_PATH = 'file_input.temp.{}.dat'.format(str(uuid.uuid4()))
 OUTPUT_FILE_PATH = 'file_output.temp.{}.dat'.format(str(uuid.uuid4()))
 LARGE_FILE_SIZE = 64 * 1024 + 5
 TEST_FILE_PERMISSIONS = 'O:S-1-5-21-2127521184-1604012920-1887927527-21560751G:S-1-5-21-2127521184-' \
                         '1604012920-1887927527-513D:AI(A;;FA;;;SY)(A;;FA;;;BA)(A;;0x1200a9;;;' \
                         'S-1-5-21-397955417-626881126-188441444-3053964)'
-# ------------------------------------------------------------------------------
 
 
+# ------------------------------------------------------------------------------
+
 class StorageFileTest(StorageTestCase):
     def _setup(self, storage_account_name, storage_account_key, rmt_account=None, rmt_key=None):
         super(StorageFileTest, self).setUp()
 
         url = self.account_url(storage_account_name, "file")
         blob_url = self.account_url(storage_account_name, "blob")
         credential = storage_account_key
@@ -1980,58 +1982,14 @@
             max_range_size=4 * 1024)
 
         # Act
         file_client.upload_file(data, validate_content=True, max_concurrency=2)
 
         # Assert
 
-    @FileSharePreparer()
-    def test_create_file_progress(self, storage_account_name, storage_account_key):
-        self._setup(storage_account_name, storage_account_key)
-
-        file_name = self._get_file_reference()
-        file_client = ShareFileClient(
-            self.account_url(storage_account_name, "file"),
-            share_name=self.share_name,
-            file_path=file_name,
-            credential=storage_account_key,
-            max_range_size=1024)
-
-        data = b'a' * 5 * 1024
-        progress = ProgressTracker(len(data), 1024)
-
-        # Act
-        file_client.upload_file(data, progress_hook=progress.assert_progress)
-
-        # Assert
-        progress.assert_complete()
-
-    @pytest.mark.live_test_only
-    @FileSharePreparer()
-    def test_create_file_progress_parallel(self, storage_account_name, storage_account_key):
-        # parallel tests introduce random order of requests, can only run live
-        self._setup(storage_account_name, storage_account_key)
-
-        file_name = self._get_file_reference()
-        file_client = ShareFileClient(
-            self.account_url(storage_account_name, "file"),
-            share_name=self.share_name,
-            file_path=file_name,
-            credential=storage_account_key,
-            max_range_size=1024)
-
-        data = b'a' * 5 * 1024
-        progress = ProgressTracker(len(data), 1024)
-
-        # Act
-        file_client.upload_file(data, progress_hook=progress.assert_progress, max_concurrency=3)
-
-        # Assert
-        progress.assert_complete()
-
     # --Test cases for sas & acl ------------------------------------------------
     @FileSharePreparer()
     def test_sas_access_file(self, storage_account_name, storage_account_key):
         # SAS URL is calculated from storage key, so this test runs live only
         if not self.is_live:
             return
```

## Comparing `azure-storage-file-share-12.9.0/tests/test_file_client_async.py` & `azure-storage-file-share-12.9.0b1/tests/test_file_client_async.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/tests/test_handle.py` & `azure-storage-file-share-12.9.0b1/tests/test_handle.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/tests/test_share_async.py` & `azure-storage-file-share-12.9.0b1/tests/test_share_async.py`

 * *Files 0% similar despite different names*

```diff
@@ -255,30 +255,30 @@
         await lease.renew()
 
         # Assert
         self.assertEqual(lease.id, lease_id_start)
         self.sleep(5)
         with self.assertRaises(HttpResponseError):
             await share_client.delete_share()
-        self.sleep(12)
+        self.sleep(10)
         await share_client.delete_share()
 
     @FileSharePreparer()
     @AsyncStorageTestCase.await_prepared_test
     async def test_lease_share_with_duration(self, storage_account_name, storage_account_key):
         self._setup(storage_account_name, storage_account_key)
         share_client = await self._create_share('test')
 
         # Act
         lease = await share_client.acquire_lease(lease_duration=15)
 
         # Assert
         with self.assertRaises(HttpResponseError):
             await share_client.acquire_lease()
-        self.sleep(17)
+        self.sleep(15)
         await share_client.acquire_lease()
 
     @FileSharePreparer()
     @AsyncStorageTestCase.await_prepared_test
     async def test_lease_share_twice(self, storage_account_name, storage_account_key):
         self._setup(storage_account_name, storage_account_key)
         share_client = await self._create_share('test')
```

## Comparing `azure-storage-file-share-12.9.0/tests/conftest.py` & `azure-storage-file-share-12.9.0b1/tests/conftest.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/tests/test_directory_async.py` & `azure-storage-file-share-12.9.0b1/tests/test_directory_async.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/tests/test_file_service_properties.py` & `azure-storage-file-share-12.9.0b1/tests/test_file_service_properties.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/tests/encryption_test_helper.py` & `azure-storage-file-share-12.9.0b1/tests/encryption_test_helper.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/tests/test_file_client.py` & `azure-storage-file-share-12.9.0b1/tests/test_file_client.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/tests/test_get_file.py` & `azure-storage-file-share-12.9.0b1/tests/test_get_file.py`

 * *Files 2% similar despite different names*

```diff
@@ -3,33 +3,33 @@
 # -------------------------------------------------------------------------
 # Copyright (c) Microsoft Corporation. All rights reserved.
 # Licensed under the MIT License. See License.txt in the project root for
 # license information.
 # --------------------------------------------------------------------------
 import base64
 import os
+import unittest
 import uuid
-from io import BytesIO
 
 import pytest
 from azure.core.exceptions import HttpResponseError, ResourceModifiedError
+
 from azure.storage.fileshare import (
     ShareFileClient,
-    ShareServiceClient
+    ShareServiceClient,
+    FileProperties
 )
-
 from devtools_testutils.storage import StorageTestCase
 from settings.testcase import FileSharePreparer
-from test_helpers import ProgressTracker
 
 # ------------------------------------------------------------------------------
 TEST_FILE_PREFIX = 'file'
 FILE_PATH = 'file_output.temp.{}.dat'.format(str(uuid.uuid4()))
-# ------------------------------------------------------------------------------
 
+# ------------------------------------------------------------------------------
 
 class StorageGetFileTest(StorageTestCase):
     def _setup(self, storage_account_name, storage_account_key):
         # test chunking functionality by reducing the threshold
         # for chunking and the size of each chunk, otherwise
         # the tests would take too long to execute
         self.MAX_SINGLE_GET_SIZE = 32 * 1024
@@ -1310,115 +1310,9 @@
 
         # Act
         props = file_client.get_file_properties()
 
         # Assert
         self.assertTrue(props.server_encrypted)
 
-    @FileSharePreparer()
-    def test_get_file_progress_single_get(self, storage_account_name, storage_account_key):
-        self._setup(storage_account_name, storage_account_key)
-
-        file_name = self._get_file_reference()
-        file = ShareFileClient(
-            self.account_url(storage_account_name, "file"),
-            share_name=self.share_name,
-            file_path=self.directory_name + '/' + file_name,
-            credential=storage_account_key)
-
-        data = b'a' * 512
-        file.upload_file(data)
-
-        progress = ProgressTracker(len(data), len(data))
-
-        # Act
-        file.download_file(progress_hook=progress.assert_progress).readall()
-
-        # Assert
-        progress.assert_complete()
-
-    @FileSharePreparer()
-    def test_get_file_progress_chunked(self, storage_account_name, storage_account_key):
-        self._setup(storage_account_name, storage_account_key)
-
-        file_name = self._get_file_reference()
-        file = ShareFileClient(
-            self.account_url(storage_account_name, "file"),
-            share_name=self.share_name,
-            file_path=self.directory_name + '/' + file_name,
-            credential=storage_account_key,
-            max_single_get_size=1024,
-            max_chunk_get_size=1024)
-
-        data = b'a' * 5120
-        file.upload_file(data)
-
-        progress = ProgressTracker(len(data), 1024)
-
-        # Act
-        file.download_file(progress_hook=progress.assert_progress).readall()
-
-        # Assert
-        progress.assert_complete()
-
-    @pytest.mark.live_test_only
-    @FileSharePreparer()
-    def test_get_file_progress_chunked_parallel(self, storage_account_name, storage_account_key):
-        # parallel tests introduce random order of requests, can only run live
-        self._setup(storage_account_name, storage_account_key)
-
-        file_name = self._get_file_reference()
-        file = ShareFileClient(
-            self.account_url(storage_account_name, "file"),
-            share_name=self.share_name,
-            file_path=self.directory_name + '/' + file_name,
-            credential=storage_account_key,
-            max_single_get_size=1024,
-            max_chunk_get_size=1024)
-
-        data = b'a' * 5120
-        file.upload_file(data)
-
-        progress = ProgressTracker(len(data), 1024)
-
-        # Act
-        file.download_file(max_concurrency=3, progress_hook=progress.assert_progress).readall()
-
-        # Assert
-        progress.assert_complete()
-
-    @pytest.mark.live_test_only
-    @FileSharePreparer()
-    def test_get_file_progress_range_readinto(self, storage_account_name, storage_account_key):
-        # parallel tests introduce random order of requests, can only run live
-        self._setup(storage_account_name, storage_account_key)
-
-        file_name = self._get_file_reference()
-        file = ShareFileClient(
-            self.account_url(storage_account_name, "file"),
-            share_name=self.share_name,
-            file_path=self.directory_name + '/' + file_name,
-            credential=storage_account_key,
-            max_single_get_size=1024,
-            max_chunk_get_size=1024)
-
-        data = b'a' * 5120
-        file.upload_file(data)
-
-        length = 4096
-        progress = ProgressTracker(length, 1024)
-        result = BytesIO()
-
-        # Act
-        stream = file.download_file(
-            offset=512,
-            length=length,
-            max_concurrency=3,
-            progress_hook=progress.assert_progress
-        )
-        read = stream.readinto(result)
-
-        # Assert
-        progress.assert_complete()
-        self.assertEqual(length, read)
 
 # ------------------------------------------------------------------------------
```

## Comparing `azure-storage-file-share-12.9.0/tests/test_directory.py` & `azure-storage-file-share-12.9.0b1/tests/test_directory.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/tests/test_handle_async.py` & `azure-storage-file-share-12.9.0b1/tests/test_handle_async.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/tests/test_share.py` & `azure-storage-file-share-12.9.0b1/tests/test_share.py`

 * *Files 0% similar despite different names*

```diff
@@ -241,29 +241,29 @@
         lease.renew()
 
         # Assert
         self.assertEqual(lease.id, lease_id_start)
         self.sleep(5)
         with self.assertRaises(HttpResponseError):
             share_client.delete_share()
-        self.sleep(12)
+        self.sleep(10)
         share_client.delete_share()
 
     @FileSharePreparer()
     def test_lease_share_with_duration(self, storage_account_name, storage_account_key):
         self._setup(storage_account_name, storage_account_key)
         share_client = self._create_share('test')
 
         # Act
         lease = share_client.acquire_lease(lease_duration=15)
 
         # Assert
         with self.assertRaises(HttpResponseError):
             share_client.acquire_lease()
-        self.sleep(17)
+        self.sleep(15)
         share_client.acquire_lease()
 
     @FileSharePreparer()
     def test_lease_share_twice(self, storage_account_name, storage_account_key):
         self._setup(storage_account_name, storage_account_key)
         share_client = self._create_share('test')
```

## Comparing `azure-storage-file-share-12.9.0/tests/test_file_async.py` & `azure-storage-file-share-12.9.0b1/tests/test_file_async.py`

 * *Files 1% similar despite different names*

```diff
@@ -15,7235 +15,7135 @@
 000000e0: 6f72 0a23 206c 6963 656e 7365 2069 6e66  or.# license inf
 000000f0: 6f72 6d61 7469 6f6e 2e0a 2320 2d2d 2d2d  ormation..# ----
 00000100: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00000110: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00000120: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00000130: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00000140: 2d2d 2d2d 2d2d 0a69 6d70 6f72 7420 6261  ------.import ba
-00000150: 7365 3634 0a69 6d70 6f72 7420 6f73 0a66  se64.import os.f
-00000160: 726f 6d20 6461 7465 7469 6d65 2069 6d70  rom datetime imp
-00000170: 6f72 7420 6461 7465 7469 6d65 2c20 7469  ort datetime, ti
-00000180: 6d65 6465 6c74 610a 0a69 6d70 6f72 7420  medelta..import 
-00000190: 7265 7175 6573 7473 0a69 6d70 6f72 7420  requests.import 
-000001a0: 7079 7465 7374 0a69 6d70 6f72 7420 7575  pytest.import uu
-000001b0: 6964 0a66 726f 6d20 617a 7572 652e 636f  id.from azure.co
-000001c0: 7265 2e63 7265 6465 6e74 6961 6c73 2069  re.credentials i
-000001d0: 6d70 6f72 7420 417a 7572 6553 6173 4372  mport AzureSasCr
-000001e0: 6564 656e 7469 616c 0a66 726f 6d20 617a  edential.from az
-000001f0: 7572 652e 636f 7265 2e65 7863 6570 7469  ure.core.excepti
-00000200: 6f6e 7320 696d 706f 7274 2048 7474 7052  ons import HttpR
-00000210: 6573 706f 6e73 6545 7272 6f72 2c20 5265  esponseError, Re
-00000220: 736f 7572 6365 4e6f 7446 6f75 6e64 4572  sourceNotFoundEr
-00000230: 726f 722c 2052 6573 6f75 7263 6545 7869  ror, ResourceExi
-00000240: 7374 7345 7272 6f72 0a66 726f 6d20 617a  stsError.from az
-00000250: 7572 652e 636f 7265 2e70 6970 656c 696e  ure.core.pipelin
-00000260: 652e 7472 616e 7370 6f72 7420 696d 706f  e.transport impo
-00000270: 7274 2041 696f 4874 7470 5472 616e 7370  rt AioHttpTransp
-00000280: 6f72 740a 6672 6f6d 2061 7a75 7265 2e73  ort.from azure.s
-00000290: 746f 7261 6765 2e62 6c6f 622e 6169 6f20  torage.blob.aio 
-000002a0: 696d 706f 7274 2042 6c6f 6253 6572 7669  import BlobServi
-000002b0: 6365 436c 6965 6e74 0a66 726f 6d20 617a  ceClient.from az
-000002c0: 7572 652e 7374 6f72 6167 652e 6669 6c65  ure.storage.file
-000002d0: 7368 6172 6520 696d 706f 7274 2028 0a20  share import (. 
-000002e0: 2020 2067 656e 6572 6174 655f 6163 636f     generate_acco
-000002f0: 756e 745f 7361 732c 0a20 2020 2067 656e  unt_sas,.    gen
-00000300: 6572 6174 655f 6669 6c65 5f73 6173 2c0a  erate_file_sas,.
-00000310: 2020 2020 6765 6e65 7261 7465 5f73 6861      generate_sha
-00000320: 7265 5f73 6173 2c0a 2020 2020 4e54 4653  re_sas,.    NTFS
-00000330: 4174 7472 6962 7574 6573 2c0a 2020 2020  Attributes,.    
-00000340: 436f 6e74 656e 7453 6574 7469 6e67 732c  ContentSettings,
-00000350: 0a20 2020 2046 696c 6553 6173 5065 726d  .    FileSasPerm
-00000360: 6973 7369 6f6e 732c 0a20 2020 2053 6861  issions,.    Sha
-00000370: 7265 5361 7350 6572 6d69 7373 696f 6e73  reSasPermissions
-00000380: 2c0a 2020 2020 4163 6365 7373 506f 6c69  ,.    AccessPoli
-00000390: 6379 2c0a 2020 2020 5265 736f 7572 6365  cy,.    Resource
-000003a0: 5479 7065 732c 0a20 2020 2041 6363 6f75  Types,.    Accou
-000003b0: 6e74 5361 7350 6572 6d69 7373 696f 6e73  ntSasPermissions
-000003c0: 2c0a 2020 2020 5374 6f72 6167 6545 7272  ,.    StorageErr
-000003d0: 6f72 436f 6465 290a 6672 6f6d 2061 7a75  orCode).from azu
-000003e0: 7265 2e73 746f 7261 6765 2e66 696c 6573  re.storage.files
-000003f0: 6861 7265 2e61 696f 2069 6d70 6f72 7420  hare.aio import 
-00000400: 280a 2020 2020 5368 6172 6546 696c 6543  (.    ShareFileC
-00000410: 6c69 656e 742c 0a20 2020 2053 6861 7265  lient,.    Share
-00000420: 5365 7276 6963 6543 6c69 656e 742c 0a29  ServiceClient,.)
-00000430: 0a66 726f 6d20 6d75 6c74 6964 6963 7420  .from multidict 
-00000440: 696d 706f 7274 2043 494d 756c 7469 4469  import CIMultiDi
-00000450: 6374 2c20 4349 4d75 6c74 6944 6963 7450  ct, CIMultiDictP
-00000460: 726f 7879 0a0a 6672 6f6d 2064 6576 746f  roxy..from devto
-00000470: 6f6c 735f 7465 7374 7574 696c 732e 7374  ols_testutils.st
-00000480: 6f72 6167 652e 6169 6f20 696d 706f 7274  orage.aio import
-00000490: 2041 7379 6e63 5374 6f72 6167 6554 6573   AsyncStorageTes
-000004a0: 7443 6173 650a 6672 6f6d 2073 6574 7469  tCase.from setti
-000004b0: 6e67 732e 7465 7374 6361 7365 2069 6d70  ngs.testcase imp
-000004c0: 6f72 7420 4669 6c65 5368 6172 6550 7265  ort FileSharePre
-000004d0: 7061 7265 720a 6672 6f6d 2074 6573 745f  parer.from test_
-000004e0: 6865 6c70 6572 735f 6173 796e 6320 696d  helpers_async im
-000004f0: 706f 7274 2050 726f 6772 6573 7354 7261  port ProgressTra
-00000500: 636b 6572 0a0a 2320 2d2d 2d2d 2d2d 2d2d  cker..# --------
-00000510: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00000520: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00000530: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00000540: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00000550: 2d2d 2d2d 2d2d 0a54 4553 545f 5348 4152  ------.TEST_SHAR
-00000560: 455f 5052 4546 4958 203d 2027 7368 6172  E_PREFIX = 'shar
-00000570: 6527 0a54 4553 545f 4449 5245 4354 4f52  e'.TEST_DIRECTOR
-00000580: 595f 5052 4546 4958 203d 2027 6469 7227  Y_PREFIX = 'dir'
-00000590: 0a54 4553 545f 4649 4c45 5f50 5245 4649  .TEST_FILE_PREFI
-000005a0: 5820 3d20 2766 696c 6527 0a54 4553 545f  X = 'file'.TEST_
-000005b0: 424c 4f42 5f50 5245 4649 5820 3d20 2762  BLOB_PREFIX = 'b
-000005c0: 6c6f 6227 0a49 4e50 5554 5f46 494c 455f  lob'.INPUT_FILE_
-000005d0: 5041 5448 203d 2027 6669 6c65 5f69 6e70  PATH = 'file_inp
-000005e0: 7574 2e74 656d 702e 7b7d 2e64 6174 272e  ut.temp.{}.dat'.
-000005f0: 666f 726d 6174 2873 7472 2875 7569 642e  format(str(uuid.
-00000600: 7575 6964 3428 2929 290a 4f55 5450 5554  uuid4())).OUTPUT
-00000610: 5f46 494c 455f 5041 5448 203d 2027 6669  _FILE_PATH = 'fi
-00000620: 6c65 5f6f 7574 7075 742e 7465 6d70 2e7b  le_output.temp.{
-00000630: 7d2e 6461 7427 2e66 6f72 6d61 7428 7374  }.dat'.format(st
-00000640: 7228 7575 6964 2e75 7569 6434 2829 2929  r(uuid.uuid4()))
-00000650: 0a4c 4152 4745 5f46 494c 455f 5349 5a45  .LARGE_FILE_SIZE
-00000660: 203d 2036 3420 2a20 3130 3234 202b 2035   = 64 * 1024 + 5
-00000670: 0a54 4553 545f 4649 4c45 5f50 4552 4d49  .TEST_FILE_PERMI
-00000680: 5353 494f 4e53 203d 2027 4f3a 532d 312d  SSIONS = 'O:S-1-
-00000690: 352d 3231 2d32 3132 3735 3231 3138 342d  5-21-2127521184-
-000006a0: 3136 3034 3031 3239 3230 2d31 3838 3739  1604012920-18879
-000006b0: 3237 3532 372d 3231 3536 3037 3531 473a  27527-21560751G:
-000006c0: 532d 312d 352d 3231 2d32 3132 3735 3231  S-1-5-21-2127521
-000006d0: 3138 342d 2720 5c0a 2020 2020 2020 2020  184-' \.        
-000006e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000006f0: 2731 3630 3430 3132 3932 302d 3138 3837  '1604012920-1887
-00000700: 3932 3735 3237 2d35 3133 443a 4149 2841  927527-513D:AI(A
-00000710: 3b3b 4641 3b3b 3b53 5929 2841 3b3b 4641  ;;FA;;;SY)(A;;FA
-00000720: 3b3b 3b42 4129 2841 3b3b 3078 3132 3030  ;;;BA)(A;;0x1200
-00000730: 6139 3b3b 3b27 205c 0a20 2020 2020 2020  a9;;;' \.       
-00000740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000750: 2027 532d 312d 352d 3231 2d33 3937 3935   'S-1-5-21-39795
-00000760: 3534 3137 2d36 3236 3838 3131 3236 2d31  5417-626881126-1
-00000770: 3838 3434 3134 3434 2d33 3035 3339 3634  88441444-3053964
-00000780: 2927 0a23 202d 2d2d 2d2d 2d2d 2d2d 2d2d  )'.# -----------
-00000790: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000007a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000007b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000007c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000007d0: 2d2d 2d0a 0a0a 636c 6173 7320 4169 6f68  ---...class Aioh
-000007e0: 7474 7054 6573 7454 7261 6e73 706f 7274  ttpTestTransport
-000007f0: 2841 696f 4874 7470 5472 616e 7370 6f72  (AioHttpTranspor
-00000800: 7429 3a0a 2020 2020 2222 2257 6f72 6b61  t):.    """Worka
-00000810: 726f 756e 6420 746f 2076 6372 7079 2062  round to vcrpy b
-00000820: 7567 3a20 6874 7470 733a 2f2f 6769 7468  ug: https://gith
-00000830: 7562 2e63 6f6d 2f6b 6576 696e 3130 3234  ub.com/kevin1024
-00000840: 2f76 6372 7079 2f70 756c 6c2f 3436 310a  /vcrpy/pull/461.
-00000850: 2020 2020 2222 220a 2020 2020 6173 796e      """.    asyn
-00000860: 6320 6465 6620 7365 6e64 2873 656c 662c  c def send(self,
-00000870: 2072 6571 7565 7374 2c20 2a2a 636f 6e66   request, **conf
-00000880: 6967 293a 0a20 2020 2020 2020 2072 6573  ig):.        res
-00000890: 706f 6e73 6520 3d20 6177 6169 7420 7375  ponse = await su
-000008a0: 7065 7228 4169 6f68 7474 7054 6573 7454  per(AiohttpTestT
-000008b0: 7261 6e73 706f 7274 2c20 7365 6c66 292e  ransport, self).
-000008c0: 7365 6e64 2872 6571 7565 7374 2c20 2a2a  send(request, **
-000008d0: 636f 6e66 6967 290a 2020 2020 2020 2020  config).        
-000008e0: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
-000008f0: 6528 7265 7370 6f6e 7365 2e68 6561 6465  e(response.heade
-00000900: 7273 2c20 4349 4d75 6c74 6944 6963 7450  rs, CIMultiDictP
-00000910: 726f 7879 293a 0a20 2020 2020 2020 2020  roxy):.         
-00000920: 2020 2072 6573 706f 6e73 652e 6865 6164     response.head
-00000930: 6572 7320 3d20 4349 4d75 6c74 6944 6963  ers = CIMultiDic
-00000940: 7450 726f 7879 2843 494d 756c 7469 4469  tProxy(CIMultiDi
-00000950: 6374 2872 6573 706f 6e73 652e 696e 7465  ct(response.inte
-00000960: 726e 616c 5f72 6573 706f 6e73 652e 6865  rnal_response.he
-00000970: 6164 6572 7329 290a 2020 2020 2020 2020  aders)).        
-00000980: 2020 2020 7265 7370 6f6e 7365 2e63 6f6e      response.con
-00000990: 7465 6e74 5f74 7970 6520 3d20 7265 7370  tent_type = resp
-000009a0: 6f6e 7365 2e68 6561 6465 7273 2e67 6574  onse.headers.get
-000009b0: 2822 636f 6e74 656e 742d 7479 7065 2229  ("content-type")
-000009c0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000009d0: 7265 7370 6f6e 7365 0a0a 0a63 6c61 7373  response...class
-000009e0: 2053 746f 7261 6765 4669 6c65 4173 796e   StorageFileAsyn
-000009f0: 6354 6573 7428 4173 796e 6353 746f 7261  cTest(AsyncStora
-00000a00: 6765 5465 7374 4361 7365 293a 0a20 2020  geTestCase):.   
-00000a10: 2064 6566 205f 7365 7475 7028 7365 6c66   def _setup(self
-00000a20: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
-00000a30: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
-00000a40: 6163 636f 756e 745f 6b65 792c 2072 6d74  account_key, rmt
-00000a50: 5f61 6363 6f75 6e74 3d4e 6f6e 652c 2072  _account=None, r
-00000a60: 6d74 5f6b 6579 3d4e 6f6e 6529 3a0a 2020  mt_key=None):.  
-00000a70: 2020 2020 2020 7572 6c20 3d20 7365 6c66        url = self
-00000a80: 2e61 6363 6f75 6e74 5f75 726c 2873 746f  .account_url(sto
-00000a90: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
-00000aa0: 652c 2022 6669 6c65 2229 0a20 2020 2020  e, "file").     
-00000ab0: 2020 2062 6c6f 625f 7572 6c20 3d20 7365     blob_url = se
-00000ac0: 6c66 2e61 6363 6f75 6e74 5f75 726c 2873  lf.account_url(s
-00000ad0: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
-00000ae0: 616d 652c 2022 626c 6f62 2229 0a20 2020  ame, "blob").   
-00000af0: 2020 2020 2063 7265 6465 6e74 6961 6c20       credential 
-00000b00: 3d20 7374 6f72 6167 655f 6163 636f 756e  = storage_accoun
-00000b10: 745f 6b65 790a 0a20 2020 2020 2020 2023  t_key..        #
-00000b20: 2074 6573 7420 6368 756e 6b69 6e67 2066   test chunking f
-00000b30: 756e 6374 696f 6e61 6c69 7479 2062 7920  unctionality by 
-00000b40: 7265 6475 6369 6e67 2074 6865 2074 6872  reducing the thr
-00000b50: 6573 686f 6c64 0a20 2020 2020 2020 2023  eshold.        #
-00000b60: 2066 6f72 2063 6875 6e6b 696e 6720 616e   for chunking an
-00000b70: 6420 7468 6520 7369 7a65 206f 6620 6561  d the size of ea
-00000b80: 6368 2063 6875 6e6b 2c20 6f74 6865 7277  ch chunk, otherw
-00000b90: 6973 650a 2020 2020 2020 2020 2320 7468  ise.        # th
-00000ba0: 6520 7465 7374 7320 776f 756c 6420 7461  e tests would ta
-00000bb0: 6b65 2074 6f6f 206c 6f6e 6720 746f 2065  ke too long to e
-00000bc0: 7865 6375 7465 0a20 2020 2020 2020 2073  xecute.        s
-00000bd0: 656c 662e 6673 6320 3d20 5368 6172 6553  elf.fsc = ShareS
-00000be0: 6572 7669 6365 436c 6965 6e74 280a 2020  erviceClient(.  
-00000bf0: 2020 2020 2020 2020 2020 7572 6c2c 2063            url, c
-00000c00: 7265 6465 6e74 6961 6c3d 6372 6564 656e  redential=creden
-00000c10: 7469 616c 2c20 6d61 785f 7261 6e67 655f  tial, max_range_
-00000c20: 7369 7a65 3d34 202a 2031 3032 3429 0a20  size=4 * 1024). 
-00000c30: 2020 2020 2020 2073 656c 662e 6273 6320         self.bsc 
-00000c40: 3d20 426c 6f62 5365 7276 6963 6543 6c69  = BlobServiceCli
-00000c50: 656e 7428 626c 6f62 5f75 726c 2c20 6372  ent(blob_url, cr
-00000c60: 6564 656e 7469 616c 3d63 7265 6465 6e74  edential=credent
-00000c70: 6961 6c29 0a20 2020 2020 2020 2073 656c  ial).        sel
-00000c80: 662e 736f 7572 6365 5f63 6f6e 7461 696e  f.source_contain
-00000c90: 6572 5f6e 616d 6520 3d20 7365 6c66 2e67  er_name = self.g
-00000ca0: 6574 5f72 6573 6f75 7263 655f 6e61 6d65  et_resource_name
-00000cb0: 2827 736f 7572 6365 7368 6172 6527 290a  ('sourceshare').
-00000cc0: 2020 2020 2020 2020 7365 6c66 2e73 6861          self.sha
-00000cd0: 7265 5f6e 616d 6520 3d20 7365 6c66 2e67  re_name = self.g
-00000ce0: 6574 5f72 6573 6f75 7263 655f 6e61 6d65  et_resource_name
-00000cf0: 2827 7574 7368 6172 6527 290a 2020 2020  ('utshare').    
-00000d00: 2020 2020 7365 6c66 2e73 686f 7274 5f62      self.short_b
-00000d10: 7974 655f 6461 7461 203d 2073 656c 662e  yte_data = self.
-00000d20: 6765 745f 7261 6e64 6f6d 5f62 7974 6573  get_random_bytes
-00000d30: 2831 3032 3429 0a0a 2020 2020 2020 2020  (1024)..        
-00000d40: 7265 6d6f 7465 5f75 726c 203d 2073 656c  remote_url = sel
-00000d50: 662e 6163 636f 756e 745f 7572 6c28 726d  f.account_url(rm
-00000d60: 745f 6163 636f 756e 742c 2022 6669 6c65  t_account, "file
-00000d70: 2229 0a20 2020 2020 2020 2072 656d 6f74  ").        remot
-00000d80: 655f 6372 6564 656e 7469 616c 203d 2072  e_credential = r
-00000d90: 6d74 5f6b 6579 0a20 2020 2020 2020 2069  mt_key.        i
-00000da0: 6620 726d 745f 6163 636f 756e 743a 0a20  f rmt_account:. 
-00000db0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00000dc0: 6673 6332 203d 2053 6861 7265 5365 7276  fsc2 = ShareServ
-00000dd0: 6963 6543 6c69 656e 7428 7265 6d6f 7465  iceClient(remote
-00000de0: 5f75 726c 2c20 6372 6564 656e 7469 616c  _url, credential
-00000df0: 3d72 656d 6f74 655f 6372 6564 656e 7469  =remote_credenti
-00000e00: 616c 2c20 7472 616e 7370 6f72 743d 4169  al, transport=Ai
-00000e10: 6f68 7474 7054 6573 7454 7261 6e73 706f  ohttpTestTranspo
-00000e20: 7274 2829 290a 2020 2020 2020 2020 2020  rt()).          
-00000e30: 2020 7365 6c66 2e72 656d 6f74 655f 7368    self.remote_sh
-00000e40: 6172 655f 6e61 6d65 203d 204e 6f6e 650a  are_name = None.
-00000e50: 0a20 2020 2064 6566 205f 7465 6172 646f  .    def _teardo
-00000e60: 776e 2873 656c 662c 2046 494c 455f 5041  wn(self, FILE_PA
-00000e70: 5448 293a 0a20 2020 2020 2020 2069 6620  TH):.        if 
-00000e80: 6f73 2e70 6174 682e 6973 6669 6c65 2846  os.path.isfile(F
-00000e90: 494c 455f 5041 5448 293a 0a20 2020 2020  ILE_PATH):.     
-00000ea0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00000eb0: 2020 2020 2020 2020 2020 2020 6f73 2e72              os.r
-00000ec0: 656d 6f76 6528 4649 4c45 5f50 4154 4829  emove(FILE_PATH)
-00000ed0: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-00000ee0: 6570 743a 0a20 2020 2020 2020 2020 2020  ept:.           
-00000ef0: 2020 2020 2070 6173 730a 0a20 2020 2023       pass..    #
-00000f00: 202d 2d48 656c 7065 7273 2d2d 2d2d 2d2d   --Helpers------
-00000f10: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00000f20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00000f30: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00000f40: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020  -----------.    
-00000f50: 6465 6620 5f67 6574 5f66 696c 655f 7265  def _get_file_re
-00000f60: 6665 7265 6e63 6528 7365 6c66 293a 0a20  ference(self):. 
-00000f70: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00000f80: 6c66 2e67 6574 5f72 6573 6f75 7263 655f  lf.get_resource_
-00000f90: 6e61 6d65 2854 4553 545f 4649 4c45 5f50  name(TEST_FILE_P
-00000fa0: 5245 4649 5829 0a0a 2020 2020 6173 796e  REFIX)..    asyn
-00000fb0: 6320 6465 6620 5f63 7265 6174 655f 736f  c def _create_so
-00000fc0: 7572 6365 5f62 6c6f 6228 7365 6c66 293a  urce_blob(self):
-00000fd0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-00000fe0: 2020 2020 2020 2020 2020 6177 6169 7420            await 
-00000ff0: 7365 6c66 2e62 7363 2e63 7265 6174 655f  self.bsc.create_
-00001000: 636f 6e74 6169 6e65 7228 7365 6c66 2e73  container(self.s
-00001010: 6f75 7263 655f 636f 6e74 6169 6e65 725f  ource_container_
-00001020: 6e61 6d65 290a 2020 2020 2020 2020 6578  name).        ex
-00001030: 6365 7074 3a0a 2020 2020 2020 2020 2020  cept:.          
-00001040: 2020 7061 7373 0a20 2020 2020 2020 2062    pass.        b
-00001050: 6c6f 625f 636c 6965 6e74 203d 2073 656c  lob_client = sel
-00001060: 662e 6273 632e 6765 745f 626c 6f62 5f63  f.bsc.get_blob_c
-00001070: 6c69 656e 7428 7365 6c66 2e73 6f75 7263  lient(self.sourc
+00000150: 7365 3634 0a69 6d70 6f72 7420 6f73 0a69  se64.import os.i
+00000160: 6d70 6f72 7420 756e 6974 7465 7374 0a66  mport unittest.f
+00000170: 726f 6d20 6461 7465 7469 6d65 2069 6d70  rom datetime imp
+00000180: 6f72 7420 6461 7465 7469 6d65 2c20 7469  ort datetime, ti
+00000190: 6d65 6465 6c74 610a 0a66 726f 6d20 617a  medelta..from az
+000001a0: 7572 652e 636f 7265 2e63 7265 6465 6e74  ure.core.credent
+000001b0: 6961 6c73 2069 6d70 6f72 7420 417a 7572  ials import Azur
+000001c0: 6553 6173 4372 6564 656e 7469 616c 0a66  eSasCredential.f
+000001d0: 726f 6d20 617a 7572 652e 636f 7265 2e70  rom azure.core.p
+000001e0: 6970 656c 696e 652e 7472 616e 7370 6f72  ipeline.transpor
+000001f0: 7420 696d 706f 7274 2041 696f 4874 7470  t import AioHttp
+00000200: 5472 616e 7370 6f72 740a 6672 6f6d 206d  Transport.from m
+00000210: 756c 7469 6469 6374 2069 6d70 6f72 7420  ultidict import 
+00000220: 4349 4d75 6c74 6944 6963 742c 2043 494d  CIMultiDict, CIM
+00000230: 756c 7469 4469 6374 5072 6f78 790a 696d  ultiDictProxy.im
+00000240: 706f 7274 2072 6571 7565 7374 730a 696d  port requests.im
+00000250: 706f 7274 2070 7974 6573 740a 696d 706f  port pytest.impo
+00000260: 7274 2075 7569 640a 0a66 726f 6d20 617a  rt uuid..from az
+00000270: 7572 652e 636f 7265 2e65 7863 6570 7469  ure.core.excepti
+00000280: 6f6e 7320 696d 706f 7274 2048 7474 7052  ons import HttpR
+00000290: 6573 706f 6e73 6545 7272 6f72 2c20 5265  esponseError, Re
+000002a0: 736f 7572 6365 4e6f 7446 6f75 6e64 4572  sourceNotFoundEr
+000002b0: 726f 722c 2052 6573 6f75 7263 6545 7869  ror, ResourceExi
+000002c0: 7374 7345 7272 6f72 0a66 726f 6d20 617a  stsError.from az
+000002d0: 7572 652e 7374 6f72 6167 652e 626c 6f62  ure.storage.blob
+000002e0: 2e61 696f 2069 6d70 6f72 7420 426c 6f62  .aio import Blob
+000002f0: 5365 7276 6963 6543 6c69 656e 740a 6672  ServiceClient.fr
+00000300: 6f6d 2061 7a75 7265 2e73 746f 7261 6765  om azure.storage
+00000310: 2e66 696c 6573 6861 7265 2069 6d70 6f72  .fileshare impor
+00000320: 7420 280a 2020 2020 6765 6e65 7261 7465  t (.    generate
+00000330: 5f61 6363 6f75 6e74 5f73 6173 2c0a 2020  _account_sas,.  
+00000340: 2020 6765 6e65 7261 7465 5f66 696c 655f    generate_file_
+00000350: 7361 732c 0a20 2020 2067 656e 6572 6174  sas,.    generat
+00000360: 655f 7368 6172 655f 7361 732c 0a20 2020  e_share_sas,.   
+00000370: 204e 5446 5341 7474 7269 6275 7465 732c   NTFSAttributes,
+00000380: 0a20 2020 2043 6f6e 7465 6e74 5365 7474  .    ContentSett
+00000390: 696e 6773 2c0a 2020 2020 4669 6c65 5361  ings,.    FileSa
+000003a0: 7350 6572 6d69 7373 696f 6e73 2c0a 2020  sPermissions,.  
+000003b0: 2020 5368 6172 6553 6173 5065 726d 6973    ShareSasPermis
+000003c0: 7369 6f6e 732c 0a20 2020 2041 6363 6573  sions,.    Acces
+000003d0: 7350 6f6c 6963 792c 0a20 2020 2052 6573  sPolicy,.    Res
+000003e0: 6f75 7263 6554 7970 6573 2c0a 2020 2020  ourceTypes,.    
+000003f0: 4163 636f 756e 7453 6173 5065 726d 6973  AccountSasPermis
+00000400: 7369 6f6e 732c 0a20 2020 2053 746f 7261  sions,.    Stora
+00000410: 6765 4572 726f 7243 6f64 6529 0a66 726f  geErrorCode).fro
+00000420: 6d20 617a 7572 652e 7374 6f72 6167 652e  m azure.storage.
+00000430: 6669 6c65 7368 6172 652e 5f70 6172 7365  fileshare._parse
+00000440: 7220 696d 706f 7274 205f 6461 7465 7469  r import _dateti
+00000450: 6d65 5f74 6f5f 7374 720a 6672 6f6d 2064  me_to_str.from d
+00000460: 6576 746f 6f6c 735f 7465 7374 7574 696c  evtools_testutil
+00000470: 7320 696d 706f 7274 2052 6573 6f75 7263  s import Resourc
+00000480: 6547 726f 7570 5072 6570 6172 6572 2c20  eGroupPreparer, 
+00000490: 5374 6f72 6167 6541 6363 6f75 6e74 5072  StorageAccountPr
+000004a0: 6570 6172 6572 0a66 726f 6d20 617a 7572  eparer.from azur
+000004b0: 652e 7374 6f72 6167 652e 6669 6c65 7368  e.storage.filesh
+000004c0: 6172 652e 6169 6f20 696d 706f 7274 2028  are.aio import (
+000004d0: 0a20 2020 2053 6861 7265 4669 6c65 436c  .    ShareFileCl
+000004e0: 6965 6e74 2c0a 2020 2020 5368 6172 6553  ient,.    ShareS
+000004f0: 6572 7669 6365 436c 6965 6e74 2c0a 290a  erviceClient,.).
+00000500: 6672 6f6d 2073 6574 7469 6e67 732e 7465  from settings.te
+00000510: 7374 6361 7365 2069 6d70 6f72 7420 4669  stcase import Fi
+00000520: 6c65 5368 6172 6550 7265 7061 7265 720a  leSharePreparer.
+00000530: 6672 6f6d 2064 6576 746f 6f6c 735f 7465  from devtools_te
+00000540: 7374 7574 696c 732e 7374 6f72 6167 652e  stutils.storage.
+00000550: 6169 6f20 696d 706f 7274 2041 7379 6e63  aio import Async
+00000560: 5374 6f72 6167 6554 6573 7443 6173 650a  StorageTestCase.
+00000570: 0a23 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  .# -------------
+00000580: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00000590: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000005a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000005b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000005c0: 2d0a 5445 5354 5f53 4841 5245 5f50 5245  -.TEST_SHARE_PRE
+000005d0: 4649 5820 3d20 2773 6861 7265 270a 5445  FIX = 'share'.TE
+000005e0: 5354 5f44 4952 4543 544f 5259 5f50 5245  ST_DIRECTORY_PRE
+000005f0: 4649 5820 3d20 2764 6972 270a 5445 5354  FIX = 'dir'.TEST
+00000600: 5f46 494c 455f 5052 4546 4958 203d 2027  _FILE_PREFIX = '
+00000610: 6669 6c65 270a 5445 5354 5f42 4c4f 425f  file'.TEST_BLOB_
+00000620: 5052 4546 4958 203d 2027 626c 6f62 270a  PREFIX = 'blob'.
+00000630: 494e 5055 545f 4649 4c45 5f50 4154 4820  INPUT_FILE_PATH 
+00000640: 3d20 2766 696c 655f 696e 7075 742e 7465  = 'file_input.te
+00000650: 6d70 2e7b 7d2e 6461 7427 2e66 6f72 6d61  mp.{}.dat'.forma
+00000660: 7428 7374 7228 7575 6964 2e75 7569 6434  t(str(uuid.uuid4
+00000670: 2829 2929 0a4f 5554 5055 545f 4649 4c45  ())).OUTPUT_FILE
+00000680: 5f50 4154 4820 3d20 2766 696c 655f 6f75  _PATH = 'file_ou
+00000690: 7470 7574 2e74 656d 702e 7b7d 2e64 6174  tput.temp.{}.dat
+000006a0: 272e 666f 726d 6174 2873 7472 2875 7569  '.format(str(uui
+000006b0: 642e 7575 6964 3428 2929 290a 4c41 5247  d.uuid4())).LARG
+000006c0: 455f 4649 4c45 5f53 495a 4520 3d20 3634  E_FILE_SIZE = 64
+000006d0: 202a 2031 3032 3420 2b20 350a 5445 5354   * 1024 + 5.TEST
+000006e0: 5f46 494c 455f 5045 524d 4953 5349 4f4e  _FILE_PERMISSION
+000006f0: 5320 3d20 274f 3a53 2d31 2d35 2d32 312d  S = 'O:S-1-5-21-
+00000700: 3231 3237 3532 3131 3834 2d31 3630 3430  2127521184-16040
+00000710: 3132 3932 302d 3138 3837 3932 3735 3237  12920-1887927527
+00000720: 2d32 3135 3630 3735 3147 3a53 2d31 2d35  -21560751G:S-1-5
+00000730: 2d32 312d 3231 3237 3532 3131 3834 2d27  -21-2127521184-'
+00000740: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+00000750: 2020 2020 2020 2020 2020 2027 3136 3034             '1604
+00000760: 3031 3239 3230 2d31 3838 3739 3237 3532  012920-188792752
+00000770: 372d 3531 3344 3a41 4928 413b 3b46 413b  7-513D:AI(A;;FA;
+00000780: 3b3b 5359 2928 413b 3b46 413b 3b3b 4241  ;;SY)(A;;FA;;;BA
+00000790: 2928 413b 3b30 7831 3230 3061 393b 3b3b  )(A;;0x1200a9;;;
+000007a0: 2720 5c0a 2020 2020 2020 2020 2020 2020  ' \.            
+000007b0: 2020 2020 2020 2020 2020 2020 2753 2d31              'S-1
+000007c0: 2d35 2d32 312d 3339 3739 3535 3431 372d  -5-21-397955417-
+000007d0: 3632 3638 3831 3132 362d 3138 3834 3431  626881126-188441
+000007e0: 3434 342d 3330 3533 3936 3429 270a 0a0a  444-3053964)'...
+000007f0: 2320 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  # --------------
+00000800: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00000810: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00000820: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00000830: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00000840: 0a0a 636c 6173 7320 4169 6f68 7474 7054  ..class AiohttpT
+00000850: 6573 7454 7261 6e73 706f 7274 2841 696f  estTransport(Aio
+00000860: 4874 7470 5472 616e 7370 6f72 7429 3a0a  HttpTransport):.
+00000870: 2020 2020 2222 2257 6f72 6b61 726f 756e      """Workaroun
+00000880: 6420 746f 2076 6372 7079 2062 7567 3a20  d to vcrpy bug: 
+00000890: 6874 7470 733a 2f2f 6769 7468 7562 2e63  https://github.c
+000008a0: 6f6d 2f6b 6576 696e 3130 3234 2f76 6372  om/kevin1024/vcr
+000008b0: 7079 2f70 756c 6c2f 3436 310a 2020 2020  py/pull/461.    
+000008c0: 2222 220a 2020 2020 6173 796e 6320 6465  """.    async de
+000008d0: 6620 7365 6e64 2873 656c 662c 2072 6571  f send(self, req
+000008e0: 7565 7374 2c20 2a2a 636f 6e66 6967 293a  uest, **config):
+000008f0: 0a20 2020 2020 2020 2072 6573 706f 6e73  .        respons
+00000900: 6520 3d20 6177 6169 7420 7375 7065 7228  e = await super(
+00000910: 4169 6f68 7474 7054 6573 7454 7261 6e73  AiohttpTestTrans
+00000920: 706f 7274 2c20 7365 6c66 292e 7365 6e64  port, self).send
+00000930: 2872 6571 7565 7374 2c20 2a2a 636f 6e66  (request, **conf
+00000940: 6967 290a 2020 2020 2020 2020 6966 206e  ig).        if n
+00000950: 6f74 2069 7369 6e73 7461 6e63 6528 7265  ot isinstance(re
+00000960: 7370 6f6e 7365 2e68 6561 6465 7273 2c20  sponse.headers, 
+00000970: 4349 4d75 6c74 6944 6963 7450 726f 7879  CIMultiDictProxy
+00000980: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+00000990: 6573 706f 6e73 652e 6865 6164 6572 7320  esponse.headers 
+000009a0: 3d20 4349 4d75 6c74 6944 6963 7450 726f  = CIMultiDictPro
+000009b0: 7879 2843 494d 756c 7469 4469 6374 2872  xy(CIMultiDict(r
+000009c0: 6573 706f 6e73 652e 696e 7465 726e 616c  esponse.internal
+000009d0: 5f72 6573 706f 6e73 652e 6865 6164 6572  _response.header
+000009e0: 7329 290a 2020 2020 2020 2020 2020 2020  s)).            
+000009f0: 7265 7370 6f6e 7365 2e63 6f6e 7465 6e74  response.content
+00000a00: 5f74 7970 6520 3d20 7265 7370 6f6e 7365  _type = response
+00000a10: 2e68 6561 6465 7273 2e67 6574 2822 636f  .headers.get("co
+00000a20: 6e74 656e 742d 7479 7065 2229 0a20 2020  ntent-type").   
+00000a30: 2020 2020 2072 6574 7572 6e20 7265 7370       return resp
+00000a40: 6f6e 7365 0a0a 0a63 6c61 7373 2053 746f  onse...class Sto
+00000a50: 7261 6765 4669 6c65 4173 796e 6354 6573  rageFileAsyncTes
+00000a60: 7428 4173 796e 6353 746f 7261 6765 5465  t(AsyncStorageTe
+00000a70: 7374 4361 7365 293a 0a20 2020 2064 6566  stCase):.    def
+00000a80: 205f 7365 7475 7028 7365 6c66 2c20 7374   _setup(self, st
+00000a90: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
+00000aa0: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
+00000ab0: 756e 745f 6b65 792c 2072 6d74 5f61 6363  unt_key, rmt_acc
+00000ac0: 6f75 6e74 3d4e 6f6e 652c 2072 6d74 5f6b  ount=None, rmt_k
+00000ad0: 6579 3d4e 6f6e 6529 3a0a 2020 2020 2020  ey=None):.      
+00000ae0: 2020 7572 6c20 3d20 7365 6c66 2e61 6363    url = self.acc
+00000af0: 6f75 6e74 5f75 726c 2873 746f 7261 6765  ount_url(storage
+00000b00: 5f61 6363 6f75 6e74 5f6e 616d 652c 2022  _account_name, "
+00000b10: 6669 6c65 2229 0a20 2020 2020 2020 2062  file").        b
+00000b20: 6c6f 625f 7572 6c20 3d20 7365 6c66 2e61  lob_url = self.a
+00000b30: 6363 6f75 6e74 5f75 726c 2873 746f 7261  ccount_url(stora
+00000b40: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
+00000b50: 2022 626c 6f62 2229 0a20 2020 2020 2020   "blob").       
+00000b60: 2063 7265 6465 6e74 6961 6c20 3d20 7374   credential = st
+00000b70: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
+00000b80: 790a 0a20 2020 2020 2020 2023 2074 6573  y..        # tes
+00000b90: 7420 6368 756e 6b69 6e67 2066 756e 6374  t chunking funct
+00000ba0: 696f 6e61 6c69 7479 2062 7920 7265 6475  ionality by redu
+00000bb0: 6369 6e67 2074 6865 2074 6872 6573 686f  cing the thresho
+00000bc0: 6c64 0a20 2020 2020 2020 2023 2066 6f72  ld.        # for
+00000bd0: 2063 6875 6e6b 696e 6720 616e 6420 7468   chunking and th
+00000be0: 6520 7369 7a65 206f 6620 6561 6368 2063  e size of each c
+00000bf0: 6875 6e6b 2c20 6f74 6865 7277 6973 650a  hunk, otherwise.
+00000c00: 2020 2020 2020 2020 2320 7468 6520 7465          # the te
+00000c10: 7374 7320 776f 756c 6420 7461 6b65 2074  sts would take t
+00000c20: 6f6f 206c 6f6e 6720 746f 2065 7865 6375  oo long to execu
+00000c30: 7465 0a20 2020 2020 2020 2073 656c 662e  te.        self.
+00000c40: 6673 6320 3d20 5368 6172 6553 6572 7669  fsc = ShareServi
+00000c50: 6365 436c 6965 6e74 280a 2020 2020 2020  ceClient(.      
+00000c60: 2020 2020 2020 7572 6c2c 2063 7265 6465        url, crede
+00000c70: 6e74 6961 6c3d 6372 6564 656e 7469 616c  ntial=credential
+00000c80: 2c20 6d61 785f 7261 6e67 655f 7369 7a65  , max_range_size
+00000c90: 3d34 202a 2031 3032 3429 0a20 2020 2020  =4 * 1024).     
+00000ca0: 2020 2073 656c 662e 6273 6320 3d20 426c     self.bsc = Bl
+00000cb0: 6f62 5365 7276 6963 6543 6c69 656e 7428  obServiceClient(
+00000cc0: 626c 6f62 5f75 726c 2c20 6372 6564 656e  blob_url, creden
+00000cd0: 7469 616c 3d63 7265 6465 6e74 6961 6c29  tial=credential)
+00000ce0: 0a20 2020 2020 2020 2073 656c 662e 736f  .        self.so
+00000cf0: 7572 6365 5f63 6f6e 7461 696e 6572 5f6e  urce_container_n
+00000d00: 616d 6520 3d20 7365 6c66 2e67 6574 5f72  ame = self.get_r
+00000d10: 6573 6f75 7263 655f 6e61 6d65 2827 736f  esource_name('so
+00000d20: 7572 6365 7368 6172 6527 290a 2020 2020  urceshare').    
+00000d30: 2020 2020 7365 6c66 2e73 6861 7265 5f6e      self.share_n
+00000d40: 616d 6520 3d20 7365 6c66 2e67 6574 5f72  ame = self.get_r
+00000d50: 6573 6f75 7263 655f 6e61 6d65 2827 7574  esource_name('ut
+00000d60: 7368 6172 6527 290a 2020 2020 2020 2020  share').        
+00000d70: 7365 6c66 2e73 686f 7274 5f62 7974 655f  self.short_byte_
+00000d80: 6461 7461 203d 2073 656c 662e 6765 745f  data = self.get_
+00000d90: 7261 6e64 6f6d 5f62 7974 6573 2831 3032  random_bytes(102
+00000da0: 3429 0a0a 2020 2020 2020 2020 7265 6d6f  4)..        remo
+00000db0: 7465 5f75 726c 203d 2073 656c 662e 6163  te_url = self.ac
+00000dc0: 636f 756e 745f 7572 6c28 726d 745f 6163  count_url(rmt_ac
+00000dd0: 636f 756e 742c 2022 6669 6c65 2229 0a20  count, "file"). 
+00000de0: 2020 2020 2020 2072 656d 6f74 655f 6372         remote_cr
+00000df0: 6564 656e 7469 616c 203d 2072 6d74 5f6b  edential = rmt_k
+00000e00: 6579 0a20 2020 2020 2020 2069 6620 726d  ey.        if rm
+00000e10: 745f 6163 636f 756e 743a 0a20 2020 2020  t_account:.     
+00000e20: 2020 2020 2020 2073 656c 662e 6673 6332         self.fsc2
+00000e30: 203d 2053 6861 7265 5365 7276 6963 6543   = ShareServiceC
+00000e40: 6c69 656e 7428 7265 6d6f 7465 5f75 726c  lient(remote_url
+00000e50: 2c20 6372 6564 656e 7469 616c 3d72 656d  , credential=rem
+00000e60: 6f74 655f 6372 6564 656e 7469 616c 2c20  ote_credential, 
+00000e70: 7472 616e 7370 6f72 743d 4169 6f68 7474  transport=Aiohtt
+00000e80: 7054 6573 7454 7261 6e73 706f 7274 2829  pTestTransport()
+00000e90: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00000ea0: 6c66 2e72 656d 6f74 655f 7368 6172 655f  lf.remote_share_
+00000eb0: 6e61 6d65 203d 204e 6f6e 650a 0a20 2020  name = None..   
+00000ec0: 2064 6566 205f 7465 6172 646f 776e 2873   def _teardown(s
+00000ed0: 656c 662c 2046 494c 455f 5041 5448 293a  elf, FILE_PATH):
+00000ee0: 0a20 2020 2020 2020 2069 6620 6f73 2e70  .        if os.p
+00000ef0: 6174 682e 6973 6669 6c65 2846 494c 455f  ath.isfile(FILE_
+00000f00: 5041 5448 293a 0a20 2020 2020 2020 2020  PATH):.         
+00000f10: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00000f20: 2020 2020 2020 2020 6f73 2e72 656d 6f76          os.remov
+00000f30: 6528 4649 4c45 5f50 4154 4829 0a20 2020  e(FILE_PATH).   
+00000f40: 2020 2020 2020 2020 2065 7863 6570 743a           except:
+00000f50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00000f60: 2070 6173 730a 0a20 2020 2023 202d 2d48   pass..    # --H
+00000f70: 656c 7065 7273 2d2d 2d2d 2d2d 2d2d 2d2d  elpers----------
+00000f80: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00000f90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00000fa0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00000fb0: 2d2d 2d2d 2d2d 2d0a 2020 2020 6465 6620  -------.    def 
+00000fc0: 5f67 6574 5f66 696c 655f 7265 6665 7265  _get_file_refere
+00000fd0: 6e63 6528 7365 6c66 293a 0a20 2020 2020  nce(self):.     
+00000fe0: 2020 2072 6574 7572 6e20 7365 6c66 2e67     return self.g
+00000ff0: 6574 5f72 6573 6f75 7263 655f 6e61 6d65  et_resource_name
+00001000: 2854 4553 545f 4649 4c45 5f50 5245 4649  (TEST_FILE_PREFI
+00001010: 5829 0a0a 2020 2020 6173 796e 6320 6465  X)..    async de
+00001020: 6620 5f63 7265 6174 655f 736f 7572 6365  f _create_source
+00001030: 5f62 6c6f 6228 7365 6c66 293a 0a20 2020  _blob(self):.   
+00001040: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00001050: 2020 2020 2020 6177 6169 7420 7365 6c66        await self
+00001060: 2e62 7363 2e63 7265 6174 655f 636f 6e74  .bsc.create_cont
+00001070: 6169 6e65 7228 7365 6c66 2e73 6f75 7263  ainer(self.sourc
 00001080: 655f 636f 6e74 6169 6e65 725f 6e61 6d65  e_container_name
-00001090: 2c20 7365 6c66 2e67 6574 5f72 6573 6f75  , self.get_resou
-000010a0: 7263 655f 6e61 6d65 2854 4553 545f 424c  rce_name(TEST_BL
-000010b0: 4f42 5f50 5245 4649 5829 290a 2020 2020  OB_PREFIX)).    
-000010c0: 2020 2020 6177 6169 7420 626c 6f62 5f63      await blob_c
-000010d0: 6c69 656e 742e 7570 6c6f 6164 5f62 6c6f  lient.upload_blo
-000010e0: 6228 6227 6162 6364 6566 6768 696a 6b6c  b(b'abcdefghijkl
-000010f0: 6d6e 6f70 2720 2a20 3332 2c20 6f76 6572  mnop' * 32, over
-00001100: 7772 6974 653d 5472 7565 290a 2020 2020  write=True).    
-00001110: 2020 2020 7265 7475 726e 2062 6c6f 625f      return blob_
-00001120: 636c 6965 6e74 0a0a 2020 2020 6173 796e  client..    asyn
-00001130: 6320 6465 6620 5f73 6574 7570 5f73 6861  c def _setup_sha
-00001140: 7265 2873 656c 662c 2073 746f 7261 6765  re(self, storage
-00001150: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
-00001160: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
-00001170: 6579 2c20 7265 6d6f 7465 3d46 616c 7365  ey, remote=False
-00001180: 293a 0a20 2020 2020 2020 2073 6861 7265  ):.        share
-00001190: 5f6e 616d 6520 3d20 7365 6c66 2e72 656d  _name = self.rem
-000011a0: 6f74 655f 7368 6172 655f 6e61 6d65 2069  ote_share_name i
-000011b0: 6620 7265 6d6f 7465 2065 6c73 6520 7365  f remote else se
-000011c0: 6c66 2e73 6861 7265 5f6e 616d 650a 2020  lf.share_name.  
-000011d0: 2020 2020 2020 6173 796e 6320 7769 7468        async with
-000011e0: 2053 6861 7265 5365 7276 6963 6543 6c69   ShareServiceCli
-000011f0: 656e 7428 0a20 2020 2020 2020 2020 2020  ent(.           
-00001200: 2020 2020 2073 656c 662e 6163 636f 756e       self.accoun
-00001210: 745f 7572 6c28 7374 6f72 6167 655f 6163  t_url(storage_ac
-00001220: 636f 756e 745f 6e61 6d65 2c20 2266 696c  count_name, "fil
-00001230: 6522 292c 0a20 2020 2020 2020 2020 2020  e"),.           
-00001240: 2020 2020 2063 7265 6465 6e74 6961 6c3d       credential=
-00001250: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-00001260: 6b65 792c 0a20 2020 2020 2020 2020 2020  key,.           
-00001270: 2020 2020 206d 6178 5f72 616e 6765 5f73       max_range_s
-00001280: 697a 653d 3420 2a20 3130 3234 2920 6173  ize=4 * 1024) as
-00001290: 2066 7363 3a0a 2020 2020 2020 2020 2020   fsc:.          
-000012a0: 2020 6966 206e 6f74 2073 656c 662e 6973    if not self.is
-000012b0: 5f70 6c61 7962 6163 6b28 293a 0a20 2020  _playback():.   
-000012c0: 2020 2020 2020 2020 2020 2020 2074 7279               try
-000012d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000012e0: 2020 2020 2020 6177 6169 7420 6673 632e        await fsc.
-000012f0: 6372 6561 7465 5f73 6861 7265 2873 6861  create_share(sha
-00001300: 7265 5f6e 616d 6529 0a20 2020 2020 2020  re_name).       
-00001310: 2020 2020 2020 2020 2065 7863 6570 743a           except:
-00001320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001330: 2020 2020 2070 6173 730a 0a20 2020 2061       pass..    a
-00001340: 7379 6e63 2064 6566 205f 6372 6561 7465  sync def _create
-00001350: 5f66 696c 6528 7365 6c66 2c20 7374 6f72  _file(self, stor
-00001360: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
-00001370: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
-00001380: 745f 6b65 792c 2066 696c 655f 6e61 6d65  t_key, file_name
-00001390: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-000013a0: 6177 6169 7420 7365 6c66 2e5f 7365 7475  await self._setu
-000013b0: 705f 7368 6172 6528 7374 6f72 6167 655f  p_share(storage_
-000013c0: 6163 636f 756e 745f 6e61 6d65 2c20 7374  account_name, st
-000013d0: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
-000013e0: 7929 0a20 2020 2020 2020 2066 696c 655f  y).        file_
-000013f0: 6e61 6d65 203d 2073 656c 662e 5f67 6574  name = self._get
-00001400: 5f66 696c 655f 7265 6665 7265 6e63 6528  _file_reference(
-00001410: 2920 6966 2066 696c 655f 6e61 6d65 2069  ) if file_name i
-00001420: 7320 4e6f 6e65 2065 6c73 6520 6669 6c65  s None else file
-00001430: 5f6e 616d 650a 2020 2020 2020 2020 7368  _name.        sh
-00001440: 6172 655f 636c 6965 6e74 203d 2073 656c  are_client = sel
-00001450: 662e 6673 632e 6765 745f 7368 6172 655f  f.fsc.get_share_
-00001460: 636c 6965 6e74 2873 656c 662e 7368 6172  client(self.shar
-00001470: 655f 6e61 6d65 290a 2020 2020 2020 2020  e_name).        
-00001480: 6669 6c65 5f63 6c69 656e 7420 3d20 7368  file_client = sh
-00001490: 6172 655f 636c 6965 6e74 2e67 6574 5f66  are_client.get_f
-000014a0: 696c 655f 636c 6965 6e74 2866 696c 655f  ile_client(file_
-000014b0: 6e61 6d65 290a 2020 2020 2020 2020 6177  name).        aw
-000014c0: 6169 7420 6669 6c65 5f63 6c69 656e 742e  ait file_client.
-000014d0: 7570 6c6f 6164 5f66 696c 6528 7365 6c66  upload_file(self
-000014e0: 2e73 686f 7274 5f62 7974 655f 6461 7461  .short_byte_data
-000014f0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00001500: 2066 696c 655f 636c 6965 6e74 0a0a 2020   file_client..  
-00001510: 2020 6173 796e 6320 6465 6620 5f63 7265    async def _cre
-00001520: 6174 655f 656d 7074 795f 6669 6c65 2873  ate_empty_file(s
-00001530: 656c 662c 2073 746f 7261 6765 5f61 6363  elf, storage_acc
-00001540: 6f75 6e74 5f6e 616d 652c 2073 746f 7261  ount_name, stora
-00001550: 6765 5f61 6363 6f75 6e74 5f6b 6579 2c20  ge_account_key, 
-00001560: 6669 6c65 5f6e 616d 653d 4e6f 6e65 2c20  file_name=None, 
-00001570: 6669 6c65 5f73 697a 653d 3230 3438 293a  file_size=2048):
-00001580: 0a20 2020 2020 2020 2061 7761 6974 2073  .        await s
-00001590: 656c 662e 5f73 6574 7570 5f73 6861 7265  elf._setup_share
-000015a0: 2873 746f 7261 6765 5f61 6363 6f75 6e74  (storage_account
+00001090: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
+000010a0: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
+000010b0: 7373 0a20 2020 2020 2020 2062 6c6f 625f  ss.        blob_
+000010c0: 636c 6965 6e74 203d 2073 656c 662e 6273  client = self.bs
+000010d0: 632e 6765 745f 626c 6f62 5f63 6c69 656e  c.get_blob_clien
+000010e0: 7428 7365 6c66 2e73 6f75 7263 655f 636f  t(self.source_co
+000010f0: 6e74 6169 6e65 725f 6e61 6d65 2c20 7365  ntainer_name, se
+00001100: 6c66 2e67 6574 5f72 6573 6f75 7263 655f  lf.get_resource_
+00001110: 6e61 6d65 2854 4553 545f 424c 4f42 5f50  name(TEST_BLOB_P
+00001120: 5245 4649 5829 290a 2020 2020 2020 2020  REFIX)).        
+00001130: 6177 6169 7420 626c 6f62 5f63 6c69 656e  await blob_clien
+00001140: 742e 7570 6c6f 6164 5f62 6c6f 6228 6227  t.upload_blob(b'
+00001150: 6162 6364 6566 6768 696a 6b6c 6d6e 6f70  abcdefghijklmnop
+00001160: 2720 2a20 3332 2c20 6f76 6572 7772 6974  ' * 32, overwrit
+00001170: 653d 5472 7565 290a 2020 2020 2020 2020  e=True).        
+00001180: 7265 7475 726e 2062 6c6f 625f 636c 6965  return blob_clie
+00001190: 6e74 0a0a 2020 2020 6173 796e 6320 6465  nt..    async de
+000011a0: 6620 5f73 6574 7570 5f73 6861 7265 2873  f _setup_share(s
+000011b0: 656c 662c 2073 746f 7261 6765 5f61 6363  elf, storage_acc
+000011c0: 6f75 6e74 5f6e 616d 652c 2073 746f 7261  ount_name, stora
+000011d0: 6765 5f61 6363 6f75 6e74 5f6b 6579 2c20  ge_account_key, 
+000011e0: 7265 6d6f 7465 3d46 616c 7365 293a 0a20  remote=False):. 
+000011f0: 2020 2020 2020 2073 6861 7265 5f6e 616d         share_nam
+00001200: 6520 3d20 7365 6c66 2e72 656d 6f74 655f  e = self.remote_
+00001210: 7368 6172 655f 6e61 6d65 2069 6620 7265  share_name if re
+00001220: 6d6f 7465 2065 6c73 6520 7365 6c66 2e73  mote else self.s
+00001230: 6861 7265 5f6e 616d 650a 2020 2020 2020  hare_name.      
+00001240: 2020 6173 796e 6320 7769 7468 2053 6861    async with Sha
+00001250: 7265 5365 7276 6963 6543 6c69 656e 7428  reServiceClient(
+00001260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001270: 2073 656c 662e 6163 636f 756e 745f 7572   self.account_ur
+00001280: 6c28 7374 6f72 6167 655f 6163 636f 756e  l(storage_accoun
+00001290: 745f 6e61 6d65 2c20 2266 696c 6522 292c  t_name, "file"),
+000012a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000012b0: 2063 7265 6465 6e74 6961 6c3d 7374 6f72   credential=stor
+000012c0: 6167 655f 6163 636f 756e 745f 6b65 792c  age_account_key,
+000012d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000012e0: 206d 6178 5f72 616e 6765 5f73 697a 653d   max_range_size=
+000012f0: 3420 2a20 3130 3234 2920 6173 2066 7363  4 * 1024) as fsc
+00001300: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00001310: 206e 6f74 2073 656c 662e 6973 5f70 6c61   not self.is_pla
+00001320: 7962 6163 6b28 293a 0a20 2020 2020 2020  yback():.       
+00001330: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+00001340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001350: 2020 6177 6169 7420 6673 632e 6372 6561    await fsc.crea
+00001360: 7465 5f73 6861 7265 2873 6861 7265 5f6e  te_share(share_n
+00001370: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
+00001380: 2020 2020 2065 7863 6570 743a 0a20 2020       except:.   
+00001390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000013a0: 2070 6173 730a 0a20 2020 2061 7379 6e63   pass..    async
+000013b0: 2064 6566 205f 6372 6561 7465 5f66 696c   def _create_fil
+000013c0: 6528 7365 6c66 2c20 7374 6f72 6167 655f  e(self, storage_
+000013d0: 6163 636f 756e 745f 6e61 6d65 2c20 7374  account_name, st
+000013e0: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
+000013f0: 792c 2066 696c 655f 6e61 6d65 3d4e 6f6e  y, file_name=Non
+00001400: 6529 3a0a 2020 2020 2020 2020 6177 6169  e):.        awai
+00001410: 7420 7365 6c66 2e5f 7365 7475 705f 7368  t self._setup_sh
+00001420: 6172 6528 7374 6f72 6167 655f 6163 636f  are(storage_acco
+00001430: 756e 745f 6e61 6d65 2c20 7374 6f72 6167  unt_name, storag
+00001440: 655f 6163 636f 756e 745f 6b65 7929 0a20  e_account_key). 
+00001450: 2020 2020 2020 2066 696c 655f 6e61 6d65         file_name
+00001460: 203d 2073 656c 662e 5f67 6574 5f66 696c   = self._get_fil
+00001470: 655f 7265 6665 7265 6e63 6528 2920 6966  e_reference() if
+00001480: 2066 696c 655f 6e61 6d65 2069 7320 4e6f   file_name is No
+00001490: 6e65 2065 6c73 6520 6669 6c65 5f6e 616d  ne else file_nam
+000014a0: 650a 2020 2020 2020 2020 7368 6172 655f  e.        share_
+000014b0: 636c 6965 6e74 203d 2073 656c 662e 6673  client = self.fs
+000014c0: 632e 6765 745f 7368 6172 655f 636c 6965  c.get_share_clie
+000014d0: 6e74 2873 656c 662e 7368 6172 655f 6e61  nt(self.share_na
+000014e0: 6d65 290a 2020 2020 2020 2020 6669 6c65  me).        file
+000014f0: 5f63 6c69 656e 7420 3d20 7368 6172 655f  _client = share_
+00001500: 636c 6965 6e74 2e67 6574 5f66 696c 655f  client.get_file_
+00001510: 636c 6965 6e74 2866 696c 655f 6e61 6d65  client(file_name
+00001520: 290a 2020 2020 2020 2020 6177 6169 7420  ).        await 
+00001530: 6669 6c65 5f63 6c69 656e 742e 7570 6c6f  file_client.uplo
+00001540: 6164 5f66 696c 6528 7365 6c66 2e73 686f  ad_file(self.sho
+00001550: 7274 5f62 7974 655f 6461 7461 290a 2020  rt_byte_data).  
+00001560: 2020 2020 2020 7265 7475 726e 2066 696c        return fil
+00001570: 655f 636c 6965 6e74 0a0a 2020 2020 6173  e_client..    as
+00001580: 796e 6320 6465 6620 5f63 7265 6174 655f  ync def _create_
+00001590: 656d 7074 795f 6669 6c65 2873 656c 662c  empty_file(self,
+000015a0: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
 000015b0: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
-000015c0: 6363 6f75 6e74 5f6b 6579 290a 2020 2020  ccount_key).    
-000015d0: 2020 2020 6669 6c65 5f6e 616d 6520 3d20      file_name = 
-000015e0: 7365 6c66 2e5f 6765 745f 6669 6c65 5f72  self._get_file_r
-000015f0: 6566 6572 656e 6365 2829 2069 6620 6669  eference() if fi
-00001600: 6c65 5f6e 616d 6520 6973 204e 6f6e 6520  le_name is None 
-00001610: 656c 7365 2066 696c 655f 6e61 6d65 0a20  else file_name. 
-00001620: 2020 2020 2020 2073 6861 7265 5f63 6c69         share_cli
-00001630: 656e 7420 3d20 7365 6c66 2e66 7363 2e67  ent = self.fsc.g
-00001640: 6574 5f73 6861 7265 5f63 6c69 656e 7428  et_share_client(
-00001650: 7365 6c66 2e73 6861 7265 5f6e 616d 6529  self.share_name)
-00001660: 0a20 2020 2020 2020 2066 696c 655f 636c  .        file_cl
-00001670: 6965 6e74 203d 2073 6861 7265 5f63 6c69  ient = share_cli
-00001680: 656e 742e 6765 745f 6669 6c65 5f63 6c69  ent.get_file_cli
-00001690: 656e 7428 6669 6c65 5f6e 616d 6529 0a20  ent(file_name). 
-000016a0: 2020 2020 2020 2061 7761 6974 2066 696c         await fil
-000016b0: 655f 636c 6965 6e74 2e63 7265 6174 655f  e_client.create_
-000016c0: 6669 6c65 2866 696c 655f 7369 7a65 290a  file(file_size).
-000016d0: 2020 2020 2020 2020 7265 7475 726e 2066          return f
-000016e0: 696c 655f 636c 6965 6e74 0a0a 2020 2020  ile_client..    
-000016f0: 6173 796e 6320 6465 6620 5f67 6574 5f66  async def _get_f
-00001700: 696c 655f 636c 6965 6e74 2873 656c 662c  ile_client(self,
-00001710: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
-00001720: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
-00001730: 6363 6f75 6e74 5f6b 6579 293a 0a20 2020  ccount_key):.   
-00001740: 2020 2020 2061 7761 6974 2073 656c 662e       await self.
-00001750: 5f73 6574 7570 5f73 6861 7265 2873 746f  _setup_share(sto
-00001760: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
-00001770: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
-00001780: 6e74 5f6b 6579 290a 2020 2020 2020 2020  nt_key).        
-00001790: 6669 6c65 5f6e 616d 6520 3d20 7365 6c66  file_name = self
-000017a0: 2e5f 6765 745f 6669 6c65 5f72 6566 6572  ._get_file_refer
-000017b0: 656e 6365 2829 0a20 2020 2020 2020 2073  ence().        s
-000017c0: 6861 7265 5f63 6c69 656e 7420 3d20 7365  hare_client = se
-000017d0: 6c66 2e66 7363 2e67 6574 5f73 6861 7265  lf.fsc.get_share
-000017e0: 5f63 6c69 656e 7428 7365 6c66 2e73 6861  _client(self.sha
-000017f0: 7265 5f6e 616d 6529 0a20 2020 2020 2020  re_name).       
-00001800: 2066 696c 655f 636c 6965 6e74 203d 2073   file_client = s
-00001810: 6861 7265 5f63 6c69 656e 742e 6765 745f  hare_client.get_
-00001820: 6669 6c65 5f63 6c69 656e 7428 6669 6c65  file_client(file
-00001830: 5f6e 616d 6529 0a20 2020 2020 2020 2072  _name).        r
-00001840: 6574 7572 6e20 6669 6c65 5f63 6c69 656e  eturn file_clien
-00001850: 740a 0a20 2020 2061 7379 6e63 2064 6566  t..    async def
-00001860: 205f 6372 6561 7465 5f72 656d 6f74 655f   _create_remote_
-00001870: 7368 6172 6528 7365 6c66 293a 0a20 2020  share(self):.   
-00001880: 2020 2020 2073 656c 662e 7265 6d6f 7465       self.remote
-00001890: 5f73 6861 7265 5f6e 616d 6520 3d20 7365  _share_name = se
-000018a0: 6c66 2e67 6574 5f72 6573 6f75 7263 655f  lf.get_resource_
-000018b0: 6e61 6d65 2827 7265 6d6f 7465 7368 6172  name('remoteshar
-000018c0: 6527 290a 2020 2020 2020 2020 7265 6d6f  e').        remo
-000018d0: 7465 5f73 6861 7265 203d 2073 656c 662e  te_share = self.
-000018e0: 6673 6332 2e67 6574 5f73 6861 7265 5f63  fsc2.get_share_c
-000018f0: 6c69 656e 7428 7365 6c66 2e72 656d 6f74  lient(self.remot
-00001900: 655f 7368 6172 655f 6e61 6d65 290a 2020  e_share_name).  
-00001910: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-00001920: 2020 2020 2020 2061 7761 6974 2072 656d         await rem
-00001930: 6f74 655f 7368 6172 652e 6372 6561 7465  ote_share.create
-00001940: 5f73 6861 7265 2829 0a20 2020 2020 2020  _share().       
-00001950: 2065 7863 6570 7420 5265 736f 7572 6365   except Resource
-00001960: 4578 6973 7473 4572 726f 723a 0a20 2020  ExistsError:.   
-00001970: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
-00001980: 2020 2020 2020 7265 7475 726e 2072 656d        return rem
-00001990: 6f74 655f 7368 6172 650a 0a20 2020 2061  ote_share..    a
-000019a0: 7379 6e63 2064 6566 205f 6372 6561 7465  sync def _create
-000019b0: 5f72 656d 6f74 655f 6669 6c65 2873 656c  _remote_file(sel
-000019c0: 662c 2066 696c 655f 6461 7461 3d4e 6f6e  f, file_data=Non
-000019d0: 6529 3a0a 2020 2020 2020 2020 6966 206e  e):.        if n
-000019e0: 6f74 2066 696c 655f 6461 7461 3a0a 2020  ot file_data:.  
-000019f0: 2020 2020 2020 2020 2020 6669 6c65 5f64            file_d
-00001a00: 6174 6120 3d20 6227 3132 3334 3536 3738  ata = b'12345678
-00001a10: 2720 2a20 3130 3234 202a 2031 3032 340a  ' * 1024 * 1024.
-00001a20: 2020 2020 2020 2020 736f 7572 6365 5f66          source_f
-00001a30: 696c 655f 6e61 6d65 203d 2073 656c 662e  ile_name = self.
-00001a40: 5f67 6574 5f66 696c 655f 7265 6665 7265  _get_file_refere
-00001a50: 6e63 6528 290a 2020 2020 2020 2020 7265  nce().        re
-00001a60: 6d6f 7465 5f73 6861 7265 203d 2073 656c  mote_share = sel
-00001a70: 662e 6673 6332 2e67 6574 5f73 6861 7265  f.fsc2.get_share
-00001a80: 5f63 6c69 656e 7428 7365 6c66 2e72 656d  _client(self.rem
-00001a90: 6f74 655f 7368 6172 655f 6e61 6d65 290a  ote_share_name).
-00001aa0: 2020 2020 2020 2020 7265 6d6f 7465 5f66          remote_f
-00001ab0: 696c 6520 3d20 7265 6d6f 7465 5f73 6861  ile = remote_sha
-00001ac0: 7265 2e67 6574 5f66 696c 655f 636c 6965  re.get_file_clie
-00001ad0: 6e74 2873 6f75 7263 655f 6669 6c65 5f6e  nt(source_file_n
-00001ae0: 616d 6529 0a20 2020 2020 2020 2061 7761  ame).        awa
-00001af0: 6974 2072 656d 6f74 655f 6669 6c65 2e75  it remote_file.u
-00001b00: 706c 6f61 645f 6669 6c65 2866 696c 655f  pload_file(file_
-00001b10: 6461 7461 290a 2020 2020 2020 2020 7265  data).        re
-00001b20: 7475 726e 2072 656d 6f74 655f 6669 6c65  turn remote_file
-00001b30: 0a0a 2020 2020 6173 796e 6320 6465 6620  ..    async def 
-00001b40: 5f77 6169 745f 666f 725f 6173 796e 635f  _wait_for_async_
-00001b50: 636f 7079 2873 656c 662c 2073 6861 7265  copy(self, share
-00001b60: 5f6e 616d 652c 2066 696c 655f 7061 7468  _name, file_path
-00001b70: 293a 0a20 2020 2020 2020 2063 6f75 6e74  ):.        count
-00001b80: 203d 2030 0a20 2020 2020 2020 2073 6861   = 0.        sha
-00001b90: 7265 5f63 6c69 656e 7420 3d20 7365 6c66  re_client = self
-00001ba0: 2e66 7363 2e67 6574 5f73 6861 7265 5f63  .fsc.get_share_c
-00001bb0: 6c69 656e 7428 7368 6172 655f 6e61 6d65  lient(share_name
-00001bc0: 290a 2020 2020 2020 2020 6669 6c65 5f63  ).        file_c
-00001bd0: 6c69 656e 7420 3d20 7368 6172 655f 636c  lient = share_cl
-00001be0: 6965 6e74 2e67 6574 5f66 696c 655f 636c  ient.get_file_cl
-00001bf0: 6965 6e74 2866 696c 655f 7061 7468 290a  ient(file_path).
-00001c00: 2020 2020 2020 2020 7072 6f70 6572 7469          properti
-00001c10: 6573 203d 2061 7761 6974 2066 696c 655f  es = await file_
-00001c20: 636c 6965 6e74 2e67 6574 5f66 696c 655f  client.get_file_
-00001c30: 7072 6f70 6572 7469 6573 2829 0a20 2020  properties().   
-00001c40: 2020 2020 2077 6869 6c65 2070 726f 7065       while prope
-00001c50: 7274 6965 732e 636f 7079 2e73 7461 7475  rties.copy.statu
-00001c60: 7320 213d 2027 7375 6363 6573 7327 3a0a  s != 'success':.
-00001c70: 2020 2020 2020 2020 2020 2020 636f 756e              coun
-00001c80: 7420 3d20 636f 756e 7420 2b20 310a 2020  t = count + 1.  
-00001c90: 2020 2020 2020 2020 2020 6966 2063 6f75            if cou
-00001ca0: 6e74 203e 2031 303a 0a20 2020 2020 2020  nt > 10:.       
-00001cb0: 2020 2020 2020 2020 2073 656c 662e 6661           self.fa
-00001cc0: 696c 2827 5469 6d65 6420 6f75 7420 7761  il('Timed out wa
-00001cd0: 6974 696e 6720 666f 7220 6173 796e 6320  iting for async 
-00001ce0: 636f 7079 2074 6f20 636f 6d70 6c65 7465  copy to complete
-00001cf0: 2e27 290a 2020 2020 2020 2020 2020 2020  .').            
-00001d00: 7365 6c66 2e73 6c65 6570 2836 290a 2020  self.sleep(6).  
-00001d10: 2020 2020 2020 2020 2020 7072 6f70 6572            proper
-00001d20: 7469 6573 203d 2061 7761 6974 2066 696c  ties = await fil
-00001d30: 655f 636c 6965 6e74 2e67 6574 5f66 696c  e_client.get_fil
-00001d40: 655f 7072 6f70 6572 7469 6573 2829 0a20  e_properties(). 
-00001d50: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00001d60: 7274 4571 7561 6c28 7072 6f70 6572 7469  rtEqual(properti
-00001d70: 6573 2e63 6f70 792e 7374 6174 7573 2c20  es.copy.status, 
-00001d80: 2773 7563 6365 7373 2729 0a0a 2020 2020  'success')..    
-00001d90: 6173 796e 6320 6465 6620 6173 7365 7274  async def assert
-00001da0: 4669 6c65 4571 7561 6c28 7365 6c66 2c20  FileEqual(self, 
-00001db0: 6669 6c65 5f63 6c69 656e 742c 2065 7870  file_client, exp
-00001dc0: 6563 7465 645f 6461 7461 293a 0a20 2020  ected_data):.   
-00001dd0: 2020 2020 2063 6f6e 7465 6e74 203d 2061       content = a
-00001de0: 7761 6974 2066 696c 655f 636c 6965 6e74  wait file_client
-00001df0: 2e64 6f77 6e6c 6f61 645f 6669 6c65 2829  .download_file()
-00001e00: 0a20 2020 2020 2020 2061 6374 7561 6c5f  .        actual_
-00001e10: 6461 7461 203d 2061 7761 6974 2063 6f6e  data = await con
-00001e20: 7465 6e74 2e72 6561 6461 6c6c 2829 0a20  tent.readall(). 
-00001e30: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00001e40: 7274 4571 7561 6c28 6163 7475 616c 5f64  rtEqual(actual_d
-00001e50: 6174 612c 2065 7870 6563 7465 645f 6461  ata, expected_da
-00001e60: 7461 290a 0a20 2020 2063 6c61 7373 204e  ta)..    class N
-00001e70: 6f6e 5365 656b 6162 6c65 4669 6c65 286f  onSeekableFile(o
-00001e80: 626a 6563 7429 3a0a 2020 2020 2020 2020  bject):.        
-00001e90: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
-00001ea0: 662c 2077 7261 7070 6564 5f66 696c 6529  f, wrapped_file)
-00001eb0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00001ec0: 6c66 2e77 7261 7070 6564 5f66 696c 6520  lf.wrapped_file 
-00001ed0: 3d20 7772 6170 7065 645f 6669 6c65 0a0a  = wrapped_file..
-00001ee0: 2020 2020 2020 2020 6465 6620 7772 6974          def writ
-00001ef0: 6528 7365 6c66 2c20 6461 7461 293a 0a20  e(self, data):. 
-00001f00: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00001f10: 7772 6170 7065 645f 6669 6c65 2e77 7269  wrapped_file.wri
-00001f20: 7465 2864 6174 6129 0a0a 2020 2020 2020  te(data)..      
-00001f30: 2020 6465 6620 7265 6164 2873 656c 662c    def read(self,
-00001f40: 2063 6f75 6e74 293a 0a20 2020 2020 2020   count):.       
-00001f50: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00001f60: 2e77 7261 7070 6564 5f66 696c 652e 7265  .wrapped_file.re
-00001f70: 6164 2863 6f75 6e74 290a 0a20 2020 2023  ad(count)..    #
-00001f80: 202d 2d54 6573 7420 6361 7365 7320 666f   --Test cases fo
-00001f90: 7220 6669 6c65 7320 2d2d 2d2d 2d2d 2d2d  r files --------
-00001fa0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00001fb0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00001fc0: 2d2d 2d2d 2d2d 0a20 2020 2040 4669 6c65  ------.    @File
-00001fd0: 5368 6172 6550 7265 7061 7265 7228 290a  SharePreparer().
-00001fe0: 2020 2020 4041 7379 6e63 5374 6f72 6167      @AsyncStorag
-00001ff0: 6554 6573 7443 6173 652e 6177 6169 745f  eTestCase.await_
-00002000: 7072 6570 6172 6564 5f74 6573 740a 2020  prepared_test.  
-00002010: 2020 6173 796e 6320 6465 6620 7465 7374    async def test
-00002020: 5f6d 616b 655f 6669 6c65 5f75 726c 5f61  _make_file_url_a
-00002030: 7379 6e63 2873 656c 662c 2073 746f 7261  sync(self, stora
-00002040: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
-00002050: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
-00002060: 5f6b 6579 293a 0a20 2020 2020 2020 2073  _key):.        s
-00002070: 656c 662e 5f73 6574 7570 2873 746f 7261  elf._setup(stora
-00002080: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
-00002090: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
-000020a0: 5f6b 6579 290a 0a20 2020 2020 2020 2073  _key)..        s
-000020b0: 6861 7265 203d 2073 656c 662e 6673 632e  hare = self.fsc.
-000020c0: 6765 745f 7368 6172 655f 636c 6965 6e74  get_share_client
-000020d0: 2822 7668 6473 2229 0a20 2020 2020 2020  ("vhds").       
-000020e0: 2066 696c 655f 636c 6965 6e74 203d 2073   file_client = s
-000020f0: 6861 7265 2e67 6574 5f66 696c 655f 636c  hare.get_file_cl
-00002100: 6965 6e74 2822 7668 645f 6469 722f 6d79  ient("vhd_dir/my
-00002110: 2e76 6864 2229 0a0a 2020 2020 2020 2020  .vhd")..        
-00002120: 2320 4163 740a 2020 2020 2020 2020 7265  # Act.        re
-00002130: 7320 3d20 6669 6c65 5f63 6c69 656e 742e  s = file_client.
-00002140: 7572 6c0a 0a20 2020 2020 2020 2023 2041  url..        # A
-00002150: 7373 6572 740a 2020 2020 2020 2020 7365  ssert.        se
-00002160: 6c66 2e61 7373 6572 7445 7175 616c 2872  lf.assertEqual(r
-00002170: 6573 2c20 2768 7474 7073 3a2f 2f27 202b  es, 'https://' +
-00002180: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
-00002190: 5f6e 616d 650a 2020 2020 2020 2020 2020  _name.          
-000021a0: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-000021b0: 2027 2e66 696c 652e 636f 7265 2e77 696e   '.file.core.win
-000021c0: 646f 7773 2e6e 6574 2f76 6864 732f 7668  dows.net/vhds/vh
-000021d0: 645f 6469 722f 6d79 2e76 6864 2729 0a0a  d_dir/my.vhd')..
-000021e0: 2020 2020 4046 696c 6553 6861 7265 5072      @FileSharePr
-000021f0: 6570 6172 6572 2829 0a20 2020 2040 4173  eparer().    @As
-00002200: 796e 6353 746f 7261 6765 5465 7374 4361  yncStorageTestCa
-00002210: 7365 2e61 7761 6974 5f70 7265 7061 7265  se.await_prepare
-00002220: 645f 7465 7374 0a20 2020 2061 7379 6e63  d_test.    async
-00002230: 2064 6566 2074 6573 745f 6d61 6b65 5f66   def test_make_f
-00002240: 696c 655f 7572 6c5f 6e6f 5f64 6972 6563  ile_url_no_direc
-00002250: 746f 7279 5f61 7379 6e63 2873 656c 662c  tory_async(self,
-00002260: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
-00002270: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
-00002280: 6363 6f75 6e74 5f6b 6579 293a 0a20 2020  ccount_key):.   
-00002290: 2020 2020 2073 656c 662e 5f73 6574 7570       self._setup
-000022a0: 2873 746f 7261 6765 5f61 6363 6f75 6e74  (storage_account
-000022b0: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
-000022c0: 6363 6f75 6e74 5f6b 6579 290a 2020 2020  ccount_key).    
-000022d0: 2020 2020 7368 6172 6520 3d20 7365 6c66      share = self
-000022e0: 2e66 7363 2e67 6574 5f73 6861 7265 5f63  .fsc.get_share_c
-000022f0: 6c69 656e 7428 2276 6864 7322 290a 2020  lient("vhds").  
-00002300: 2020 2020 2020 6669 6c65 5f63 6c69 656e        file_clien
-00002310: 7420 3d20 7368 6172 652e 6765 745f 6669  t = share.get_fi
-00002320: 6c65 5f63 6c69 656e 7428 226d 792e 7668  le_client("my.vh
-00002330: 6422 290a 0a20 2020 2020 2020 2023 2041  d")..        # A
-00002340: 6374 0a20 2020 2020 2020 2072 6573 203d  ct.        res =
-00002350: 2066 696c 655f 636c 6965 6e74 2e75 726c   file_client.url
-00002360: 0a0a 2020 2020 2020 2020 2320 4173 7365  ..        # Asse
-00002370: 7274 0a20 2020 2020 2020 2073 656c 662e  rt.        self.
-00002380: 6173 7365 7274 4571 7561 6c28 7265 732c  assertEqual(res,
-00002390: 2027 6874 7470 733a 2f2f 2720 2b20 7374   'https://' + st
-000023a0: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
-000023b0: 6d65 0a20 2020 2020 2020 2020 2020 2020  me.             
-000023c0: 2020 2020 2020 2020 2020 2020 2b20 272e              + '.
-000023d0: 6669 6c65 2e63 6f72 652e 7769 6e64 6f77  file.core.window
-000023e0: 732e 6e65 742f 7668 6473 2f6d 792e 7668  s.net/vhds/my.vh
-000023f0: 6427 290a 0a20 2020 2040 4669 6c65 5368  d')..    @FileSh
-00002400: 6172 6550 7265 7061 7265 7228 290a 2020  arePreparer().  
-00002410: 2020 4041 7379 6e63 5374 6f72 6167 6554    @AsyncStorageT
-00002420: 6573 7443 6173 652e 6177 6169 745f 7072  estCase.await_pr
-00002430: 6570 6172 6564 5f74 6573 740a 2020 2020  epared_test.    
-00002440: 6173 796e 6320 6465 6620 7465 7374 5f6d  async def test_m
-00002450: 616b 655f 6669 6c65 5f75 726c 5f77 6974  ake_file_url_wit
-00002460: 685f 7072 6f74 6f63 6f6c 2873 656c 662c  h_protocol(self,
-00002470: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
-00002480: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
-00002490: 6363 6f75 6e74 5f6b 6579 293a 0a20 2020  ccount_key):.   
-000024a0: 2020 2020 2073 656c 662e 5f73 6574 7570       self._setup
-000024b0: 2873 746f 7261 6765 5f61 6363 6f75 6e74  (storage_account
-000024c0: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
-000024d0: 6363 6f75 6e74 5f6b 6579 290a 2020 2020  ccount_key).    
-000024e0: 2020 2020 7572 6c20 3d20 7365 6c66 2e61      url = self.a
-000024f0: 6363 6f75 6e74 5f75 726c 2873 746f 7261  ccount_url(stora
-00002500: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
-00002510: 2022 6669 6c65 2229 2e72 6570 6c61 6365   "file").replace
-00002520: 2827 6874 7470 7327 2c20 2768 7474 7027  ('https', 'http'
-00002530: 290a 2020 2020 2020 2020 6673 6320 3d20  ).        fsc = 
-00002540: 5368 6172 6553 6572 7669 6365 436c 6965  ShareServiceClie
-00002550: 6e74 2875 726c 2c20 6372 6564 656e 7469  nt(url, credenti
-00002560: 616c 3d73 746f 7261 6765 5f61 6363 6f75  al=storage_accou
-00002570: 6e74 5f6b 6579 290a 2020 2020 2020 2020  nt_key).        
-00002580: 7368 6172 6520 3d20 6673 632e 6765 745f  share = fsc.get_
-00002590: 7368 6172 655f 636c 6965 6e74 2822 7668  share_client("vh
-000025a0: 6473 2229 0a20 2020 2020 2020 2066 696c  ds").        fil
-000025b0: 655f 636c 6965 6e74 203d 2073 6861 7265  e_client = share
-000025c0: 2e67 6574 5f66 696c 655f 636c 6965 6e74  .get_file_client
-000025d0: 2822 7668 645f 6469 722f 6d79 2e76 6864  ("vhd_dir/my.vhd
-000025e0: 2229 0a0a 2020 2020 2020 2020 2320 4163  ")..        # Ac
-000025f0: 740a 2020 2020 2020 2020 7265 7320 3d20  t.        res = 
-00002600: 6669 6c65 5f63 6c69 656e 742e 7572 6c0a  file_client.url.
-00002610: 0a20 2020 2020 2020 2023 2041 7373 6572  .        # Asser
-00002620: 740a 2020 2020 2020 2020 7365 6c66 2e61  t.        self.a
-00002630: 7373 6572 7445 7175 616c 2872 6573 2c20  ssertEqual(res, 
-00002640: 2768 7474 703a 2f2f 2720 2b20 7374 6f72  'http://' + stor
-00002650: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
-00002660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002670: 2020 2020 2020 2020 2020 2b20 272e 6669            + '.fi
-00002680: 6c65 2e63 6f72 652e 7769 6e64 6f77 732e  le.core.windows.
-00002690: 6e65 742f 7668 6473 2f76 6864 5f64 6972  net/vhds/vhd_dir
-000026a0: 2f6d 792e 7668 6427 290a 0a20 2020 2040  /my.vhd')..    @
-000026b0: 4669 6c65 5368 6172 6550 7265 7061 7265  FileSharePrepare
-000026c0: 7228 290a 2020 2020 4041 7379 6e63 5374  r().    @AsyncSt
-000026d0: 6f72 6167 6554 6573 7443 6173 652e 6177  orageTestCase.aw
-000026e0: 6169 745f 7072 6570 6172 6564 5f74 6573  ait_prepared_tes
-000026f0: 740a 2020 2020 6173 796e 6320 6465 6620  t.    async def 
-00002700: 7465 7374 5f6d 616b 655f 6669 6c65 5f75  test_make_file_u
-00002710: 726c 5f77 6974 685f 7361 7328 7365 6c66  rl_with_sas(self
-00002720: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
-00002730: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
-00002740: 6163 636f 756e 745f 6b65 7929 3a0a 2020  account_key):.  
-00002750: 2020 2020 2020 7365 6c66 2e5f 7365 7475        self._setu
-00002760: 7028 7374 6f72 6167 655f 6163 636f 756e  p(storage_accoun
-00002770: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
-00002780: 6163 636f 756e 745f 6b65 7929 0a20 2020  account_key).   
-00002790: 2020 2020 2073 6173 203d 2027 3f73 763d       sas = '?sv=
-000027a0: 3230 3135 2d30 342d 3035 2673 743d 3230  2015-04-05&st=20
-000027b0: 3135 2d30 342d 3239 5432 3225 3341 3138  15-04-29T22%3A18
-000027c0: 2533 4132 365a 2673 653d 3230 3135 2d30  %3A26Z&se=2015-0
-000027d0: 342d 3330 5430 3225 3341 3233 2533 4132  4-30T02%3A23%3A2
-000027e0: 365a 2673 723d 6226 7370 3d72 7726 7369  6Z&sr=b&sp=rw&si
-000027f0: 703d 3136 382e 312e 352e 3630 2d31 3638  p=168.1.5.60-168
-00002800: 2e31 2e35 2e37 3026 7370 723d 6874 7470  .1.5.70&spr=http
-00002810: 7326 7369 673d 5a25 3246 5248 4958 3558  s&sig=Z%2FRHIX5X
-00002820: 6367 304d 7132 7271 4933 4f6c 5754 6a45  cg0Mq2rqI3OlWTjE
-00002830: 6732 7459 6b62 6f58 7231 5039 5a55 5844  g2tYkboXr1P9ZUXD
-00002840: 746b 6b25 3344 270a 2020 2020 2020 2020  tkk%3D'.        
-00002850: 6669 6c65 5f63 6c69 656e 7420 3d20 5368  file_client = Sh
-00002860: 6172 6546 696c 6543 6c69 656e 7428 0a20  areFileClient(. 
-00002870: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00002880: 6163 636f 756e 745f 7572 6c28 7374 6f72  account_url(stor
-00002890: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
-000028a0: 2c20 2266 696c 6522 292c 0a20 2020 2020  , "file"),.     
-000028b0: 2020 2020 2020 2073 6861 7265 5f6e 616d         share_nam
-000028c0: 653d 2276 6864 7322 2c0a 2020 2020 2020  e="vhds",.      
-000028d0: 2020 2020 2020 6669 6c65 5f70 6174 683d        file_path=
-000028e0: 2276 6864 5f64 6972 2f6d 792e 7668 6422  "vhd_dir/my.vhd"
-000028f0: 2c0a 2020 2020 2020 2020 2020 2020 6372  ,.            cr
-00002900: 6564 656e 7469 616c 3d73 6173 0a20 2020  edential=sas.   
-00002910: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00002920: 2320 4163 740a 2020 2020 2020 2020 7265  # Act.        re
-00002930: 7320 3d20 6669 6c65 5f63 6c69 656e 742e  s = file_client.
-00002940: 7572 6c0a 0a20 2020 2020 2020 2023 2041  url..        # A
-00002950: 7373 6572 740a 2020 2020 2020 2020 7365  ssert.        se
-00002960: 6c66 2e61 7373 6572 7445 7175 616c 2872  lf.assertEqual(r
-00002970: 6573 2c20 2768 7474 7073 3a2f 2f27 202b  es, 'https://' +
-00002980: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
-00002990: 5f6e 616d 6520 2b0a 2020 2020 2020 2020  _name +.        
-000029a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000029b0: 2027 2e66 696c 652e 636f 7265 2e77 696e   '.file.core.win
-000029c0: 646f 7773 2e6e 6574 2f76 6864 732f 7668  dows.net/vhds/vh
-000029d0: 645f 6469 722f 6d79 2e76 6864 7b7d 272e  d_dir/my.vhd{}'.
-000029e0: 666f 726d 6174 2873 6173 2929 0a0a 2020  format(sas))..  
-000029f0: 2020 4046 696c 6553 6861 7265 5072 6570    @FileSharePrep
-00002a00: 6172 6572 2829 0a20 2020 2040 4173 796e  arer().    @Asyn
-00002a10: 6353 746f 7261 6765 5465 7374 4361 7365  cStorageTestCase
-00002a20: 2e61 7761 6974 5f70 7265 7061 7265 645f  .await_prepared_
-00002a30: 7465 7374 0a20 2020 2061 7379 6e63 2064  test.    async d
-00002a40: 6566 2074 6573 745f 6372 6561 7465 5f66  ef test_create_f
-00002a50: 696c 655f 6173 796e 6328 7365 6c66 2c20  ile_async(self, 
-00002a60: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-00002a70: 6e61 6d65 2c20 7374 6f72 6167 655f 6163  name, storage_ac
-00002a80: 636f 756e 745f 6b65 7929 3a0a 2020 2020  count_key):.    
-00002a90: 2020 2020 7365 6c66 2e5f 7365 7475 7028      self._setup(
-00002aa0: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-00002ab0: 6e61 6d65 2c20 7374 6f72 6167 655f 6163  name, storage_ac
-00002ac0: 636f 756e 745f 6b65 7929 0a20 2020 2020  count_key).     
-00002ad0: 2020 2061 7761 6974 2073 656c 662e 5f73     await self._s
-00002ae0: 6574 7570 5f73 6861 7265 2873 746f 7261  etup_share(stora
-00002af0: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
-00002b00: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
-00002b10: 5f6b 6579 290a 2020 2020 2020 2020 6669  _key).        fi
-00002b20: 6c65 5f6e 616d 6520 3d20 7365 6c66 2e5f  le_name = self._
-00002b30: 6765 745f 6669 6c65 5f72 6566 6572 656e  get_file_referen
-00002b40: 6365 2829 0a20 2020 2020 2020 2061 7379  ce().        asy
-00002b50: 6e63 2077 6974 6820 5368 6172 6546 696c  nc with ShareFil
-00002b60: 6543 6c69 656e 7428 0a20 2020 2020 2020  eClient(.       
-00002b70: 2020 2020 2073 656c 662e 6163 636f 756e       self.accoun
-00002b80: 745f 7572 6c28 7374 6f72 6167 655f 6163  t_url(storage_ac
-00002b90: 636f 756e 745f 6e61 6d65 2c20 2266 696c  count_name, "fil
-00002ba0: 6522 292c 0a20 2020 2020 2020 2020 2020  e"),.           
-00002bb0: 2073 6861 7265 5f6e 616d 653d 7365 6c66   share_name=self
-00002bc0: 2e73 6861 7265 5f6e 616d 652c 0a20 2020  .share_name,.   
-00002bd0: 2020 2020 2020 2020 2066 696c 655f 7061           file_pa
-00002be0: 7468 3d66 696c 655f 6e61 6d65 2c0a 2020  th=file_name,.  
-00002bf0: 2020 2020 2020 2020 2020 6372 6564 656e            creden
-00002c00: 7469 616c 3d73 746f 7261 6765 5f61 6363  tial=storage_acc
-00002c10: 6f75 6e74 5f6b 6579 2920 6173 2066 696c  ount_key) as fil
-00002c20: 655f 636c 6965 6e74 3a0a 0a20 2020 2020  e_client:..     
-00002c30: 2020 2020 2020 2023 2041 6374 0a20 2020         # Act.   
-00002c40: 2020 2020 2020 2020 2072 6573 7020 3d20           resp = 
-00002c50: 6177 6169 7420 6669 6c65 5f63 6c69 656e  await file_clien
-00002c60: 742e 6372 6561 7465 5f66 696c 6528 3130  t.create_file(10
-00002c70: 3234 290a 0a20 2020 2020 2020 2020 2020  24)..           
-00002c80: 2023 2041 7373 6572 740a 2020 2020 2020   # Assert.      
-00002c90: 2020 2020 2020 7072 6f70 7320 3d20 6177        props = aw
-00002ca0: 6169 7420 6669 6c65 5f63 6c69 656e 742e  ait file_client.
-00002cb0: 6765 745f 6669 6c65 5f70 726f 7065 7274  get_file_propert
-00002cc0: 6965 7328 290a 2020 2020 2020 2020 2020  ies().          
-00002cd0: 2020 7365 6c66 2e61 7373 6572 7449 734e    self.assertIsN
-00002ce0: 6f74 4e6f 6e65 2870 726f 7073 290a 2020  otNone(props).  
-00002cf0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00002d00: 7373 6572 7445 7175 616c 2870 726f 7073  ssertEqual(props
-00002d10: 2e65 7461 672c 2072 6573 705b 2765 7461  .etag, resp['eta
-00002d20: 6727 5d29 0a20 2020 2020 2020 2020 2020  g']).           
-00002d30: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00002d40: 6c28 7072 6f70 732e 6c61 7374 5f6d 6f64  l(props.last_mod
-00002d50: 6966 6965 642c 2072 6573 705b 276c 6173  ified, resp['las
-00002d60: 745f 6d6f 6469 6669 6564 275d 290a 0a20  t_modified']).. 
-00002d70: 2020 2040 4669 6c65 5368 6172 6550 7265     @FileSharePre
-00002d80: 7061 7265 7228 290a 2020 2020 4041 7379  parer().    @Asy
-00002d90: 6e63 5374 6f72 6167 6554 6573 7443 6173  ncStorageTestCas
-00002da0: 652e 6177 6169 745f 7072 6570 6172 6564  e.await_prepared
-00002db0: 5f74 6573 740a 2020 2020 6173 796e 6320  _test.    async 
-00002dc0: 6465 6620 7465 7374 5f63 7265 6174 655f  def test_create_
-00002dd0: 6669 6c65 5f77 6974 685f 6d65 7461 6461  file_with_metada
-00002de0: 7461 5f61 7379 6e63 2873 656c 662c 2073  ta_async(self, s
-00002df0: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
-00002e00: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
-00002e10: 6f75 6e74 5f6b 6579 293a 0a20 2020 2020  ount_key):.     
-00002e20: 2020 2073 656c 662e 5f73 6574 7570 2873     self._setup(s
-00002e30: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
-00002e40: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
-00002e50: 6f75 6e74 5f6b 6579 290a 2020 2020 2020  ount_key).      
-00002e60: 2020 6177 6169 7420 7365 6c66 2e5f 7365    await self._se
-00002e70: 7475 705f 7368 6172 6528 7374 6f72 6167  tup_share(storag
-00002e80: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
-00002e90: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-00002ea0: 6b65 7929 0a20 2020 2020 2020 206d 6574  key).        met
-00002eb0: 6164 6174 6120 3d20 7b27 6865 6c6c 6f27  adata = {'hello'
-00002ec0: 3a20 2777 6f72 6c64 272c 2027 6e75 6d62  : 'world', 'numb
-00002ed0: 6572 273a 2027 3432 277d 0a20 2020 2020  er': '42'}.     
-00002ee0: 2020 2066 696c 655f 6e61 6d65 203d 2073     file_name = s
-00002ef0: 656c 662e 5f67 6574 5f66 696c 655f 7265  elf._get_file_re
-00002f00: 6665 7265 6e63 6528 290a 2020 2020 2020  ference().      
-00002f10: 2020 6173 796e 6320 7769 7468 2053 6861    async with Sha
-00002f20: 7265 4669 6c65 436c 6965 6e74 280a 2020  reFileClient(.  
-00002f30: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00002f40: 6363 6f75 6e74 5f75 726c 2873 746f 7261  ccount_url(stora
-00002f50: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
-00002f60: 2022 6669 6c65 2229 2c0a 2020 2020 2020   "file"),.      
-00002f70: 2020 2020 2020 7368 6172 655f 6e61 6d65        share_name
-00002f80: 3d73 656c 662e 7368 6172 655f 6e61 6d65  =self.share_name
-00002f90: 2c0a 2020 2020 2020 2020 2020 2020 6669  ,.            fi
-00002fa0: 6c65 5f70 6174 683d 6669 6c65 5f6e 616d  le_path=file_nam
-00002fb0: 652c 0a20 2020 2020 2020 2020 2020 2063  e,.            c
-00002fc0: 7265 6465 6e74 6961 6c3d 7374 6f72 6167  redential=storag
-00002fd0: 655f 6163 636f 756e 745f 6b65 7929 2061  e_account_key) a
-00002fe0: 7320 6669 6c65 5f63 6c69 656e 743a 0a0a  s file_client:..
-00002ff0: 2020 2020 2020 2020 2020 2020 2320 4163              # Ac
-00003000: 740a 2020 2020 2020 2020 2020 2020 7265  t.            re
-00003010: 7370 203d 2061 7761 6974 2066 696c 655f  sp = await file_
-00003020: 636c 6965 6e74 2e63 7265 6174 655f 6669  client.create_fi
-00003030: 6c65 2831 3032 342c 206d 6574 6164 6174  le(1024, metadat
-00003040: 613d 6d65 7461 6461 7461 290a 0a20 2020  a=metadata)..   
-00003050: 2020 2020 2020 2020 2023 2041 7373 6572           # Asser
-00003060: 740a 2020 2020 2020 2020 2020 2020 7072  t.            pr
-00003070: 6f70 7320 3d20 6177 6169 7420 6669 6c65  ops = await file
-00003080: 5f63 6c69 656e 742e 6765 745f 6669 6c65  _client.get_file
-00003090: 5f70 726f 7065 7274 6965 7328 290a 2020  _properties().  
-000030a0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-000030b0: 7373 6572 7449 734e 6f74 4e6f 6e65 2870  ssertIsNotNone(p
-000030c0: 726f 7073 290a 2020 2020 2020 2020 2020  rops).          
-000030d0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-000030e0: 616c 2870 726f 7073 2e65 7461 672c 2072  al(props.etag, r
-000030f0: 6573 705b 2765 7461 6727 5d29 0a20 2020  esp['etag']).   
-00003100: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-00003110: 7365 7274 4571 7561 6c28 7072 6f70 732e  sertEqual(props.
-00003120: 6c61 7374 5f6d 6f64 6966 6965 642c 2072  last_modified, r
-00003130: 6573 705b 276c 6173 745f 6d6f 6469 6669  esp['last_modifi
-00003140: 6564 275d 290a 2020 2020 2020 2020 2020  ed']).          
-00003150: 2020 7365 6c66 2e61 7373 6572 7444 6963    self.assertDic
-00003160: 7445 7175 616c 2870 726f 7073 2e6d 6574  tEqual(props.met
-00003170: 6164 6174 612c 206d 6574 6164 6174 6129  adata, metadata)
-00003180: 0a0a 2020 2020 4046 696c 6553 6861 7265  ..    @FileShare
-00003190: 5072 6570 6172 6572 2829 0a20 2020 2040  Preparer().    @
-000031a0: 4173 796e 6353 746f 7261 6765 5465 7374  AsyncStorageTest
-000031b0: 4361 7365 2e61 7761 6974 5f70 7265 7061  Case.await_prepa
-000031c0: 7265 645f 7465 7374 0a20 2020 2061 7379  red_test.    asy
-000031d0: 6e63 2064 6566 2074 6573 745f 6372 6561  nc def test_crea
-000031e0: 7465 5f66 696c 655f 7768 656e 5f66 696c  te_file_when_fil
-000031f0: 655f 7065 726d 6973 7369 6f6e 5f69 735f  e_permission_is_
-00003200: 746f 6f5f 6c6f 6e67 2873 656c 662c 2073  too_long(self, s
-00003210: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
-00003220: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
-00003230: 6f75 6e74 5f6b 6579 293a 0a20 2020 2020  ount_key):.     
-00003240: 2020 2073 656c 662e 5f73 6574 7570 2873     self._setup(s
-00003250: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
-00003260: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
-00003270: 6f75 6e74 5f6b 6579 290a 2020 2020 2020  ount_key).      
-00003280: 2020 6669 6c65 5f63 6c69 656e 7420 3d20    file_client = 
-00003290: 6177 6169 7420 7365 6c66 2e5f 6765 745f  await self._get_
-000032a0: 6669 6c65 5f63 6c69 656e 7428 7374 6f72  file_client(stor
-000032b0: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
-000032c0: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
-000032d0: 745f 6b65 7929 0a20 2020 2020 2020 2070  t_key).        p
-000032e0: 6572 6d69 7373 696f 6e20 3d20 7374 7228  ermission = str(
-000032f0: 7365 6c66 2e67 6574 5f72 616e 646f 6d5f  self.get_random_
-00003300: 6279 7465 7328 3820 2a20 3130 3234 202b  bytes(8 * 1024 +
-00003310: 2031 2929 0a20 2020 2020 2020 2077 6974   1)).        wit
-00003320: 6820 7365 6c66 2e61 7373 6572 7452 6169  h self.assertRai
-00003330: 7365 7328 5661 6c75 6545 7272 6f72 293a  ses(ValueError):
-00003340: 0a20 2020 2020 2020 2020 2020 2061 7761  .            awa
-00003350: 6974 2066 696c 655f 636c 6965 6e74 2e63  it file_client.c
-00003360: 7265 6174 655f 6669 6c65 2831 3032 342c  reate_file(1024,
-00003370: 2066 696c 655f 7065 726d 6973 7369 6f6e   file_permission
-00003380: 3d70 6572 6d69 7373 696f 6e29 0a0a 2020  =permission)..  
-00003390: 2020 4046 696c 6553 6861 7265 5072 6570    @FileSharePrep
-000033a0: 6172 6572 2829 0a20 2020 2040 4173 796e  arer().    @Asyn
-000033b0: 6353 746f 7261 6765 5465 7374 4361 7365  cStorageTestCase
-000033c0: 2e61 7761 6974 5f70 7265 7061 7265 645f  .await_prepared_
-000033d0: 7465 7374 0a20 2020 2061 7379 6e63 2064  test.    async d
-000033e0: 6566 2074 6573 745f 6372 6561 7465 5f66  ef test_create_f
-000033f0: 696c 655f 7769 7468 5f69 6e76 616c 6964  ile_with_invalid
-00003400: 5f66 696c 655f 7065 726d 6973 7369 6f6e  _file_permission
-00003410: 2873 656c 662c 2073 746f 7261 6765 5f61  (self, storage_a
-00003420: 6363 6f75 6e74 5f6e 616d 652c 2073 746f  ccount_name, sto
-00003430: 7261 6765 5f61 6363 6f75 6e74 5f6b 6579  rage_account_key
-00003440: 293a 0a20 2020 2020 2020 2073 656c 662e  ):.        self.
-00003450: 5f73 6574 7570 2873 746f 7261 6765 5f61  _setup(storage_a
-00003460: 6363 6f75 6e74 5f6e 616d 652c 2073 746f  ccount_name, sto
-00003470: 7261 6765 5f61 6363 6f75 6e74 5f6b 6579  rage_account_key
-00003480: 290a 2020 2020 2020 2020 6669 6c65 5f6e  ).        file_n
-00003490: 616d 6520 3d20 6177 6169 7420 7365 6c66  ame = await self
-000034a0: 2e5f 6765 745f 6669 6c65 5f63 6c69 656e  ._get_file_clien
-000034b0: 7428 7374 6f72 6167 655f 6163 636f 756e  t(storage_accoun
-000034c0: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
-000034d0: 6163 636f 756e 745f 6b65 7929 0a0a 2020  account_key)..  
-000034e0: 2020 2020 2020 7769 7468 2073 656c 662e        with self.
-000034f0: 6173 7365 7274 5261 6973 6573 2848 7474  assertRaises(Htt
-00003500: 7052 6573 706f 6e73 6545 7272 6f72 293a  pResponseError):
-00003510: 0a20 2020 2020 2020 2020 2020 2061 7761  .            awa
-00003520: 6974 2066 696c 655f 6e61 6d65 2e63 7265  it file_name.cre
-00003530: 6174 655f 6669 6c65 2831 3032 342c 2066  ate_file(1024, f
-00003540: 696c 655f 7065 726d 6973 7369 6f6e 3d22  ile_permission="
-00003550: 6162 6364 6522 290a 0a20 2020 2040 4669  abcde")..    @Fi
-00003560: 6c65 5368 6172 6550 7265 7061 7265 7228  leSharePreparer(
-00003570: 290a 2020 2020 4041 7379 6e63 5374 6f72  ).    @AsyncStor
-00003580: 6167 6554 6573 7443 6173 652e 6177 6169  ageTestCase.awai
-00003590: 745f 7072 6570 6172 6564 5f74 6573 740a  t_prepared_test.
-000035a0: 2020 2020 6173 796e 6320 6465 6620 7465      async def te
-000035b0: 7374 5f63 7265 6174 655f 6669 6c65 5f77  st_create_file_w
-000035c0: 6974 685f 6c65 6173 655f 6173 796e 6328  ith_lease_async(
-000035d0: 7365 6c66 2c20 7374 6f72 6167 655f 6163  self, storage_ac
-000035e0: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
-000035f0: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
-00003600: 3a0a 2020 2020 2020 2020 7365 6c66 2e5f  :.        self._
-00003610: 7365 7475 7028 7374 6f72 6167 655f 6163  setup(storage_ac
-00003620: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
-00003630: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
-00003640: 0a20 2020 2020 2020 2066 696c 655f 636c  .        file_cl
-00003650: 6965 6e74 203d 2061 7761 6974 2073 656c  ient = await sel
-00003660: 662e 5f67 6574 5f66 696c 655f 636c 6965  f._get_file_clie
-00003670: 6e74 2873 746f 7261 6765 5f61 6363 6f75  nt(storage_accou
-00003680: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
-00003690: 5f61 6363 6f75 6e74 5f6b 6579 290a 2020  _account_key).  
-000036a0: 2020 2020 2020 6177 6169 7420 6669 6c65        await file
-000036b0: 5f63 6c69 656e 742e 6372 6561 7465 5f66  _client.create_f
-000036c0: 696c 6528 3130 3234 290a 0a20 2020 2020  ile(1024)..     
-000036d0: 2020 206c 6561 7365 203d 2061 7761 6974     lease = await
-000036e0: 2066 696c 655f 636c 6965 6e74 2e61 6371   file_client.acq
-000036f0: 7569 7265 5f6c 6561 7365 2829 0a20 2020  uire_lease().   
-00003700: 2020 2020 2072 6573 7020 3d20 6177 6169       resp = awai
-00003710: 7420 6669 6c65 5f63 6c69 656e 742e 6372  t file_client.cr
-00003720: 6561 7465 5f66 696c 6528 3130 3234 2c20  eate_file(1024, 
-00003730: 6c65 6173 653d 6c65 6173 6529 0a20 2020  lease=lease).   
-00003740: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00003750: 4973 4e6f 744e 6f6e 6528 7265 7370 290a  IsNotNone(resp).
-00003760: 0a20 2020 2020 2020 2023 2054 6865 7265  .        # There
-00003770: 2069 7320 6375 7272 656e 746c 7920 6120   is currently a 
-00003780: 6c65 6173 6520 6f6e 2074 6865 2066 696c  lease on the fil
-00003790: 6520 736f 2074 6865 7265 2073 686f 756c  e so there shoul
-000037a0: 6420 6265 2061 6e20 6578 6365 7074 696f  d be an exceptio
-000037b0: 6e20 7768 656e 2064 656c 6574 6520 7468  n when delete th
-000037c0: 6520 6669 6c65 2077 6974 686f 7574 206c  e file without l
-000037d0: 6561 7365 0a20 2020 2020 2020 2077 6974  ease.        wit
-000037e0: 6820 7365 6c66 2e61 7373 6572 7452 6169  h self.assertRai
-000037f0: 7365 7328 4874 7470 5265 7370 6f6e 7365  ses(HttpResponse
-00003800: 4572 726f 7229 3a0a 2020 2020 2020 2020  Error):.        
-00003810: 2020 2020 6177 6169 7420 6669 6c65 5f63      await file_c
-00003820: 6c69 656e 742e 6465 6c65 7465 5f66 696c  lient.delete_fil
-00003830: 6528 290a 0a20 2020 2020 2020 2023 2054  e()..        # T
-00003840: 6865 7265 2069 7320 6375 7272 656e 746c  here is currentl
-00003850: 7920 6120 6c65 6173 6520 6f6e 2074 6865  y a lease on the
-00003860: 2066 696c 6520 736f 2064 656c 6574 6520   file so delete 
-00003870: 7468 6520 6669 6c65 2077 6974 6820 7468  the file with th
-00003880: 6520 6c65 6173 6520 7769 6c6c 2073 7563  e lease will suc
-00003890: 6365 6564 0a20 2020 2020 2020 2061 7761  ceed.        awa
-000038a0: 6974 2066 696c 655f 636c 6965 6e74 2e64  it file_client.d
-000038b0: 656c 6574 655f 6669 6c65 286c 6561 7365  elete_file(lease
-000038c0: 3d6c 6561 7365 290a 0a20 2020 2040 4669  =lease)..    @Fi
-000038d0: 6c65 5368 6172 6550 7265 7061 7265 7228  leSharePreparer(
-000038e0: 290a 2020 2020 4041 7379 6e63 5374 6f72  ).    @AsyncStor
-000038f0: 6167 6554 6573 7443 6173 652e 6177 6169  ageTestCase.awai
-00003900: 745f 7072 6570 6172 6564 5f74 6573 740a  t_prepared_test.
-00003910: 2020 2020 6173 796e 6320 6465 6620 7465      async def te
-00003920: 7374 5f63 7265 6174 655f 6669 6c65 5f77  st_create_file_w
-00003930: 6974 685f 6368 616e 6765 645f 6c65 6173  ith_changed_leas
-00003940: 655f 6173 796e 6328 7365 6c66 2c20 7374  e_async(self, st
-00003950: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
-00003960: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
-00003970: 756e 745f 6b65 7929 3a0a 2020 2020 2020  unt_key):.      
-00003980: 2020 7365 6c66 2e5f 7365 7475 7028 7374    self._setup(st
-00003990: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
-000039a0: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
-000039b0: 756e 745f 6b65 7929 0a20 2020 2020 2020  unt_key).       
-000039c0: 2066 696c 655f 636c 6965 6e74 203d 2061   file_client = a
-000039d0: 7761 6974 2073 656c 662e 5f67 6574 5f66  wait self._get_f
-000039e0: 696c 655f 636c 6965 6e74 2873 746f 7261  ile_client(stora
-000039f0: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
-00003a00: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
-00003a10: 5f6b 6579 290a 2020 2020 2020 2020 6177  _key).        aw
-00003a20: 6169 7420 6669 6c65 5f63 6c69 656e 742e  ait file_client.
-00003a30: 6372 6561 7465 5f66 696c 6528 3130 3234  create_file(1024
-00003a40: 290a 0a20 2020 2020 2020 206c 6561 7365  )..        lease
-00003a50: 203d 2061 7761 6974 2066 696c 655f 636c   = await file_cl
-00003a60: 6965 6e74 2e61 6371 7569 7265 5f6c 6561  ient.acquire_lea
-00003a70: 7365 2829 0a20 2020 2020 2020 206f 6c64  se().        old
-00003a80: 5f6c 6561 7365 5f69 6420 3d20 6c65 6173  _lease_id = leas
-00003a90: 652e 6964 0a20 2020 2020 2020 2061 7761  e.id.        awa
-00003aa0: 6974 206c 6561 7365 2e63 6861 6e67 6528  it lease.change(
-00003ab0: 7374 7228 7575 6964 2e75 7569 6434 2829  str(uuid.uuid4()
-00003ac0: 2929 0a0a 2020 2020 2020 2020 2320 7573  ))..        # us
-00003ad0: 6520 7468 6520 6f6c 6420 6c65 6173 6520  e the old lease 
-00003ae0: 6964 2074 6f20 6372 6561 7465 2066 696c  id to create fil
-00003af0: 6520 7769 6c6c 2074 6872 6f77 2065 7863  e will throw exc
-00003b00: 6570 7469 6f6e 2e0a 2020 2020 2020 2020  eption..        
-00003b10: 7769 7468 2073 656c 662e 6173 7365 7274  with self.assert
-00003b20: 5261 6973 6573 2848 7474 7052 6573 706f  Raises(HttpRespo
-00003b30: 6e73 6545 7272 6f72 293a 0a20 2020 2020  nseError):.     
-00003b40: 2020 2020 2020 2061 7761 6974 2066 696c         await fil
-00003b50: 655f 636c 6965 6e74 2e63 7265 6174 655f  e_client.create_
-00003b60: 6669 6c65 2831 3032 342c 206c 6561 7365  file(1024, lease
-00003b70: 3d6f 6c64 5f6c 6561 7365 5f69 6429 0a0a  =old_lease_id)..
-00003b80: 2020 2020 2020 2020 2320 7573 6520 7468          # use th
-00003b90: 6520 6e65 7720 6c65 6173 6520 746f 2063  e new lease to c
-00003ba0: 7265 6174 6520 6669 6c65 2077 696c 6c20  reate file will 
-00003bb0: 7375 6363 6565 642e 0a20 2020 2020 2020  succeed..       
-00003bc0: 2072 6573 7020 3d20 6177 6169 7420 6669   resp = await fi
-00003bd0: 6c65 5f63 6c69 656e 742e 6372 6561 7465  le_client.create
-00003be0: 5f66 696c 6528 3130 3234 2c20 6c65 6173  _file(1024, leas
-00003bf0: 653d 6c65 6173 6529 0a0a 2020 2020 2020  e=lease)..      
-00003c00: 2020 7365 6c66 2e61 7373 6572 7449 734e    self.assertIsN
-00003c10: 6f74 4e6f 6e65 2872 6573 7029 0a0a 2020  otNone(resp)..  
-00003c20: 2020 4046 696c 6553 6861 7265 5072 6570    @FileSharePrep
-00003c30: 6172 6572 2829 0a20 2020 2040 4173 796e  arer().    @Asyn
-00003c40: 6353 746f 7261 6765 5465 7374 4361 7365  cStorageTestCase
-00003c50: 2e61 7761 6974 5f70 7265 7061 7265 645f  .await_prepared_
-00003c60: 7465 7374 0a20 2020 2061 7379 6e63 2064  test.    async d
-00003c70: 6566 2074 6573 745f 6372 6561 7465 5f66  ef test_create_f
-00003c80: 696c 655f 7769 6c6c 5f73 6574 5f61 6c6c  ile_will_set_all
-00003c90: 5f73 6d62 5f70 726f 7065 7274 6965 7328  _smb_properties(
-00003ca0: 7365 6c66 2c20 7374 6f72 6167 655f 6163  self, storage_ac
-00003cb0: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
-00003cc0: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
-00003cd0: 3a0a 2020 2020 2020 2020 7365 6c66 2e5f  :.        self._
-00003ce0: 7365 7475 7028 7374 6f72 6167 655f 6163  setup(storage_ac
-00003cf0: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
-00003d00: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
-00003d10: 0a20 2020 2020 2020 2066 696c 655f 636c  .        file_cl
-00003d20: 6965 6e74 203d 2061 7761 6974 2073 656c  ient = await sel
-00003d30: 662e 5f67 6574 5f66 696c 655f 636c 6965  f._get_file_clie
-00003d40: 6e74 2873 746f 7261 6765 5f61 6363 6f75  nt(storage_accou
-00003d50: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
-00003d60: 5f61 6363 6f75 6e74 5f6b 6579 290a 0a20  _account_key).. 
-00003d70: 2020 2020 2020 2023 2041 6374 0a20 2020         # Act.   
-00003d80: 2020 2020 2061 7761 6974 2066 696c 655f       await file_
-00003d90: 636c 6965 6e74 2e63 7265 6174 655f 6669  client.create_fi
-00003da0: 6c65 2831 3032 3429 0a20 2020 2020 2020  le(1024).       
-00003db0: 2066 696c 655f 7072 6f70 6572 7469 6573   file_properties
-00003dc0: 203d 2061 7761 6974 2066 696c 655f 636c   = await file_cl
-00003dd0: 6965 6e74 2e67 6574 5f66 696c 655f 7072  ient.get_file_pr
-00003de0: 6f70 6572 7469 6573 2829 0a0a 2020 2020  operties()..    
-00003df0: 2020 2020 2320 4173 7365 7274 0a20 2020      # Assert.   
-00003e00: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00003e10: 4973 4e6f 744e 6f6e 6528 6669 6c65 5f70  IsNotNone(file_p
-00003e20: 726f 7065 7274 6965 7329 0a20 2020 2020  roperties).     
-00003e30: 2020 2073 656c 662e 6173 7365 7274 4973     self.assertIs
-00003e40: 4e6f 744e 6f6e 6528 6669 6c65 5f70 726f  NotNone(file_pro
-00003e50: 7065 7274 6965 732e 6368 616e 6765 5f74  perties.change_t
-00003e60: 696d 6529 0a20 2020 2020 2020 2073 656c  ime).        sel
-00003e70: 662e 6173 7365 7274 4973 4e6f 744e 6f6e  f.assertIsNotNon
-00003e80: 6528 6669 6c65 5f70 726f 7065 7274 6965  e(file_propertie
-00003e90: 732e 6372 6561 7469 6f6e 5f74 696d 6529  s.creation_time)
-00003ea0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00003eb0: 7365 7274 4973 4e6f 744e 6f6e 6528 6669  sertIsNotNone(fi
-00003ec0: 6c65 5f70 726f 7065 7274 6965 732e 6669  le_properties.fi
-00003ed0: 6c65 5f61 7474 7269 6275 7465 7329 0a20  le_attributes). 
-00003ee0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00003ef0: 7274 4973 4e6f 744e 6f6e 6528 6669 6c65  rtIsNotNone(file
-00003f00: 5f70 726f 7065 7274 6965 732e 6c61 7374  _properties.last
-00003f10: 5f77 7269 7465 5f74 696d 6529 0a0a 2020  _write_time)..  
-00003f20: 2020 4046 696c 6553 6861 7265 5072 6570    @FileSharePrep
-00003f30: 6172 6572 2829 0a20 2020 2040 4173 796e  arer().    @Asyn
-00003f40: 6353 746f 7261 6765 5465 7374 4361 7365  cStorageTestCase
-00003f50: 2e61 7761 6974 5f70 7265 7061 7265 645f  .await_prepared_
-00003f60: 7465 7374 0a20 2020 2061 7379 6e63 2064  test.    async d
-00003f70: 6566 2074 6573 745f 6372 6561 7465 5f66  ef test_create_f
-00003f80: 696c 655f 7365 745f 736d 625f 7072 6f70  ile_set_smb_prop
-00003f90: 6572 7469 6573 2873 656c 662c 2073 746f  erties(self, sto
-00003fa0: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
-00003fb0: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
-00003fc0: 6e74 5f6b 6579 293a 0a20 2020 2020 2020  nt_key):.       
-00003fd0: 2073 656c 662e 5f73 6574 7570 2873 746f   self._setup(sto
-00003fe0: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
-00003ff0: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
-00004000: 6e74 5f6b 6579 290a 2020 2020 2020 2020  nt_key).        
-00004010: 6669 6c65 5f63 6c69 656e 7420 3d20 6177  file_client = aw
-00004020: 6169 7420 7365 6c66 2e5f 6765 745f 6669  ait self._get_fi
-00004030: 6c65 5f63 6c69 656e 7428 7374 6f72 6167  le_client(storag
-00004040: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
-00004050: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-00004060: 6b65 7929 0a0a 2020 2020 2020 2020 6669  key)..        fi
-00004070: 6c65 5f61 7474 7269 6275 7465 7320 3d20  le_attributes = 
-00004080: 4e54 4653 4174 7472 6962 7574 6573 2872  NTFSAttributes(r
-00004090: 6561 645f 6f6e 6c79 3d54 7275 652c 2061  ead_only=True, a
-000040a0: 7263 6869 7665 3d54 7275 6529 0a20 2020  rchive=True).   
-000040b0: 2020 2020 2066 696c 655f 6372 6561 7469       file_creati
-000040c0: 6f6e 5f74 696d 6520 3d20 6669 6c65 5f6c  on_time = file_l
-000040d0: 6173 745f 7772 6974 655f 7469 6d65 203d  ast_write_time =
-000040e0: 2066 696c 655f 6368 616e 6765 5f74 696d   file_change_tim
-000040f0: 6520 3d20 6461 7465 7469 6d65 2832 3032  e = datetime(202
-00004100: 322c 2033 2c20 3130 2c20 3130 2c20 3134  2, 3, 10, 10, 14
-00004110: 2c20 3330 2c20 3530 3030 3030 290a 0a20  , 30, 500000).. 
-00004120: 2020 2020 2020 2023 2041 6374 0a20 2020         # Act.   
-00004130: 2020 2020 2061 7761 6974 2066 696c 655f       await file_
-00004140: 636c 6965 6e74 2e63 7265 6174 655f 6669  client.create_fi
-00004150: 6c65 280a 2020 2020 2020 2020 2020 2020  le(.            
-00004160: 7369 7a65 3d31 3032 342c 0a20 2020 2020  size=1024,.     
-00004170: 2020 2020 2020 2066 696c 655f 6174 7472         file_attr
-00004180: 6962 7574 6573 3d66 696c 655f 6174 7472  ibutes=file_attr
-00004190: 6962 7574 6573 2c0a 2020 2020 2020 2020  ibutes,.        
-000041a0: 2020 2020 6669 6c65 5f63 7265 6174 696f      file_creatio
-000041b0: 6e5f 7469 6d65 3d66 696c 655f 6372 6561  n_time=file_crea
-000041c0: 7469 6f6e 5f74 696d 652c 0a20 2020 2020  tion_time,.     
-000041d0: 2020 2020 2020 2066 696c 655f 6c61 7374         file_last
-000041e0: 5f77 7269 7465 5f74 696d 653d 6669 6c65  _write_time=file
-000041f0: 5f6c 6173 745f 7772 6974 655f 7469 6d65  _last_write_time
-00004200: 2c0a 2020 2020 2020 2020 2020 2020 6669  ,.            fi
-00004210: 6c65 5f63 6861 6e67 655f 7469 6d65 3d66  le_change_time=f
-00004220: 696c 655f 6368 616e 6765 5f74 696d 6529  ile_change_time)
-00004230: 0a20 2020 2020 2020 2066 696c 655f 7072  .        file_pr
-00004240: 6f70 6572 7469 6573 203d 2061 7761 6974  operties = await
-00004250: 2066 696c 655f 636c 6965 6e74 2e67 6574   file_client.get
-00004260: 5f66 696c 655f 7072 6f70 6572 7469 6573  _file_properties
-00004270: 2829 0a0a 2020 2020 2020 2020 2320 4173  ()..        # As
-00004280: 7365 7274 0a20 2020 2020 2020 2073 656c  sert.        sel
-00004290: 662e 6173 7365 7274 4973 4e6f 744e 6f6e  f.assertIsNotNon
-000042a0: 6528 6669 6c65 5f70 726f 7065 7274 6965  e(file_propertie
-000042b0: 7329 0a20 2020 2020 2020 2073 656c 662e  s).        self.
-000042c0: 6173 7365 7274 4571 7561 6c28 6669 6c65  assertEqual(file
-000042d0: 5f63 7265 6174 696f 6e5f 7469 6d65 2c20  _creation_time, 
-000042e0: 6669 6c65 5f70 726f 7065 7274 6965 732e  file_properties.
-000042f0: 6372 6561 7469 6f6e 5f74 696d 6529 0a20  creation_time). 
-00004300: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00004310: 7274 4571 7561 6c28 6669 6c65 5f6c 6173  rtEqual(file_las
-00004320: 745f 7772 6974 655f 7469 6d65 2c20 6669  t_write_time, fi
-00004330: 6c65 5f70 726f 7065 7274 6965 732e 6c61  le_properties.la
-00004340: 7374 5f77 7269 7465 5f74 696d 6529 0a20  st_write_time). 
-00004350: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00004360: 7274 4571 7561 6c28 6669 6c65 5f63 6861  rtEqual(file_cha
-00004370: 6e67 655f 7469 6d65 2c20 6669 6c65 5f70  nge_time, file_p
-00004380: 726f 7065 7274 6965 732e 6368 616e 6765  roperties.change
-00004390: 5f74 696d 6529 0a20 2020 2020 2020 2073  _time).        s
-000043a0: 656c 662e 6173 7365 7274 496e 2827 5265  elf.assertIn('Re
-000043b0: 6164 4f6e 6c79 272c 2066 696c 655f 7072  adOnly', file_pr
-000043c0: 6f70 6572 7469 6573 2e66 696c 655f 6174  operties.file_at
-000043d0: 7472 6962 7574 6573 290a 2020 2020 2020  tributes).      
-000043e0: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
-000043f0: 2741 7263 6869 7665 272c 2066 696c 655f  'Archive', file_
-00004400: 7072 6f70 6572 7469 6573 2e66 696c 655f  properties.file_
-00004410: 6174 7472 6962 7574 6573 290a 0a20 2020  attributes)..   
-00004420: 2040 4669 6c65 5368 6172 6550 7265 7061   @FileSharePrepa
-00004430: 7265 7228 290a 2020 2020 4041 7379 6e63  rer().    @Async
-00004440: 5374 6f72 6167 6554 6573 7443 6173 652e  StorageTestCase.
-00004450: 6177 6169 745f 7072 6570 6172 6564 5f74  await_prepared_t
-00004460: 6573 740a 2020 2020 6173 796e 6320 6465  est.    async de
-00004470: 6620 7465 7374 5f66 696c 655f 6578 6973  f test_file_exis
-00004480: 7473 5f61 7379 6e63 2873 656c 662c 2073  ts_async(self, s
-00004490: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
-000044a0: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
-000044b0: 6f75 6e74 5f6b 6579 293a 0a20 2020 2020  ount_key):.     
-000044c0: 2020 2073 656c 662e 5f73 6574 7570 2873     self._setup(s
-000044d0: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
-000044e0: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
-000044f0: 6f75 6e74 5f6b 6579 290a 2020 2020 2020  ount_key).      
-00004500: 2020 6669 6c65 5f63 6c69 656e 7420 3d20    file_client = 
-00004510: 6177 6169 7420 7365 6c66 2e5f 6372 6561  await self._crea
-00004520: 7465 5f66 696c 6528 7374 6f72 6167 655f  te_file(storage_
-00004530: 6163 636f 756e 745f 6e61 6d65 2c20 7374  account_name, st
-00004540: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
-00004550: 7929 0a0a 2020 2020 2020 2020 2320 4163  y)..        # Ac
-00004560: 740a 2020 2020 2020 2020 6578 6973 7473  t.        exists
-00004570: 203d 2061 7761 6974 2066 696c 655f 636c   = await file_cl
-00004580: 6965 6e74 2e67 6574 5f66 696c 655f 7072  ient.get_file_pr
-00004590: 6f70 6572 7469 6573 2829 0a0a 2020 2020  operties()..    
-000045a0: 2020 2020 2320 4173 7365 7274 0a20 2020      # Assert.   
-000045b0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-000045c0: 5472 7565 2865 7869 7374 7329 0a0a 2020  True(exists)..  
-000045d0: 2020 4046 696c 6553 6861 7265 5072 6570    @FileSharePrep
-000045e0: 6172 6572 2829 0a20 2020 2061 7379 6e63  arer().    async
-000045f0: 2064 6566 2074 6573 745f 736e 6170 7368   def test_snapsh
-00004600: 6f74 5f65 7869 7374 7328 7365 6c66 2c20  ot_exists(self, 
-00004610: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-00004620: 6e61 6d65 2c20 7374 6f72 6167 655f 6163  name, storage_ac
-00004630: 636f 756e 745f 6b65 7929 3a0a 2020 2020  count_key):.    
-00004640: 2020 2020 7365 6c66 2e5f 7365 7475 7028      self._setup(
-00004650: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-00004660: 6e61 6d65 2c20 7374 6f72 6167 655f 6163  name, storage_ac
-00004670: 636f 756e 745f 6b65 7929 0a20 2020 2020  count_key).     
-00004680: 2020 2061 7761 6974 2073 656c 662e 5f73     await self._s
-00004690: 6574 7570 5f73 6861 7265 2873 746f 7261  etup_share(stora
-000046a0: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
-000046b0: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
-000046c0: 5f6b 6579 290a 2020 2020 2020 2020 7368  _key).        sh
-000046d0: 6172 655f 636c 6965 6e74 203d 2073 656c  are_client = sel
-000046e0: 662e 6673 632e 6765 745f 7368 6172 655f  f.fsc.get_share_
-000046f0: 636c 6965 6e74 2873 656c 662e 7368 6172  client(self.shar
-00004700: 655f 6e61 6d65 290a 2020 2020 2020 2020  e_name).        
-00004710: 6469 7265 6374 6f72 795f 6e61 6d65 203d  directory_name =
-00004720: 2073 656c 662e 6765 745f 7265 736f 7572   self.get_resour
-00004730: 6365 5f6e 616d 6528 2264 6972 6563 746f  ce_name("directo
-00004740: 7279 2229 0a20 2020 2020 2020 2064 6972  ry").        dir
-00004750: 6563 746f 7279 5f63 6c69 656e 7420 3d20  ectory_client = 
-00004760: 6177 6169 7420 7368 6172 655f 636c 6965  await share_clie
-00004770: 6e74 2e63 7265 6174 655f 6469 7265 6374  nt.create_direct
-00004780: 6f72 7928 6469 7265 6374 6f72 795f 6e61  ory(directory_na
-00004790: 6d65 290a 2020 2020 2020 2020 6669 6c65  me).        file
-000047a0: 5f6e 616d 6520 3d20 7365 6c66 2e5f 6765  _name = self._ge
-000047b0: 745f 6669 6c65 5f72 6566 6572 656e 6365  t_file_reference
-000047c0: 2829 0a20 2020 2020 2020 2066 696c 655f  ().        file_
-000047d0: 636c 6965 6e74 203d 2064 6972 6563 746f  client = directo
-000047e0: 7279 5f63 6c69 656e 742e 6765 745f 6669  ry_client.get_fi
-000047f0: 6c65 5f63 6c69 656e 7428 6669 6c65 5f6e  le_client(file_n
-00004800: 616d 6529 0a20 2020 2020 2020 2061 7761  ame).        awa
-00004810: 6974 2066 696c 655f 636c 6965 6e74 2e75  it file_client.u
-00004820: 706c 6f61 645f 6669 6c65 2873 656c 662e  pload_file(self.
-00004830: 7368 6f72 745f 6279 7465 5f64 6174 6129  short_byte_data)
-00004840: 0a0a 2020 2020 2020 2020 736e 6170 7368  ..        snapsh
-00004850: 6f74 203d 2061 7761 6974 2073 6861 7265  ot = await share
-00004860: 5f63 6c69 656e 742e 6372 6561 7465 5f73  _client.create_s
-00004870: 6e61 7073 686f 7428 290a 2020 2020 2020  napshot().      
-00004880: 2020 7368 6172 655f 736e 6170 7368 6f74    share_snapshot
-00004890: 5f63 6c69 656e 7420 3d20 7365 6c66 2e66  _client = self.f
-000048a0: 7363 2e67 6574 5f73 6861 7265 5f63 6c69  sc.get_share_cli
-000048b0: 656e 7428 7365 6c66 2e73 6861 7265 5f6e  ent(self.share_n
-000048c0: 616d 652c 2073 6e61 7073 686f 743d 736e  ame, snapshot=sn
-000048d0: 6170 7368 6f74 290a 2020 2020 2020 2020  apshot).        
-000048e0: 6669 6c65 5f73 6e61 7073 686f 745f 636c  file_snapshot_cl
-000048f0: 6965 6e74 203d 2073 6861 7265 5f73 6e61  ient = share_sna
-00004900: 7073 686f 745f 636c 6965 6e74 2e67 6574  pshot_client.get
-00004910: 5f64 6972 6563 746f 7279 5f63 6c69 656e  _directory_clien
-00004920: 7428 6469 7265 6374 6f72 795f 6e61 6d65  t(directory_name
-00004930: 292e 6765 745f 6669 6c65 5f63 6c69 656e  ).get_file_clien
-00004940: 7428 6669 6c65 5f6e 616d 6529 0a0a 2020  t(file_name)..  
-00004950: 2020 2020 2020 6177 6169 7420 6669 6c65        await file
-00004960: 5f63 6c69 656e 742e 6465 6c65 7465 5f66  _client.delete_f
-00004970: 696c 6528 290a 0a20 2020 2020 2020 2023  ile()..        #
-00004980: 2041 6374 0a20 2020 2020 2020 2070 726f   Act.        pro
-00004990: 7073 203d 2061 7761 6974 2066 696c 655f  ps = await file_
-000049a0: 736e 6170 7368 6f74 5f63 6c69 656e 742e  snapshot_client.
-000049b0: 646f 776e 6c6f 6164 5f66 696c 6528 290a  download_file().
-000049c0: 0a20 2020 2020 2020 2023 2041 7373 6572  .        # Asser
-000049d0: 740a 2020 2020 2020 2020 7365 6c66 2e61  t.        self.a
-000049e0: 7373 6572 7454 7275 6528 7072 6f70 7329  ssertTrue(props)
-000049f0: 0a0a 2020 2020 4046 696c 6553 6861 7265  ..    @FileShare
-00004a00: 5072 6570 6172 6572 2829 0a20 2020 2040  Preparer().    @
-00004a10: 4173 796e 6353 746f 7261 6765 5465 7374  AsyncStorageTest
-00004a20: 4361 7365 2e61 7761 6974 5f70 7265 7061  Case.await_prepa
-00004a30: 7265 645f 7465 7374 0a20 2020 2061 7379  red_test.    asy
-00004a40: 6e63 2064 6566 2074 6573 745f 6669 6c65  nc def test_file
-00004a50: 5f6e 6f74 5f65 7869 7374 735f 6173 796e  _not_exists_asyn
-00004a60: 6328 7365 6c66 2c20 7374 6f72 6167 655f  c(self, storage_
-00004a70: 6163 636f 756e 745f 6e61 6d65 2c20 7374  account_name, st
-00004a80: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
-00004a90: 7929 3a0a 2020 2020 2020 2020 7365 6c66  y):.        self
-00004aa0: 2e5f 7365 7475 7028 7374 6f72 6167 655f  ._setup(storage_
-00004ab0: 6163 636f 756e 745f 6e61 6d65 2c20 7374  account_name, st
-00004ac0: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
-00004ad0: 7929 0a20 2020 2020 2020 2066 696c 655f  y).        file_
-00004ae0: 6e61 6d65 203d 2073 656c 662e 5f67 6574  name = self._get
-00004af0: 5f66 696c 655f 7265 6665 7265 6e63 6528  _file_reference(
-00004b00: 290a 2020 2020 2020 2020 6669 6c65 5f63  ).        file_c
-00004b10: 6c69 656e 7420 3d20 5368 6172 6546 696c  lient = ShareFil
-00004b20: 6543 6c69 656e 7428 0a20 2020 2020 2020  eClient(.       
-00004b30: 2020 2020 2073 656c 662e 6163 636f 756e       self.accoun
-00004b40: 745f 7572 6c28 7374 6f72 6167 655f 6163  t_url(storage_ac
-00004b50: 636f 756e 745f 6e61 6d65 2c20 2266 696c  count_name, "fil
-00004b60: 6522 292c 0a20 2020 2020 2020 2020 2020  e"),.           
-00004b70: 2073 6861 7265 5f6e 616d 653d 7365 6c66   share_name=self
-00004b80: 2e73 6861 7265 5f6e 616d 652c 0a20 2020  .share_name,.   
-00004b90: 2020 2020 2020 2020 2066 696c 655f 7061           file_pa
-00004ba0: 7468 3d22 6d69 7373 696e 6764 6972 2f22  th="missingdir/"
-00004bb0: 202b 2066 696c 655f 6e61 6d65 2c0a 2020   + file_name,.  
-00004bc0: 2020 2020 2020 2020 2020 6372 6564 656e            creden
-00004bd0: 7469 616c 3d73 746f 7261 6765 5f61 6363  tial=storage_acc
-00004be0: 6f75 6e74 5f6b 6579 290a 0a20 2020 2020  ount_key)..     
-00004bf0: 2020 2023 2041 6374 0a20 2020 2020 2020     # Act.       
-00004c00: 2077 6974 6820 7365 6c66 2e61 7373 6572   with self.asser
-00004c10: 7452 6169 7365 7328 5265 736f 7572 6365  tRaises(Resource
-00004c20: 4e6f 7446 6f75 6e64 4572 726f 7229 3a0a  NotFoundError):.
-00004c30: 2020 2020 2020 2020 2020 2020 6177 6169              awai
-00004c40: 7420 6669 6c65 5f63 6c69 656e 742e 6765  t file_client.ge
-00004c50: 745f 6669 6c65 5f70 726f 7065 7274 6965  t_file_propertie
-00004c60: 7328 290a 0a20 2020 2040 4669 6c65 5368  s()..    @FileSh
-00004c70: 6172 6550 7265 7061 7265 7228 290a 2020  arePreparer().  
-00004c80: 2020 4041 7379 6e63 5374 6f72 6167 6554    @AsyncStorageT
-00004c90: 6573 7443 6173 652e 6177 6169 745f 7072  estCase.await_pr
-00004ca0: 6570 6172 6564 5f74 6573 740a 2020 2020  epared_test.    
-00004cb0: 6173 796e 6320 6465 6620 7465 7374 5f66  async def test_f
-00004cc0: 696c 655f 6578 6973 7473 5f77 6974 685f  ile_exists_with_
-00004cd0: 736e 6170 7368 6f74 5f61 7379 6e63 2873  snapshot_async(s
-00004ce0: 656c 662c 2073 746f 7261 6765 5f61 6363  elf, storage_acc
-00004cf0: 6f75 6e74 5f6e 616d 652c 2073 746f 7261  ount_name, stora
-00004d00: 6765 5f61 6363 6f75 6e74 5f6b 6579 293a  ge_account_key):
-00004d10: 0a20 2020 2020 2020 2073 656c 662e 5f73  .        self._s
-00004d20: 6574 7570 2873 746f 7261 6765 5f61 6363  etup(storage_acc
-00004d30: 6f75 6e74 5f6e 616d 652c 2073 746f 7261  ount_name, stora
-00004d40: 6765 5f61 6363 6f75 6e74 5f6b 6579 290a  ge_account_key).
-00004d50: 2020 2020 2020 2020 6669 6c65 5f63 6c69          file_cli
-00004d60: 656e 7420 3d20 6177 6169 7420 7365 6c66  ent = await self
-00004d70: 2e5f 6372 6561 7465 5f66 696c 6528 7374  ._create_file(st
-00004d80: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
-00004d90: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
-00004da0: 756e 745f 6b65 7929 0a20 2020 2020 2020  unt_key).       
-00004db0: 2073 6861 7265 5f63 6c69 656e 7420 3d20   share_client = 
-00004dc0: 7365 6c66 2e66 7363 2e67 6574 5f73 6861  self.fsc.get_sha
-00004dd0: 7265 5f63 6c69 656e 7428 7365 6c66 2e73  re_client(self.s
-00004de0: 6861 7265 5f6e 616d 6529 0a20 2020 2020  hare_name).     
-00004df0: 2020 2073 6e61 7073 686f 7420 3d20 6177     snapshot = aw
-00004e00: 6169 7420 7368 6172 655f 636c 6965 6e74  ait share_client
-00004e10: 2e63 7265 6174 655f 736e 6170 7368 6f74  .create_snapshot
-00004e20: 2829 0a20 2020 2020 2020 2061 7761 6974  ().        await
-00004e30: 2066 696c 655f 636c 6965 6e74 2e64 656c   file_client.del
-00004e40: 6574 655f 6669 6c65 2829 0a0a 2020 2020  ete_file()..    
-00004e50: 2020 2020 2320 4163 740a 2020 2020 2020      # Act.      
-00004e60: 2020 736e 6170 7368 6f74 5f63 6c69 656e    snapshot_clien
-00004e70: 7420 3d20 5368 6172 6546 696c 6543 6c69  t = ShareFileCli
-00004e80: 656e 7428 0a20 2020 2020 2020 2020 2020  ent(.           
-00004e90: 2073 656c 662e 6163 636f 756e 745f 7572   self.account_ur
-00004ea0: 6c28 7374 6f72 6167 655f 6163 636f 756e  l(storage_accoun
-00004eb0: 745f 6e61 6d65 2c20 2266 696c 6522 292c  t_name, "file"),
-00004ec0: 0a20 2020 2020 2020 2020 2020 2073 6861  .            sha
-00004ed0: 7265 5f6e 616d 653d 7365 6c66 2e73 6861  re_name=self.sha
-00004ee0: 7265 5f6e 616d 652c 0a20 2020 2020 2020  re_name,.       
-00004ef0: 2020 2020 2066 696c 655f 7061 7468 3d66       file_path=f
-00004f00: 696c 655f 636c 6965 6e74 2e66 696c 655f  ile_client.file_
-00004f10: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
-00004f20: 2020 736e 6170 7368 6f74 3d73 6e61 7073    snapshot=snaps
-00004f30: 686f 742c 0a20 2020 2020 2020 2020 2020  hot,.           
-00004f40: 2063 7265 6465 6e74 6961 6c3d 7374 6f72   credential=stor
-00004f50: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
-00004f60: 0a20 2020 2020 2020 2070 726f 7073 203d  .        props =
-00004f70: 2061 7761 6974 2073 6e61 7073 686f 745f   await snapshot_
-00004f80: 636c 6965 6e74 2e67 6574 5f66 696c 655f  client.get_file_
-00004f90: 7072 6f70 6572 7469 6573 2829 0a0a 2020  properties()..  
-00004fa0: 2020 2020 2020 2320 4173 7365 7274 0a20        # Assert. 
-00004fb0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00004fc0: 7274 5472 7565 2870 726f 7073 290a 0a20  rtTrue(props).. 
-00004fd0: 2020 2040 4669 6c65 5368 6172 6550 7265     @FileSharePre
-00004fe0: 7061 7265 7228 290a 2020 2020 4041 7379  parer().    @Asy
-00004ff0: 6e63 5374 6f72 6167 6554 6573 7443 6173  ncStorageTestCas
-00005000: 652e 6177 6169 745f 7072 6570 6172 6564  e.await_prepared
-00005010: 5f74 6573 740a 2020 2020 6173 796e 6320  _test.    async 
-00005020: 6465 6620 7465 7374 5f66 696c 655f 6e6f  def test_file_no
-00005030: 745f 6578 6973 7473 5f77 6974 685f 736e  t_exists_with_sn
-00005040: 6170 7368 6f74 5f61 7379 6e63 2873 656c  apshot_async(sel
-00005050: 662c 2073 746f 7261 6765 5f61 6363 6f75  f, storage_accou
-00005060: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
-00005070: 5f61 6363 6f75 6e74 5f6b 6579 293a 0a20  _account_key):. 
-00005080: 2020 2020 2020 2073 656c 662e 5f73 6574         self._set
-00005090: 7570 2873 746f 7261 6765 5f61 6363 6f75  up(storage_accou
-000050a0: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
-000050b0: 5f61 6363 6f75 6e74 5f6b 6579 290a 2020  _account_key).  
-000050c0: 2020 2020 2020 6177 6169 7420 7365 6c66        await self
-000050d0: 2e5f 7365 7475 705f 7368 6172 6528 7374  ._setup_share(st
-000050e0: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
-000050f0: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
-00005100: 756e 745f 6b65 7929 0a20 2020 2020 2020  unt_key).       
-00005110: 2073 6861 7265 5f63 6c69 656e 7420 3d20   share_client = 
-00005120: 7365 6c66 2e66 7363 2e67 6574 5f73 6861  self.fsc.get_sha
-00005130: 7265 5f63 6c69 656e 7428 7365 6c66 2e73  re_client(self.s
-00005140: 6861 7265 5f6e 616d 6529 0a20 2020 2020  hare_name).     
-00005150: 2020 2073 6e61 7073 686f 7420 3d20 6177     snapshot = aw
-00005160: 6169 7420 7368 6172 655f 636c 6965 6e74  ait share_client
-00005170: 2e63 7265 6174 655f 736e 6170 7368 6f74  .create_snapshot
-00005180: 2829 0a0a 2020 2020 2020 2020 6669 6c65  ()..        file
-00005190: 5f63 6c69 656e 7420 3d20 6177 6169 7420  _client = await 
-000051a0: 7365 6c66 2e5f 6372 6561 7465 5f66 696c  self._create_fil
-000051b0: 6528 7374 6f72 6167 655f 6163 636f 756e  e(storage_accoun
-000051c0: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
-000051d0: 6163 636f 756e 745f 6b65 7929 0a0a 2020  account_key)..  
-000051e0: 2020 2020 2020 2320 4163 740a 2020 2020        # Act.    
-000051f0: 2020 2020 736e 6170 7368 6f74 5f63 6c69      snapshot_cli
-00005200: 656e 7420 3d20 5368 6172 6546 696c 6543  ent = ShareFileC
-00005210: 6c69 656e 7428 0a20 2020 2020 2020 2020  lient(.         
-00005220: 2020 2073 656c 662e 6163 636f 756e 745f     self.account_
-00005230: 7572 6c28 7374 6f72 6167 655f 6163 636f  url(storage_acco
-00005240: 756e 745f 6e61 6d65 2c20 2266 696c 6522  unt_name, "file"
-00005250: 292c 0a20 2020 2020 2020 2020 2020 2073  ),.            s
-00005260: 6861 7265 5f6e 616d 653d 7365 6c66 2e73  hare_name=self.s
-00005270: 6861 7265 5f6e 616d 652c 0a20 2020 2020  hare_name,.     
-00005280: 2020 2020 2020 2066 696c 655f 7061 7468         file_path
-00005290: 3d66 696c 655f 636c 6965 6e74 2e66 696c  =file_client.fil
-000052a0: 655f 6e61 6d65 2c0a 2020 2020 2020 2020  e_name,.        
-000052b0: 2020 2020 736e 6170 7368 6f74 3d73 6e61      snapshot=sna
-000052c0: 7073 686f 742c 0a20 2020 2020 2020 2020  pshot,.         
-000052d0: 2020 2063 7265 6465 6e74 6961 6c3d 7374     credential=st
-000052e0: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
-000052f0: 7929 0a0a 2020 2020 2020 2020 2320 4173  y)..        # As
-00005300: 7365 7274 0a20 2020 2020 2020 2077 6974  sert.        wit
-00005310: 6820 7365 6c66 2e61 7373 6572 7452 6169  h self.assertRai
-00005320: 7365 7328 5265 736f 7572 6365 4e6f 7446  ses(ResourceNotF
-00005330: 6f75 6e64 4572 726f 7229 3a0a 2020 2020  oundError):.    
-00005340: 2020 2020 2020 2020 6177 6169 7420 736e          await sn
-00005350: 6170 7368 6f74 5f63 6c69 656e 742e 6765  apshot_client.ge
-00005360: 745f 6669 6c65 5f70 726f 7065 7274 6965  t_file_propertie
-00005370: 7328 290a 0a20 2020 2040 4669 6c65 5368  s()..    @FileSh
-00005380: 6172 6550 7265 7061 7265 7228 290a 2020  arePreparer().  
-00005390: 2020 4041 7379 6e63 5374 6f72 6167 6554    @AsyncStorageT
-000053a0: 6573 7443 6173 652e 6177 6169 745f 7072  estCase.await_pr
-000053b0: 6570 6172 6564 5f74 6573 740a 2020 2020  epared_test.    
-000053c0: 6173 796e 6320 6465 6620 7465 7374 5f72  async def test_r
-000053d0: 6573 697a 655f 6669 6c65 5f61 7379 6e63  esize_file_async
-000053e0: 2873 656c 662c 2073 746f 7261 6765 5f61  (self, storage_a
-000053f0: 6363 6f75 6e74 5f6e 616d 652c 2073 746f  ccount_name, sto
-00005400: 7261 6765 5f61 6363 6f75 6e74 5f6b 6579  rage_account_key
-00005410: 293a 0a20 2020 2020 2020 2073 656c 662e  ):.        self.
-00005420: 5f73 6574 7570 2873 746f 7261 6765 5f61  _setup(storage_a
-00005430: 6363 6f75 6e74 5f6e 616d 652c 2073 746f  ccount_name, sto
-00005440: 7261 6765 5f61 6363 6f75 6e74 5f6b 6579  rage_account_key
-00005450: 290a 2020 2020 2020 2020 6669 6c65 5f63  ).        file_c
-00005460: 6c69 656e 7420 3d20 6177 6169 7420 7365  lient = await se
-00005470: 6c66 2e5f 6372 6561 7465 5f66 696c 6528  lf._create_file(
-00005480: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-00005490: 6e61 6d65 2c20 7374 6f72 6167 655f 6163  name, storage_ac
-000054a0: 636f 756e 745f 6b65 7929 0a0a 2020 2020  count_key)..    
-000054b0: 2020 2020 2320 4163 740a 2020 2020 2020      # Act.      
-000054c0: 2020 6177 6169 7420 6669 6c65 5f63 6c69    await file_cli
-000054d0: 656e 742e 7265 7369 7a65 5f66 696c 6528  ent.resize_file(
-000054e0: 3529 0a0a 2020 2020 2020 2020 2320 4173  5)..        # As
-000054f0: 7365 7274 0a20 2020 2020 2020 2070 726f  sert.        pro
-00005500: 7073 203d 2061 7761 6974 2066 696c 655f  ps = await file_
-00005510: 636c 6965 6e74 2e67 6574 5f66 696c 655f  client.get_file_
-00005520: 7072 6f70 6572 7469 6573 2829 0a20 2020  properties().   
-00005530: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00005540: 4571 7561 6c28 7072 6f70 732e 7369 7a65  Equal(props.size
-00005550: 2c20 3529 0a0a 2020 2020 4046 696c 6553  , 5)..    @FileS
-00005560: 6861 7265 5072 6570 6172 6572 2829 0a20  harePreparer(). 
-00005570: 2020 2040 4173 796e 6353 746f 7261 6765     @AsyncStorage
-00005580: 5465 7374 4361 7365 2e61 7761 6974 5f70  TestCase.await_p
-00005590: 7265 7061 7265 645f 7465 7374 0a20 2020  repared_test.   
-000055a0: 2061 7379 6e63 2064 6566 2074 6573 745f   async def test_
-000055b0: 7265 7369 7a65 5f66 696c 655f 7769 7468  resize_file_with
-000055c0: 5f6c 6561 7365 5f61 7379 6e63 2873 656c  _lease_async(sel
-000055d0: 662c 2073 746f 7261 6765 5f61 6363 6f75  f, storage_accou
-000055e0: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
-000055f0: 5f61 6363 6f75 6e74 5f6b 6579 293a 0a20  _account_key):. 
-00005600: 2020 2020 2020 2073 656c 662e 5f73 6574         self._set
-00005610: 7570 2873 746f 7261 6765 5f61 6363 6f75  up(storage_accou
-00005620: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
-00005630: 5f61 6363 6f75 6e74 5f6b 6579 290a 2020  _account_key).  
-00005640: 2020 2020 2020 6669 6c65 5f63 6c69 656e        file_clien
-00005650: 7420 3d20 6177 6169 7420 7365 6c66 2e5f  t = await self._
-00005660: 6372 6561 7465 5f66 696c 6528 7374 6f72  create_file(stor
-00005670: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
-00005680: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
-00005690: 745f 6b65 7929 0a20 2020 2020 2020 206c  t_key).        l
-000056a0: 6561 7365 203d 2061 7761 6974 2066 696c  ease = await fil
-000056b0: 655f 636c 6965 6e74 2e61 6371 7569 7265  e_client.acquire
-000056c0: 5f6c 6561 7365 2829 0a0a 2020 2020 2020  _lease()..      
-000056d0: 2020 2320 4163 740a 2020 2020 2020 2020    # Act.        
-000056e0: 7769 7468 2073 656c 662e 6173 7365 7274  with self.assert
-000056f0: 5261 6973 6573 2848 7474 7052 6573 706f  Raises(HttpRespo
-00005700: 6e73 6545 7272 6f72 293a 0a20 2020 2020  nseError):.     
-00005710: 2020 2020 2020 2061 7761 6974 2066 696c         await fil
-00005720: 655f 636c 6965 6e74 2e72 6573 697a 655f  e_client.resize_
-00005730: 6669 6c65 2835 290a 2020 2020 2020 2020  file(5).        
-00005740: 6177 6169 7420 6669 6c65 5f63 6c69 656e  await file_clien
-00005750: 742e 7265 7369 7a65 5f66 696c 6528 352c  t.resize_file(5,
-00005760: 206c 6561 7365 3d6c 6561 7365 290a 0a20   lease=lease).. 
-00005770: 2020 2020 2020 2023 2041 7373 6572 740a         # Assert.
-00005780: 2020 2020 2020 2020 7072 6f70 7320 3d20          props = 
-00005790: 6177 6169 7420 6669 6c65 5f63 6c69 656e  await file_clien
-000057a0: 742e 6765 745f 6669 6c65 5f70 726f 7065  t.get_file_prope
-000057b0: 7274 6965 7328 290a 2020 2020 2020 2020  rties().        
-000057c0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-000057d0: 2870 726f 7073 2e73 697a 652c 2035 290a  (props.size, 5).
-000057e0: 0a20 2020 2040 4669 6c65 5368 6172 6550  .    @FileShareP
-000057f0: 7265 7061 7265 7228 290a 2020 2020 4041  reparer().    @A
-00005800: 7379 6e63 5374 6f72 6167 6554 6573 7443  syncStorageTestC
-00005810: 6173 652e 6177 6169 745f 7072 6570 6172  ase.await_prepar
-00005820: 6564 5f74 6573 740a 2020 2020 6173 796e  ed_test.    asyn
-00005830: 6320 6465 6620 7465 7374 5f73 6574 5f66  c def test_set_f
-00005840: 696c 655f 7072 6f70 6572 7469 6573 5f61  ile_properties_a
-00005850: 7379 6e63 2873 656c 662c 2073 746f 7261  sync(self, stora
-00005860: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
-00005870: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
-00005880: 5f6b 6579 293a 0a20 2020 2020 2020 2073  _key):.        s
-00005890: 656c 662e 5f73 6574 7570 2873 746f 7261  elf._setup(stora
-000058a0: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
-000058b0: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
-000058c0: 5f6b 6579 290a 2020 2020 2020 2020 6669  _key).        fi
-000058d0: 6c65 5f63 6c69 656e 7420 3d20 6177 6169  le_client = awai
-000058e0: 7420 7365 6c66 2e5f 6372 6561 7465 5f66  t self._create_f
-000058f0: 696c 6528 7374 6f72 6167 655f 6163 636f  ile(storage_acco
-00005900: 756e 745f 6e61 6d65 2c20 7374 6f72 6167  unt_name, storag
-00005910: 655f 6163 636f 756e 745f 6b65 7929 0a0a  e_account_key)..
-00005920: 2020 2020 2020 2020 2320 4163 740a 2020          # Act.  
-00005930: 2020 2020 2020 636f 6e74 656e 745f 7365        content_se
-00005940: 7474 696e 6773 203d 2043 6f6e 7465 6e74  ttings = Content
-00005950: 5365 7474 696e 6773 280a 2020 2020 2020  Settings(.      
-00005960: 2020 2020 2020 636f 6e74 656e 745f 6c61        content_la
-00005970: 6e67 7561 6765 3d27 7370 616e 6973 6827  nguage='spanish'
-00005980: 2c0a 2020 2020 2020 2020 2020 2020 636f  ,.            co
-00005990: 6e74 656e 745f 6469 7370 6f73 6974 696f  ntent_dispositio
-000059a0: 6e3d 2769 6e6c 696e 6527 290a 2020 2020  n='inline').    
-000059b0: 2020 2020 7265 7370 203d 2061 7761 6974      resp = await
-000059c0: 2066 696c 655f 636c 6965 6e74 2e73 6574   file_client.set
-000059d0: 5f68 7474 705f 6865 6164 6572 7328 636f  _http_headers(co
-000059e0: 6e74 656e 745f 7365 7474 696e 6773 3d63  ntent_settings=c
-000059f0: 6f6e 7465 6e74 5f73 6574 7469 6e67 7329  ontent_settings)
-00005a00: 0a0a 2020 2020 2020 2020 2320 4173 7365  ..        # Asse
-00005a10: 7274 0a20 2020 2020 2020 2070 726f 7065  rt.        prope
-00005a20: 7274 6965 7320 3d20 6177 6169 7420 6669  rties = await fi
-00005a30: 6c65 5f63 6c69 656e 742e 6765 745f 6669  le_client.get_fi
-00005a40: 6c65 5f70 726f 7065 7274 6965 7328 290a  le_properties().
-00005a50: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00005a60: 6572 7445 7175 616c 2870 726f 7065 7274  ertEqual(propert
-00005a70: 6965 732e 636f 6e74 656e 745f 7365 7474  ies.content_sett
-00005a80: 696e 6773 2e63 6f6e 7465 6e74 5f6c 616e  ings.content_lan
-00005a90: 6775 6167 652c 2063 6f6e 7465 6e74 5f73  guage, content_s
-00005aa0: 6574 7469 6e67 732e 636f 6e74 656e 745f  ettings.content_
-00005ab0: 6c61 6e67 7561 6765 290a 2020 2020 2020  language).      
-00005ac0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00005ad0: 616c 2870 726f 7065 7274 6965 732e 636f  al(properties.co
-00005ae0: 6e74 656e 745f 7365 7474 696e 6773 2e63  ntent_settings.c
-00005af0: 6f6e 7465 6e74 5f64 6973 706f 7369 7469  ontent_dispositi
-00005b00: 6f6e 2c20 636f 6e74 656e 745f 7365 7474  on, content_sett
-00005b10: 696e 6773 2e63 6f6e 7465 6e74 5f64 6973  ings.content_dis
-00005b20: 706f 7369 7469 6f6e 290a 2020 2020 2020  position).      
-00005b30: 2020 7365 6c66 2e61 7373 6572 7449 734e    self.assertIsN
-00005b40: 6f74 4e6f 6e65 2870 726f 7065 7274 6965  otNone(propertie
-00005b50: 732e 6c61 7374 5f77 7269 7465 5f74 696d  s.last_write_tim
-00005b60: 6529 0a20 2020 2020 2020 2073 656c 662e  e).        self.
-00005b70: 6173 7365 7274 4973 4e6f 744e 6f6e 6528  assertIsNotNone(
-00005b80: 7072 6f70 6572 7469 6573 2e63 7265 6174  properties.creat
-00005b90: 696f 6e5f 7469 6d65 290a 2020 2020 2020  ion_time).      
-00005ba0: 2020 7365 6c66 2e61 7373 6572 7449 734e    self.assertIsN
-00005bb0: 6f74 4e6f 6e65 2870 726f 7065 7274 6965  otNone(propertie
-00005bc0: 732e 7065 726d 6973 7369 6f6e 5f6b 6579  s.permission_key
-00005bd0: 290a 0a20 2020 2040 4669 6c65 5368 6172  )..    @FileShar
-00005be0: 6550 7265 7061 7265 7228 290a 2020 2020  ePreparer().    
-00005bf0: 4041 7379 6e63 5374 6f72 6167 6554 6573  @AsyncStorageTes
-00005c00: 7443 6173 652e 6177 6169 745f 7072 6570  tCase.await_prep
-00005c10: 6172 6564 5f74 6573 740a 2020 2020 6173  ared_test.    as
-00005c20: 796e 6320 6465 6620 7465 7374 5f73 6574  ync def test_set
-00005c30: 5f66 696c 655f 7072 6f70 6572 7469 6573  _file_properties
-00005c40: 5f77 6974 685f 6669 6c65 5f70 6572 6d69  _with_file_permi
-00005c50: 7373 696f 6e28 7365 6c66 2c20 7374 6f72  ssion(self, stor
-00005c60: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
-00005c70: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
-00005c80: 745f 6b65 7929 3a0a 2020 2020 2020 2020  t_key):.        
-00005c90: 7365 6c66 2e5f 7365 7475 7028 7374 6f72  self._setup(stor
-00005ca0: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
-00005cb0: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
-00005cc0: 745f 6b65 7929 0a20 2020 2020 2020 2066  t_key).        f
-00005cd0: 696c 655f 636c 6965 6e74 203d 2061 7761  ile_client = awa
-00005ce0: 6974 2073 656c 662e 5f63 7265 6174 655f  it self._create_
-00005cf0: 6669 6c65 2873 746f 7261 6765 5f61 6363  file(storage_acc
-00005d00: 6f75 6e74 5f6e 616d 652c 2073 746f 7261  ount_name, stora
-00005d10: 6765 5f61 6363 6f75 6e74 5f6b 6579 290a  ge_account_key).
-00005d20: 2020 2020 2020 2020 7072 6f70 6572 7469          properti
-00005d30: 6573 5f6f 6e5f 6372 6561 7469 6f6e 203d  es_on_creation =
-00005d40: 2061 7761 6974 2066 696c 655f 636c 6965   await file_clie
-00005d50: 6e74 2e67 6574 5f66 696c 655f 7072 6f70  nt.get_file_prop
-00005d60: 6572 7469 6573 2829 0a0a 2020 2020 2020  erties()..      
-00005d70: 2020 636f 6e74 656e 745f 7365 7474 696e    content_settin
-00005d80: 6773 203d 2043 6f6e 7465 6e74 5365 7474  gs = ContentSett
-00005d90: 696e 6773 280a 2020 2020 2020 2020 2020  ings(.          
-00005da0: 2020 636f 6e74 656e 745f 6c61 6e67 7561    content_langua
-00005db0: 6765 3d27 7370 616e 6973 6827 2c0a 2020  ge='spanish',.  
-00005dc0: 2020 2020 2020 2020 2020 636f 6e74 656e            conten
-00005dd0: 745f 6469 7370 6f73 6974 696f 6e3d 2769  t_disposition='i
-00005de0: 6e6c 696e 6527 290a 0a20 2020 2020 2020  nline')..       
-00005df0: 206e 7466 735f 6174 7472 6962 7574 6573   ntfs_attributes
-00005e00: 203d 204e 5446 5341 7474 7269 6275 7465   = NTFSAttribute
-00005e10: 7328 6172 6368 6976 653d 5472 7565 2c20  s(archive=True, 
-00005e20: 7465 6d70 6f72 6172 793d 5472 7565 290a  temporary=True).
-00005e30: 2020 2020 2020 2020 6c61 7374 5f77 7269          last_wri
-00005e40: 7465 5f74 696d 6520 3d20 7072 6f70 6572  te_time = proper
-00005e50: 7469 6573 5f6f 6e5f 6372 6561 7469 6f6e  ties_on_creation
-00005e60: 2e6c 6173 745f 7772 6974 655f 7469 6d65  .last_write_time
-00005e70: 202b 2074 696d 6564 656c 7461 2868 6f75   + timedelta(hou
-00005e80: 7273 3d33 290a 2020 2020 2020 2020 6372  rs=3).        cr
-00005e90: 6561 7469 6f6e 5f74 696d 6520 3d20 7072  eation_time = pr
-00005ea0: 6f70 6572 7469 6573 5f6f 6e5f 6372 6561  operties_on_crea
-00005eb0: 7469 6f6e 2e63 7265 6174 696f 6e5f 7469  tion.creation_ti
-00005ec0: 6d65 202b 2074 696d 6564 656c 7461 2868  me + timedelta(h
-00005ed0: 6f75 7273 3d33 290a 2020 2020 2020 2020  ours=3).        
-00005ee0: 6368 616e 6765 5f74 696d 6520 3d20 7072  change_time = pr
-00005ef0: 6f70 6572 7469 6573 5f6f 6e5f 6372 6561  operties_on_crea
-00005f00: 7469 6f6e 2e63 6861 6e67 655f 7469 6d65  tion.change_time
-00005f10: 202b 2074 696d 6564 656c 7461 2868 6f75   + timedelta(hou
-00005f20: 7273 3d33 290a 0a20 2020 2020 2020 2023  rs=3)..        #
-00005f30: 2041 6374 0a20 2020 2020 2020 2061 7761   Act.        awa
-00005f40: 6974 2066 696c 655f 636c 6965 6e74 2e73  it file_client.s
-00005f50: 6574 5f68 7474 705f 6865 6164 6572 7328  et_http_headers(
-00005f60: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-00005f70: 7465 6e74 5f73 6574 7469 6e67 733d 636f  tent_settings=co
-00005f80: 6e74 656e 745f 7365 7474 696e 6773 2c0a  ntent_settings,.
-00005f90: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-00005fa0: 5f61 7474 7269 6275 7465 733d 6e74 6673  _attributes=ntfs
-00005fb0: 5f61 7474 7269 6275 7465 732c 0a20 2020  _attributes,.   
-00005fc0: 2020 2020 2020 2020 2066 696c 655f 6c61           file_la
-00005fd0: 7374 5f77 7269 7465 5f74 696d 653d 6c61  st_write_time=la
-00005fe0: 7374 5f77 7269 7465 5f74 696d 652c 0a20  st_write_time,. 
-00005ff0: 2020 2020 2020 2020 2020 2066 696c 655f             file_
-00006000: 6372 6561 7469 6f6e 5f74 696d 653d 6372  creation_time=cr
-00006010: 6561 7469 6f6e 5f74 696d 652c 0a20 2020  eation_time,.   
-00006020: 2020 2020 2020 2020 2066 696c 655f 6368           file_ch
-00006030: 616e 6765 5f74 696d 653d 6368 616e 6765  ange_time=change
-00006040: 5f74 696d 650a 2020 2020 2020 2020 290a  _time.        ).
-00006050: 0a20 2020 2020 2020 2023 2041 7373 6572  .        # Asser
-00006060: 740a 2020 2020 2020 2020 7072 6f70 6572  t.        proper
-00006070: 7469 6573 203d 2061 7761 6974 2066 696c  ties = await fil
-00006080: 655f 636c 6965 6e74 2e67 6574 5f66 696c  e_client.get_fil
-00006090: 655f 7072 6f70 6572 7469 6573 2829 0a20  e_properties(). 
-000060a0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-000060b0: 7274 4571 7561 6c28 7072 6f70 6572 7469  rtEqual(properti
-000060c0: 6573 2e63 6f6e 7465 6e74 5f73 6574 7469  es.content_setti
-000060d0: 6e67 732e 636f 6e74 656e 745f 6c61 6e67  ngs.content_lang
-000060e0: 7561 6765 2c20 636f 6e74 656e 745f 7365  uage, content_se
-000060f0: 7474 696e 6773 2e63 6f6e 7465 6e74 5f6c  ttings.content_l
-00006100: 616e 6775 6167 6529 0a20 2020 2020 2020  anguage).       
-00006110: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00006120: 6c28 7072 6f70 6572 7469 6573 2e63 6f6e  l(properties.con
-00006130: 7465 6e74 5f73 6574 7469 6e67 732e 636f  tent_settings.co
-00006140: 6e74 656e 745f 6469 7370 6f73 6974 696f  ntent_dispositio
-00006150: 6e2c 2063 6f6e 7465 6e74 5f73 6574 7469  n, content_setti
-00006160: 6e67 732e 636f 6e74 656e 745f 6469 7370  ngs.content_disp
-00006170: 6f73 6974 696f 6e29 0a20 2020 2020 2020  osition).       
-00006180: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00006190: 6c28 7072 6f70 6572 7469 6573 2e63 7265  l(properties.cre
-000061a0: 6174 696f 6e5f 7469 6d65 2c20 6372 6561  ation_time, crea
-000061b0: 7469 6f6e 5f74 696d 6529 0a20 2020 2020  tion_time).     
-000061c0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-000061d0: 7561 6c28 7072 6f70 6572 7469 6573 2e6c  ual(properties.l
-000061e0: 6173 745f 7772 6974 655f 7469 6d65 2c20  ast_write_time, 
-000061f0: 6c61 7374 5f77 7269 7465 5f74 696d 6529  last_write_time)
-00006200: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00006210: 7365 7274 4571 7561 6c28 7072 6f70 6572  sertEqual(proper
-00006220: 7469 6573 2e63 6861 6e67 655f 7469 6d65  ties.change_time
-00006230: 2c20 6368 616e 6765 5f74 696d 6529 0a20  , change_time). 
-00006240: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00006250: 7274 496e 2822 4172 6368 6976 6522 2c20  rtIn("Archive", 
-00006260: 7072 6f70 6572 7469 6573 2e66 696c 655f  properties.file_
-00006270: 6174 7472 6962 7574 6573 290a 2020 2020  attributes).    
-00006280: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
-00006290: 6e28 2254 656d 706f 7261 7279 222c 2070  n("Temporary", p
-000062a0: 726f 7065 7274 6965 732e 6669 6c65 5f61  roperties.file_a
-000062b0: 7474 7269 6275 7465 7329 0a0a 2020 2020  ttributes)..    
-000062c0: 4046 696c 6553 6861 7265 5072 6570 6172  @FileSharePrepar
-000062d0: 6572 2829 0a20 2020 2040 4173 796e 6353  er().    @AsyncS
-000062e0: 746f 7261 6765 5465 7374 4361 7365 2e61  torageTestCase.a
-000062f0: 7761 6974 5f70 7265 7061 7265 645f 7465  wait_prepared_te
-00006300: 7374 0a20 2020 2061 7379 6e63 2064 6566  st.    async def
-00006310: 2074 6573 745f 6765 745f 6669 6c65 5f70   test_get_file_p
-00006320: 726f 7065 7274 6965 735f 6173 796e 6328  roperties_async(
-00006330: 7365 6c66 2c20 7374 6f72 6167 655f 6163  self, storage_ac
-00006340: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
-00006350: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
-00006360: 3a0a 2020 2020 2020 2020 7365 6c66 2e5f  :.        self._
-00006370: 7365 7475 7028 7374 6f72 6167 655f 6163  setup(storage_ac
-00006380: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
-00006390: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
-000063a0: 0a20 2020 2020 2020 2066 696c 655f 636c  .        file_cl
-000063b0: 6965 6e74 203d 2061 7761 6974 2073 656c  ient = await sel
-000063c0: 662e 5f63 7265 6174 655f 6669 6c65 2873  f._create_file(s
-000063d0: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
-000063e0: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
-000063f0: 6f75 6e74 5f6b 6579 290a 0a20 2020 2020  ount_key)..     
-00006400: 2020 2023 2041 6374 0a20 2020 2020 2020     # Act.       
-00006410: 2070 726f 7065 7274 6965 7320 3d20 6177   properties = aw
-00006420: 6169 7420 6669 6c65 5f63 6c69 656e 742e  ait file_client.
-00006430: 6765 745f 6669 6c65 5f70 726f 7065 7274  get_file_propert
-00006440: 6965 7328 290a 0a20 2020 2020 2020 2023  ies()..        #
-00006450: 2041 7373 6572 740a 2020 2020 2020 2020   Assert.        
-00006460: 7365 6c66 2e61 7373 6572 7449 734e 6f74  self.assertIsNot
-00006470: 4e6f 6e65 2870 726f 7065 7274 6965 7329  None(properties)
-00006480: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00006490: 7365 7274 4571 7561 6c28 7072 6f70 6572  sertEqual(proper
-000064a0: 7469 6573 2e73 697a 652c 206c 656e 2873  ties.size, len(s
-000064b0: 656c 662e 7368 6f72 745f 6279 7465 5f64  elf.short_byte_d
-000064c0: 6174 6129 290a 0a20 2020 2040 4669 6c65  ata))..    @File
-000064d0: 5368 6172 6550 7265 7061 7265 7228 290a  SharePreparer().
-000064e0: 2020 2020 4041 7379 6e63 5374 6f72 6167      @AsyncStorag
-000064f0: 6554 6573 7443 6173 652e 6177 6169 745f  eTestCase.await_
-00006500: 7072 6570 6172 6564 5f74 6573 740a 2020  prepared_test.  
-00006510: 2020 6173 796e 6320 6465 6620 7465 7374    async def test
-00006520: 5f67 6574 5f66 696c 655f 7072 6f70 6572  _get_file_proper
-00006530: 7469 6573 5f77 6974 685f 696e 7661 6c69  ties_with_invali
-00006540: 645f 6c65 6173 655f 6661 696c 735f 6173  d_lease_fails_as
-00006550: 796e 6328 7365 6c66 2c20 7374 6f72 6167  ync(self, storag
-00006560: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
-00006570: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-00006580: 6b65 7929 3a0a 2020 2020 2020 2020 7365  key):.        se
-00006590: 6c66 2e5f 7365 7475 7028 7374 6f72 6167  lf._setup(storag
-000065a0: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
-000065b0: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-000065c0: 6b65 7929 0a20 2020 2020 2020 2066 696c  key).        fil
-000065d0: 655f 636c 6965 6e74 203d 2061 7761 6974  e_client = await
-000065e0: 2073 656c 662e 5f63 7265 6174 655f 6669   self._create_fi
-000065f0: 6c65 2873 746f 7261 6765 5f61 6363 6f75  le(storage_accou
-00006600: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
-00006610: 5f61 6363 6f75 6e74 5f6b 6579 290a 2020  _account_key).  
-00006620: 2020 2020 2020 6669 6c65 5f63 6c69 656e        file_clien
-00006630: 742e 6163 7175 6972 655f 6c65 6173 6528  t.acquire_lease(
-00006640: 290a 0a20 2020 2020 2020 2023 2041 6374  )..        # Act
-00006650: 0a20 2020 2020 2020 2077 6974 6820 7365  .        with se
-00006660: 6c66 2e61 7373 6572 7452 6169 7365 7328  lf.assertRaises(
-00006670: 4874 7470 5265 7370 6f6e 7365 4572 726f  HttpResponseErro
-00006680: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-00006690: 6177 6169 7420 6669 6c65 5f63 6c69 656e  await file_clien
-000066a0: 742e 6765 745f 6669 6c65 5f70 726f 7065  t.get_file_prope
-000066b0: 7274 6965 7328 6c65 6173 653d 7374 7228  rties(lease=str(
-000066c0: 7575 6964 2e75 7569 6434 2829 2929 0a0a  uuid.uuid4()))..
-000066d0: 2020 2020 2020 2020 2320 6765 7420 7072          # get pr
-000066e0: 6f70 6572 7469 6573 206f 6e20 6120 6c65  operties on a le
-000066f0: 6173 6564 2066 696c 6520 7769 6c6c 2073  ased file will s
-00006700: 7563 6365 6564 0a20 2020 2020 2020 2070  ucceed.        p
-00006710: 726f 7065 7274 6965 7320 3d20 6177 6169  roperties = awai
-00006720: 7420 6669 6c65 5f63 6c69 656e 742e 6765  t file_client.ge
-00006730: 745f 6669 6c65 5f70 726f 7065 7274 6965  t_file_propertie
-00006740: 7328 290a 0a20 2020 2020 2020 2023 2041  s()..        # A
-00006750: 7373 6572 740a 2020 2020 2020 2020 7365  ssert.        se
-00006760: 6c66 2e61 7373 6572 7449 734e 6f74 4e6f  lf.assertIsNotNo
-00006770: 6e65 2870 726f 7065 7274 6965 7329 0a20  ne(properties). 
-00006780: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00006790: 7274 4571 7561 6c28 7072 6f70 6572 7469  rtEqual(properti
-000067a0: 6573 2e73 697a 652c 206c 656e 2873 656c  es.size, len(sel
-000067b0: 662e 7368 6f72 745f 6279 7465 5f64 6174  f.short_byte_dat
-000067c0: 6129 290a 0a20 2020 2040 4669 6c65 5368  a))..    @FileSh
-000067d0: 6172 6550 7265 7061 7265 7228 290a 2020  arePreparer().  
-000067e0: 2020 4041 7379 6e63 5374 6f72 6167 6554    @AsyncStorageT
-000067f0: 6573 7443 6173 652e 6177 6169 745f 7072  estCase.await_pr
-00006800: 6570 6172 6564 5f74 6573 740a 2020 2020  epared_test.    
-00006810: 6173 796e 6320 6465 6620 7465 7374 5f67  async def test_g
-00006820: 6574 5f66 696c 655f 7072 6f70 6572 7469  et_file_properti
-00006830: 6573 5f77 6974 685f 736e 6170 7368 6f74  es_with_snapshot
-00006840: 5f61 7379 6e63 2873 656c 662c 2073 746f  _async(self, sto
-00006850: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
-00006860: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
-00006870: 6e74 5f6b 6579 293a 0a20 2020 2020 2020  nt_key):.       
-00006880: 2073 656c 662e 5f73 6574 7570 2873 746f   self._setup(sto
-00006890: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
-000068a0: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
-000068b0: 6e74 5f6b 6579 290a 2020 2020 2020 2020  nt_key).        
-000068c0: 6669 6c65 5f63 6c69 656e 7420 3d20 6177  file_client = aw
-000068d0: 6169 7420 7365 6c66 2e5f 6372 6561 7465  ait self._create
-000068e0: 5f66 696c 6528 7374 6f72 6167 655f 6163  _file(storage_ac
-000068f0: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
-00006900: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
-00006910: 0a20 2020 2020 2020 206d 6574 6164 6174  .        metadat
-00006920: 6120 3d20 7b22 7465 7374 3122 3a20 2266  a = {"test1": "f
-00006930: 6f6f 222c 2022 7465 7374 3222 3a20 2262  oo", "test2": "b
-00006940: 6172 227d 0a20 2020 2020 2020 2061 7761  ar"}.        awa
-00006950: 6974 2066 696c 655f 636c 6965 6e74 2e73  it file_client.s
-00006960: 6574 5f66 696c 655f 6d65 7461 6461 7461  et_file_metadata
-00006970: 286d 6574 6164 6174 6129 0a0a 2020 2020  (metadata)..    
-00006980: 2020 2020 7368 6172 655f 636c 6965 6e74      share_client
-00006990: 203d 2073 656c 662e 6673 632e 6765 745f   = self.fsc.get_
-000069a0: 7368 6172 655f 636c 6965 6e74 2873 656c  share_client(sel
-000069b0: 662e 7368 6172 655f 6e61 6d65 290a 2020  f.share_name).  
-000069c0: 2020 2020 2020 736e 6170 7368 6f74 203d        snapshot =
-000069d0: 2061 7761 6974 2073 6861 7265 5f63 6c69   await share_cli
-000069e0: 656e 742e 6372 6561 7465 5f73 6e61 7073  ent.create_snaps
-000069f0: 686f 7428 290a 0a20 2020 2020 2020 206d  hot()..        m
-00006a00: 6574 6164 6174 6132 203d 207b 2274 6573  etadata2 = {"tes
-00006a10: 7431 3030 223a 2022 666f 6f31 3030 222c  t100": "foo100",
-00006a20: 2022 7465 7374 3230 3022 3a20 2262 6172   "test200": "bar
-00006a30: 3230 3022 7d0a 2020 2020 2020 2020 6177  200"}.        aw
-00006a40: 6169 7420 6669 6c65 5f63 6c69 656e 742e  ait file_client.
-00006a50: 7365 745f 6669 6c65 5f6d 6574 6164 6174  set_file_metadat
-00006a60: 6128 6d65 7461 6461 7461 3229 0a0a 2020  a(metadata2)..  
-00006a70: 2020 2020 2020 2320 4163 740a 2020 2020        # Act.    
-00006a80: 2020 2020 6669 6c65 5f70 726f 7073 203d      file_props =
-00006a90: 2061 7761 6974 2066 696c 655f 636c 6965   await file_clie
-00006aa0: 6e74 2e67 6574 5f66 696c 655f 7072 6f70  nt.get_file_prop
-00006ab0: 6572 7469 6573 2829 0a20 2020 2020 2020  erties().       
-00006ac0: 2073 6e61 7073 686f 745f 636c 6965 6e74   snapshot_client
-00006ad0: 203d 2053 6861 7265 4669 6c65 436c 6965   = ShareFileClie
-00006ae0: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
-00006af0: 7365 6c66 2e61 6363 6f75 6e74 5f75 726c  self.account_url
-00006b00: 2873 746f 7261 6765 5f61 6363 6f75 6e74  (storage_account
-00006b10: 5f6e 616d 652c 2022 6669 6c65 2229 2c0a  _name, "file"),.
-00006b20: 2020 2020 2020 2020 2020 2020 7368 6172              shar
-00006b30: 655f 6e61 6d65 3d73 656c 662e 7368 6172  e_name=self.shar
-00006b40: 655f 6e61 6d65 2c0a 2020 2020 2020 2020  e_name,.        
-00006b50: 2020 2020 6669 6c65 5f70 6174 683d 6669      file_path=fi
-00006b60: 6c65 5f63 6c69 656e 742e 6669 6c65 5f6e  le_client.file_n
-00006b70: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
-00006b80: 2073 6e61 7073 686f 743d 736e 6170 7368   snapshot=snapsh
-00006b90: 6f74 2c0a 2020 2020 2020 2020 2020 2020  ot,.            
-00006ba0: 6372 6564 656e 7469 616c 3d73 746f 7261  credential=stora
-00006bb0: 6765 5f61 6363 6f75 6e74 5f6b 6579 290a  ge_account_key).
-00006bc0: 2020 2020 2020 2020 736e 6170 7368 6f74          snapshot
-00006bd0: 5f70 726f 7073 203d 2061 7761 6974 2073  _props = await s
-00006be0: 6e61 7073 686f 745f 636c 6965 6e74 2e67  napshot_client.g
-00006bf0: 6574 5f66 696c 655f 7072 6f70 6572 7469  et_file_properti
-00006c00: 6573 2829 0a20 2020 2020 2020 2023 2041  es().        # A
-00006c10: 7373 6572 740a 2020 2020 2020 2020 7365  ssert.        se
-00006c20: 6c66 2e61 7373 6572 7449 734e 6f74 4e6f  lf.assertIsNotNo
-00006c30: 6e65 2866 696c 655f 7072 6f70 7329 0a20  ne(file_props). 
-00006c40: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00006c50: 7274 4973 4e6f 744e 6f6e 6528 736e 6170  rtIsNotNone(snap
-00006c60: 7368 6f74 5f70 726f 7073 290a 2020 2020  shot_props).    
-00006c70: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00006c80: 7175 616c 2873 6e61 7073 686f 745f 7072  qual(snapshot_pr
-00006c90: 6f70 732e 736e 6170 7368 6f74 2c20 736e  ops.snapshot, sn
-00006ca0: 6170 7368 6f74 5f63 6c69 656e 742e 736e  apshot_client.sn
-00006cb0: 6170 7368 6f74 290a 2020 2020 2020 2020  apshot).        
-00006cc0: 7365 6c66 2e61 7373 6572 7444 6963 7445  self.assertDictE
-00006cd0: 7175 616c 286d 6574 6164 6174 612c 2073  qual(metadata, s
-00006ce0: 6e61 7073 686f 745f 7072 6f70 732e 6d65  napshot_props.me
-00006cf0: 7461 6461 7461 290a 0a20 2020 2040 4669  tadata)..    @Fi
-00006d00: 6c65 5368 6172 6550 7265 7061 7265 7228  leSharePreparer(
-00006d10: 290a 2020 2020 4041 7379 6e63 5374 6f72  ).    @AsyncStor
-00006d20: 6167 6554 6573 7443 6173 652e 6177 6169  ageTestCase.awai
-00006d30: 745f 7072 6570 6172 6564 5f74 6573 740a  t_prepared_test.
-00006d40: 2020 2020 6173 796e 6320 6465 6620 7465      async def te
-00006d50: 7374 5f67 6574 5f66 696c 655f 6d65 7461  st_get_file_meta
-00006d60: 6461 7461 5f77 6974 685f 736e 6170 7368  data_with_snapsh
-00006d70: 6f74 5f61 7379 6e63 2873 656c 662c 2073  ot_async(self, s
-00006d80: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
-00006d90: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
-00006da0: 6f75 6e74 5f6b 6579 293a 0a20 2020 2020  ount_key):.     
-00006db0: 2020 2073 656c 662e 5f73 6574 7570 2873     self._setup(s
-00006dc0: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
-00006dd0: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
-00006de0: 6f75 6e74 5f6b 6579 290a 2020 2020 2020  ount_key).      
-00006df0: 2020 6669 6c65 5f63 6c69 656e 7420 3d20    file_client = 
-00006e00: 6177 6169 7420 7365 6c66 2e5f 6372 6561  await self._crea
-00006e10: 7465 5f66 696c 6528 7374 6f72 6167 655f  te_file(storage_
-00006e20: 6163 636f 756e 745f 6e61 6d65 2c20 7374  account_name, st
-00006e30: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
-00006e40: 7929 0a20 2020 2020 2020 206d 6574 6164  y).        metad
-00006e50: 6174 6120 3d20 7b22 7465 7374 3122 3a20  ata = {"test1": 
-00006e60: 2266 6f6f 222c 2022 7465 7374 3222 3a20  "foo", "test2": 
-00006e70: 2262 6172 227d 0a20 2020 2020 2020 2061  "bar"}.        a
-00006e80: 7761 6974 2066 696c 655f 636c 6965 6e74  wait file_client
-00006e90: 2e73 6574 5f66 696c 655f 6d65 7461 6461  .set_file_metada
-00006ea0: 7461 286d 6574 6164 6174 6129 0a0a 2020  ta(metadata)..  
-00006eb0: 2020 2020 2020 7368 6172 655f 636c 6965        share_clie
-00006ec0: 6e74 203d 2073 656c 662e 6673 632e 6765  nt = self.fsc.ge
-00006ed0: 745f 7368 6172 655f 636c 6965 6e74 2873  t_share_client(s
-00006ee0: 656c 662e 7368 6172 655f 6e61 6d65 290a  elf.share_name).
-00006ef0: 2020 2020 2020 2020 736e 6170 7368 6f74          snapshot
-00006f00: 203d 2061 7761 6974 2073 6861 7265 5f63   = await share_c
-00006f10: 6c69 656e 742e 6372 6561 7465 5f73 6e61  lient.create_sna
-00006f20: 7073 686f 7428 290a 2020 2020 2020 2020  pshot().        
-00006f30: 736e 6170 7368 6f74 5f63 6c69 656e 7420  snapshot_client 
-00006f40: 3d20 5368 6172 6546 696c 6543 6c69 656e  = ShareFileClien
-00006f50: 7428 0a20 2020 2020 2020 2020 2020 2073  t(.            s
-00006f60: 656c 662e 6163 636f 756e 745f 7572 6c28  elf.account_url(
-00006f70: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-00006f80: 6e61 6d65 2c20 2266 696c 6522 292c 0a20  name, "file"),. 
-00006f90: 2020 2020 2020 2020 2020 2073 6861 7265             share
-00006fa0: 5f6e 616d 653d 7365 6c66 2e73 6861 7265  _name=self.share
-00006fb0: 5f6e 616d 652c 0a20 2020 2020 2020 2020  _name,.         
-00006fc0: 2020 2066 696c 655f 7061 7468 3d66 696c     file_path=fil
-00006fd0: 655f 636c 6965 6e74 2e66 696c 655f 6e61  e_client.file_na
-00006fe0: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
-00006ff0: 736e 6170 7368 6f74 3d73 6e61 7073 686f  snapshot=snapsho
-00007000: 742c 0a20 2020 2020 2020 2020 2020 2063  t,.            c
-00007010: 7265 6465 6e74 6961 6c3d 7374 6f72 6167  redential=storag
-00007020: 655f 6163 636f 756e 745f 6b65 7929 0a0a  e_account_key)..
-00007030: 2020 2020 2020 2020 6d65 7461 6461 7461          metadata
-00007040: 3220 3d20 7b22 7465 7374 3130 3022 3a20  2 = {"test100": 
-00007050: 2266 6f6f 3130 3022 2c20 2274 6573 7432  "foo100", "test2
-00007060: 3030 223a 2022 6261 7232 3030 227d 0a20  00": "bar200"}. 
-00007070: 2020 2020 2020 2061 7761 6974 2066 696c         await fil
-00007080: 655f 636c 6965 6e74 2e73 6574 5f66 696c  e_client.set_fil
-00007090: 655f 6d65 7461 6461 7461 286d 6574 6164  e_metadata(metad
-000070a0: 6174 6132 290a 0a20 2020 2020 2020 2023  ata2)..        #
-000070b0: 2041 6374 0a20 2020 2020 2020 2066 696c   Act.        fil
-000070c0: 655f 6d65 7461 6461 7461 203d 2061 7761  e_metadata = awa
-000070d0: 6974 2066 696c 655f 636c 6965 6e74 2e67  it file_client.g
-000070e0: 6574 5f66 696c 655f 7072 6f70 6572 7469  et_file_properti
-000070f0: 6573 2829 0a20 2020 2020 2020 2066 696c  es().        fil
-00007100: 655f 736e 6170 7368 6f74 5f6d 6574 6164  e_snapshot_metad
-00007110: 6174 6120 3d20 6177 6169 7420 736e 6170  ata = await snap
-00007120: 7368 6f74 5f63 6c69 656e 742e 6765 745f  shot_client.get_
-00007130: 6669 6c65 5f70 726f 7065 7274 6965 7328  file_properties(
-00007140: 290a 0a20 2020 2020 2020 2023 2041 7373  )..        # Ass
-00007150: 6572 740a 2020 2020 2020 2020 7365 6c66  ert.        self
-00007160: 2e61 7373 6572 7444 6963 7445 7175 616c  .assertDictEqual
-00007170: 286d 6574 6164 6174 6132 2c20 6669 6c65  (metadata2, file
-00007180: 5f6d 6574 6164 6174 612e 6d65 7461 6461  _metadata.metada
-00007190: 7461 290a 2020 2020 2020 2020 7365 6c66  ta).        self
-000071a0: 2e61 7373 6572 7444 6963 7445 7175 616c  .assertDictEqual
-000071b0: 286d 6574 6164 6174 612c 2066 696c 655f  (metadata, file_
-000071c0: 736e 6170 7368 6f74 5f6d 6574 6164 6174  snapshot_metadat
-000071d0: 612e 6d65 7461 6461 7461 290a 0a20 2020  a.metadata)..   
-000071e0: 2040 4669 6c65 5368 6172 6550 7265 7061   @FileSharePrepa
-000071f0: 7265 7228 290a 2020 2020 4041 7379 6e63  rer().    @Async
-00007200: 5374 6f72 6167 6554 6573 7443 6173 652e  StorageTestCase.
-00007210: 6177 6169 745f 7072 6570 6172 6564 5f74  await_prepared_t
-00007220: 6573 740a 2020 2020 6173 796e 6320 6465  est.    async de
-00007230: 6620 7465 7374 5f67 6574 5f66 696c 655f  f test_get_file_
-00007240: 7072 6f70 6572 7469 6573 5f77 6974 685f  properties_with_
-00007250: 6e6f 6e5f 6578 6973 7469 6e67 5f66 696c  non_existing_fil
-00007260: 655f 6173 796e 6328 7365 6c66 2c20 7374  e_async(self, st
-00007270: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
-00007280: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
-00007290: 756e 745f 6b65 7929 3a0a 2020 2020 2020  unt_key):.      
-000072a0: 2020 7365 6c66 2e5f 7365 7475 7028 7374    self._setup(st
-000072b0: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
-000072c0: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
-000072d0: 756e 745f 6b65 7929 0a20 2020 2020 2020  unt_key).       
-000072e0: 2066 696c 655f 6e61 6d65 203d 2073 656c   file_name = sel
-000072f0: 662e 5f67 6574 5f66 696c 655f 7265 6665  f._get_file_refe
-00007300: 7265 6e63 6528 290a 2020 2020 2020 2020  rence().        
-00007310: 6669 6c65 5f63 6c69 656e 7420 3d20 5368  file_client = Sh
-00007320: 6172 6546 696c 6543 6c69 656e 7428 0a20  areFileClient(. 
-00007330: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00007340: 6163 636f 756e 745f 7572 6c28 7374 6f72  account_url(stor
-00007350: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
-00007360: 2c20 2266 696c 6522 292c 0a20 2020 2020  , "file"),.     
-00007370: 2020 2020 2020 2073 6861 7265 5f6e 616d         share_nam
-00007380: 653d 7365 6c66 2e73 6861 7265 5f6e 616d  e=self.share_nam
-00007390: 652c 0a20 2020 2020 2020 2020 2020 2066  e,.            f
-000073a0: 696c 655f 7061 7468 3d66 696c 655f 6e61  ile_path=file_na
-000073b0: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
-000073c0: 6372 6564 656e 7469 616c 3d73 746f 7261  credential=stora
-000073d0: 6765 5f61 6363 6f75 6e74 5f6b 6579 290a  ge_account_key).
-000073e0: 0a20 2020 2020 2020 2023 2041 6374 0a20  .        # Act. 
-000073f0: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
-00007400: 2e61 7373 6572 7452 6169 7365 7328 5265  .assertRaises(Re
-00007410: 736f 7572 6365 4e6f 7446 6f75 6e64 4572  sourceNotFoundEr
-00007420: 726f 7229 3a0a 2020 2020 2020 2020 2020  ror):.          
-00007430: 2020 6177 6169 7420 6669 6c65 5f63 6c69    await file_cli
-00007440: 656e 742e 6765 745f 6669 6c65 5f70 726f  ent.get_file_pro
-00007450: 7065 7274 6965 7328 290a 0a20 2020 2020  perties()..     
-00007460: 2020 2020 2020 2023 2041 7373 6572 740a         # Assert.
-00007470: 0a20 2020 2040 4669 6c65 5368 6172 6550  .    @FileShareP
-00007480: 7265 7061 7265 7228 290a 2020 2020 4041  reparer().    @A
-00007490: 7379 6e63 5374 6f72 6167 6554 6573 7443  syncStorageTestC
-000074a0: 6173 652e 6177 6169 745f 7072 6570 6172  ase.await_prepar
-000074b0: 6564 5f74 6573 740a 2020 2020 6173 796e  ed_test.    asyn
-000074c0: 6320 6465 6620 7465 7374 5f67 6574 5f66  c def test_get_f
-000074d0: 696c 655f 6d65 7461 6461 7461 5f61 7379  ile_metadata_asy
-000074e0: 6e63 2873 656c 662c 2073 746f 7261 6765  nc(self, storage
-000074f0: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
-00007500: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
-00007510: 6579 293a 0a20 2020 2020 2020 2073 656c  ey):.        sel
-00007520: 662e 5f73 6574 7570 2873 746f 7261 6765  f._setup(storage
-00007530: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
-00007540: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
-00007550: 6579 290a 2020 2020 2020 2020 6669 6c65  ey).        file
-00007560: 5f63 6c69 656e 7420 3d20 6177 6169 7420  _client = await 
-00007570: 7365 6c66 2e5f 6372 6561 7465 5f66 696c  self._create_fil
-00007580: 6528 7374 6f72 6167 655f 6163 636f 756e  e(storage_accoun
-00007590: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
-000075a0: 6163 636f 756e 745f 6b65 7929 0a0a 2020  account_key)..  
-000075b0: 2020 2020 2020 2320 4163 740a 2020 2020        # Act.    
-000075c0: 2020 2020 6d64 203d 2061 7761 6974 2066      md = await f
-000075d0: 696c 655f 636c 6965 6e74 2e67 6574 5f66  ile_client.get_f
-000075e0: 696c 655f 7072 6f70 6572 7469 6573 2829  ile_properties()
-000075f0: 0a0a 2020 2020 2020 2020 2320 4173 7365  ..        # Asse
-00007600: 7274 0a20 2020 2020 2020 2073 656c 662e  rt.        self.
-00007610: 6173 7365 7274 4973 4e6f 744e 6f6e 6528  assertIsNotNone(
-00007620: 6d64 2e6d 6574 6164 6174 6129 0a20 2020  md.metadata).   
-00007630: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00007640: 4571 7561 6c28 302c 206c 656e 286d 642e  Equal(0, len(md.
-00007650: 6d65 7461 6461 7461 2929 0a0a 2020 2020  metadata))..    
-00007660: 4070 7974 6573 742e 6d61 726b 2e6c 6976  @pytest.mark.liv
-00007670: 655f 7465 7374 5f6f 6e6c 790a 2020 2020  e_test_only.    
-00007680: 4046 696c 6553 6861 7265 5072 6570 6172  @FileSharePrepar
-00007690: 6572 2829 0a20 2020 2040 4173 796e 6353  er().    @AsyncS
-000076a0: 746f 7261 6765 5465 7374 4361 7365 2e61  torageTestCase.a
-000076b0: 7761 6974 5f70 7265 7061 7265 645f 7465  wait_prepared_te
-000076c0: 7374 0a20 2020 2061 7379 6e63 2064 6566  st.    async def
-000076d0: 2074 6573 745f 7365 745f 6669 6c65 5f6d   test_set_file_m
-000076e0: 6574 6164 6174 615f 7769 7468 5f75 7070  etadata_with_upp
-000076f0: 6572 5f63 6173 655f 6173 796e 6328 7365  er_case_async(se
-00007700: 6c66 2c20 7374 6f72 6167 655f 6163 636f  lf, storage_acco
-00007710: 756e 745f 6e61 6d65 2c20 7374 6f72 6167  unt_name, storag
-00007720: 655f 6163 636f 756e 745f 6b65 7929 3a0a  e_account_key):.
-00007730: 2020 2020 2020 2020 2320 4d61 6b65 2074          # Make t
-00007740: 6869 7320 7465 7374 206c 6976 6520 7465  his test live te
-00007750: 7374 206f 6e6c 792c 2066 6f72 2074 6865  st only, for the
-00007760: 2072 6561 736f 6e20 7468 6174 206d 6574   reason that met
-00007770: 6164 6174 6120 6361 6e20 6f6e 6c79 2062  adata can only b
-00007780: 6520 7265 636f 7264 6564 2069 6e20 6c6f  e recorded in lo
-00007790: 7765 7220 6361 7365 2e0a 2020 2020 2020  wer case..      
-000077a0: 2020 7365 6c66 2e5f 7365 7475 7028 7374    self._setup(st
-000077b0: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
-000077c0: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
-000077d0: 756e 745f 6b65 7929 0a20 2020 2020 2020  unt_key).       
-000077e0: 206d 6574 6164 6174 6120 3d20 7b27 6865   metadata = {'he
-000077f0: 6c6c 6f27 3a20 2777 6f72 6c64 272c 2027  llo': 'world', '
-00007800: 6e75 6d62 6572 273a 2027 3432 272c 2027  number': '42', '
-00007810: 5550 273a 2027 5550 7661 6c27 7d0a 2020  UP': 'UPval'}.  
-00007820: 2020 2020 2020 6669 6c65 5f63 6c69 656e        file_clien
-00007830: 7420 3d20 6177 6169 7420 7365 6c66 2e5f  t = await self._
-00007840: 6372 6561 7465 5f66 696c 6528 7374 6f72  create_file(stor
-00007850: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
-00007860: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
-00007870: 745f 6b65 7929 0a0a 2020 2020 2020 2020  t_key)..        
-00007880: 2320 4163 740a 2020 2020 2020 2020 6177  # Act.        aw
-00007890: 6169 7420 6669 6c65 5f63 6c69 656e 742e  ait file_client.
-000078a0: 7365 745f 6669 6c65 5f6d 6574 6164 6174  set_file_metadat
-000078b0: 6128 6d65 7461 6461 7461 290a 0a20 2020  a(metadata)..   
-000078c0: 2020 2020 2023 2041 7373 6572 740a 2020       # Assert.  
-000078d0: 2020 2020 2020 7072 6f70 7320 3d20 6177        props = aw
-000078e0: 6169 7420 6669 6c65 5f63 6c69 656e 742e  ait file_client.
-000078f0: 6765 745f 6669 6c65 5f70 726f 7065 7274  get_file_propert
-00007900: 6965 7328 290a 2020 2020 2020 2020 6d64  ies().        md
-00007910: 203d 2070 726f 7073 2e6d 6574 6164 6174   = props.metadat
-00007920: 610a 2020 2020 2020 2020 7365 6c66 2e61  a.        self.a
-00007930: 7373 6572 7445 7175 616c 2833 2c20 6c65  ssertEqual(3, le
-00007940: 6e28 6d64 2929 0a20 2020 2020 2020 2073  n(md)).        s
-00007950: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00007960: 6d64 5b27 6865 6c6c 6f27 5d2c 2027 776f  md['hello'], 'wo
-00007970: 726c 6427 290a 2020 2020 2020 2020 7365  rld').        se
-00007980: 6c66 2e61 7373 6572 7445 7175 616c 286d  lf.assertEqual(m
-00007990: 645b 276e 756d 6265 7227 5d2c 2027 3432  d['number'], '42
-000079a0: 2729 0a20 2020 2020 2020 2073 656c 662e  ').        self.
-000079b0: 6173 7365 7274 4571 7561 6c28 6d64 5b27  assertEqual(md['
-000079c0: 5550 275d 2c20 2755 5076 616c 2729 0a20  UP'], 'UPval'). 
-000079d0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-000079e0: 7274 4661 6c73 6528 2775 7027 2069 6e20  rtFalse('up' in 
-000079f0: 6d64 290a 0a20 2020 2040 7079 7465 7374  md)..    @pytest
-00007a00: 2e6d 6172 6b2e 6c69 7665 5f74 6573 745f  .mark.live_test_
-00007a10: 6f6e 6c79 0a20 2020 2040 4669 6c65 5368  only.    @FileSh
-00007a20: 6172 6550 7265 7061 7265 7228 290a 2020  arePreparer().  
-00007a30: 2020 4041 7379 6e63 5374 6f72 6167 6554    @AsyncStorageT
-00007a40: 6573 7443 6173 652e 6177 6169 745f 7072  estCase.await_pr
-00007a50: 6570 6172 6564 5f74 6573 740a 2020 2020  epared_test.    
-00007a60: 6173 796e 6320 6465 6620 7465 7374 5f62  async def test_b
-00007a70: 7265 616b 5f6c 6561 7365 5f77 6974 685f  reak_lease_with_
-00007a80: 6272 6f6b 656e 5f70 6572 696f 645f 6661  broken_period_fa
-00007a90: 696c 7328 7365 6c66 2c20 7374 6f72 6167  ils(self, storag
-00007aa0: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
-00007ab0: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-00007ac0: 6b65 7929 3a0a 2020 2020 2020 2020 7365  key):.        se
-00007ad0: 6c66 2e5f 7365 7475 7028 7374 6f72 6167  lf._setup(storag
-00007ae0: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
-00007af0: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-00007b00: 6b65 7929 0a20 2020 2020 2020 2066 696c  key).        fil
-00007b10: 655f 636c 6965 6e74 203d 2061 7761 6974  e_client = await
-00007b20: 2073 656c 662e 5f63 7265 6174 655f 6669   self._create_fi
-00007b30: 6c65 2873 746f 7261 6765 5f61 6363 6f75  le(storage_accou
-00007b40: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
-00007b50: 5f61 6363 6f75 6e74 5f6b 6579 290a 2020  _account_key).  
-00007b60: 2020 2020 2020 6c65 6173 6520 3d20 6177        lease = aw
-00007b70: 6169 7420 6669 6c65 5f63 6c69 656e 742e  ait file_client.
-00007b80: 6163 7175 6972 655f 6c65 6173 6528 290a  acquire_lease().
-00007b90: 0a20 2020 2020 2020 2023 2041 7373 6572  .        # Asser
-00007ba0: 740a 2020 2020 2020 2020 7365 6c66 2e61  t.        self.a
-00007bb0: 7373 6572 7449 734e 6f74 4e6f 6e65 286c  ssertIsNotNone(l
-00007bc0: 6561 7365 290a 2020 2020 2020 2020 7769  ease).        wi
-00007bd0: 7468 2073 656c 662e 6173 7365 7274 5261  th self.assertRa
-00007be0: 6973 6573 2854 7970 6545 7272 6f72 293a  ises(TypeError):
-00007bf0: 0a20 2020 2020 2020 2020 2020 2061 7761  .            awa
-00007c00: 6974 206c 6561 7365 2e62 7265 616b 5f6c  it lease.break_l
-00007c10: 6561 7365 286c 6561 7365 5f62 7265 616b  ease(lease_break
-00007c20: 5f70 6572 696f 643d 3529 0a0a 2020 2020  _period=5)..    
-00007c30: 4070 7974 6573 742e 6d61 726b 2e6c 6976  @pytest.mark.liv
-00007c40: 655f 7465 7374 5f6f 6e6c 790a 2020 2020  e_test_only.    
-00007c50: 4046 696c 6553 6861 7265 5072 6570 6172  @FileSharePrepar
-00007c60: 6572 2829 0a20 2020 2040 4173 796e 6353  er().    @AsyncS
-00007c70: 746f 7261 6765 5465 7374 4361 7365 2e61  torageTestCase.a
-00007c80: 7761 6974 5f70 7265 7061 7265 645f 7465  wait_prepared_te
-00007c90: 7374 0a20 2020 2061 7379 6e63 2064 6566  st.    async def
-00007ca0: 2074 6573 745f 7365 745f 6669 6c65 5f6d   test_set_file_m
-00007cb0: 6574 6164 6174 615f 7769 7468 5f62 726f  etadata_with_bro
-00007cc0: 6b65 6e5f 6c65 6173 655f 6173 796e 6328  ken_lease_async(
-00007cd0: 7365 6c66 2c20 7374 6f72 6167 655f 6163  self, storage_ac
-00007ce0: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
-00007cf0: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
-00007d00: 3a0a 2020 2020 2020 2020 2320 4d61 6b65  :.        # Make
-00007d10: 2074 6869 7320 7465 7374 206c 6976 6520   this test live 
-00007d20: 7465 7374 206f 6e6c 792c 2066 6f72 2074  test only, for t
-00007d30: 6865 2072 6561 736f 6e20 7468 6174 206d  he reason that m
-00007d40: 6574 6164 6174 6120 6361 6e20 6f6e 6c79  etadata can only
-00007d50: 2062 6520 7265 636f 7264 6564 2069 6e20   be recorded in 
-00007d60: 6c6f 7765 7220 6361 7365 2e0a 2020 2020  lower case..    
-00007d70: 2020 2020 7365 6c66 2e5f 7365 7475 7028      self._setup(
-00007d80: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-00007d90: 6e61 6d65 2c20 7374 6f72 6167 655f 6163  name, storage_ac
-00007da0: 636f 756e 745f 6b65 7929 0a20 2020 2020  count_key).     
-00007db0: 2020 206d 6574 6164 6174 6120 3d20 7b27     metadata = {'
-00007dc0: 6865 6c6c 6f27 3a20 2777 6f72 6c64 272c  hello': 'world',
-00007dd0: 2027 6e75 6d62 6572 273a 2027 3432 272c   'number': '42',
-00007de0: 2027 5550 273a 2027 5550 7661 6c27 7d0a   'UP': 'UPval'}.
-00007df0: 2020 2020 2020 2020 6669 6c65 5f63 6c69          file_cli
-00007e00: 656e 7420 3d20 6177 6169 7420 7365 6c66  ent = await self
-00007e10: 2e5f 6372 6561 7465 5f66 696c 6528 7374  ._create_file(st
-00007e20: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
-00007e30: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
-00007e40: 756e 745f 6b65 7929 0a0a 2020 2020 2020  unt_key)..      
-00007e50: 2020 6c65 6173 6520 3d20 6177 6169 7420    lease = await 
-00007e60: 6669 6c65 5f63 6c69 656e 742e 6163 7175  file_client.acqu
-00007e70: 6972 655f 6c65 6173 6528 290a 2020 2020  ire_lease().    
-00007e80: 2020 2020 7769 7468 2073 656c 662e 6173      with self.as
-00007e90: 7365 7274 5261 6973 6573 2848 7474 7052  sertRaises(HttpR
-00007ea0: 6573 706f 6e73 6545 7272 6f72 293a 0a20  esponseError):. 
-00007eb0: 2020 2020 2020 2020 2020 2061 7761 6974             await
-00007ec0: 2066 696c 655f 636c 6965 6e74 2e73 6574   file_client.set
-00007ed0: 5f66 696c 655f 6d65 7461 6461 7461 286d  _file_metadata(m
-00007ee0: 6574 6164 6174 6129 0a0a 2020 2020 2020  etadata)..      
-00007ef0: 2020 6c65 6173 655f 6964 5f74 6f5f 6265    lease_id_to_be
-00007f00: 5f62 726f 6b65 6e20 3d20 6c65 6173 652e  _broken = lease.
-00007f10: 6964 0a20 2020 2020 2020 2061 7761 6974  id.        await
-00007f20: 206c 6561 7365 2e62 7265 616b 5f6c 6561   lease.break_lea
-00007f30: 7365 2829 0a0a 2020 2020 2020 2020 2320  se()..        # 
-00007f40: 4163 740a 2020 2020 2020 2020 2320 6c65  Act.        # le
-00007f50: 6173 6520 6973 2062 726f 6b65 6e2c 2073  ase is broken, s
-00007f60: 6574 206d 6574 6164 6174 6120 646f 6573  et metadata does
-00007f70: 6e27 7420 7265 7175 6972 6520 6120 6c65  n't require a le
-00007f80: 6173 650a 2020 2020 2020 2020 6177 6169  ase.        awai
-00007f90: 7420 6669 6c65 5f63 6c69 656e 742e 7365  t file_client.se
-00007fa0: 745f 6669 6c65 5f6d 6574 6164 6174 6128  t_file_metadata(
-00007fb0: 7b27 6865 6c6c 6f27 3a20 2777 6f72 6c64  {'hello': 'world
-00007fc0: 277d 290a 2020 2020 2020 2020 7072 6f70  '}).        prop
-00007fd0: 7320 3d20 6177 6169 7420 6669 6c65 5f63  s = await file_c
-00007fe0: 6c69 656e 742e 6765 745f 6669 6c65 5f70  lient.get_file_p
-00007ff0: 726f 7065 7274 6965 7328 290a 2020 2020  roperties().    
-00008000: 2020 2020 2320 4173 7365 7274 0a20 2020      # Assert.   
-00008010: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00008020: 4571 7561 6c28 312c 206c 656e 2870 726f  Equal(1, len(pro
-00008030: 7073 2e6d 6574 6164 6174 6129 290a 2020  ps.metadata)).  
-00008040: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00008050: 7445 7175 616c 2870 726f 7073 2e6d 6574  tEqual(props.met
-00008060: 6164 6174 615b 2768 656c 6c6f 275d 2c20  adata['hello'], 
-00008070: 2777 6f72 6c64 2729 0a0a 2020 2020 2020  'world')..      
-00008080: 2020 2320 4163 740a 2020 2020 2020 2020    # Act.        
-00008090: 6177 6169 7420 6669 6c65 5f63 6c69 656e  await file_clien
-000080a0: 742e 6163 7175 6972 655f 6c65 6173 6528  t.acquire_lease(
-000080b0: 6c65 6173 655f 6964 3d6c 6561 7365 5f69  lease_id=lease_i
-000080c0: 645f 746f 5f62 655f 6272 6f6b 656e 290a  d_to_be_broken).
-000080d0: 2020 2020 2020 2020 6177 6169 7420 6669          await fi
-000080e0: 6c65 5f63 6c69 656e 742e 7365 745f 6669  le_client.set_fi
-000080f0: 6c65 5f6d 6574 6164 6174 6128 6d65 7461  le_metadata(meta
-00008100: 6461 7461 2c20 6c65 6173 653d 6c65 6173  data, lease=leas
-00008110: 655f 6964 5f74 6f5f 6265 5f62 726f 6b65  e_id_to_be_broke
-00008120: 6e29 0a20 2020 2020 2020 2023 2041 7373  n).        # Ass
-00008130: 6572 740a 2020 2020 2020 2020 7072 6f70  ert.        prop
-00008140: 7320 3d20 6177 6169 7420 6669 6c65 5f63  s = await file_c
-00008150: 6c69 656e 742e 6765 745f 6669 6c65 5f70  lient.get_file_p
-00008160: 726f 7065 7274 6965 7328 290a 2020 2020  roperties().    
-00008170: 2020 2020 6d64 203d 2070 726f 7073 2e6d      md = props.m
-00008180: 6574 6164 6174 610a 2020 2020 2020 2020  etadata.        
-00008190: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-000081a0: 2833 2c20 6c65 6e28 6d64 2929 0a20 2020  (3, len(md)).   
-000081b0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-000081c0: 4571 7561 6c28 6d64 5b27 6865 6c6c 6f27  Equal(md['hello'
-000081d0: 5d2c 2027 776f 726c 6427 290a 2020 2020  ], 'world').    
-000081e0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-000081f0: 7175 616c 286d 645b 276e 756d 6265 7227  qual(md['number'
-00008200: 5d2c 2027 3432 2729 0a20 2020 2020 2020  ], '42').       
-00008210: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00008220: 6c28 6d64 5b27 5550 275d 2c20 2755 5076  l(md['UP'], 'UPv
-00008230: 616c 2729 0a20 2020 2020 2020 2073 656c  al').        sel
-00008240: 662e 6173 7365 7274 4661 6c73 6528 2775  f.assertFalse('u
-00008250: 7027 2069 6e20 6d64 290a 0a20 2020 2040  p' in md)..    @
-00008260: 4669 6c65 5368 6172 6550 7265 7061 7265  FileSharePrepare
-00008270: 7228 290a 2020 2020 4041 7379 6e63 5374  r().    @AsyncSt
-00008280: 6f72 6167 6554 6573 7443 6173 652e 6177  orageTestCase.aw
-00008290: 6169 745f 7072 6570 6172 6564 5f74 6573  ait_prepared_tes
-000082a0: 740a 2020 2020 6173 796e 6320 6465 6620  t.    async def 
-000082b0: 7465 7374 5f64 656c 6574 655f 6669 6c65  test_delete_file
-000082c0: 5f77 6974 685f 6578 6973 7469 6e67 5f66  _with_existing_f
-000082d0: 696c 655f 6173 796e 6328 7365 6c66 2c20  ile_async(self, 
-000082e0: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-000082f0: 6e61 6d65 2c20 7374 6f72 6167 655f 6163  name, storage_ac
-00008300: 636f 756e 745f 6b65 7929 3a0a 2020 2020  count_key):.    
-00008310: 2020 2020 7365 6c66 2e5f 7365 7475 7028      self._setup(
-00008320: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-00008330: 6e61 6d65 2c20 7374 6f72 6167 655f 6163  name, storage_ac
-00008340: 636f 756e 745f 6b65 7929 0a20 2020 2020  count_key).     
-00008350: 2020 2066 696c 655f 636c 6965 6e74 203d     file_client =
-00008360: 2061 7761 6974 2073 656c 662e 5f63 7265   await self._cre
-00008370: 6174 655f 6669 6c65 2873 746f 7261 6765  ate_file(storage
-00008380: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
-00008390: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
-000083a0: 6579 290a 0a20 2020 2020 2020 2023 2041  ey)..        # A
-000083b0: 6374 0a20 2020 2020 2020 2061 7761 6974  ct.        await
-000083c0: 2066 696c 655f 636c 6965 6e74 2e64 656c   file_client.del
-000083d0: 6574 655f 6669 6c65 2829 0a0a 2020 2020  ete_file()..    
-000083e0: 2020 2020 2320 4173 7365 7274 0a20 2020      # Assert.   
-000083f0: 2020 2020 2077 6974 6820 7365 6c66 2e61       with self.a
-00008400: 7373 6572 7452 6169 7365 7328 5265 736f  ssertRaises(Reso
-00008410: 7572 6365 4e6f 7446 6f75 6e64 4572 726f  urceNotFoundErro
-00008420: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-00008430: 6177 6169 7420 6669 6c65 5f63 6c69 656e  await file_clien
-00008440: 742e 6765 745f 6669 6c65 5f70 726f 7065  t.get_file_prope
-00008450: 7274 6965 7328 290a 0a20 2020 2040 4669  rties()..    @Fi
-00008460: 6c65 5368 6172 6550 7265 7061 7265 7228  leSharePreparer(
-00008470: 290a 2020 2020 4041 7379 6e63 5374 6f72  ).    @AsyncStor
-00008480: 6167 6554 6573 7443 6173 652e 6177 6169  ageTestCase.awai
-00008490: 745f 7072 6570 6172 6564 5f74 6573 740a  t_prepared_test.
-000084a0: 2020 2020 6173 796e 6320 6465 6620 7465      async def te
-000084b0: 7374 5f64 656c 6574 655f 6669 6c65 5f77  st_delete_file_w
-000084c0: 6974 685f 6e6f 6e5f 6578 6973 7469 6e67  ith_non_existing
-000084d0: 5f66 696c 655f 6173 796e 6328 7365 6c66  _file_async(self
-000084e0: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
-000084f0: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
-00008500: 6163 636f 756e 745f 6b65 7929 3a0a 2020  account_key):.  
-00008510: 2020 2020 2020 7365 6c66 2e5f 7365 7475        self._setu
-00008520: 7028 7374 6f72 6167 655f 6163 636f 756e  p(storage_accoun
-00008530: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
-00008540: 6163 636f 756e 745f 6b65 7929 0a20 2020  account_key).   
-00008550: 2020 2020 2066 696c 655f 6e61 6d65 203d       file_name =
-00008560: 2073 656c 662e 5f67 6574 5f66 696c 655f   self._get_file_
-00008570: 7265 6665 7265 6e63 6528 290a 2020 2020  reference().    
-00008580: 2020 2020 6669 6c65 5f63 6c69 656e 7420      file_client 
-00008590: 3d20 5368 6172 6546 696c 6543 6c69 656e  = ShareFileClien
-000085a0: 7428 0a20 2020 2020 2020 2020 2020 2073  t(.            s
-000085b0: 656c 662e 6163 636f 756e 745f 7572 6c28  elf.account_url(
-000085c0: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-000085d0: 6e61 6d65 2c20 2266 696c 6522 292c 0a20  name, "file"),. 
-000085e0: 2020 2020 2020 2020 2020 2073 6861 7265             share
-000085f0: 5f6e 616d 653d 7365 6c66 2e73 6861 7265  _name=self.share
-00008600: 5f6e 616d 652c 0a20 2020 2020 2020 2020  _name,.         
-00008610: 2020 2066 696c 655f 7061 7468 3d66 696c     file_path=fil
-00008620: 655f 6e61 6d65 2c0a 2020 2020 2020 2020  e_name,.        
-00008630: 2020 2020 6372 6564 656e 7469 616c 3d73      credential=s
-00008640: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
-00008650: 6579 2c0a 2020 2020 2020 2020 2020 2020  ey,.            
-00008660: 7472 616e 7370 6f72 743d 4169 6f68 7474  transport=Aiohtt
-00008670: 7054 6573 7454 7261 6e73 706f 7274 2829  pTestTransport()
-00008680: 290a 0a20 2020 2020 2020 2023 2041 6374  )..        # Act
-00008690: 0a20 2020 2020 2020 2077 6974 6820 7365  .        with se
-000086a0: 6c66 2e61 7373 6572 7452 6169 7365 7328  lf.assertRaises(
-000086b0: 5265 736f 7572 6365 4e6f 7446 6f75 6e64  ResourceNotFound
-000086c0: 4572 726f 7229 3a0a 2020 2020 2020 2020  Error):.        
-000086d0: 2020 2020 6177 6169 7420 6669 6c65 5f63      await file_c
-000086e0: 6c69 656e 742e 6465 6c65 7465 5f66 696c  lient.delete_fil
-000086f0: 6528 290a 0a20 2020 2020 2020 2020 2020  e()..           
-00008700: 2023 2041 7373 6572 740a 0a20 2020 2040   # Assert..    @
-00008710: 4669 6c65 5368 6172 6550 7265 7061 7265  FileSharePrepare
-00008720: 7228 290a 2020 2020 4041 7379 6e63 5374  r().    @AsyncSt
-00008730: 6f72 6167 6554 6573 7443 6173 652e 6177  orageTestCase.aw
-00008740: 6169 745f 7072 6570 6172 6564 5f74 6573  ait_prepared_tes
-00008750: 740a 2020 2020 6173 796e 6320 6465 6620  t.    async def 
-00008760: 7465 7374 5f75 7064 6174 655f 7261 6e67  test_update_rang
-00008770: 655f 6173 796e 6328 7365 6c66 2c20 7374  e_async(self, st
-00008780: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
-00008790: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
-000087a0: 756e 745f 6b65 7929 3a0a 2020 2020 2020  unt_key):.      
-000087b0: 2020 7365 6c66 2e5f 7365 7475 7028 7374    self._setup(st
-000087c0: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
-000087d0: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
-000087e0: 756e 745f 6b65 7929 0a20 2020 2020 2020  unt_key).       
-000087f0: 2066 696c 655f 636c 6965 6e74 203d 2061   file_client = a
-00008800: 7761 6974 2073 656c 662e 5f63 7265 6174  wait self._creat
-00008810: 655f 6669 6c65 2873 746f 7261 6765 5f61  e_file(storage_a
-00008820: 6363 6f75 6e74 5f6e 616d 652c 2073 746f  ccount_name, sto
-00008830: 7261 6765 5f61 6363 6f75 6e74 5f6b 6579  rage_account_key
-00008840: 290a 0a20 2020 2020 2020 2023 2041 6374  )..        # Act
-00008850: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
-00008860: 6227 6162 6364 6566 6768 696a 6b6c 6d6e  b'abcdefghijklmn
-00008870: 6f70 2720 2a20 3332 0a20 2020 2020 2020  op' * 32.       
-00008880: 2061 7761 6974 2066 696c 655f 636c 6965   await file_clie
-00008890: 6e74 2e75 706c 6f61 645f 7261 6e67 6528  nt.upload_range(
-000088a0: 6461 7461 2c20 6f66 6673 6574 3d30 2c20  data, offset=0, 
-000088b0: 6c65 6e67 7468 3d35 3132 290a 0a20 2020  length=512)..   
-000088c0: 2020 2020 2023 2041 7373 6572 740a 2020       # Assert.  
-000088d0: 2020 2020 2020 636f 6e74 656e 7420 3d20        content = 
-000088e0: 6177 6169 7420 6669 6c65 5f63 6c69 656e  await file_clien
-000088f0: 742e 646f 776e 6c6f 6164 5f66 696c 6528  t.download_file(
-00008900: 290a 2020 2020 2020 2020 636f 6e74 656e  ).        conten
-00008910: 7420 3d20 6177 6169 7420 636f 6e74 656e  t = await conten
-00008920: 742e 7265 6164 616c 6c28 290a 2020 2020  t.readall().    
-00008930: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00008940: 7175 616c 2864 6174 612c 2063 6f6e 7465  qual(data, conte
-00008950: 6e74 5b3a 3531 325d 290a 2020 2020 2020  nt[:512]).      
-00008960: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00008970: 616c 2873 656c 662e 7368 6f72 745f 6279  al(self.short_by
-00008980: 7465 5f64 6174 615b 3531 323a 5d2c 2063  te_data[512:], c
-00008990: 6f6e 7465 6e74 5b35 3132 3a5d 290a 0a20  ontent[512:]).. 
-000089a0: 2020 2040 4669 6c65 5368 6172 6550 7265     @FileSharePre
-000089b0: 7061 7265 7228 290a 2020 2020 4041 7379  parer().    @Asy
-000089c0: 6e63 5374 6f72 6167 6554 6573 7443 6173  ncStorageTestCas
-000089d0: 652e 6177 6169 745f 7072 6570 6172 6564  e.await_prepared
-000089e0: 5f74 6573 740a 2020 2020 6173 796e 6320  _test.    async 
-000089f0: 6465 6620 7465 7374 5f75 7064 6174 655f  def test_update_
-00008a00: 7261 6e67 655f 7769 7468 5f6c 6561 7365  range_with_lease
-00008a10: 5f61 7379 6e63 2873 656c 662c 2073 746f  _async(self, sto
-00008a20: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
-00008a30: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
-00008a40: 6e74 5f6b 6579 293a 0a20 2020 2020 2020  nt_key):.       
-00008a50: 2073 656c 662e 5f73 6574 7570 2873 746f   self._setup(sto
-00008a60: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
-00008a70: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
-00008a80: 6e74 5f6b 6579 290a 2020 2020 2020 2020  nt_key).        
-00008a90: 6669 6c65 5f63 6c69 656e 7420 3d20 6177  file_client = aw
-00008aa0: 6169 7420 7365 6c66 2e5f 6372 6561 7465  ait self._create
-00008ab0: 5f66 696c 6528 7374 6f72 6167 655f 6163  _file(storage_ac
-00008ac0: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
-00008ad0: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
-00008ae0: 0a20 2020 2020 2020 206c 6561 7365 203d  .        lease =
-00008af0: 2061 7761 6974 2066 696c 655f 636c 6965   await file_clie
-00008b00: 6e74 2e61 6371 7569 7265 5f6c 6561 7365  nt.acquire_lease
-00008b10: 2829 0a0a 2020 2020 2020 2020 2320 4163  ()..        # Ac
-00008b20: 740a 2020 2020 2020 2020 6461 7461 203d  t.        data =
-00008b30: 2062 2761 6263 6465 6667 6869 6a6b 6c6d   b'abcdefghijklm
-00008b40: 6e6f 7027 202a 2033 320a 2020 2020 2020  nop' * 32.      
-00008b50: 2020 7769 7468 2073 656c 662e 6173 7365    with self.asse
-00008b60: 7274 5261 6973 6573 2848 7474 7052 6573  rtRaises(HttpRes
-00008b70: 706f 6e73 6545 7272 6f72 293a 0a20 2020  ponseError):.   
-00008b80: 2020 2020 2020 2020 2061 7761 6974 2066           await f
-00008b90: 696c 655f 636c 6965 6e74 2e75 706c 6f61  ile_client.uploa
-00008ba0: 645f 7261 6e67 6528 6461 7461 2c20 6f66  d_range(data, of
-00008bb0: 6673 6574 3d30 2c20 6c65 6e67 7468 3d35  fset=0, length=5
-00008bc0: 3132 290a 2020 2020 2020 2020 6177 6169  12).        awai
-00008bd0: 7420 6669 6c65 5f63 6c69 656e 742e 7570  t file_client.up
-00008be0: 6c6f 6164 5f72 616e 6765 2864 6174 612c  load_range(data,
-00008bf0: 206f 6666 7365 743d 302c 206c 656e 6774   offset=0, lengt
-00008c00: 683d 3531 322c 206c 6561 7365 3d6c 6561  h=512, lease=lea
-00008c10: 7365 290a 0a20 2020 2020 2020 2023 2041  se)..        # A
-00008c20: 7373 6572 740a 2020 2020 2020 2020 636f  ssert.        co
-00008c30: 6e74 656e 7420 3d20 6177 6169 7420 6669  ntent = await fi
-00008c40: 6c65 5f63 6c69 656e 742e 646f 776e 6c6f  le_client.downlo
-00008c50: 6164 5f66 696c 6528 290a 2020 2020 2020  ad_file().      
-00008c60: 2020 636f 6e74 656e 7420 3d20 6177 6169    content = awai
-00008c70: 7420 636f 6e74 656e 742e 7265 6164 616c  t content.readal
-00008c80: 6c28 290a 2020 2020 2020 2020 7365 6c66  l().        self
-00008c90: 2e61 7373 6572 7445 7175 616c 2864 6174  .assertEqual(dat
-00008ca0: 612c 2063 6f6e 7465 6e74 5b3a 3531 325d  a, content[:512]
-00008cb0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00008cc0: 7373 6572 7445 7175 616c 2873 656c 662e  ssertEqual(self.
-00008cd0: 7368 6f72 745f 6279 7465 5f64 6174 615b  short_byte_data[
-00008ce0: 3531 323a 5d2c 2063 6f6e 7465 6e74 5b35  512:], content[5
-00008cf0: 3132 3a5d 290a 0a20 2020 2040 4669 6c65  12:])..    @File
-00008d00: 5368 6172 6550 7265 7061 7265 7228 290a  SharePreparer().
-00008d10: 2020 2020 4041 7379 6e63 5374 6f72 6167      @AsyncStorag
-00008d20: 6554 6573 7443 6173 652e 6177 6169 745f  eTestCase.await_
-00008d30: 7072 6570 6172 6564 5f74 6573 740a 2020  prepared_test.  
-00008d40: 2020 6173 796e 6320 6465 6620 7465 7374    async def test
-00008d50: 5f75 7064 6174 655f 7261 6e67 655f 7769  _update_range_wi
-00008d60: 7468 5f6d 6435 5f61 7379 6e63 2873 656c  th_md5_async(sel
-00008d70: 662c 2073 746f 7261 6765 5f61 6363 6f75  f, storage_accou
-00008d80: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
-00008d90: 5f61 6363 6f75 6e74 5f6b 6579 293a 0a20  _account_key):. 
-00008da0: 2020 2020 2020 2073 656c 662e 5f73 6574         self._set
-00008db0: 7570 2873 746f 7261 6765 5f61 6363 6f75  up(storage_accou
-00008dc0: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
-00008dd0: 5f61 6363 6f75 6e74 5f6b 6579 290a 2020  _account_key).  
-00008de0: 2020 2020 2020 6669 6c65 5f63 6c69 656e        file_clien
-00008df0: 7420 3d20 6177 6169 7420 7365 6c66 2e5f  t = await self._
-00008e00: 6372 6561 7465 5f66 696c 6528 7374 6f72  create_file(stor
-00008e10: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
-00008e20: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
-00008e30: 745f 6b65 7929 0a0a 2020 2020 2020 2020  t_key)..        
-00008e40: 2320 4163 740a 2020 2020 2020 2020 6461  # Act.        da
-00008e50: 7461 203d 2062 2761 6263 6465 6667 6869  ta = b'abcdefghi
-00008e60: 6a6b 6c6d 6e6f 7027 202a 2033 320a 2020  jklmnop' * 32.  
-00008e70: 2020 2020 2020 6177 6169 7420 6669 6c65        await file
-00008e80: 5f63 6c69 656e 742e 7570 6c6f 6164 5f72  _client.upload_r
-00008e90: 616e 6765 2864 6174 612c 206f 6666 7365  ange(data, offse
-00008ea0: 743d 302c 206c 656e 6774 683d 3531 322c  t=0, length=512,
-00008eb0: 2076 616c 6964 6174 655f 636f 6e74 656e   validate_conten
-00008ec0: 743d 5472 7565 290a 0a20 2020 2020 2020  t=True)..       
-00008ed0: 2023 2041 7373 6572 740a 0a20 2020 2040   # Assert..    @
-00008ee0: 4669 6c65 5368 6172 6550 7265 7061 7265  FileSharePrepare
-00008ef0: 7228 290a 2020 2020 4041 7379 6e63 5374  r().    @AsyncSt
-00008f00: 6f72 6167 6554 6573 7443 6173 652e 6177  orageTestCase.aw
-00008f10: 6169 745f 7072 6570 6172 6564 5f74 6573  ait_prepared_tes
-00008f20: 740a 2020 2020 6173 796e 6320 6465 6620  t.    async def 
-00008f30: 7465 7374 5f75 7064 6174 655f 7261 6e67  test_update_rang
-00008f40: 655f 6c61 7374 5f77 7269 7474 656e 5f6d  e_last_written_m
-00008f50: 6f64 655f 6e6f 7728 7365 6c66 2c20 7374  ode_now(self, st
-00008f60: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
-00008f70: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
-00008f80: 756e 745f 6b65 7929 3a0a 2020 2020 2020  unt_key):.      
-00008f90: 2020 7365 6c66 2e5f 7365 7475 7028 7374    self._setup(st
-00008fa0: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
-00008fb0: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
-00008fc0: 756e 745f 6b65 7929 0a20 2020 2020 2020  unt_key).       
-00008fd0: 2066 696c 655f 636c 6965 6e74 203d 2061   file_client = a
-00008fe0: 7761 6974 2073 656c 662e 5f63 7265 6174  wait self._creat
-00008ff0: 655f 6669 6c65 2873 746f 7261 6765 5f61  e_file(storage_a
-00009000: 6363 6f75 6e74 5f6e 616d 652c 2073 746f  ccount_name, sto
-00009010: 7261 6765 5f61 6363 6f75 6e74 5f6b 6579  rage_account_key
-00009020: 290a 2020 2020 2020 2020 6375 7272 656e  ).        curren
-00009030: 745f 6c61 7374 5f77 7269 7465 5f74 696d  t_last_write_tim
-00009040: 6520 3d20 2861 7761 6974 2066 696c 655f  e = (await file_
-00009050: 636c 6965 6e74 2e67 6574 5f66 696c 655f  client.get_file_
-00009060: 7072 6f70 6572 7469 6573 2829 292e 6c61  properties()).la
-00009070: 7374 5f77 7269 7465 5f74 696d 650a 0a20  st_write_time.. 
-00009080: 2020 2020 2020 2023 2041 6374 0a20 2020         # Act.   
-00009090: 2020 2020 2064 6174 6120 3d20 6227 6162       data = b'ab
-000090a0: 6364 6566 6768 696a 6b6c 6d6e 6f70 2720  cdefghijklmnop' 
-000090b0: 2a20 3332 0a20 2020 2020 2020 2061 7761  * 32.        awa
-000090c0: 6974 2066 696c 655f 636c 6965 6e74 2e75  it file_client.u
-000090d0: 706c 6f61 645f 7261 6e67 6528 6461 7461  pload_range(data
-000090e0: 2c20 6f66 6673 6574 3d30 2c20 6c65 6e67  , offset=0, leng
-000090f0: 7468 3d35 3132 2c20 6669 6c65 5f6c 6173  th=512, file_las
-00009100: 745f 7772 6974 655f 6d6f 6465 3d22 4e6f  t_write_mode="No
-00009110: 7722 290a 0a20 2020 2020 2020 2023 2041  w")..        # A
-00009120: 7373 6572 740a 2020 2020 2020 2020 6e65  ssert.        ne
-00009130: 775f 6c61 7374 5f77 7269 7465 5f74 696d  w_last_write_tim
-00009140: 6520 3d20 2861 7761 6974 2066 696c 655f  e = (await file_
-00009150: 636c 6965 6e74 2e67 6574 5f66 696c 655f  client.get_file_
-00009160: 7072 6f70 6572 7469 6573 2829 292e 6c61  properties()).la
-00009170: 7374 5f77 7269 7465 5f74 696d 650a 2020  st_write_time.  
-00009180: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00009190: 744e 6f74 4571 7561 6c28 6375 7272 656e  tNotEqual(curren
-000091a0: 745f 6c61 7374 5f77 7269 7465 5f74 696d  t_last_write_tim
-000091b0: 652c 206e 6577 5f6c 6173 745f 7772 6974  e, new_last_writ
-000091c0: 655f 7469 6d65 290a 0a20 2020 2040 4669  e_time)..    @Fi
-000091d0: 6c65 5368 6172 6550 7265 7061 7265 7228  leSharePreparer(
-000091e0: 290a 2020 2020 4041 7379 6e63 5374 6f72  ).    @AsyncStor
-000091f0: 6167 6554 6573 7443 6173 652e 6177 6169  ageTestCase.awai
-00009200: 745f 7072 6570 6172 6564 5f74 6573 740a  t_prepared_test.
-00009210: 2020 2020 6173 796e 6320 6465 6620 7465      async def te
-00009220: 7374 5f75 7064 6174 655f 7261 6e67 655f  st_update_range_
-00009230: 6c61 7374 5f77 7269 7474 656e 5f6d 6f64  last_written_mod
-00009240: 655f 7072 6573 6572 7665 2873 656c 662c  e_preserve(self,
-00009250: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
-00009260: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
-00009270: 6363 6f75 6e74 5f6b 6579 293a 0a20 2020  ccount_key):.   
-00009280: 2020 2020 2073 656c 662e 5f73 6574 7570       self._setup
-00009290: 2873 746f 7261 6765 5f61 6363 6f75 6e74  (storage_account
-000092a0: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
-000092b0: 6363 6f75 6e74 5f6b 6579 290a 2020 2020  ccount_key).    
-000092c0: 2020 2020 6669 6c65 5f63 6c69 656e 7420      file_client 
-000092d0: 3d20 6177 6169 7420 7365 6c66 2e5f 6372  = await self._cr
-000092e0: 6561 7465 5f66 696c 6528 7374 6f72 6167  eate_file(storag
-000092f0: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
-00009300: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-00009310: 6b65 7929 0a20 2020 2020 2020 2063 7572  key).        cur
-00009320: 7265 6e74 5f6c 6173 745f 7772 6974 655f  rent_last_write_
-00009330: 7469 6d65 203d 2028 6177 6169 7420 6669  time = (await fi
-00009340: 6c65 5f63 6c69 656e 742e 6765 745f 6669  le_client.get_fi
-00009350: 6c65 5f70 726f 7065 7274 6965 7328 2929  le_properties())
-00009360: 2e6c 6173 745f 7772 6974 655f 7469 6d65  .last_write_time
-00009370: 0a0a 2020 2020 2020 2020 2320 4163 740a  ..        # Act.
-00009380: 2020 2020 2020 2020 6461 7461 203d 2062          data = b
-00009390: 2761 6263 6465 6667 6869 6a6b 6c6d 6e6f  'abcdefghijklmno
-000093a0: 7027 202a 2033 320a 2020 2020 2020 2020  p' * 32.        
-000093b0: 6177 6169 7420 6669 6c65 5f63 6c69 656e  await file_clien
-000093c0: 742e 7570 6c6f 6164 5f72 616e 6765 2864  t.upload_range(d
-000093d0: 6174 612c 206f 6666 7365 743d 302c 206c  ata, offset=0, l
-000093e0: 656e 6774 683d 3531 322c 2066 696c 655f  ength=512, file_
-000093f0: 6c61 7374 5f77 7269 7465 5f6d 6f64 653d  last_write_mode=
-00009400: 2250 7265 7365 7276 6522 290a 0a20 2020  "Preserve")..   
-00009410: 2020 2020 2023 2041 7373 6572 740a 2020       # Assert.  
-00009420: 2020 2020 2020 6e65 775f 6c61 7374 5f77        new_last_w
-00009430: 7269 7465 5f74 696d 6520 3d20 2861 7761  rite_time = (awa
-00009440: 6974 2066 696c 655f 636c 6965 6e74 2e67  it file_client.g
-00009450: 6574 5f66 696c 655f 7072 6f70 6572 7469  et_file_properti
-00009460: 6573 2829 292e 6c61 7374 5f77 7269 7465  es()).last_write
-00009470: 5f74 696d 650a 2020 2020 2020 2020 7365  _time.        se
-00009480: 6c66 2e61 7373 6572 7445 7175 616c 2863  lf.assertEqual(c
-00009490: 7572 7265 6e74 5f6c 6173 745f 7772 6974  urrent_last_writ
-000094a0: 655f 7469 6d65 2c20 6e65 775f 6c61 7374  e_time, new_last
-000094b0: 5f77 7269 7465 5f74 696d 6529 0a0a 2020  _write_time)..  
-000094c0: 2020 4046 696c 6553 6861 7265 5072 6570    @FileSharePrep
-000094d0: 6172 6572 2829 0a20 2020 2040 4173 796e  arer().    @Asyn
-000094e0: 6353 746f 7261 6765 5465 7374 4361 7365  cStorageTestCase
-000094f0: 2e61 7761 6974 5f70 7265 7061 7265 645f  .await_prepared_
-00009500: 7465 7374 0a20 2020 2061 7379 6e63 2064  test.    async d
-00009510: 6566 2074 6573 745f 7570 6461 7465 5f72  ef test_update_r
-00009520: 616e 6765 5f66 726f 6d5f 6669 6c65 5f75  ange_from_file_u
-00009530: 726c 5f77 6865 6e5f 736f 7572 6365 5f66  rl_when_source_f
-00009540: 696c 655f 646f 6573 5f6e 6f74 5f68 6176  ile_does_not_hav
-00009550: 655f 656e 6f75 6768 5f62 7974 6573 2873  e_enough_bytes(s
-00009560: 656c 662c 2073 746f 7261 6765 5f61 6363  elf, storage_acc
-00009570: 6f75 6e74 5f6e 616d 652c 2073 746f 7261  ount_name, stora
-00009580: 6765 5f61 6363 6f75 6e74 5f6b 6579 293a  ge_account_key):
-00009590: 0a20 2020 2020 2020 2073 656c 662e 5f73  .        self._s
-000095a0: 6574 7570 2873 746f 7261 6765 5f61 6363  etup(storage_acc
-000095b0: 6f75 6e74 5f6e 616d 652c 2073 746f 7261  ount_name, stora
-000095c0: 6765 5f61 6363 6f75 6e74 5f6b 6579 290a  ge_account_key).
-000095d0: 2020 2020 2020 2020 736f 7572 6365 5f66          source_f
-000095e0: 696c 655f 6e61 6d65 203d 2027 7465 7374  ile_name = 'test
-000095f0: 6669 6c65 3127 0a20 2020 2020 2020 2073  file1'.        s
-00009600: 6f75 7263 655f 6669 6c65 5f63 6c69 656e  ource_file_clien
-00009610: 7420 3d20 6177 6169 7420 7365 6c66 2e5f  t = await self._
-00009620: 6372 6561 7465 5f66 696c 6528 7374 6f72  create_file(stor
-00009630: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
-00009640: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
-00009650: 745f 6b65 792c 2066 696c 655f 6e61 6d65  t_key, file_name
-00009660: 3d73 6f75 7263 655f 6669 6c65 5f6e 616d  =source_file_nam
-00009670: 6529 0a0a 2020 2020 2020 2020 6465 7374  e)..        dest
-00009680: 696e 6174 696f 6e5f 6669 6c65 5f6e 616d  ination_file_nam
-00009690: 6520 3d20 2766 696c 6574 6f75 7064 6174  e = 'filetoupdat
-000096a0: 6527 0a20 2020 2020 2020 2064 6573 7469  e'.        desti
-000096b0: 6e61 7469 6f6e 5f66 696c 655f 636c 6965  nation_file_clie
-000096c0: 6e74 203d 2061 7761 6974 2073 656c 662e  nt = await self.
-000096d0: 5f63 7265 6174 655f 6669 6c65 2873 746f  _create_file(sto
-000096e0: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
-000096f0: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
-00009700: 6e74 5f6b 6579 2c20 6669 6c65 5f6e 616d  nt_key, file_nam
-00009710: 653d 6465 7374 696e 6174 696f 6e5f 6669  e=destination_fi
-00009720: 6c65 5f6e 616d 6529 0a0a 2020 2020 2020  le_name)..      
-00009730: 2020 2320 6765 6e65 7261 7465 2053 4153    # generate SAS
-00009740: 2066 6f72 2074 6865 2073 6f75 7263 6520   for the source 
-00009750: 6669 6c65 0a20 2020 2020 2020 2073 6173  file.        sas
-00009760: 5f74 6f6b 656e 5f66 6f72 5f73 6f75 7263  _token_for_sourc
-00009770: 655f 6669 6c65 203d 2067 656e 6572 6174  e_file = generat
-00009780: 655f 6669 6c65 5f73 6173 280a 2020 2020  e_file_sas(.    
-00009790: 2020 2020 2020 2020 736f 7572 6365 5f66          source_f
-000097a0: 696c 655f 636c 6965 6e74 2e61 6363 6f75  ile_client.accou
-000097b0: 6e74 5f6e 616d 652c 0a20 2020 2020 2020  nt_name,.       
-000097c0: 2020 2020 2073 6f75 7263 655f 6669 6c65       source_file
-000097d0: 5f63 6c69 656e 742e 7368 6172 655f 6e61  _client.share_na
-000097e0: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
-000097f0: 736f 7572 6365 5f66 696c 655f 636c 6965  source_file_clie
-00009800: 6e74 2e66 696c 655f 7061 7468 2c0a 2020  nt.file_path,.  
-00009810: 2020 2020 2020 2020 2020 736f 7572 6365            source
-00009820: 5f66 696c 655f 636c 6965 6e74 2e63 7265  _file_client.cre
-00009830: 6465 6e74 6961 6c2e 6163 636f 756e 745f  dential.account_
-00009840: 6b65 7929 0a0a 2020 2020 2020 2020 736f  key)..        so
-00009850: 7572 6365 5f66 696c 655f 7572 6c20 3d20  urce_file_url = 
-00009860: 736f 7572 6365 5f66 696c 655f 636c 6965  source_file_clie
-00009870: 6e74 2e75 726c 202b 2027 3f27 202b 2073  nt.url + '?' + s
-00009880: 6173 5f74 6f6b 656e 5f66 6f72 5f73 6f75  as_token_for_sou
-00009890: 7263 655f 6669 6c65 0a0a 2020 2020 2020  rce_file..      
-000098a0: 2020 2320 4163 740a 2020 2020 2020 2020    # Act.        
-000098b0: 7769 7468 2073 656c 662e 6173 7365 7274  with self.assert
-000098c0: 5261 6973 6573 2848 7474 7052 6573 706f  Raises(HttpRespo
-000098d0: 6e73 6545 7272 6f72 293a 0a20 2020 2020  nseError):.     
-000098e0: 2020 2020 2020 2023 2077 6865 6e20 7468         # when th
-000098f0: 6520 736f 7572 6365 2066 696c 6520 6861  e source file ha
-00009900: 7320 6c65 7373 2062 7974 6573 2074 6861  s less bytes tha
-00009910: 6e20 3230 3530 2c20 7468 726f 7720 6578  n 2050, throw ex
-00009920: 6365 7074 696f 6e0a 2020 2020 2020 2020  ception.        
-00009930: 2020 2020 6177 6169 7420 6465 7374 696e      await destin
-00009940: 6174 696f 6e5f 6669 6c65 5f63 6c69 656e  ation_file_clien
-00009950: 742e 7570 6c6f 6164 5f72 616e 6765 5f66  t.upload_range_f
-00009960: 726f 6d5f 7572 6c28 736f 7572 6365 5f66  rom_url(source_f
-00009970: 696c 655f 7572 6c2c 206f 6666 7365 743d  ile_url, offset=
-00009980: 302c 206c 656e 6774 683d 3230 3530 2c20  0, length=2050, 
-00009990: 736f 7572 6365 5f6f 6666 7365 743d 3029  source_offset=0)
-000099a0: 0a0a 2020 2020 4046 696c 6553 6861 7265  ..    @FileShare
-000099b0: 5072 6570 6172 6572 2829 0a20 2020 2040  Preparer().    @
-000099c0: 4173 796e 6353 746f 7261 6765 5465 7374  AsyncStorageTest
-000099d0: 4361 7365 2e61 7761 6974 5f70 7265 7061  Case.await_prepa
-000099e0: 7265 645f 7465 7374 0a20 2020 2061 7379  red_test.    asy
-000099f0: 6e63 2064 6566 2074 6573 745f 7570 6461  nc def test_upda
-00009a00: 7465 5f72 616e 6765 5f66 726f 6d5f 6669  te_range_from_fi
-00009a10: 6c65 5f75 726c 2873 656c 662c 2073 746f  le_url(self, sto
-00009a20: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
-00009a30: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
-00009a40: 6e74 5f6b 6579 293a 0a20 2020 2020 2020  nt_key):.       
-00009a50: 2073 656c 662e 5f73 6574 7570 2873 746f   self._setup(sto
-00009a60: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
-00009a70: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
-00009a80: 6e74 5f6b 6579 290a 2020 2020 2020 2020  nt_key).        
-00009a90: 736f 7572 6365 5f66 696c 655f 6e61 6d65  source_file_name
-00009aa0: 203d 2027 7465 7374 6669 6c65 270a 2020   = 'testfile'.  
-00009ab0: 2020 2020 2020 736f 7572 6365 5f66 696c        source_fil
-00009ac0: 655f 636c 6965 6e74 203d 2061 7761 6974  e_client = await
-00009ad0: 2073 656c 662e 5f63 7265 6174 655f 6669   self._create_fi
-00009ae0: 6c65 2873 746f 7261 6765 5f61 6363 6f75  le(storage_accou
-00009af0: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
-00009b00: 5f61 6363 6f75 6e74 5f6b 6579 2c20 6669  _account_key, fi
-00009b10: 6c65 5f6e 616d 653d 736f 7572 6365 5f66  le_name=source_f
-00009b20: 696c 655f 6e61 6d65 290a 2020 2020 2020  ile_name).      
-00009b30: 2020 6461 7461 203d 2062 2761 6263 6465    data = b'abcde
-00009b40: 6667 6869 6a6b 6c6d 6e6f 7027 202a 2033  fghijklmnop' * 3
-00009b50: 320a 2020 2020 2020 2020 6177 6169 7420  2.        await 
-00009b60: 736f 7572 6365 5f66 696c 655f 636c 6965  source_file_clie
-00009b70: 6e74 2e75 706c 6f61 645f 7261 6e67 6528  nt.upload_range(
-00009b80: 6461 7461 2c20 6f66 6673 6574 3d30 2c20  data, offset=0, 
-00009b90: 6c65 6e67 7468 3d35 3132 290a 0a20 2020  length=512)..   
-00009ba0: 2020 2020 2064 6573 7469 6e61 7469 6f6e       destination
-00009bb0: 5f66 696c 655f 6e61 6d65 203d 2027 6669  _file_name = 'fi
-00009bc0: 6c65 746f 7570 6461 7465 270a 2020 2020  letoupdate'.    
-00009bd0: 2020 2020 6465 7374 696e 6174 696f 6e5f      destination_
-00009be0: 6669 6c65 5f63 6c69 656e 7420 3d20 6177  file_client = aw
-00009bf0: 6169 7420 7365 6c66 2e5f 6372 6561 7465  ait self._create
-00009c00: 5f65 6d70 7479 5f66 696c 6528 7374 6f72  _empty_file(stor
-00009c10: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
-00009c20: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
-00009c30: 745f 6b65 792c 2066 696c 655f 6e61 6d65  t_key, file_name
-00009c40: 3d64 6573 7469 6e61 7469 6f6e 5f66 696c  =destination_fil
-00009c50: 655f 6e61 6d65 290a 0a20 2020 2020 2020  e_name)..       
-00009c60: 2023 2067 656e 6572 6174 6520 5341 5320   # generate SAS 
-00009c70: 666f 7220 7468 6520 736f 7572 6365 2066  for the source f
-00009c80: 696c 650a 2020 2020 2020 2020 7361 735f  ile.        sas_
-00009c90: 746f 6b65 6e5f 666f 725f 736f 7572 6365  token_for_source
-00009ca0: 5f66 696c 6520 3d20 6765 6e65 7261 7465  _file = generate
-00009cb0: 5f66 696c 655f 7361 7328 0a20 2020 2020  _file_sas(.     
-00009cc0: 2020 2020 2020 2073 6f75 7263 655f 6669         source_fi
-00009cd0: 6c65 5f63 6c69 656e 742e 6163 636f 756e  le_client.accoun
-00009ce0: 745f 6e61 6d65 2c0a 2020 2020 2020 2020  t_name,.        
-00009cf0: 2020 2020 736f 7572 6365 5f66 696c 655f      source_file_
-00009d00: 636c 6965 6e74 2e73 6861 7265 5f6e 616d  client.share_nam
-00009d10: 652c 0a20 2020 2020 2020 2020 2020 2073  e,.            s
-00009d20: 6f75 7263 655f 6669 6c65 5f63 6c69 656e  ource_file_clien
-00009d30: 742e 6669 6c65 5f70 6174 682c 0a20 2020  t.file_path,.   
-00009d40: 2020 2020 2020 2020 2073 6f75 7263 655f           source_
-00009d50: 6669 6c65 5f63 6c69 656e 742e 6372 6564  file_client.cred
-00009d60: 656e 7469 616c 2e61 6363 6f75 6e74 5f6b  ential.account_k
-00009d70: 6579 2c0a 2020 2020 2020 2020 2020 2020  ey,.            
-00009d80: 4669 6c65 5361 7350 6572 6d69 7373 696f  FileSasPermissio
-00009d90: 6e73 2872 6561 643d 5472 7565 292c 0a20  ns(read=True),. 
-00009da0: 2020 2020 2020 2020 2020 2065 7870 6972             expir
-00009db0: 793d 6461 7465 7469 6d65 2e75 7463 6e6f  y=datetime.utcno
-00009dc0: 7728 2920 2b20 7469 6d65 6465 6c74 6128  w() + timedelta(
-00009dd0: 686f 7572 733d 3129 290a 0a20 2020 2020  hours=1))..     
-00009de0: 2020 2073 6f75 7263 655f 6669 6c65 5f75     source_file_u
-00009df0: 726c 203d 2073 6f75 7263 655f 6669 6c65  rl = source_file
-00009e00: 5f63 6c69 656e 742e 7572 6c20 2b20 273f  _client.url + '?
-00009e10: 2720 2b20 7361 735f 746f 6b65 6e5f 666f  ' + sas_token_fo
-00009e20: 725f 736f 7572 6365 5f66 696c 650a 2020  r_source_file.  
-00009e30: 2020 2020 2020 2320 4163 740a 2020 2020        # Act.    
-00009e40: 2020 2020 6177 6169 7420 6465 7374 696e      await destin
-00009e50: 6174 696f 6e5f 6669 6c65 5f63 6c69 656e  ation_file_clien
-00009e60: 742e 7570 6c6f 6164 5f72 616e 6765 5f66  t.upload_range_f
-00009e70: 726f 6d5f 7572 6c28 736f 7572 6365 5f66  rom_url(source_f
-00009e80: 696c 655f 7572 6c2c 206f 6666 7365 743d  ile_url, offset=
-00009e90: 302c 206c 656e 6774 683d 3531 322c 2073  0, length=512, s
-00009ea0: 6f75 7263 655f 6f66 6673 6574 3d30 290a  ource_offset=0).
-00009eb0: 0a20 2020 2020 2020 2023 2041 7373 6572  .        # Asser
-00009ec0: 740a 2020 2020 2020 2020 2320 546f 206d  t.        # To m
-00009ed0: 616b 6520 7375 7265 2074 6865 2072 616e  ake sure the ran
-00009ee0: 6765 206f 6620 7468 6520 6669 6c65 2069  ge of the file i
-00009ef0: 7320 6163 7475 616c 6c79 2075 7064 6174  s actually updat
-00009f00: 6564 0a20 2020 2020 2020 2066 696c 655f  ed.        file_
-00009f10: 7261 6e67 6573 203d 2061 7761 6974 2064  ranges = await d
-00009f20: 6573 7469 6e61 7469 6f6e 5f66 696c 655f  estination_file_
-00009f30: 636c 6965 6e74 2e67 6574 5f72 616e 6765  client.get_range
-00009f40: 7328 290a 2020 2020 2020 2020 6669 6c65  s().        file
-00009f50: 5f63 6f6e 7465 6e74 203d 2061 7761 6974  _content = await
-00009f60: 2064 6573 7469 6e61 7469 6f6e 5f66 696c   destination_fil
-00009f70: 655f 636c 6965 6e74 2e64 6f77 6e6c 6f61  e_client.downloa
-00009f80: 645f 6669 6c65 286f 6666 7365 743d 302c  d_file(offset=0,
-00009f90: 206c 656e 6774 683d 3531 3229 0a20 2020   length=512).   
-00009fa0: 2020 2020 2066 696c 655f 636f 6e74 656e       file_conten
-00009fb0: 7420 3d20 6177 6169 7420 6669 6c65 5f63  t = await file_c
-00009fc0: 6f6e 7465 6e74 2e72 6561 6461 6c6c 2829  ontent.readall()
-00009fd0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00009fe0: 7365 7274 4571 7561 6c28 312c 206c 656e  sertEqual(1, len
-00009ff0: 2866 696c 655f 7261 6e67 6573 2929 0a20  (file_ranges)). 
-0000a000: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0000a010: 7274 4571 7561 6c28 302c 2066 696c 655f  rtEqual(0, file_
-0000a020: 7261 6e67 6573 5b30 5d2e 6765 7428 2773  ranges[0].get('s
-0000a030: 7461 7274 2729 290a 2020 2020 2020 2020  tart')).        
-0000a040: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-0000a050: 2835 3131 2c20 6669 6c65 5f72 616e 6765  (511, file_range
-0000a060: 735b 305d 2e67 6574 2827 656e 6427 2929  s[0].get('end'))
-0000a070: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-0000a080: 7365 7274 4571 7561 6c28 6461 7461 2c20  sertEqual(data, 
-0000a090: 6669 6c65 5f63 6f6e 7465 6e74 290a 0a20  file_content).. 
-0000a0a0: 2020 2040 4669 6c65 5368 6172 6550 7265     @FileSharePre
-0000a0b0: 7061 7265 7228 290a 2020 2020 4041 7379  parer().    @Asy
-0000a0c0: 6e63 5374 6f72 6167 6554 6573 7443 6173  ncStorageTestCas
-0000a0d0: 652e 6177 6169 745f 7072 6570 6172 6564  e.await_prepared
-0000a0e0: 5f74 6573 740a 2020 2020 6173 796e 6320  _test.    async 
-0000a0f0: 6465 6620 7465 7374 5f75 7064 6174 655f  def test_update_
-0000a100: 7261 6e67 655f 6672 6f6d 5f66 696c 655f  range_from_file_
-0000a110: 7572 6c5f 7769 7468 5f6f 6175 7468 280a  url_with_oauth(.
-0000a120: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000a130: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
-0000a140: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
-0000a150: 6163 636f 756e 745f 6b65 7929 3a0a 2020  account_key):.  
-0000a160: 2020 2020 2020 7365 6c66 2e5f 7365 7475        self._setu
-0000a170: 7028 7374 6f72 6167 655f 6163 636f 756e  p(storage_accoun
-0000a180: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
-0000a190: 6163 636f 756e 745f 6b65 7929 0a20 2020  account_key).   
-0000a1a0: 2020 2020 2073 6f75 7263 655f 626c 6f62       source_blob
-0000a1b0: 5f63 6c69 656e 7420 3d20 6177 6169 7420  _client = await 
-0000a1c0: 7365 6c66 2e5f 6372 6561 7465 5f73 6f75  self._create_sou
-0000a1d0: 7263 655f 626c 6f62 2829 0a20 2020 2020  rce_blob().     
-0000a1e0: 2020 2061 6363 6573 735f 746f 6b65 6e20     access_token 
-0000a1f0: 3d20 6177 6169 7420 7365 6c66 2e67 656e  = await self.gen
-0000a200: 6572 6174 655f 6f61 7574 685f 746f 6b65  erate_oauth_toke
-0000a210: 6e28 292e 6765 745f 746f 6b65 6e28 2268  n().get_token("h
-0000a220: 7474 7073 3a2f 2f73 746f 7261 6765 2e61  ttps://storage.a
-0000a230: 7a75 7265 2e63 6f6d 2f2e 6465 6661 756c  zure.com/.defaul
-0000a240: 7422 290a 2020 2020 2020 2020 746f 6b65  t").        toke
-0000a250: 6e20 3d20 2242 6561 7265 7220 7b7d 222e  n = "Bearer {}".
-0000a260: 666f 726d 6174 2861 6363 6573 735f 746f  format(access_to
-0000a270: 6b65 6e2e 746f 6b65 6e29 0a0a 2020 2020  ken.token)..    
-0000a280: 2020 2020 6465 7374 696e 6174 696f 6e5f      destination_
-0000a290: 6669 6c65 5f6e 616d 6520 3d20 2766 696c  file_name = 'fil
-0000a2a0: 6574 6f75 7064 6174 6527 0a20 2020 2020  etoupdate'.     
-0000a2b0: 2020 2064 6573 7469 6e61 7469 6f6e 5f66     destination_f
-0000a2c0: 696c 655f 636c 6965 6e74 203d 2061 7761  ile_client = awa
-0000a2d0: 6974 2073 656c 662e 5f63 7265 6174 655f  it self._create_
-0000a2e0: 656d 7074 795f 6669 6c65 280a 2020 2020  empty_file(.    
-0000a2f0: 2020 2020 2020 2020 7374 6f72 6167 655f          storage_
-0000a300: 6163 636f 756e 745f 6e61 6d65 2c20 7374  account_name, st
-0000a310: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
-0000a320: 792c 2066 696c 655f 6e61 6d65 3d64 6573  y, file_name=des
-0000a330: 7469 6e61 7469 6f6e 5f66 696c 655f 6e61  tination_file_na
-0000a340: 6d65 290a 2020 2020 2020 2020 7769 7468  me).        with
-0000a350: 2073 656c 662e 6173 7365 7274 5261 6973   self.assertRais
-0000a360: 6573 2848 7474 7052 6573 706f 6e73 6545  es(HttpResponseE
-0000a370: 7272 6f72 293a 0a20 2020 2020 2020 2020  rror):.         
-0000a380: 2020 2061 7761 6974 2064 6573 7469 6e61     await destina
-0000a390: 7469 6f6e 5f66 696c 655f 636c 6965 6e74  tion_file_client
-0000a3a0: 2e75 706c 6f61 645f 7261 6e67 655f 6672  .upload_range_fr
-0000a3b0: 6f6d 5f75 726c 280a 2020 2020 2020 2020  om_url(.        
-0000a3c0: 2020 2020 2020 2020 736f 7572 6365 5f62          source_b
-0000a3d0: 6c6f 625f 636c 6965 6e74 2e75 726c 2c20  lob_client.url, 
-0000a3e0: 6f66 6673 6574 3d30 2c20 6c65 6e67 7468  offset=0, length
-0000a3f0: 3d35 3132 2c20 736f 7572 6365 5f6f 6666  =512, source_off
-0000a400: 7365 743d 3029 0a0a 2020 2020 2020 2020  set=0)..        
-0000a410: 6177 6169 7420 6465 7374 696e 6174 696f  await destinatio
-0000a420: 6e5f 6669 6c65 5f63 6c69 656e 742e 7570  n_file_client.up
-0000a430: 6c6f 6164 5f72 616e 6765 5f66 726f 6d5f  load_range_from_
-0000a440: 7572 6c28 0a20 2020 2020 2020 2020 2020  url(.           
-0000a450: 2073 6f75 7263 655f 626c 6f62 5f63 6c69   source_blob_cli
-0000a460: 656e 742e 7572 6c2c 206f 6666 7365 743d  ent.url, offset=
-0000a470: 302c 206c 656e 6774 683d 3531 322c 2073  0, length=512, s
-0000a480: 6f75 7263 655f 6f66 6673 6574 3d30 2c20  ource_offset=0, 
-0000a490: 736f 7572 6365 5f61 7574 686f 7269 7a61  source_authoriza
-0000a4a0: 7469 6f6e 3d74 6f6b 656e 290a 0a20 2020  tion=token)..   
-0000a4b0: 2040 4669 6c65 5368 6172 6550 7265 7061   @FileSharePrepa
-0000a4c0: 7265 7228 290a 2020 2020 4041 7379 6e63  rer().    @Async
-0000a4d0: 5374 6f72 6167 6554 6573 7443 6173 652e  StorageTestCase.
-0000a4e0: 6177 6169 745f 7072 6570 6172 6564 5f74  await_prepared_t
-0000a4f0: 6573 740a 2020 2020 6173 796e 6320 6465  est.    async de
-0000a500: 6620 7465 7374 5f75 7064 6174 655f 7261  f test_update_ra
-0000a510: 6e67 655f 6672 6f6d 5f66 696c 655f 7572  nge_from_file_ur
-0000a520: 6c5f 7769 7468 5f6c 6561 7365 5f61 7379  l_with_lease_asy
-0000a530: 6e63 2873 656c 662c 2073 746f 7261 6765  nc(self, storage
-0000a540: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
-0000a550: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
-0000a560: 6579 293a 0a20 2020 2020 2020 2073 656c  ey):.        sel
-0000a570: 662e 5f73 6574 7570 2873 746f 7261 6765  f._setup(storage
-0000a580: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
-0000a590: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
-0000a5a0: 6579 290a 2020 2020 2020 2020 736f 7572  ey).        sour
-0000a5b0: 6365 5f66 696c 655f 6e61 6d65 203d 2027  ce_file_name = '
-0000a5c0: 7465 7374 6669 6c65 270a 2020 2020 2020  testfile'.      
-0000a5d0: 2020 736f 7572 6365 5f66 696c 655f 636c    source_file_cl
-0000a5e0: 6965 6e74 203d 2061 7761 6974 2073 656c  ient = await sel
-0000a5f0: 662e 5f63 7265 6174 655f 6669 6c65 2873  f._create_file(s
-0000a600: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
-0000a610: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
-0000a620: 6f75 6e74 5f6b 6579 2c20 6669 6c65 5f6e  ount_key, file_n
-0000a630: 616d 653d 736f 7572 6365 5f66 696c 655f  ame=source_file_
-0000a640: 6e61 6d65 290a 2020 2020 2020 2020 6461  name).        da
-0000a650: 7461 203d 2062 2761 6263 6465 6667 6869  ta = b'abcdefghi
-0000a660: 6a6b 6c6d 6e6f 7027 202a 2033 320a 2020  jklmnop' * 32.  
-0000a670: 2020 2020 2020 6177 6169 7420 736f 7572        await sour
-0000a680: 6365 5f66 696c 655f 636c 6965 6e74 2e75  ce_file_client.u
-0000a690: 706c 6f61 645f 7261 6e67 6528 6461 7461  pload_range(data
-0000a6a0: 2c20 6f66 6673 6574 3d30 2c20 6c65 6e67  , offset=0, leng
-0000a6b0: 7468 3d35 3132 290a 0a20 2020 2020 2020  th=512)..       
-0000a6c0: 2064 6573 7469 6e61 7469 6f6e 5f66 696c   destination_fil
-0000a6d0: 655f 6e61 6d65 203d 2027 6669 6c65 746f  e_name = 'fileto
-0000a6e0: 7570 6461 7465 270a 2020 2020 2020 2020  update'.        
-0000a6f0: 6465 7374 696e 6174 696f 6e5f 6669 6c65  destination_file
-0000a700: 5f63 6c69 656e 7420 3d20 6177 6169 7420  _client = await 
-0000a710: 7365 6c66 2e5f 6372 6561 7465 5f65 6d70  self._create_emp
-0000a720: 7479 5f66 696c 6528 7374 6f72 6167 655f  ty_file(storage_
-0000a730: 6163 636f 756e 745f 6e61 6d65 2c20 7374  account_name, st
-0000a740: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
-0000a750: 792c 2066 696c 655f 6e61 6d65 3d64 6573  y, file_name=des
-0000a760: 7469 6e61 7469 6f6e 5f66 696c 655f 6e61  tination_file_na
-0000a770: 6d65 290a 2020 2020 2020 2020 6c65 6173  me).        leas
-0000a780: 6520 3d20 6177 6169 7420 6465 7374 696e  e = await destin
-0000a790: 6174 696f 6e5f 6669 6c65 5f63 6c69 656e  ation_file_clien
-0000a7a0: 742e 6163 7175 6972 655f 6c65 6173 6528  t.acquire_lease(
-0000a7b0: 290a 0a20 2020 2020 2020 2023 2067 656e  )..        # gen
-0000a7c0: 6572 6174 6520 5341 5320 666f 7220 7468  erate SAS for th
-0000a7d0: 6520 736f 7572 6365 2066 696c 650a 2020  e source file.  
-0000a7e0: 2020 2020 2020 7361 735f 746f 6b65 6e5f        sas_token_
-0000a7f0: 666f 725f 736f 7572 6365 5f66 696c 6520  for_source_file 
-0000a800: 3d20 6765 6e65 7261 7465 5f66 696c 655f  = generate_file_
-0000a810: 7361 7328 0a20 2020 2020 2020 2020 2020  sas(.           
-0000a820: 2073 6f75 7263 655f 6669 6c65 5f63 6c69   source_file_cli
-0000a830: 656e 742e 6163 636f 756e 745f 6e61 6d65  ent.account_name
-0000a840: 2c0a 2020 2020 2020 2020 2020 2020 736f  ,.            so
-0000a850: 7572 6365 5f66 696c 655f 636c 6965 6e74  urce_file_client
-0000a860: 2e73 6861 7265 5f6e 616d 652c 0a20 2020  .share_name,.   
-0000a870: 2020 2020 2020 2020 2073 6f75 7263 655f           source_
-0000a880: 6669 6c65 5f63 6c69 656e 742e 6669 6c65  file_client.file
-0000a890: 5f70 6174 682c 0a20 2020 2020 2020 2020  _path,.         
-0000a8a0: 2020 2073 6f75 7263 655f 6669 6c65 5f63     source_file_c
-0000a8b0: 6c69 656e 742e 6372 6564 656e 7469 616c  lient.credential
-0000a8c0: 2e61 6363 6f75 6e74 5f6b 6579 2c0a 2020  .account_key,.  
-0000a8d0: 2020 2020 2020 2020 2020 4669 6c65 5361            FileSa
-0000a8e0: 7350 6572 6d69 7373 696f 6e73 2872 6561  sPermissions(rea
-0000a8f0: 643d 5472 7565 292c 0a20 2020 2020 2020  d=True),.       
-0000a900: 2020 2020 2065 7870 6972 793d 6461 7465       expiry=date
-0000a910: 7469 6d65 2e75 7463 6e6f 7728 2920 2b20  time.utcnow() + 
-0000a920: 7469 6d65 6465 6c74 6128 686f 7572 733d  timedelta(hours=
-0000a930: 3129 290a 0a20 2020 2020 2020 2073 6f75  1))..        sou
-0000a940: 7263 655f 6669 6c65 5f75 726c 203d 2073  rce_file_url = s
-0000a950: 6f75 7263 655f 6669 6c65 5f63 6c69 656e  ource_file_clien
-0000a960: 742e 7572 6c20 2b20 273f 2720 2b20 7361  t.url + '?' + sa
-0000a970: 735f 746f 6b65 6e5f 666f 725f 736f 7572  s_token_for_sour
-0000a980: 6365 5f66 696c 650a 2020 2020 2020 2020  ce_file.        
-0000a990: 2320 4163 740a 2020 2020 2020 2020 7769  # Act.        wi
-0000a9a0: 7468 2073 656c 662e 6173 7365 7274 5261  th self.assertRa
-0000a9b0: 6973 6573 2848 7474 7052 6573 706f 6e73  ises(HttpRespons
-0000a9c0: 6545 7272 6f72 293a 0a20 2020 2020 2020  eError):.       
-0000a9d0: 2020 2020 2061 7761 6974 2064 6573 7469       await desti
-0000a9e0: 6e61 7469 6f6e 5f66 696c 655f 636c 6965  nation_file_clie
-0000a9f0: 6e74 2e75 706c 6f61 645f 7261 6e67 655f  nt.upload_range_
-0000aa00: 6672 6f6d 5f75 726c 2873 6f75 7263 655f  from_url(source_
-0000aa10: 6669 6c65 5f75 726c 2c20 6f66 6673 6574  file_url, offset
-0000aa20: 3d30 2c20 6c65 6e67 7468 3d35 3132 2c20  =0, length=512, 
-0000aa30: 736f 7572 6365 5f6f 6666 7365 743d 3029  source_offset=0)
-0000aa40: 0a20 2020 2020 2020 2061 7761 6974 2064  .        await d
-0000aa50: 6573 7469 6e61 7469 6f6e 5f66 696c 655f  estination_file_
-0000aa60: 636c 6965 6e74 2e75 706c 6f61 645f 7261  client.upload_ra
-0000aa70: 6e67 655f 6672 6f6d 5f75 726c 2873 6f75  nge_from_url(sou
-0000aa80: 7263 655f 6669 6c65 5f75 726c 2c20 6f66  rce_file_url, of
-0000aa90: 6673 6574 3d30 2c20 6c65 6e67 7468 3d35  fset=0, length=5
-0000aaa0: 3132 2c20 736f 7572 6365 5f6f 6666 7365  12, source_offse
-0000aab0: 743d 302c 0a20 2020 2020 2020 2020 2020  t=0,.           
-0000aac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aaf0: 206c 6561 7365 3d6c 6561 7365 290a 0a20   lease=lease).. 
-0000ab00: 2020 2020 2020 2023 2041 7373 6572 740a         # Assert.
-0000ab10: 2020 2020 2020 2020 2320 546f 206d 616b          # To mak
-0000ab20: 6520 7375 7265 2074 6865 2072 616e 6765  e sure the range
-0000ab30: 206f 6620 7468 6520 6669 6c65 2069 7320   of the file is 
-0000ab40: 6163 7475 616c 6c79 2075 7064 6174 6564  actually updated
-0000ab50: 0a20 2020 2020 2020 2066 696c 655f 7261  .        file_ra
-0000ab60: 6e67 6573 203d 2061 7761 6974 2064 6573  nges = await des
-0000ab70: 7469 6e61 7469 6f6e 5f66 696c 655f 636c  tination_file_cl
-0000ab80: 6965 6e74 2e67 6574 5f72 616e 6765 7328  ient.get_ranges(
-0000ab90: 290a 2020 2020 2020 2020 6669 6c65 5f63  ).        file_c
-0000aba0: 6f6e 7465 6e74 203d 2061 7761 6974 2064  ontent = await d
-0000abb0: 6573 7469 6e61 7469 6f6e 5f66 696c 655f  estination_file_
-0000abc0: 636c 6965 6e74 2e64 6f77 6e6c 6f61 645f  client.download_
-0000abd0: 6669 6c65 286f 6666 7365 743d 302c 206c  file(offset=0, l
-0000abe0: 656e 6774 683d 3531 3229 0a20 2020 2020  ength=512).     
-0000abf0: 2020 2066 696c 655f 636f 6e74 656e 7420     file_content 
-0000ac00: 3d20 6177 6169 7420 6669 6c65 5f63 6f6e  = await file_con
-0000ac10: 7465 6e74 2e72 6561 6461 6c6c 2829 0a20  tent.readall(). 
-0000ac20: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0000ac30: 7274 4571 7561 6c28 312c 206c 656e 2866  rtEqual(1, len(f
-0000ac40: 696c 655f 7261 6e67 6573 2929 0a20 2020  ile_ranges)).   
-0000ac50: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000ac60: 4571 7561 6c28 302c 2066 696c 655f 7261  Equal(0, file_ra
-0000ac70: 6e67 6573 5b30 5d2e 6765 7428 2773 7461  nges[0].get('sta
-0000ac80: 7274 2729 290a 2020 2020 2020 2020 7365  rt')).        se
-0000ac90: 6c66 2e61 7373 6572 7445 7175 616c 2835  lf.assertEqual(5
-0000aca0: 3131 2c20 6669 6c65 5f72 616e 6765 735b  11, file_ranges[
-0000acb0: 305d 2e67 6574 2827 656e 6427 2929 0a20  0].get('end')). 
-0000acc0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0000acd0: 7274 4571 7561 6c28 6461 7461 2c20 6669  rtEqual(data, fi
-0000ace0: 6c65 5f63 6f6e 7465 6e74 290a 0a20 2020  le_content)..   
-0000acf0: 2040 4669 6c65 5368 6172 6550 7265 7061   @FileSharePrepa
-0000ad00: 7265 7228 290a 2020 2020 4041 7379 6e63  rer().    @Async
-0000ad10: 5374 6f72 6167 6554 6573 7443 6173 652e  StorageTestCase.
-0000ad20: 6177 6169 745f 7072 6570 6172 6564 5f74  await_prepared_t
-0000ad30: 6573 740a 2020 2020 6173 796e 6320 6465  est.    async de
-0000ad40: 6620 7465 7374 5f75 7064 6174 655f 6269  f test_update_bi
-0000ad50: 675f 7261 6e67 655f 6672 6f6d 5f66 696c  g_range_from_fil
-0000ad60: 655f 7572 6c28 7365 6c66 2c20 7374 6f72  e_url(self, stor
-0000ad70: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
-0000ad80: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
-0000ad90: 745f 6b65 7929 3a0a 2020 2020 2020 2020  t_key):.        
-0000ada0: 7365 6c66 2e5f 7365 7475 7028 7374 6f72  self._setup(stor
-0000adb0: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
-0000adc0: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
-0000add0: 745f 6b65 7929 0a20 2020 2020 2020 2073  t_key).        s
-0000ade0: 6f75 7263 655f 6669 6c65 5f6e 616d 6520  ource_file_name 
-0000adf0: 3d20 2774 6573 7466 696c 6531 270a 2020  = 'testfile1'.  
-0000ae00: 2020 2020 2020 656e 6420 3d20 3130 3438        end = 1048
-0000ae10: 3537 350a 0a20 2020 2020 2020 2073 6f75  575..        sou
-0000ae20: 7263 655f 6669 6c65 5f63 6c69 656e 7420  rce_file_client 
-0000ae30: 3d20 6177 6169 7420 7365 6c66 2e5f 6372  = await self._cr
-0000ae40: 6561 7465 5f65 6d70 7479 5f66 696c 6528  eate_empty_file(
-0000ae50: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-0000ae60: 6e61 6d65 2c20 7374 6f72 6167 655f 6163  name, storage_ac
-0000ae70: 636f 756e 745f 6b65 792c 2066 696c 655f  count_key, file_
-0000ae80: 6e61 6d65 3d73 6f75 7263 655f 6669 6c65  name=source_file
-0000ae90: 5f6e 616d 652c 2066 696c 655f 7369 7a65  _name, file_size
-0000aea0: 3d31 3032 3420 2a20 3130 3234 290a 2020  =1024 * 1024).  
-0000aeb0: 2020 2020 2020 6461 7461 203d 2062 2761        data = b'a
-0000aec0: 6263 6465 6667 6869 6a6b 6c6d 6e6f 7027  bcdefghijklmnop'
-0000aed0: 202a 2036 3535 3336 0a20 2020 2020 2020   * 65536.       
-0000aee0: 2061 7761 6974 2073 6f75 7263 655f 6669   await source_fi
-0000aef0: 6c65 5f63 6c69 656e 742e 7570 6c6f 6164  le_client.upload
-0000af00: 5f72 616e 6765 2864 6174 612c 206f 6666  _range(data, off
-0000af10: 7365 743d 302c 206c 656e 6774 683d 656e  set=0, length=en
-0000af20: 642b 3129 0a0a 2020 2020 2020 2020 6465  d+1)..        de
-0000af30: 7374 696e 6174 696f 6e5f 6669 6c65 5f6e  stination_file_n
-0000af40: 616d 6520 3d20 2766 696c 6574 6f75 7064  ame = 'filetoupd
-0000af50: 6174 6531 270a 2020 2020 2020 2020 6465  ate1'.        de
-0000af60: 7374 696e 6174 696f 6e5f 6669 6c65 5f63  stination_file_c
-0000af70: 6c69 656e 7420 3d20 6177 6169 7420 7365  lient = await se
-0000af80: 6c66 2e5f 6372 6561 7465 5f65 6d70 7479  lf._create_empty
-0000af90: 5f66 696c 6528 7374 6f72 6167 655f 6163  _file(storage_ac
-0000afa0: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
-0000afb0: 6167 655f 6163 636f 756e 745f 6b65 792c  age_account_key,
-0000afc0: 2066 696c 655f 6e61 6d65 3d64 6573 7469   file_name=desti
-0000afd0: 6e61 7469 6f6e 5f66 696c 655f 6e61 6d65  nation_file_name
-0000afe0: 2c20 6669 6c65 5f73 697a 653d 3130 3234  , file_size=1024
-0000aff0: 202a 2031 3032 3429 0a0a 2020 2020 2020   * 1024)..      
-0000b000: 2020 2320 6765 6e65 7261 7465 2053 4153    # generate SAS
-0000b010: 2066 6f72 2074 6865 2073 6f75 7263 6520   for the source 
-0000b020: 6669 6c65 0a20 2020 2020 2020 2073 6173  file.        sas
-0000b030: 5f74 6f6b 656e 5f66 6f72 5f73 6f75 7263  _token_for_sourc
-0000b040: 655f 6669 6c65 203d 2067 656e 6572 6174  e_file = generat
-0000b050: 655f 6669 6c65 5f73 6173 280a 2020 2020  e_file_sas(.    
-0000b060: 2020 2020 2020 2020 736f 7572 6365 5f66          source_f
-0000b070: 696c 655f 636c 6965 6e74 2e61 6363 6f75  ile_client.accou
-0000b080: 6e74 5f6e 616d 652c 0a20 2020 2020 2020  nt_name,.       
-0000b090: 2020 2020 2073 6f75 7263 655f 6669 6c65       source_file
-0000b0a0: 5f63 6c69 656e 742e 7368 6172 655f 6e61  _client.share_na
-0000b0b0: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
-0000b0c0: 736f 7572 6365 5f66 696c 655f 636c 6965  source_file_clie
-0000b0d0: 6e74 2e66 696c 655f 7061 7468 2c0a 2020  nt.file_path,.  
-0000b0e0: 2020 2020 2020 2020 2020 736f 7572 6365            source
-0000b0f0: 5f66 696c 655f 636c 6965 6e74 2e63 7265  _file_client.cre
-0000b100: 6465 6e74 6961 6c2e 6163 636f 756e 745f  dential.account_
-0000b110: 6b65 792c 0a20 2020 2020 2020 2020 2020  key,.           
-0000b120: 2046 696c 6553 6173 5065 726d 6973 7369   FileSasPermissi
-0000b130: 6f6e 7328 7265 6164 3d54 7275 6529 2c0a  ons(read=True),.
-0000b140: 2020 2020 2020 2020 2020 2020 6578 7069              expi
-0000b150: 7279 3d64 6174 6574 696d 652e 7574 636e  ry=datetime.utcn
-0000b160: 6f77 2829 202b 2074 696d 6564 656c 7461  ow() + timedelta
-0000b170: 2868 6f75 7273 3d31 2929 0a0a 2020 2020  (hours=1))..    
-0000b180: 2020 2020 736f 7572 6365 5f66 696c 655f      source_file_
-0000b190: 7572 6c20 3d20 736f 7572 6365 5f66 696c  url = source_fil
-0000b1a0: 655f 636c 6965 6e74 2e75 726c 202b 2027  e_client.url + '
-0000b1b0: 3f27 202b 2073 6173 5f74 6f6b 656e 5f66  ?' + sas_token_f
-0000b1c0: 6f72 5f73 6f75 7263 655f 6669 6c65 0a0a  or_source_file..
-0000b1d0: 2020 2020 2020 2020 2320 4163 740a 2020          # Act.  
-0000b1e0: 2020 2020 2020 6177 6169 7420 6465 7374        await dest
-0000b1f0: 696e 6174 696f 6e5f 6669 6c65 5f63 6c69  ination_file_cli
-0000b200: 656e 742e 7570 6c6f 6164 5f72 616e 6765  ent.upload_range
-0000b210: 5f66 726f 6d5f 7572 6c28 736f 7572 6365  _from_url(source
-0000b220: 5f66 696c 655f 7572 6c2c 206f 6666 7365  _file_url, offse
-0000b230: 743d 302c 206c 656e 6774 683d 656e 642b  t=0, length=end+
-0000b240: 312c 2073 6f75 7263 655f 6f66 6673 6574  1, source_offset
-0000b250: 3d30 290a 0a20 2020 2020 2020 2023 2041  =0)..        # A
-0000b260: 7373 6572 740a 2020 2020 2020 2020 2320  ssert.        # 
-0000b270: 546f 206d 616b 6520 7375 7265 2074 6865  To make sure the
-0000b280: 2072 616e 6765 206f 6620 7468 6520 6669   range of the fi
-0000b290: 6c65 2069 7320 6163 7475 616c 6c79 2075  le is actually u
-0000b2a0: 7064 6174 6564 0a20 2020 2020 2020 2066  pdated.        f
-0000b2b0: 696c 655f 7261 6e67 6573 203d 2061 7761  ile_ranges = awa
-0000b2c0: 6974 2064 6573 7469 6e61 7469 6f6e 5f66  it destination_f
-0000b2d0: 696c 655f 636c 6965 6e74 2e67 6574 5f72  ile_client.get_r
-0000b2e0: 616e 6765 7328 290a 2020 2020 2020 2020  anges().        
-0000b2f0: 6669 6c65 5f63 6f6e 7465 6e74 203d 2061  file_content = a
-0000b300: 7761 6974 2064 6573 7469 6e61 7469 6f6e  wait destination
-0000b310: 5f66 696c 655f 636c 6965 6e74 2e64 6f77  _file_client.dow
-0000b320: 6e6c 6f61 645f 6669 6c65 286f 6666 7365  nload_file(offse
-0000b330: 743d 302c 206c 656e 6774 683d 656e 6420  t=0, length=end 
-0000b340: 2b20 3129 0a20 2020 2020 2020 2066 696c  + 1).        fil
-0000b350: 655f 636f 6e74 656e 7420 3d20 6177 6169  e_content = awai
-0000b360: 7420 6669 6c65 5f63 6f6e 7465 6e74 2e72  t file_content.r
-0000b370: 6561 6461 6c6c 2829 0a20 2020 2020 2020  eadall().       
-0000b380: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-0000b390: 6c28 312c 206c 656e 2866 696c 655f 7261  l(1, len(file_ra
-0000b3a0: 6e67 6573 2929 0a20 2020 2020 2020 2073  nges)).        s
-0000b3b0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-0000b3c0: 302c 2066 696c 655f 7261 6e67 6573 5b30  0, file_ranges[0
-0000b3d0: 5d2e 6765 7428 2773 7461 7274 2729 290a  ].get('start')).
-0000b3e0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0000b3f0: 6572 7445 7175 616c 2865 6e64 2c20 6669  ertEqual(end, fi
-0000b400: 6c65 5f72 616e 6765 735b 305d 2e67 6574  le_ranges[0].get
-0000b410: 2827 656e 6427 2929 0a20 2020 2020 2020  ('end')).       
-0000b420: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-0000b430: 6c28 6461 7461 2c20 6669 6c65 5f63 6f6e  l(data, file_con
-0000b440: 7465 6e74 290a 0a20 2020 2040 4669 6c65  tent)..    @File
-0000b450: 5368 6172 6550 7265 7061 7265 7228 290a  SharePreparer().
-0000b460: 2020 2020 4041 7379 6e63 5374 6f72 6167      @AsyncStorag
-0000b470: 6554 6573 7443 6173 652e 6177 6169 745f  eTestCase.await_
-0000b480: 7072 6570 6172 6564 5f74 6573 740a 2020  prepared_test.  
-0000b490: 2020 6173 796e 6320 6465 6620 7465 7374    async def test
-0000b4a0: 5f75 7064 6174 655f 7261 6e67 655f 6672  _update_range_fr
-0000b4b0: 6f6d 5f66 696c 655f 7572 6c5f 6c61 7374  om_file_url_last
-0000b4c0: 5f77 7269 7474 656e 5f6d 6f64 655f 6e6f  _written_mode_no
-0000b4d0: 7728 7365 6c66 2c20 7374 6f72 6167 655f  w(self, storage_
-0000b4e0: 6163 636f 756e 745f 6e61 6d65 2c20 7374  account_name, st
-0000b4f0: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
-0000b500: 7929 3a0a 2020 2020 2020 2020 7365 6c66  y):.        self
-0000b510: 2e5f 7365 7475 7028 7374 6f72 6167 655f  ._setup(storage_
-0000b520: 6163 636f 756e 745f 6e61 6d65 2c20 7374  account_name, st
-0000b530: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
-0000b540: 7929 0a20 2020 2020 2020 2073 6f75 7263  y).        sourc
-0000b550: 655f 6669 6c65 5f63 6c69 656e 7420 3d20  e_file_client = 
-0000b560: 6177 6169 7420 7365 6c66 2e5f 6372 6561  await self._crea
-0000b570: 7465 5f66 696c 6528 7374 6f72 6167 655f  te_file(storage_
-0000b580: 6163 636f 756e 745f 6e61 6d65 2c20 7374  account_name, st
-0000b590: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
-0000b5a0: 792c 2066 696c 655f 6e61 6d65 3d27 7465  y, file_name='te
-0000b5b0: 7374 6669 6c65 2729 0a20 2020 2020 2020  stfile').       
-0000b5c0: 2064 6174 6120 3d20 6227 6162 6364 6566   data = b'abcdef
-0000b5d0: 6768 696a 6b6c 6d6e 6f70 2720 2a20 3332  ghijklmnop' * 32
-0000b5e0: 0a20 2020 2020 2020 2061 7761 6974 2073  .        await s
-0000b5f0: 6f75 7263 655f 6669 6c65 5f63 6c69 656e  ource_file_clien
-0000b600: 742e 7570 6c6f 6164 5f72 616e 6765 2864  t.upload_range(d
-0000b610: 6174 612c 206f 6666 7365 743d 302c 206c  ata, offset=0, l
-0000b620: 656e 6774 683d 3531 3229 0a0a 2020 2020  ength=512)..    
-0000b630: 2020 2020 6465 7374 696e 6174 696f 6e5f      destination_
-0000b640: 6669 6c65 5f63 6c69 656e 7420 3d20 6177  file_client = aw
-0000b650: 6169 7420 7365 6c66 2e5f 6372 6561 7465  ait self._create
-0000b660: 5f65 6d70 7479 5f66 696c 6528 0a20 2020  _empty_file(.   
-0000b670: 2020 2020 2020 2020 2073 746f 7261 6765           storage
-0000b680: 5f61 6363 6f75 6e74 5f6e 616d 652c 0a20  _account_name,. 
-0000b690: 2020 2020 2020 2020 2020 2073 746f 7261             stora
-0000b6a0: 6765 5f61 6363 6f75 6e74 5f6b 6579 2c0a  ge_account_key,.
-0000b6b0: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-0000b6c0: 5f6e 616d 653d 2766 696c 6574 6f75 7064  _name='filetoupd
-0000b6d0: 6174 6527 290a 2020 2020 2020 2020 6375  ate').        cu
-0000b6e0: 7272 656e 745f 6c61 7374 5f77 7269 7465  rrent_last_write
-0000b6f0: 5f74 696d 6520 3d20 2861 7761 6974 2064  _time = (await d
-0000b700: 6573 7469 6e61 7469 6f6e 5f66 696c 655f  estination_file_
-0000b710: 636c 6965 6e74 2e67 6574 5f66 696c 655f  client.get_file_
-0000b720: 7072 6f70 6572 7469 6573 2829 292e 6c61  properties()).la
-0000b730: 7374 5f77 7269 7465 5f74 696d 650a 0a20  st_write_time.. 
-0000b740: 2020 2020 2020 2023 2067 656e 6572 6174         # generat
-0000b750: 6520 5341 5320 666f 7220 7468 6520 736f  e SAS for the so
-0000b760: 7572 6365 2066 696c 650a 2020 2020 2020  urce file.      
-0000b770: 2020 7361 735f 746f 6b65 6e5f 666f 725f    sas_token_for_
-0000b780: 736f 7572 6365 5f66 696c 6520 3d20 6765  source_file = ge
-0000b790: 6e65 7261 7465 5f66 696c 655f 7361 7328  nerate_file_sas(
-0000b7a0: 0a20 2020 2020 2020 2020 2020 2073 6f75  .            sou
-0000b7b0: 7263 655f 6669 6c65 5f63 6c69 656e 742e  rce_file_client.
-0000b7c0: 6163 636f 756e 745f 6e61 6d65 2c0a 2020  account_name,.  
-0000b7d0: 2020 2020 2020 2020 2020 736f 7572 6365            source
-0000b7e0: 5f66 696c 655f 636c 6965 6e74 2e73 6861  _file_client.sha
-0000b7f0: 7265 5f6e 616d 652c 0a20 2020 2020 2020  re_name,.       
-0000b800: 2020 2020 2073 6f75 7263 655f 6669 6c65       source_file
-0000b810: 5f63 6c69 656e 742e 6669 6c65 5f70 6174  _client.file_pat
-0000b820: 682c 0a20 2020 2020 2020 2020 2020 2073  h,.            s
-0000b830: 6f75 7263 655f 6669 6c65 5f63 6c69 656e  ource_file_clien
-0000b840: 742e 6372 6564 656e 7469 616c 2e61 6363  t.credential.acc
-0000b850: 6f75 6e74 5f6b 6579 2c0a 2020 2020 2020  ount_key,.      
-0000b860: 2020 2020 2020 4669 6c65 5361 7350 6572        FileSasPer
-0000b870: 6d69 7373 696f 6e73 2872 6561 643d 5472  missions(read=Tr
-0000b880: 7565 292c 0a20 2020 2020 2020 2020 2020  ue),.           
-0000b890: 2065 7870 6972 793d 6461 7465 7469 6d65   expiry=datetime
-0000b8a0: 2e75 7463 6e6f 7728 2920 2b20 7469 6d65  .utcnow() + time
-0000b8b0: 6465 6c74 6128 686f 7572 733d 3129 290a  delta(hours=1)).
-0000b8c0: 0a20 2020 2020 2020 2073 6f75 7263 655f  .        source_
-0000b8d0: 6669 6c65 5f75 726c 203d 2073 6f75 7263  file_url = sourc
-0000b8e0: 655f 6669 6c65 5f63 6c69 656e 742e 7572  e_file_client.ur
-0000b8f0: 6c20 2b20 273f 2720 2b20 7361 735f 746f  l + '?' + sas_to
-0000b900: 6b65 6e5f 666f 725f 736f 7572 6365 5f66  ken_for_source_f
-0000b910: 696c 650a 0a20 2020 2020 2020 2023 2041  ile..        # A
-0000b920: 6374 0a20 2020 2020 2020 2061 7761 6974  ct.        await
-0000b930: 2064 6573 7469 6e61 7469 6f6e 5f66 696c   destination_fil
-0000b940: 655f 636c 6965 6e74 2e75 706c 6f61 645f  e_client.upload_
-0000b950: 7261 6e67 655f 6672 6f6d 5f75 726c 2873  range_from_url(s
-0000b960: 6f75 7263 655f 6669 6c65 5f75 726c 2c20  ource_file_url, 
-0000b970: 6f66 6673 6574 3d30 2c20 6c65 6e67 7468  offset=0, length
-0000b980: 3d35 3132 2c20 736f 7572 6365 5f6f 6666  =512, source_off
-0000b990: 7365 743d 302c 0a20 2020 2020 2020 2020  set=0,.         
-0000b9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b9d0: 2020 2066 696c 655f 6c61 7374 5f77 7269     file_last_wri
-0000b9e0: 7465 5f6d 6f64 653d 224e 6f77 2229 0a0a  te_mode="Now")..
-0000b9f0: 2020 2020 2020 2020 2320 4173 7365 7274          # Assert
-0000ba00: 0a20 2020 2020 2020 206e 6577 5f6c 6173  .        new_las
-0000ba10: 745f 7772 6974 655f 7469 6d65 203d 2028  t_write_time = (
-0000ba20: 6177 6169 7420 6465 7374 696e 6174 696f  await destinatio
-0000ba30: 6e5f 6669 6c65 5f63 6c69 656e 742e 6765  n_file_client.ge
-0000ba40: 745f 6669 6c65 5f70 726f 7065 7274 6965  t_file_propertie
-0000ba50: 7328 2929 2e6c 6173 745f 7772 6974 655f  s()).last_write_
-0000ba60: 7469 6d65 0a20 2020 2020 2020 2073 656c  time.        sel
-0000ba70: 662e 6173 7365 7274 4e6f 7445 7175 616c  f.assertNotEqual
-0000ba80: 2863 7572 7265 6e74 5f6c 6173 745f 7772  (current_last_wr
-0000ba90: 6974 655f 7469 6d65 2c20 6e65 775f 6c61  ite_time, new_la
-0000baa0: 7374 5f77 7269 7465 5f74 696d 6529 0a0a  st_write_time)..
-0000bab0: 2020 2020 4046 696c 6553 6861 7265 5072      @FileSharePr
-0000bac0: 6570 6172 6572 2829 0a20 2020 2040 4173  eparer().    @As
-0000bad0: 796e 6353 746f 7261 6765 5465 7374 4361  yncStorageTestCa
-0000bae0: 7365 2e61 7761 6974 5f70 7265 7061 7265  se.await_prepare
-0000baf0: 645f 7465 7374 0a20 2020 2061 7379 6e63  d_test.    async
-0000bb00: 2064 6566 2074 6573 745f 7570 6461 7465   def test_update
-0000bb10: 5f72 616e 6765 5f66 726f 6d5f 6669 6c65  _range_from_file
-0000bb20: 5f75 726c 5f6c 6173 745f 7772 6974 7465  _url_last_writte
-0000bb30: 6e5f 6d6f 6465 5f70 7265 7365 7276 6528  n_mode_preserve(
-0000bb40: 7365 6c66 2c20 7374 6f72 6167 655f 6163  self, storage_ac
-0000bb50: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
-0000bb60: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
-0000bb70: 3a0a 2020 2020 2020 2020 7365 6c66 2e5f  :.        self._
-0000bb80: 7365 7475 7028 7374 6f72 6167 655f 6163  setup(storage_ac
-0000bb90: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
-0000bba0: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
-0000bbb0: 0a20 2020 2020 2020 2073 6f75 7263 655f  .        source_
-0000bbc0: 6669 6c65 5f63 6c69 656e 7420 3d20 6177  file_client = aw
-0000bbd0: 6169 7420 7365 6c66 2e5f 6372 6561 7465  ait self._create
-0000bbe0: 5f66 696c 6528 7374 6f72 6167 655f 6163  _file(storage_ac
-0000bbf0: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
-0000bc00: 6167 655f 6163 636f 756e 745f 6b65 792c  age_account_key,
-0000bc10: 2066 696c 655f 6e61 6d65 3d27 7465 7374   file_name='test
-0000bc20: 6669 6c65 2729 0a20 2020 2020 2020 2064  file').        d
-0000bc30: 6174 6120 3d20 6227 6162 6364 6566 6768  ata = b'abcdefgh
-0000bc40: 696a 6b6c 6d6e 6f70 2720 2a20 3332 0a20  ijklmnop' * 32. 
-0000bc50: 2020 2020 2020 2061 7761 6974 2073 6f75         await sou
-0000bc60: 7263 655f 6669 6c65 5f63 6c69 656e 742e  rce_file_client.
-0000bc70: 7570 6c6f 6164 5f72 616e 6765 2864 6174  upload_range(dat
-0000bc80: 612c 206f 6666 7365 743d 302c 206c 656e  a, offset=0, len
-0000bc90: 6774 683d 3531 3229 0a0a 2020 2020 2020  gth=512)..      
-0000bca0: 2020 6465 7374 696e 6174 696f 6e5f 6669    destination_fi
-0000bcb0: 6c65 5f63 6c69 656e 7420 3d20 6177 6169  le_client = awai
-0000bcc0: 7420 7365 6c66 2e5f 6372 6561 7465 5f65  t self._create_e
-0000bcd0: 6d70 7479 5f66 696c 6528 0a20 2020 2020  mpty_file(.     
-0000bce0: 2020 2020 2020 2073 746f 7261 6765 5f61         storage_a
-0000bcf0: 6363 6f75 6e74 5f6e 616d 652c 0a20 2020  ccount_name,.   
-0000bd00: 2020 2020 2020 2020 2073 746f 7261 6765           storage
-0000bd10: 5f61 6363 6f75 6e74 5f6b 6579 2c0a 2020  _account_key,.  
-0000bd20: 2020 2020 2020 2020 2020 6669 6c65 5f6e            file_n
-0000bd30: 616d 653d 2766 696c 6574 6f75 7064 6174  ame='filetoupdat
-0000bd40: 6527 290a 2020 2020 2020 2020 6375 7272  e').        curr
-0000bd50: 656e 745f 6c61 7374 5f77 7269 7465 5f74  ent_last_write_t
-0000bd60: 696d 6520 3d20 2861 7761 6974 2064 6573  ime = (await des
-0000bd70: 7469 6e61 7469 6f6e 5f66 696c 655f 636c  tination_file_cl
-0000bd80: 6965 6e74 2e67 6574 5f66 696c 655f 7072  ient.get_file_pr
-0000bd90: 6f70 6572 7469 6573 2829 292e 6c61 7374  operties()).last
-0000bda0: 5f77 7269 7465 5f74 696d 650a 0a20 2020  _write_time..   
-0000bdb0: 2020 2020 2023 2067 656e 6572 6174 6520       # generate 
-0000bdc0: 5341 5320 666f 7220 7468 6520 736f 7572  SAS for the sour
-0000bdd0: 6365 2066 696c 650a 2020 2020 2020 2020  ce file.        
-0000bde0: 7361 735f 746f 6b65 6e5f 666f 725f 736f  sas_token_for_so
-0000bdf0: 7572 6365 5f66 696c 6520 3d20 6765 6e65  urce_file = gene
-0000be00: 7261 7465 5f66 696c 655f 7361 7328 0a20  rate_file_sas(. 
-0000be10: 2020 2020 2020 2020 2020 2073 6f75 7263             sourc
-0000be20: 655f 6669 6c65 5f63 6c69 656e 742e 6163  e_file_client.ac
-0000be30: 636f 756e 745f 6e61 6d65 2c0a 2020 2020  count_name,.    
-0000be40: 2020 2020 2020 2020 736f 7572 6365 5f66          source_f
-0000be50: 696c 655f 636c 6965 6e74 2e73 6861 7265  ile_client.share
-0000be60: 5f6e 616d 652c 0a20 2020 2020 2020 2020  _name,.         
-0000be70: 2020 2073 6f75 7263 655f 6669 6c65 5f63     source_file_c
-0000be80: 6c69 656e 742e 6669 6c65 5f70 6174 682c  lient.file_path,
-0000be90: 0a20 2020 2020 2020 2020 2020 2073 6f75  .            sou
-0000bea0: 7263 655f 6669 6c65 5f63 6c69 656e 742e  rce_file_client.
-0000beb0: 6372 6564 656e 7469 616c 2e61 6363 6f75  credential.accou
-0000bec0: 6e74 5f6b 6579 2c0a 2020 2020 2020 2020  nt_key,.        
-0000bed0: 2020 2020 4669 6c65 5361 7350 6572 6d69      FileSasPermi
-0000bee0: 7373 696f 6e73 2872 6561 643d 5472 7565  ssions(read=True
-0000bef0: 292c 0a20 2020 2020 2020 2020 2020 2065  ),.            e
-0000bf00: 7870 6972 793d 6461 7465 7469 6d65 2e75  xpiry=datetime.u
-0000bf10: 7463 6e6f 7728 2920 2b20 7469 6d65 6465  tcnow() + timede
-0000bf20: 6c74 6128 686f 7572 733d 3129 290a 0a20  lta(hours=1)).. 
-0000bf30: 2020 2020 2020 2073 6f75 7263 655f 6669         source_fi
-0000bf40: 6c65 5f75 726c 203d 2073 6f75 7263 655f  le_url = source_
-0000bf50: 6669 6c65 5f63 6c69 656e 742e 7572 6c20  file_client.url 
-0000bf60: 2b20 273f 2720 2b20 7361 735f 746f 6b65  + '?' + sas_toke
-0000bf70: 6e5f 666f 725f 736f 7572 6365 5f66 696c  n_for_source_fil
-0000bf80: 650a 0a20 2020 2020 2020 2023 2041 6374  e..        # Act
-0000bf90: 0a20 2020 2020 2020 2061 7761 6974 2064  .        await d
-0000bfa0: 6573 7469 6e61 7469 6f6e 5f66 696c 655f  estination_file_
-0000bfb0: 636c 6965 6e74 2e75 706c 6f61 645f 7261  client.upload_ra
-0000bfc0: 6e67 655f 6672 6f6d 5f75 726c 2873 6f75  nge_from_url(sou
-0000bfd0: 7263 655f 6669 6c65 5f75 726c 2c20 6f66  rce_file_url, of
-0000bfe0: 6673 6574 3d30 2c20 6c65 6e67 7468 3d35  fset=0, length=5
-0000bff0: 3132 2c20 736f 7572 6365 5f6f 6666 7365  12, source_offse
-0000c000: 743d 302c 0a20 2020 2020 2020 2020 2020  t=0,.           
-0000c010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c040: 2066 696c 655f 6c61 7374 5f77 7269 7465   file_last_write
-0000c050: 5f6d 6f64 653d 2250 7265 7365 7276 6522  _mode="Preserve"
-0000c060: 290a 0a20 2020 2020 2020 2023 2041 7373  )..        # Ass
-0000c070: 6572 740a 2020 2020 2020 2020 6e65 775f  ert.        new_
-0000c080: 6c61 7374 5f77 7269 7465 5f74 696d 6520  last_write_time 
-0000c090: 3d20 2861 7761 6974 2064 6573 7469 6e61  = (await destina
-0000c0a0: 7469 6f6e 5f66 696c 655f 636c 6965 6e74  tion_file_client
-0000c0b0: 2e67 6574 5f66 696c 655f 7072 6f70 6572  .get_file_proper
-0000c0c0: 7469 6573 2829 292e 6c61 7374 5f77 7269  ties()).last_wri
-0000c0d0: 7465 5f74 696d 650a 2020 2020 2020 2020  te_time.        
-0000c0e0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-0000c0f0: 2863 7572 7265 6e74 5f6c 6173 745f 7772  (current_last_wr
-0000c100: 6974 655f 7469 6d65 2c20 6e65 775f 6c61  ite_time, new_la
-0000c110: 7374 5f77 7269 7465 5f74 696d 6529 0a0a  st_write_time)..
-0000c120: 2020 2020 4046 696c 6553 6861 7265 5072      @FileSharePr
-0000c130: 6570 6172 6572 2829 0a20 2020 2040 4173  eparer().    @As
-0000c140: 796e 6353 746f 7261 6765 5465 7374 4361  yncStorageTestCa
-0000c150: 7365 2e61 7761 6974 5f70 7265 7061 7265  se.await_prepare
-0000c160: 645f 7465 7374 0a20 2020 2061 7379 6e63  d_test.    async
-0000c170: 2064 6566 2074 6573 745f 636c 6561 725f   def test_clear_
-0000c180: 7261 6e67 655f 6173 796e 6328 7365 6c66  range_async(self
-0000c190: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
-0000c1a0: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
-0000c1b0: 6163 636f 756e 745f 6b65 7929 3a0a 2020  account_key):.  
-0000c1c0: 2020 2020 2020 7365 6c66 2e5f 7365 7475        self._setu
-0000c1d0: 7028 7374 6f72 6167 655f 6163 636f 756e  p(storage_accoun
-0000c1e0: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
-0000c1f0: 6163 636f 756e 745f 6b65 7929 0a20 2020  account_key).   
-0000c200: 2020 2020 2066 696c 655f 636c 6965 6e74       file_client
-0000c210: 203d 2061 7761 6974 2073 656c 662e 5f63   = await self._c
-0000c220: 7265 6174 655f 6669 6c65 2873 746f 7261  reate_file(stora
-0000c230: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
-0000c240: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
-0000c250: 5f6b 6579 290a 0a20 2020 2020 2020 2023  _key)..        #
-0000c260: 2041 6374 0a20 2020 2020 2020 2072 6573   Act.        res
-0000c270: 7020 3d20 6177 6169 7420 6669 6c65 5f63  p = await file_c
-0000c280: 6c69 656e 742e 636c 6561 725f 7261 6e67  lient.clear_rang
-0000c290: 6528 6f66 6673 6574 3d30 2c20 6c65 6e67  e(offset=0, leng
-0000c2a0: 7468 3d35 3132 290a 0a20 2020 2020 2020  th=512)..       
-0000c2b0: 2023 2041 7373 6572 740a 2020 2020 2020   # Assert.      
-0000c2c0: 2020 636f 6e74 656e 7420 3d20 6177 6169    content = awai
-0000c2d0: 7420 6669 6c65 5f63 6c69 656e 742e 646f  t file_client.do
-0000c2e0: 776e 6c6f 6164 5f66 696c 6528 290a 2020  wnload_file().  
-0000c2f0: 2020 2020 2020 636f 6e74 656e 7420 3d20        content = 
-0000c300: 6177 6169 7420 636f 6e74 656e 742e 7265  await content.re
-0000c310: 6164 616c 6c28 290a 2020 2020 2020 2020  adall().        
-0000c320: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-0000c330: 2862 275c 7830 3027 202a 2035 3132 2c20  (b'\x00' * 512, 
-0000c340: 636f 6e74 656e 745b 3a35 3132 5d29 0a20  content[:512]). 
-0000c350: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0000c360: 7274 4571 7561 6c28 7365 6c66 2e73 686f  rtEqual(self.sho
-0000c370: 7274 5f62 7974 655f 6461 7461 5b35 3132  rt_byte_data[512
-0000c380: 3a5d 2c20 636f 6e74 656e 745b 3531 323a  :], content[512:
-0000c390: 5d29 0a0a 2020 2020 4046 696c 6553 6861  ])..    @FileSha
-0000c3a0: 7265 5072 6570 6172 6572 2829 0a20 2020  rePreparer().   
-0000c3b0: 2040 4173 796e 6353 746f 7261 6765 5465   @AsyncStorageTe
-0000c3c0: 7374 4361 7365 2e61 7761 6974 5f70 7265  stCase.await_pre
-0000c3d0: 7061 7265 645f 7465 7374 0a20 2020 2061  pared_test.    a
-0000c3e0: 7379 6e63 2064 6566 2074 6573 745f 7570  sync def test_up
-0000c3f0: 6461 7465 5f66 696c 655f 756e 6963 6f64  date_file_unicod
-0000c400: 655f 6173 796e 6328 7365 6c66 2c20 7374  e_async(self, st
-0000c410: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
-0000c420: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
-0000c430: 756e 745f 6b65 7929 3a0a 2020 2020 2020  unt_key):.      
-0000c440: 2020 7365 6c66 2e5f 7365 7475 7028 7374    self._setup(st
-0000c450: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
-0000c460: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
-0000c470: 756e 745f 6b65 7929 0a20 2020 2020 2020  unt_key).       
-0000c480: 2066 696c 655f 636c 6965 6e74 203d 2061   file_client = a
-0000c490: 7761 6974 2073 656c 662e 5f63 7265 6174  wait self._creat
-0000c4a0: 655f 6669 6c65 2873 746f 7261 6765 5f61  e_file(storage_a
-0000c4b0: 6363 6f75 6e74 5f6e 616d 652c 2073 746f  ccount_name, sto
-0000c4c0: 7261 6765 5f61 6363 6f75 6e74 5f6b 6579  rage_account_key
-0000c4d0: 290a 0a20 2020 2020 2020 2023 2041 6374  )..        # Act
-0000c4e0: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
-0000c4f0: 7527 6162 6364 6566 6768 696a 6b6c 6d6e  u'abcdefghijklmn
-0000c500: 6f70 2720 2a20 3332 0a20 2020 2020 2020  op' * 32.       
-0000c510: 2061 7761 6974 2066 696c 655f 636c 6965   await file_clie
-0000c520: 6e74 2e75 706c 6f61 645f 7261 6e67 6528  nt.upload_range(
-0000c530: 6461 7461 2c20 6f66 6673 6574 3d30 2c20  data, offset=0, 
-0000c540: 6c65 6e67 7468 3d35 3132 290a 0a20 2020  length=512)..   
-0000c550: 2020 2020 2065 6e63 6f64 6564 203d 2064       encoded = d
-0000c560: 6174 612e 656e 636f 6465 2827 7574 662d  ata.encode('utf-
-0000c570: 3827 290a 0a20 2020 2020 2020 2023 2041  8')..        # A
-0000c580: 7373 6572 740a 2020 2020 2020 2020 636f  ssert.        co
-0000c590: 6e74 656e 7420 3d20 6177 6169 7420 6669  ntent = await fi
-0000c5a0: 6c65 5f63 6c69 656e 742e 646f 776e 6c6f  le_client.downlo
-0000c5b0: 6164 5f66 696c 6528 290a 2020 2020 2020  ad_file().      
-0000c5c0: 2020 636f 6e74 656e 7420 3d20 6177 6169    content = awai
-0000c5d0: 7420 636f 6e74 656e 742e 7265 6164 616c  t content.readal
-0000c5e0: 6c28 290a 2020 2020 2020 2020 7365 6c66  l().        self
-0000c5f0: 2e61 7373 6572 7445 7175 616c 2865 6e63  .assertEqual(enc
-0000c600: 6f64 6564 2c20 636f 6e74 656e 745b 3a35  oded, content[:5
-0000c610: 3132 5d29 0a20 2020 2020 2020 2073 656c  12]).        sel
-0000c620: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
-0000c630: 6c66 2e73 686f 7274 5f62 7974 655f 6461  lf.short_byte_da
-0000c640: 7461 5b35 3132 3a5d 2c20 636f 6e74 656e  ta[512:], conten
-0000c650: 745b 3531 323a 5d29 0a0a 2020 2020 2020  t[512:])..      
-0000c660: 2020 2320 4173 7365 7274 0a0a 2020 2020    # Assert..    
-0000c670: 4046 696c 6553 6861 7265 5072 6570 6172  @FileSharePrepar
-0000c680: 6572 2829 0a20 2020 2040 4173 796e 6353  er().    @AsyncS
-0000c690: 746f 7261 6765 5465 7374 4361 7365 2e61  torageTestCase.a
-0000c6a0: 7761 6974 5f70 7265 7061 7265 645f 7465  wait_prepared_te
-0000c6b0: 7374 0a20 2020 2061 7379 6e63 2064 6566  st.    async def
-0000c6c0: 2074 6573 745f 6c69 7374 5f72 616e 6765   test_list_range
-0000c6d0: 735f 6e6f 6e65 5f61 7379 6e63 2873 656c  s_none_async(sel
-0000c6e0: 662c 2073 746f 7261 6765 5f61 6363 6f75  f, storage_accou
-0000c6f0: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
-0000c700: 5f61 6363 6f75 6e74 5f6b 6579 293a 0a20  _account_key):. 
-0000c710: 2020 2020 2020 2073 656c 662e 5f73 6574         self._set
-0000c720: 7570 2873 746f 7261 6765 5f61 6363 6f75  up(storage_accou
-0000c730: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
-0000c740: 5f61 6363 6f75 6e74 5f6b 6579 290a 2020  _account_key).  
-0000c750: 2020 2020 2020 6669 6c65 5f6e 616d 6520        file_name 
-0000c760: 3d20 7365 6c66 2e5f 6765 745f 6669 6c65  = self._get_file
-0000c770: 5f72 6566 6572 656e 6365 2829 0a20 2020  _reference().   
-0000c780: 2020 2020 2061 7761 6974 2073 656c 662e       await self.
-0000c790: 5f73 6574 7570 5f73 6861 7265 2873 746f  _setup_share(sto
-0000c7a0: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
-0000c7b0: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
-0000c7c0: 6e74 5f6b 6579 290a 2020 2020 2020 2020  nt_key).        
-0000c7d0: 6669 6c65 5f63 6c69 656e 7420 3d20 5368  file_client = Sh
-0000c7e0: 6172 6546 696c 6543 6c69 656e 7428 0a20  areFileClient(. 
-0000c7f0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000c800: 6163 636f 756e 745f 7572 6c28 7374 6f72  account_url(stor
-0000c810: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
-0000c820: 2c20 2266 696c 6522 292c 0a20 2020 2020  , "file"),.     
-0000c830: 2020 2020 2020 2073 6861 7265 5f6e 616d         share_nam
-0000c840: 653d 7365 6c66 2e73 6861 7265 5f6e 616d  e=self.share_nam
-0000c850: 652c 0a20 2020 2020 2020 2020 2020 2066  e,.            f
-0000c860: 696c 655f 7061 7468 3d66 696c 655f 6e61  ile_path=file_na
-0000c870: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
-0000c880: 6372 6564 656e 7469 616c 3d73 746f 7261  credential=stora
-0000c890: 6765 5f61 6363 6f75 6e74 5f6b 6579 2c0a  ge_account_key,.
-0000c8a0: 2020 2020 2020 2020 2020 2020 7472 616e              tran
-0000c8b0: 7370 6f72 743d 4169 6f68 7474 7054 6573  sport=AiohttpTes
-0000c8c0: 7454 7261 6e73 706f 7274 2829 290a 2020  tTransport()).  
-0000c8d0: 2020 2020 2020 6177 6169 7420 6669 6c65        await file
-0000c8e0: 5f63 6c69 656e 742e 6372 6561 7465 5f66  _client.create_f
-0000c8f0: 696c 6528 3130 3234 290a 0a20 2020 2020  ile(1024)..     
-0000c900: 2020 2023 2041 6374 0a20 2020 2020 2020     # Act.       
-0000c910: 2072 616e 6765 7320 3d20 6177 6169 7420   ranges = await 
-0000c920: 6669 6c65 5f63 6c69 656e 742e 6765 745f  file_client.get_
-0000c930: 7261 6e67 6573 2829 0a0a 2020 2020 2020  ranges()..      
-0000c940: 2020 2320 4173 7365 7274 0a20 2020 2020    # Assert.     
-0000c950: 2020 2073 656c 662e 6173 7365 7274 4973     self.assertIs
-0000c960: 4e6f 744e 6f6e 6528 7261 6e67 6573 290a  NotNone(ranges).
-0000c970: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0000c980: 6572 7445 7175 616c 286c 656e 2872 616e  ertEqual(len(ran
-0000c990: 6765 7329 2c20 3029 0a0a 2020 2020 4046  ges), 0)..    @F
-0000c9a0: 696c 6553 6861 7265 5072 6570 6172 6572  ileSharePreparer
-0000c9b0: 2829 0a20 2020 2040 4173 796e 6353 746f  ().    @AsyncSto
-0000c9c0: 7261 6765 5465 7374 4361 7365 2e61 7761  rageTestCase.awa
-0000c9d0: 6974 5f70 7265 7061 7265 645f 7465 7374  it_prepared_test
-0000c9e0: 0a20 2020 2061 7379 6e63 2064 6566 2074  .    async def t
-0000c9f0: 6573 745f 6c69 7374 5f72 616e 6765 735f  est_list_ranges_
-0000ca00: 6e6f 6e65 5f77 6974 685f 696e 7661 6c69  none_with_invali
-0000ca10: 645f 6c65 6173 655f 6661 696c 735f 6173  d_lease_fails_as
-0000ca20: 796e 6328 7365 6c66 2c20 7374 6f72 6167  ync(self, storag
-0000ca30: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
-0000ca40: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-0000ca50: 6b65 7929 3a0a 2020 2020 2020 2020 7365  key):.        se
-0000ca60: 6c66 2e5f 7365 7475 7028 7374 6f72 6167  lf._setup(storag
-0000ca70: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
-0000ca80: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-0000ca90: 6b65 7929 0a20 2020 2020 2020 2066 696c  key).        fil
-0000caa0: 655f 6e61 6d65 203d 2073 656c 662e 5f67  e_name = self._g
-0000cab0: 6574 5f66 696c 655f 7265 6665 7265 6e63  et_file_referenc
-0000cac0: 6528 290a 2020 2020 2020 2020 6177 6169  e().        awai
-0000cad0: 7420 7365 6c66 2e5f 7365 7475 705f 7368  t self._setup_sh
-0000cae0: 6172 6528 7374 6f72 6167 655f 6163 636f  are(storage_acco
-0000caf0: 756e 745f 6e61 6d65 2c20 7374 6f72 6167  unt_name, storag
-0000cb00: 655f 6163 636f 756e 745f 6b65 7929 0a20  e_account_key). 
-0000cb10: 2020 2020 2020 2066 696c 655f 636c 6965         file_clie
-0000cb20: 6e74 203d 2053 6861 7265 4669 6c65 436c  nt = ShareFileCl
-0000cb30: 6965 6e74 280a 2020 2020 2020 2020 2020  ient(.          
-0000cb40: 2020 7365 6c66 2e61 6363 6f75 6e74 5f75    self.account_u
-0000cb50: 726c 2873 746f 7261 6765 5f61 6363 6f75  rl(storage_accou
-0000cb60: 6e74 5f6e 616d 652c 2022 6669 6c65 2229  nt_name, "file")
-0000cb70: 2c0a 2020 2020 2020 2020 2020 2020 7368  ,.            sh
-0000cb80: 6172 655f 6e61 6d65 3d73 656c 662e 7368  are_name=self.sh
-0000cb90: 6172 655f 6e61 6d65 2c0a 2020 2020 2020  are_name,.      
-0000cba0: 2020 2020 2020 6669 6c65 5f70 6174 683d        file_path=
-0000cbb0: 6669 6c65 5f6e 616d 652c 0a20 2020 2020  file_name,.     
-0000cbc0: 2020 2020 2020 2063 7265 6465 6e74 6961         credentia
-0000cbd0: 6c3d 7374 6f72 6167 655f 6163 636f 756e  l=storage_accoun
-0000cbe0: 745f 6b65 792c 0a20 2020 2020 2020 2020  t_key,.         
-0000cbf0: 2020 2074 7261 6e73 706f 7274 3d41 696f     transport=Aio
-0000cc00: 6874 7470 5465 7374 5472 616e 7370 6f72  httpTestTranspor
-0000cc10: 7428 2929 0a20 2020 2020 2020 2061 7761  t()).        awa
-0000cc20: 6974 2066 696c 655f 636c 6965 6e74 2e63  it file_client.c
-0000cc30: 7265 6174 655f 6669 6c65 2831 3032 3429  reate_file(1024)
-0000cc40: 0a20 2020 2020 2020 2061 7761 6974 2066  .        await f
-0000cc50: 696c 655f 636c 6965 6e74 2e61 6371 7569  ile_client.acqui
-0000cc60: 7265 5f6c 6561 7365 2829 0a0a 2020 2020  re_lease()..    
-0000cc70: 2020 2020 2320 4163 740a 2020 2020 2020      # Act.      
-0000cc80: 2020 7769 7468 2073 656c 662e 6173 7365    with self.asse
-0000cc90: 7274 5261 6973 6573 2848 7474 7052 6573  rtRaises(HttpRes
-0000cca0: 706f 6e73 6545 7272 6f72 293a 0a20 2020  ponseError):.   
-0000ccb0: 2020 2020 2020 2020 2061 7761 6974 2066           await f
-0000ccc0: 696c 655f 636c 6965 6e74 2e67 6574 5f72  ile_client.get_r
-0000ccd0: 616e 6765 7328 6c65 6173 653d 7374 7228  anges(lease=str(
-0000cce0: 7575 6964 2e75 7569 6434 2829 2929 0a0a  uuid.uuid4()))..
-0000ccf0: 2020 2020 2020 2020 2320 4765 7420 7261          # Get ra
-0000cd00: 6e67 6573 206f 6e20 6120 6c65 6173 6564  nges on a leased
-0000cd10: 2066 696c 6520 7769 6c6c 2073 7563 6365   file will succe
-0000cd20: 6564 2077 6974 686f 7574 2070 726f 7669  ed without provi
-0000cd30: 6465 2074 6865 206c 6561 7365 0a20 2020  de the lease.   
-0000cd40: 2020 2020 2072 616e 6765 7320 3d20 6177       ranges = aw
-0000cd50: 6169 7420 6669 6c65 5f63 6c69 656e 742e  ait file_client.
-0000cd60: 6765 745f 7261 6e67 6573 2829 0a0a 2020  get_ranges()..  
-0000cd70: 2020 2020 2020 2320 4173 7365 7274 0a20        # Assert. 
-0000cd80: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0000cd90: 7274 4973 4e6f 744e 6f6e 6528 7261 6e67  rtIsNotNone(rang
-0000cda0: 6573 290a 2020 2020 2020 2020 7365 6c66  es).        self
-0000cdb0: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
-0000cdc0: 2872 616e 6765 7329 2c20 3029 0a0a 2020  (ranges), 0)..  
-0000cdd0: 2020 4070 7974 6573 742e 6d61 726b 2e70    @pytest.mark.p
-0000cde0: 6c61 7962 6163 6b5f 7465 7374 5f6f 6e6c  layback_test_onl
-0000cdf0: 790a 2020 2020 4046 696c 6553 6861 7265  y.    @FileShare
-0000ce00: 5072 6570 6172 6572 2829 0a20 2020 2040  Preparer().    @
-0000ce10: 4173 796e 6353 746f 7261 6765 5465 7374  AsyncStorageTest
-0000ce20: 4361 7365 2e61 7761 6974 5f70 7265 7061  Case.await_prepa
-0000ce30: 7265 645f 7465 7374 0a20 2020 2061 7379  red_test.    asy
-0000ce40: 6e63 2064 6566 2074 6573 745f 6c69 7374  nc def test_list
-0000ce50: 5f72 616e 6765 735f 6469 6666 2873 656c  _ranges_diff(sel
-0000ce60: 662c 2073 746f 7261 6765 5f61 6363 6f75  f, storage_accou
-0000ce70: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
-0000ce80: 5f61 6363 6f75 6e74 5f6b 6579 293a 0a20  _account_key):. 
-0000ce90: 2020 2020 2020 2073 656c 662e 5f73 6574         self._set
-0000cea0: 7570 2873 746f 7261 6765 5f61 6363 6f75  up(storage_accou
-0000ceb0: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
-0000cec0: 5f61 6363 6f75 6e74 5f6b 6579 290a 2020  _account_key).  
-0000ced0: 2020 2020 2020 6669 6c65 5f6e 616d 6520        file_name 
-0000cee0: 3d20 7365 6c66 2e5f 6765 745f 6669 6c65  = self._get_file
-0000cef0: 5f72 6566 6572 656e 6365 2829 0a20 2020  _reference().   
-0000cf00: 2020 2020 2061 7761 6974 2073 656c 662e       await self.
-0000cf10: 5f73 6574 7570 5f73 6861 7265 2873 746f  _setup_share(sto
-0000cf20: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
-0000cf30: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
-0000cf40: 6e74 5f6b 6579 290a 2020 2020 2020 2020  nt_key).        
-0000cf50: 6669 6c65 5f63 6c69 656e 7420 3d20 5368  file_client = Sh
-0000cf60: 6172 6546 696c 6543 6c69 656e 7428 0a20  areFileClient(. 
-0000cf70: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000cf80: 6163 636f 756e 745f 7572 6c28 7374 6f72  account_url(stor
-0000cf90: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
-0000cfa0: 2c20 2266 696c 6522 292c 0a20 2020 2020  , "file"),.     
-0000cfb0: 2020 2020 2020 2073 6861 7265 5f6e 616d         share_nam
-0000cfc0: 653d 7365 6c66 2e73 6861 7265 5f6e 616d  e=self.share_nam
-0000cfd0: 652c 0a20 2020 2020 2020 2020 2020 2066  e,.            f
-0000cfe0: 696c 655f 7061 7468 3d66 696c 655f 6e61  ile_path=file_na
-0000cff0: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
-0000d000: 6372 6564 656e 7469 616c 3d73 746f 7261  credential=stora
-0000d010: 6765 5f61 6363 6f75 6e74 5f6b 6579 290a  ge_account_key).
-0000d020: 0a20 2020 2020 2020 2061 7761 6974 2066  .        await f
-0000d030: 696c 655f 636c 6965 6e74 2e63 7265 6174  ile_client.creat
-0000d040: 655f 6669 6c65 2832 3034 3829 0a20 2020  e_file(2048).   
-0000d050: 2020 2020 2073 6861 7265 5f63 6c69 656e       share_clien
-0000d060: 7420 3d20 7365 6c66 2e66 7363 2e67 6574  t = self.fsc.get
-0000d070: 5f73 6861 7265 5f63 6c69 656e 7428 7365  _share_client(se
-0000d080: 6c66 2e73 6861 7265 5f6e 616d 6529 0a20  lf.share_name). 
-0000d090: 2020 2020 2020 2073 6e61 7073 686f 7431         snapshot1
-0000d0a0: 203d 2061 7761 6974 2073 6861 7265 5f63   = await share_c
-0000d0b0: 6c69 656e 742e 6372 6561 7465 5f73 6e61  lient.create_sna
-0000d0c0: 7073 686f 7428 290a 0a20 2020 2020 2020  pshot()..       
-0000d0d0: 2064 6174 6120 3d20 7365 6c66 2e67 6574   data = self.get
-0000d0e0: 5f72 616e 646f 6d5f 6279 7465 7328 3135  _random_bytes(15
-0000d0f0: 3336 290a 2020 2020 2020 2020 6177 6169  36).        awai
-0000d100: 7420 6669 6c65 5f63 6c69 656e 742e 7570  t file_client.up
-0000d110: 6c6f 6164 5f72 616e 6765 2864 6174 612c  load_range(data,
-0000d120: 206f 6666 7365 743d 302c 206c 656e 6774   offset=0, lengt
-0000d130: 683d 3135 3336 290a 2020 2020 2020 2020  h=1536).        
-0000d140: 736e 6170 7368 6f74 3220 3d20 6177 6169  snapshot2 = awai
-0000d150: 7420 7368 6172 655f 636c 6965 6e74 2e63  t share_client.c
-0000d160: 7265 6174 655f 736e 6170 7368 6f74 2829  reate_snapshot()
-0000d170: 0a20 2020 2020 2020 2061 7761 6974 2066  .        await f
-0000d180: 696c 655f 636c 6965 6e74 2e63 6c65 6172  ile_client.clear
-0000d190: 5f72 616e 6765 286f 6666 7365 743d 3531  _range(offset=51
-0000d1a0: 322c 206c 656e 6774 683d 3531 3229 0a0a  2, length=512)..
-0000d1b0: 2020 2020 2020 2020 7261 6e67 6573 312c          ranges1,
-0000d1c0: 2063 6c65 6172 6564 3120 3d20 6177 6169   cleared1 = awai
-0000d1d0: 7420 6669 6c65 5f63 6c69 656e 742e 6765  t file_client.ge
-0000d1e0: 745f 7261 6e67 6573 5f64 6966 6628 7072  t_ranges_diff(pr
-0000d1f0: 6576 696f 7573 5f73 6861 7265 736e 6170  evious_sharesnap
-0000d200: 7368 6f74 3d73 6e61 7073 686f 7431 290a  shot=snapshot1).
-0000d210: 2020 2020 2020 2020 7261 6e67 6573 322c          ranges2,
-0000d220: 2063 6c65 6172 6564 3220 3d20 6177 6169   cleared2 = awai
-0000d230: 7420 6669 6c65 5f63 6c69 656e 742e 6765  t file_client.ge
-0000d240: 745f 7261 6e67 6573 5f64 6966 6628 7072  t_ranges_diff(pr
-0000d250: 6576 696f 7573 5f73 6861 7265 736e 6170  evious_sharesnap
-0000d260: 7368 6f74 3d73 6e61 7073 686f 7432 5b27  shot=snapshot2['
-0000d270: 736e 6170 7368 6f74 275d 290a 0a20 2020  snapshot'])..   
-0000d280: 2020 2020 2023 2041 7373 6572 740a 2020       # Assert.  
-0000d290: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0000d2a0: 7449 734e 6f74 4e6f 6e65 2872 616e 6765  tIsNotNone(range
-0000d2b0: 7331 290a 2020 2020 2020 2020 7365 6c66  s1).        self
-0000d2c0: 2e61 7373 6572 7449 7349 6e73 7461 6e63  .assertIsInstanc
-0000d2d0: 6528 7261 6e67 6573 312c 206c 6973 7429  e(ranges1, list)
-0000d2e0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-0000d2f0: 7365 7274 4571 7561 6c28 6c65 6e28 7261  sertEqual(len(ra
-0000d300: 6e67 6573 3129 2c20 3229 0a20 2020 2020  nges1), 2).     
-0000d310: 2020 2073 656c 662e 6173 7365 7274 4973     self.assertIs
-0000d320: 496e 7374 616e 6365 2863 6c65 6172 6564  Instance(cleared
-0000d330: 312c 206c 6973 7429 0a20 2020 2020 2020  1, list).       
-0000d340: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-0000d350: 6c28 6c65 6e28 636c 6561 7265 6431 292c  l(len(cleared1),
-0000d360: 2031 290a 2020 2020 2020 2020 7365 6c66   1).        self
-0000d370: 2e61 7373 6572 7445 7175 616c 2872 616e  .assertEqual(ran
-0000d380: 6765 7331 5b30 5d5b 2773 7461 7274 275d  ges1[0]['start']
-0000d390: 2c20 3029 0a20 2020 2020 2020 2073 656c  , 0).        sel
-0000d3a0: 662e 6173 7365 7274 4571 7561 6c28 7261  f.assertEqual(ra
-0000d3b0: 6e67 6573 315b 305d 5b27 656e 6427 5d2c  nges1[0]['end'],
-0000d3c0: 2035 3131 290a 2020 2020 2020 2020 7365   511).        se
-0000d3d0: 6c66 2e61 7373 6572 7445 7175 616c 2863  lf.assertEqual(c
-0000d3e0: 6c65 6172 6564 315b 305d 5b27 7374 6172  leared1[0]['star
-0000d3f0: 7427 5d2c 2035 3132 290a 2020 2020 2020  t'], 512).      
-0000d400: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-0000d410: 616c 2863 6c65 6172 6564 315b 305d 5b27  al(cleared1[0]['
-0000d420: 656e 6427 5d2c 2031 3032 3329 0a20 2020  end'], 1023).   
-0000d430: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000d440: 4571 7561 6c28 7261 6e67 6573 315b 315d  Equal(ranges1[1]
-0000d450: 5b27 7374 6172 7427 5d2c 2031 3032 3429  ['start'], 1024)
-0000d460: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-0000d470: 7365 7274 4571 7561 6c28 7261 6e67 6573  sertEqual(ranges
-0000d480: 315b 315d 5b27 656e 6427 5d2c 2031 3533  1[1]['end'], 153
-0000d490: 3529 0a0a 2020 2020 2020 2020 7365 6c66  5)..        self
-0000d4a0: 2e61 7373 6572 7449 734e 6f74 4e6f 6e65  .assertIsNotNone
-0000d4b0: 2872 616e 6765 7332 290a 2020 2020 2020  (ranges2).      
-0000d4c0: 2020 7365 6c66 2e61 7373 6572 7449 7349    self.assertIsI
-0000d4d0: 6e73 7461 6e63 6528 7261 6e67 6573 322c  nstance(ranges2,
-0000d4e0: 206c 6973 7429 0a20 2020 2020 2020 2073   list).        s
-0000d4f0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-0000d500: 6c65 6e28 7261 6e67 6573 3229 2c20 3029  len(ranges2), 0)
-0000d510: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-0000d520: 7365 7274 4973 496e 7374 616e 6365 2863  sertIsInstance(c
-0000d530: 6c65 6172 6564 322c 206c 6973 7429 0a20  leared2, list). 
-0000d540: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0000d550: 7274 4571 7561 6c28 6c65 6e28 636c 6561  rtEqual(len(clea
-0000d560: 7265 6432 292c 2031 290a 2020 2020 2020  red2), 1).      
-0000d570: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-0000d580: 616c 2863 6c65 6172 6564 325b 305d 5b27  al(cleared2[0]['
-0000d590: 7374 6172 7427 5d2c 2035 3132 290a 2020  start'], 512).  
-0000d5a0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0000d5b0: 7445 7175 616c 2863 6c65 6172 6564 325b  tEqual(cleared2[
-0000d5c0: 305d 5b27 656e 6427 5d2c 2031 3032 3329  0]['end'], 1023)
-0000d5d0: 0a0a 2020 2020 4046 696c 6553 6861 7265  ..    @FileShare
-0000d5e0: 5072 6570 6172 6572 2829 0a20 2020 2040  Preparer().    @
-0000d5f0: 4173 796e 6353 746f 7261 6765 5465 7374  AsyncStorageTest
-0000d600: 4361 7365 2e61 7761 6974 5f70 7265 7061  Case.await_prepa
-0000d610: 7265 645f 7465 7374 0a20 2020 2061 7379  red_test.    asy
-0000d620: 6e63 2064 6566 2074 6573 745f 6c69 7374  nc def test_list
-0000d630: 5f72 616e 6765 735f 325f 6173 796e 6328  _ranges_2_async(
-0000d640: 7365 6c66 2c20 7374 6f72 6167 655f 6163  self, storage_ac
-0000d650: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
-0000d660: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
-0000d670: 3a0a 2020 2020 2020 2020 7365 6c66 2e5f  :.        self._
-0000d680: 7365 7475 7028 7374 6f72 6167 655f 6163  setup(storage_ac
-0000d690: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
-0000d6a0: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
-0000d6b0: 0a20 2020 2020 2020 2066 696c 655f 6e61  .        file_na
-0000d6c0: 6d65 203d 2073 656c 662e 5f67 6574 5f66  me = self._get_f
-0000d6d0: 696c 655f 7265 6665 7265 6e63 6528 290a  ile_reference().
-0000d6e0: 2020 2020 2020 2020 6177 6169 7420 7365          await se
-0000d6f0: 6c66 2e5f 7365 7475 705f 7368 6172 6528  lf._setup_share(
-0000d700: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-0000d710: 6e61 6d65 2c20 7374 6f72 6167 655f 6163  name, storage_ac
-0000d720: 636f 756e 745f 6b65 7929 0a20 2020 2020  count_key).     
-0000d730: 2020 2066 696c 655f 636c 6965 6e74 203d     file_client =
-0000d740: 2053 6861 7265 4669 6c65 436c 6965 6e74   ShareFileClient
-0000d750: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
-0000d760: 6c66 2e61 6363 6f75 6e74 5f75 726c 2873  lf.account_url(s
-0000d770: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
-0000d780: 616d 652c 2022 6669 6c65 2229 2c0a 2020  ame, "file"),.  
-0000d790: 2020 2020 2020 2020 2020 7368 6172 655f            share_
-0000d7a0: 6e61 6d65 3d73 656c 662e 7368 6172 655f  name=self.share_
-0000d7b0: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
-0000d7c0: 2020 6669 6c65 5f70 6174 683d 6669 6c65    file_path=file
-0000d7d0: 5f6e 616d 652c 0a20 2020 2020 2020 2020  _name,.         
-0000d7e0: 2020 2063 7265 6465 6e74 6961 6c3d 7374     credential=st
-0000d7f0: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
-0000d800: 792c 0a20 2020 2020 2020 2020 2020 2074  y,.            t
-0000d810: 7261 6e73 706f 7274 3d41 696f 6874 7470  ransport=Aiohttp
-0000d820: 5465 7374 5472 616e 7370 6f72 7428 2929  TestTransport())
-0000d830: 0a20 2020 2020 2020 2061 7761 6974 2066  .        await f
-0000d840: 696c 655f 636c 6965 6e74 2e63 7265 6174  ile_client.creat
-0000d850: 655f 6669 6c65 2832 3034 3829 0a0a 2020  e_file(2048)..  
-0000d860: 2020 2020 2020 6461 7461 203d 2062 2761        data = b'a
-0000d870: 6263 6465 6667 6869 6a6b 6c6d 6e6f 7027  bcdefghijklmnop'
-0000d880: 202a 2033 320a 2020 2020 2020 2020 7265   * 32.        re
-0000d890: 7370 3120 3d20 6177 6169 7420 6669 6c65  sp1 = await file
-0000d8a0: 5f63 6c69 656e 742e 7570 6c6f 6164 5f72  _client.upload_r
-0000d8b0: 616e 6765 2864 6174 612c 206f 6666 7365  ange(data, offse
-0000d8c0: 743d 302c 206c 656e 6774 683d 3531 3229  t=0, length=512)
-0000d8d0: 0a20 2020 2020 2020 2072 6573 7032 203d  .        resp2 =
-0000d8e0: 2061 7761 6974 2066 696c 655f 636c 6965   await file_clie
-0000d8f0: 6e74 2e75 706c 6f61 645f 7261 6e67 6528  nt.upload_range(
-0000d900: 6461 7461 2c20 6f66 6673 6574 3d31 3032  data, offset=102
-0000d910: 342c 206c 656e 6774 683d 3531 3229 0a0a  4, length=512)..
-0000d920: 2020 2020 2020 2020 2320 4163 740a 2020          # Act.  
-0000d930: 2020 2020 2020 7261 6e67 6573 203d 2061        ranges = a
-0000d940: 7761 6974 2066 696c 655f 636c 6965 6e74  wait file_client
-0000d950: 2e67 6574 5f72 616e 6765 7328 290a 0a20  .get_ranges().. 
-0000d960: 2020 2020 2020 2023 2041 7373 6572 740a         # Assert.
-0000d970: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0000d980: 6572 7449 734e 6f74 4e6f 6e65 2872 616e  ertIsNotNone(ran
-0000d990: 6765 7329 0a20 2020 2020 2020 2073 656c  ges).        sel
-0000d9a0: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
-0000d9b0: 6e28 7261 6e67 6573 292c 2032 290a 2020  n(ranges), 2).  
-0000d9c0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0000d9d0: 7445 7175 616c 2872 616e 6765 735b 305d  tEqual(ranges[0]
-0000d9e0: 5b27 7374 6172 7427 5d2c 2030 290a 2020  ['start'], 0).  
-0000d9f0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0000da00: 7445 7175 616c 2872 616e 6765 735b 305d  tEqual(ranges[0]
-0000da10: 5b27 656e 6427 5d2c 2035 3131 290a 2020  ['end'], 511).  
-0000da20: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0000da30: 7445 7175 616c 2872 616e 6765 735b 315d  tEqual(ranges[1]
-0000da40: 5b27 7374 6172 7427 5d2c 2031 3032 3429  ['start'], 1024)
-0000da50: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-0000da60: 7365 7274 4571 7561 6c28 7261 6e67 6573  sertEqual(ranges
-0000da70: 5b31 5d5b 2765 6e64 275d 2c20 3135 3335  [1]['end'], 1535
-0000da80: 290a 0a20 2020 2040 4669 6c65 5368 6172  )..    @FileShar
-0000da90: 6550 7265 7061 7265 7228 290a 2020 2020  ePreparer().    
-0000daa0: 4041 7379 6e63 5374 6f72 6167 6554 6573  @AsyncStorageTes
-0000dab0: 7443 6173 652e 6177 6169 745f 7072 6570  tCase.await_prep
-0000dac0: 6172 6564 5f74 6573 740a 2020 2020 6173  ared_test.    as
-0000dad0: 796e 6320 6465 6620 7465 7374 5f6c 6973  ync def test_lis
-0000dae0: 745f 7261 6e67 6573 5f6e 6f6e 655f 6672  t_ranges_none_fr
-0000daf0: 6f6d 5f73 6e61 7073 686f 745f 6173 796e  om_snapshot_asyn
-0000db00: 6328 7365 6c66 2c20 7374 6f72 6167 655f  c(self, storage_
-0000db10: 6163 636f 756e 745f 6e61 6d65 2c20 7374  account_name, st
-0000db20: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
-0000db30: 7929 3a0a 2020 2020 2020 2020 7365 6c66  y):.        self
-0000db40: 2e5f 7365 7475 7028 7374 6f72 6167 655f  ._setup(storage_
-0000db50: 6163 636f 756e 745f 6e61 6d65 2c20 7374  account_name, st
-0000db60: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
-0000db70: 7929 0a20 2020 2020 2020 2066 696c 655f  y).        file_
-0000db80: 6e61 6d65 203d 2073 656c 662e 5f67 6574  name = self._get
-0000db90: 5f66 696c 655f 7265 6665 7265 6e63 6528  _file_reference(
-0000dba0: 290a 2020 2020 2020 2020 6177 6169 7420  ).        await 
-0000dbb0: 7365 6c66 2e5f 7365 7475 705f 7368 6172  self._setup_shar
-0000dbc0: 6528 7374 6f72 6167 655f 6163 636f 756e  e(storage_accoun
-0000dbd0: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
-0000dbe0: 6163 636f 756e 745f 6b65 7929 0a20 2020  account_key).   
-0000dbf0: 2020 2020 2066 696c 655f 636c 6965 6e74       file_client
-0000dc00: 203d 2053 6861 7265 4669 6c65 436c 6965   = ShareFileClie
-0000dc10: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
-0000dc20: 7365 6c66 2e61 6363 6f75 6e74 5f75 726c  self.account_url
-0000dc30: 2873 746f 7261 6765 5f61 6363 6f75 6e74  (storage_account
-0000dc40: 5f6e 616d 652c 2022 6669 6c65 2229 2c0a  _name, "file"),.
-0000dc50: 2020 2020 2020 2020 2020 2020 7368 6172              shar
-0000dc60: 655f 6e61 6d65 3d73 656c 662e 7368 6172  e_name=self.shar
-0000dc70: 655f 6e61 6d65 2c0a 2020 2020 2020 2020  e_name,.        
-0000dc80: 2020 2020 6669 6c65 5f70 6174 683d 6669      file_path=fi
-0000dc90: 6c65 5f6e 616d 652c 0a20 2020 2020 2020  le_name,.       
-0000dca0: 2020 2020 2063 7265 6465 6e74 6961 6c3d       credential=
-0000dcb0: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-0000dcc0: 6b65 7929 0a20 2020 2020 2020 2061 7761  key).        awa
-0000dcd0: 6974 2066 696c 655f 636c 6965 6e74 2e63  it file_client.c
-0000dce0: 7265 6174 655f 6669 6c65 2831 3032 3429  reate_file(1024)
-0000dcf0: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-0000dd00: 2020 7368 6172 655f 636c 6965 6e74 203d    share_client =
-0000dd10: 2073 656c 662e 6673 632e 6765 745f 7368   self.fsc.get_sh
-0000dd20: 6172 655f 636c 6965 6e74 2873 656c 662e  are_client(self.
-0000dd30: 7368 6172 655f 6e61 6d65 290a 2020 2020  share_name).    
-0000dd40: 2020 2020 736e 6170 7368 6f74 203d 2061      snapshot = a
-0000dd50: 7761 6974 2073 6861 7265 5f63 6c69 656e  wait share_clien
-0000dd60: 742e 6372 6561 7465 5f73 6e61 7073 686f  t.create_snapsho
-0000dd70: 7428 290a 2020 2020 2020 2020 736e 6170  t().        snap
-0000dd80: 7368 6f74 5f63 6c69 656e 7420 3d20 5368  shot_client = Sh
-0000dd90: 6172 6546 696c 6543 6c69 656e 7428 0a20  areFileClient(. 
-0000dda0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000ddb0: 6163 636f 756e 745f 7572 6c28 7374 6f72  account_url(stor
-0000ddc0: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
-0000ddd0: 2c20 2266 696c 6522 292c 0a20 2020 2020  , "file"),.     
-0000dde0: 2020 2020 2020 2073 6861 7265 5f6e 616d         share_nam
-0000ddf0: 653d 7365 6c66 2e73 6861 7265 5f6e 616d  e=self.share_nam
-0000de00: 652c 0a20 2020 2020 2020 2020 2020 2066  e,.            f
-0000de10: 696c 655f 7061 7468 3d66 696c 655f 636c  ile_path=file_cl
-0000de20: 6965 6e74 2e66 696c 655f 6e61 6d65 2c0a  ient.file_name,.
-0000de30: 2020 2020 2020 2020 2020 2020 736e 6170              snap
-0000de40: 7368 6f74 3d73 6e61 7073 686f 742c 0a20  shot=snapshot,. 
-0000de50: 2020 2020 2020 2020 2020 2063 7265 6465             crede
-0000de60: 6e74 6961 6c3d 7374 6f72 6167 655f 6163  ntial=storage_ac
-0000de70: 636f 756e 745f 6b65 792c 0a20 2020 2020  count_key,.     
-0000de80: 2020 2020 2020 2074 7261 6e73 706f 7274         transport
-0000de90: 3d41 696f 6874 7470 5465 7374 5472 616e  =AiohttpTestTran
-0000dea0: 7370 6f72 7428 2929 0a0a 2020 2020 2020  sport())..      
-0000deb0: 2020 6177 6169 7420 6669 6c65 5f63 6c69    await file_cli
-0000dec0: 656e 742e 6465 6c65 7465 5f66 696c 6528  ent.delete_file(
-0000ded0: 290a 0a20 2020 2020 2020 2023 2041 6374  )..        # Act
-0000dee0: 0a20 2020 2020 2020 2072 616e 6765 7320  .        ranges 
-0000def0: 3d20 6177 6169 7420 736e 6170 7368 6f74  = await snapshot
-0000df00: 5f63 6c69 656e 742e 6765 745f 7261 6e67  _client.get_rang
-0000df10: 6573 2829 0a0a 2020 2020 2020 2020 2320  es()..        # 
-0000df20: 4173 7365 7274 0a20 2020 2020 2020 2073  Assert.        s
-0000df30: 656c 662e 6173 7365 7274 4973 4e6f 744e  elf.assertIsNotN
-0000df40: 6f6e 6528 7261 6e67 6573 290a 2020 2020  one(ranges).    
-0000df50: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-0000df60: 7175 616c 286c 656e 2872 616e 6765 7329  qual(len(ranges)
-0000df70: 2c20 3029 0a0a 2020 2020 4046 696c 6553  , 0)..    @FileS
-0000df80: 6861 7265 5072 6570 6172 6572 2829 0a20  harePreparer(). 
-0000df90: 2020 2040 4173 796e 6353 746f 7261 6765     @AsyncStorage
-0000dfa0: 5465 7374 4361 7365 2e61 7761 6974 5f70  TestCase.await_p
-0000dfb0: 7265 7061 7265 645f 7465 7374 0a20 2020  repared_test.   
-0000dfc0: 2061 7379 6e63 2064 6566 2074 6573 745f   async def test_
-0000dfd0: 6c69 7374 5f72 616e 6765 735f 325f 6672  list_ranges_2_fr
-0000dfe0: 6f6d 5f73 6e61 7073 686f 745f 6173 796e  om_snapshot_asyn
-0000dff0: 6328 7365 6c66 2c20 7374 6f72 6167 655f  c(self, storage_
-0000e000: 6163 636f 756e 745f 6e61 6d65 2c20 7374  account_name, st
-0000e010: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
-0000e020: 7929 3a0a 2020 2020 2020 2020 7365 6c66  y):.        self
-0000e030: 2e5f 7365 7475 7028 7374 6f72 6167 655f  ._setup(storage_
-0000e040: 6163 636f 756e 745f 6e61 6d65 2c20 7374  account_name, st
-0000e050: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
-0000e060: 7929 0a20 2020 2020 2020 2066 696c 655f  y).        file_
-0000e070: 6e61 6d65 203d 2073 656c 662e 5f67 6574  name = self._get
-0000e080: 5f66 696c 655f 7265 6665 7265 6e63 6528  _file_reference(
-0000e090: 290a 2020 2020 2020 2020 6177 6169 7420  ).        await 
-0000e0a0: 7365 6c66 2e5f 7365 7475 705f 7368 6172  self._setup_shar
-0000e0b0: 6528 7374 6f72 6167 655f 6163 636f 756e  e(storage_accoun
-0000e0c0: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
-0000e0d0: 6163 636f 756e 745f 6b65 7929 0a20 2020  account_key).   
-0000e0e0: 2020 2020 2066 696c 655f 636c 6965 6e74       file_client
-0000e0f0: 203d 2053 6861 7265 4669 6c65 436c 6965   = ShareFileClie
-0000e100: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
-0000e110: 7365 6c66 2e61 6363 6f75 6e74 5f75 726c  self.account_url
-0000e120: 2873 746f 7261 6765 5f61 6363 6f75 6e74  (storage_account
-0000e130: 5f6e 616d 652c 2022 6669 6c65 2229 2c0a  _name, "file"),.
-0000e140: 2020 2020 2020 2020 2020 2020 7368 6172              shar
-0000e150: 655f 6e61 6d65 3d73 656c 662e 7368 6172  e_name=self.shar
-0000e160: 655f 6e61 6d65 2c0a 2020 2020 2020 2020  e_name,.        
-0000e170: 2020 2020 6669 6c65 5f70 6174 683d 6669      file_path=fi
-0000e180: 6c65 5f6e 616d 652c 0a20 2020 2020 2020  le_name,.       
-0000e190: 2020 2020 2063 7265 6465 6e74 6961 6c3d       credential=
-0000e1a0: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-0000e1b0: 6b65 792c 0a20 2020 2020 2020 2020 2020  key,.           
-0000e1c0: 2074 7261 6e73 706f 7274 3d41 696f 6874   transport=Aioht
-0000e1d0: 7470 5465 7374 5472 616e 7370 6f72 7428  tpTestTransport(
-0000e1e0: 2929 0a20 2020 2020 2020 2061 7761 6974  )).        await
-0000e1f0: 2066 696c 655f 636c 6965 6e74 2e63 7265   file_client.cre
-0000e200: 6174 655f 6669 6c65 2832 3034 3829 0a20  ate_file(2048). 
-0000e210: 2020 2020 2020 2064 6174 6120 3d20 6227         data = b'
-0000e220: 6162 6364 6566 6768 696a 6b6c 6d6e 6f70  abcdefghijklmnop
-0000e230: 2720 2a20 3332 0a20 2020 2020 2020 2072  ' * 32.        r
-0000e240: 6573 7031 203d 2061 7761 6974 2066 696c  esp1 = await fil
-0000e250: 655f 636c 6965 6e74 2e75 706c 6f61 645f  e_client.upload_
-0000e260: 7261 6e67 6528 6461 7461 2c20 6f66 6673  range(data, offs
-0000e270: 6574 3d30 2c20 6c65 6e67 7468 3d35 3132  et=0, length=512
-0000e280: 290a 2020 2020 2020 2020 7265 7370 3220  ).        resp2 
-0000e290: 3d20 6177 6169 7420 6669 6c65 5f63 6c69  = await file_cli
-0000e2a0: 656e 742e 7570 6c6f 6164 5f72 616e 6765  ent.upload_range
-0000e2b0: 2864 6174 612c 206f 6666 7365 743d 3130  (data, offset=10
-0000e2c0: 3234 2c20 6c65 6e67 7468 3d35 3132 290a  24, length=512).
-0000e2d0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-0000e2e0: 2073 6861 7265 5f63 6c69 656e 7420 3d20   share_client = 
-0000e2f0: 7365 6c66 2e66 7363 2e67 6574 5f73 6861  self.fsc.get_sha
-0000e300: 7265 5f63 6c69 656e 7428 7365 6c66 2e73  re_client(self.s
-0000e310: 6861 7265 5f6e 616d 6529 0a20 2020 2020  hare_name).     
-0000e320: 2020 2073 6e61 7073 686f 7420 3d20 6177     snapshot = aw
-0000e330: 6169 7420 7368 6172 655f 636c 6965 6e74  ait share_client
-0000e340: 2e63 7265 6174 655f 736e 6170 7368 6f74  .create_snapshot
-0000e350: 2829 0a20 2020 2020 2020 2073 6e61 7073  ().        snaps
-0000e360: 686f 745f 636c 6965 6e74 203d 2053 6861  hot_client = Sha
-0000e370: 7265 4669 6c65 436c 6965 6e74 280a 2020  reFileClient(.  
-0000e380: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-0000e390: 6363 6f75 6e74 5f75 726c 2873 746f 7261  ccount_url(stora
-0000e3a0: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
-0000e3b0: 2022 6669 6c65 2229 2c0a 2020 2020 2020   "file"),.      
-0000e3c0: 2020 2020 2020 7368 6172 655f 6e61 6d65        share_name
-0000e3d0: 3d73 656c 662e 7368 6172 655f 6e61 6d65  =self.share_name
-0000e3e0: 2c0a 2020 2020 2020 2020 2020 2020 6669  ,.            fi
-0000e3f0: 6c65 5f70 6174 683d 6669 6c65 5f63 6c69  le_path=file_cli
-0000e400: 656e 742e 6669 6c65 5f6e 616d 652c 0a20  ent.file_name,. 
-0000e410: 2020 2020 2020 2020 2020 2073 6e61 7073             snaps
-0000e420: 686f 743d 736e 6170 7368 6f74 2c0a 2020  hot=snapshot,.  
-0000e430: 2020 2020 2020 2020 2020 6372 6564 656e            creden
-0000e440: 7469 616c 3d73 746f 7261 6765 5f61 6363  tial=storage_acc
-0000e450: 6f75 6e74 5f6b 6579 2c0a 2020 2020 2020  ount_key,.      
-0000e460: 2020 2020 2020 7472 616e 7370 6f72 743d        transport=
-0000e470: 4169 6f68 7474 7054 6573 7454 7261 6e73  AiohttpTestTrans
-0000e480: 706f 7274 2829 290a 0a20 2020 2020 2020  port())..       
-0000e490: 2061 7761 6974 2066 696c 655f 636c 6965   await file_clie
-0000e4a0: 6e74 2e64 656c 6574 655f 6669 6c65 2829  nt.delete_file()
-0000e4b0: 0a0a 2020 2020 2020 2020 2320 4163 740a  ..        # Act.
-0000e4c0: 2020 2020 2020 2020 7261 6e67 6573 203d          ranges =
-0000e4d0: 2061 7761 6974 2073 6e61 7073 686f 745f   await snapshot_
-0000e4e0: 636c 6965 6e74 2e67 6574 5f72 616e 6765  client.get_range
-0000e4f0: 7328 290a 0a20 2020 2020 2020 2023 2041  s()..        # A
-0000e500: 7373 6572 740a 2020 2020 2020 2020 7365  ssert.        se
-0000e510: 6c66 2e61 7373 6572 7449 734e 6f74 4e6f  lf.assertIsNotNo
-0000e520: 6e65 2872 616e 6765 7329 0a20 2020 2020  ne(ranges).     
-0000e530: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-0000e540: 7561 6c28 6c65 6e28 7261 6e67 6573 292c  ual(len(ranges),
-0000e550: 2032 290a 2020 2020 2020 2020 7365 6c66   2).        self
-0000e560: 2e61 7373 6572 7445 7175 616c 2872 616e  .assertEqual(ran
-0000e570: 6765 735b 305d 5b27 7374 6172 7427 5d2c  ges[0]['start'],
-0000e580: 2030 290a 2020 2020 2020 2020 7365 6c66   0).        self
-0000e590: 2e61 7373 6572 7445 7175 616c 2872 616e  .assertEqual(ran
-0000e5a0: 6765 735b 305d 5b27 656e 6427 5d2c 2035  ges[0]['end'], 5
-0000e5b0: 3131 290a 2020 2020 2020 2020 7365 6c66  11).        self
-0000e5c0: 2e61 7373 6572 7445 7175 616c 2872 616e  .assertEqual(ran
-0000e5d0: 6765 735b 315d 5b27 7374 6172 7427 5d2c  ges[1]['start'],
-0000e5e0: 2031 3032 3429 0a20 2020 2020 2020 2073   1024).        s
-0000e5f0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-0000e600: 7261 6e67 6573 5b31 5d5b 2765 6e64 275d  ranges[1]['end']
-0000e610: 2c20 3135 3335 290a 0a20 2020 2040 4669  , 1535)..    @Fi
-0000e620: 6c65 5368 6172 6550 7265 7061 7265 7228  leSharePreparer(
-0000e630: 290a 2020 2020 4041 7379 6e63 5374 6f72  ).    @AsyncStor
-0000e640: 6167 6554 6573 7443 6173 652e 6177 6169  ageTestCase.awai
-0000e650: 745f 7072 6570 6172 6564 5f74 6573 740a  t_prepared_test.
-0000e660: 2020 2020 6173 796e 6320 6465 6620 7465      async def te
-0000e670: 7374 5f63 6f70 795f 6669 6c65 5f77 6974  st_copy_file_wit
-0000e680: 685f 6578 6973 7469 6e67 5f66 696c 655f  h_existing_file_
-0000e690: 6173 796e 6328 7365 6c66 2c20 7374 6f72  async(self, stor
-0000e6a0: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
-0000e6b0: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
-0000e6c0: 745f 6b65 7929 3a0a 2020 2020 2020 2020  t_key):.        
-0000e6d0: 7365 6c66 2e5f 7365 7475 7028 7374 6f72  self._setup(stor
-0000e6e0: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
-0000e6f0: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
-0000e700: 745f 6b65 7929 0a20 2020 2020 2020 2073  t_key).        s
-0000e710: 6f75 7263 655f 636c 6965 6e74 203d 2061  ource_client = a
-0000e720: 7761 6974 2073 656c 662e 5f63 7265 6174  wait self._creat
-0000e730: 655f 6669 6c65 2873 746f 7261 6765 5f61  e_file(storage_a
-0000e740: 6363 6f75 6e74 5f6e 616d 652c 2073 746f  ccount_name, sto
-0000e750: 7261 6765 5f61 6363 6f75 6e74 5f6b 6579  rage_account_key
-0000e760: 290a 2020 2020 2020 2020 6669 6c65 5f63  ).        file_c
-0000e770: 6c69 656e 7420 3d20 5368 6172 6546 696c  lient = ShareFil
-0000e780: 6543 6c69 656e 7428 0a20 2020 2020 2020  eClient(.       
-0000e790: 2020 2020 2073 656c 662e 6163 636f 756e       self.accoun
-0000e7a0: 745f 7572 6c28 7374 6f72 6167 655f 6163  t_url(storage_ac
-0000e7b0: 636f 756e 745f 6e61 6d65 2c20 2266 696c  count_name, "fil
-0000e7c0: 6522 292c 0a20 2020 2020 2020 2020 2020  e"),.           
-0000e7d0: 2073 6861 7265 5f6e 616d 653d 7365 6c66   share_name=self
-0000e7e0: 2e73 6861 7265 5f6e 616d 652c 0a20 2020  .share_name,.   
-0000e7f0: 2020 2020 2020 2020 2066 696c 655f 7061           file_pa
-0000e800: 7468 3d27 6669 6c65 3163 6f70 7927 2c0a  th='file1copy',.
-0000e810: 2020 2020 2020 2020 2020 2020 6372 6564              cred
-0000e820: 656e 7469 616c 3d73 746f 7261 6765 5f61  ential=storage_a
-0000e830: 6363 6f75 6e74 5f6b 6579 2c0a 2020 2020  ccount_key,.    
-0000e840: 2020 2020 2020 2020 7472 616e 7370 6f72          transpor
-0000e850: 743d 4169 6f68 7474 7054 6573 7454 7261  t=AiohttpTestTra
-0000e860: 6e73 706f 7274 2829 290a 0a20 2020 2020  nsport())..     
-0000e870: 2020 2023 2041 6374 0a20 2020 2020 2020     # Act.       
-0000e880: 2063 6f70 7920 3d20 6177 6169 7420 6669   copy = await fi
-0000e890: 6c65 5f63 6c69 656e 742e 7374 6172 745f  le_client.start_
-0000e8a0: 636f 7079 5f66 726f 6d5f 7572 6c28 736f  copy_from_url(so
-0000e8b0: 7572 6365 5f63 6c69 656e 742e 7572 6c29  urce_client.url)
-0000e8c0: 0a0a 2020 2020 2020 2020 2320 4173 7365  ..        # Asse
-0000e8d0: 7274 0a20 2020 2020 2020 2073 656c 662e  rt.        self.
-0000e8e0: 6173 7365 7274 4973 4e6f 744e 6f6e 6528  assertIsNotNone(
-0000e8f0: 636f 7079 290a 2020 2020 2020 2020 7365  copy).        se
-0000e900: 6c66 2e61 7373 6572 7445 7175 616c 2863  lf.assertEqual(c
-0000e910: 6f70 795b 2763 6f70 795f 7374 6174 7573  opy['copy_status
-0000e920: 275d 2c20 2773 7563 6365 7373 2729 0a20  '], 'success'). 
-0000e930: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0000e940: 7274 4973 4e6f 744e 6f6e 6528 636f 7079  rtIsNotNone(copy
-0000e950: 5b27 636f 7079 5f69 6427 5d29 0a0a 2020  ['copy_id'])..  
-0000e960: 2020 2020 2020 636f 7079 5f66 696c 6520        copy_file 
-0000e970: 3d20 6177 6169 7420 6669 6c65 5f63 6c69  = await file_cli
-0000e980: 656e 742e 646f 776e 6c6f 6164 5f66 696c  ent.download_fil
-0000e990: 6528 290a 2020 2020 2020 2020 636f 6e74  e().        cont
-0000e9a0: 656e 7420 3d20 6177 6169 7420 636f 7079  ent = await copy
-0000e9b0: 5f66 696c 652e 7265 6164 616c 6c28 290a  _file.readall().
-0000e9c0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0000e9d0: 6572 7445 7175 616c 2863 6f6e 7465 6e74  ertEqual(content
-0000e9e0: 2c20 7365 6c66 2e73 686f 7274 5f62 7974  , self.short_byt
-0000e9f0: 655f 6461 7461 290a 0a20 2020 2040 4669  e_data)..    @Fi
-0000ea00: 6c65 5368 6172 6550 7265 7061 7265 7228  leSharePreparer(
-0000ea10: 290a 2020 2020 4041 7379 6e63 5374 6f72  ).    @AsyncStor
-0000ea20: 6167 6554 6573 7443 6173 652e 6177 6169  ageTestCase.awai
-0000ea30: 745f 7072 6570 6172 6564 5f74 6573 740a  t_prepared_test.
-0000ea40: 2020 2020 6173 796e 6320 6465 6620 7465      async def te
-0000ea50: 7374 5f63 6f70 795f 6578 6973 7469 6e67  st_copy_existing
-0000ea60: 5f66 696c 655f 7769 7468 5f6c 6561 7365  _file_with_lease
-0000ea70: 5f61 7379 6e63 2873 656c 662c 2073 746f  _async(self, sto
-0000ea80: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
-0000ea90: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
-0000eaa0: 6e74 5f6b 6579 293a 0a20 2020 2020 2020  nt_key):.       
-0000eab0: 2073 656c 662e 5f73 6574 7570 2873 746f   self._setup(sto
-0000eac0: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
-0000ead0: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
-0000eae0: 6e74 5f6b 6579 290a 2020 2020 2020 2020  nt_key).        
-0000eaf0: 736f 7572 6365 5f63 6c69 656e 7420 3d20  source_client = 
-0000eb00: 6177 6169 7420 7365 6c66 2e5f 6372 6561  await self._crea
-0000eb10: 7465 5f66 696c 6528 7374 6f72 6167 655f  te_file(storage_
-0000eb20: 6163 636f 756e 745f 6e61 6d65 2c20 7374  account_name, st
-0000eb30: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
-0000eb40: 7929 0a20 2020 2020 2020 2066 696c 655f  y).        file_
-0000eb50: 636c 6965 6e74 203d 2053 6861 7265 4669  client = ShareFi
-0000eb60: 6c65 436c 6965 6e74 280a 2020 2020 2020  leClient(.      
-0000eb70: 2020 2020 2020 7365 6c66 2e61 6363 6f75        self.accou
-0000eb80: 6e74 5f75 726c 2873 746f 7261 6765 5f61  nt_url(storage_a
-0000eb90: 6363 6f75 6e74 5f6e 616d 652c 2022 6669  ccount_name, "fi
-0000eba0: 6c65 2229 2c0a 2020 2020 2020 2020 2020  le"),.          
-0000ebb0: 2020 7368 6172 655f 6e61 6d65 3d73 656c    share_name=sel
-0000ebc0: 662e 7368 6172 655f 6e61 6d65 2c0a 2020  f.share_name,.  
-0000ebd0: 2020 2020 2020 2020 2020 6669 6c65 5f70            file_p
-0000ebe0: 6174 683d 2766 696c 6531 636f 7079 272c  ath='file1copy',
-0000ebf0: 0a20 2020 2020 2020 2020 2020 2063 7265  .            cre
-0000ec00: 6465 6e74 6961 6c3d 7374 6f72 6167 655f  dential=storage_
-0000ec10: 6163 636f 756e 745f 6b65 7929 0a20 2020  account_key).   
-0000ec20: 2020 2020 2061 7761 6974 2066 696c 655f       await file_
-0000ec30: 636c 6965 6e74 2e63 7265 6174 655f 6669  client.create_fi
-0000ec40: 6c65 2831 3032 3429 0a20 2020 2020 2020  le(1024).       
-0000ec50: 206c 6561 7365 203d 2061 7761 6974 2066   lease = await f
-0000ec60: 696c 655f 636c 6965 6e74 2e61 6371 7569  ile_client.acqui
-0000ec70: 7265 5f6c 6561 7365 2829 0a0a 2020 2020  re_lease()..    
-0000ec80: 2020 2020 2320 4163 740a 2020 2020 2020      # Act.      
-0000ec90: 2020 7769 7468 2073 656c 662e 6173 7365    with self.asse
-0000eca0: 7274 5261 6973 6573 2848 7474 7052 6573  rtRaises(HttpRes
-0000ecb0: 706f 6e73 6545 7272 6f72 293a 0a20 2020  ponseError):.   
-0000ecc0: 2020 2020 2020 2020 2061 7761 6974 2066           await f
-0000ecd0: 696c 655f 636c 6965 6e74 2e73 7461 7274  ile_client.start
-0000ece0: 5f63 6f70 795f 6672 6f6d 5f75 726c 2873  _copy_from_url(s
-0000ecf0: 6f75 7263 655f 636c 6965 6e74 2e75 726c  ource_client.url
-0000ed00: 290a 0a20 2020 2020 2020 2063 6f70 7920  )..        copy 
-0000ed10: 3d20 6177 6169 7420 6669 6c65 5f63 6c69  = await file_cli
-0000ed20: 656e 742e 7374 6172 745f 636f 7079 5f66  ent.start_copy_f
-0000ed30: 726f 6d5f 7572 6c28 736f 7572 6365 5f63  rom_url(source_c
-0000ed40: 6c69 656e 742e 7572 6c2c 206c 6561 7365  lient.url, lease
-0000ed50: 3d6c 6561 7365 290a 0a20 2020 2020 2020  =lease)..       
-0000ed60: 2023 2041 7373 6572 740a 2020 2020 2020   # Assert.      
-0000ed70: 2020 7365 6c66 2e61 7373 6572 7449 734e    self.assertIsN
-0000ed80: 6f74 4e6f 6e65 2863 6f70 7929 0a20 2020  otNone(copy).   
-0000ed90: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000eda0: 4571 7561 6c28 636f 7079 5b27 636f 7079  Equal(copy['copy
-0000edb0: 5f73 7461 7475 7327 5d2c 2027 7375 6363  _status'], 'succ
-0000edc0: 6573 7327 290a 2020 2020 2020 2020 7365  ess').        se
-0000edd0: 6c66 2e61 7373 6572 7449 734e 6f74 4e6f  lf.assertIsNotNo
-0000ede0: 6e65 2863 6f70 795b 2763 6f70 795f 6964  ne(copy['copy_id
-0000edf0: 275d 290a 0a20 2020 2020 2020 2063 6f70  '])..        cop
-0000ee00: 795f 6669 6c65 203d 2061 7761 6974 2066  y_file = await f
-0000ee10: 696c 655f 636c 6965 6e74 2e64 6f77 6e6c  ile_client.downl
-0000ee20: 6f61 645f 6669 6c65 2829 0a20 2020 2020  oad_file().     
-0000ee30: 2020 2063 6f6e 7465 6e74 203d 2061 7761     content = awa
-0000ee40: 6974 2063 6f70 795f 6669 6c65 2e72 6561  it copy_file.rea
-0000ee50: 6461 6c6c 2829 0a20 2020 2020 2020 2073  dall().        s
-0000ee60: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-0000ee70: 636f 6e74 656e 742c 2073 656c 662e 7368  content, self.sh
-0000ee80: 6f72 745f 6279 7465 5f64 6174 6129 0a0a  ort_byte_data)..
-0000ee90: 2020 2020 4046 696c 6553 6861 7265 5072      @FileSharePr
-0000eea0: 6570 6172 6572 2829 0a20 2020 2040 4173  eparer().    @As
-0000eeb0: 796e 6353 746f 7261 6765 5465 7374 4361  yncStorageTestCa
-0000eec0: 7365 2e61 7761 6974 5f70 7265 7061 7265  se.await_prepare
-0000eed0: 645f 7465 7374 0a20 2020 2061 7379 6e63  d_test.    async
-0000eee0: 2064 6566 2074 6573 745f 636f 7079 5f66   def test_copy_f
-0000eef0: 696c 655f 6967 6e6f 7265 5f72 6561 646f  ile_ignore_reado
-0000ef00: 6e6c 7928 7365 6c66 2c20 7374 6f72 6167  nly(self, storag
-0000ef10: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
-0000ef20: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-0000ef30: 6b65 7929 3a0a 2020 2020 2020 2020 7365  key):.        se
-0000ef40: 6c66 2e5f 7365 7475 7028 7374 6f72 6167  lf._setup(storag
-0000ef50: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
-0000ef60: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-0000ef70: 6b65 7929 0a20 2020 2020 2020 2073 6f75  key).        sou
-0000ef80: 7263 655f 6669 6c65 203d 2061 7761 6974  rce_file = await
-0000ef90: 2073 656c 662e 5f63 7265 6174 655f 6669   self._create_fi
-0000efa0: 6c65 2873 746f 7261 6765 5f61 6363 6f75  le(storage_accou
-0000efb0: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
-0000efc0: 5f61 6363 6f75 6e74 5f6b 6579 290a 2020  _account_key).  
-0000efd0: 2020 2020 2020 6465 7374 5f66 696c 6520        dest_file 
-0000efe0: 3d20 5368 6172 6546 696c 6543 6c69 656e  = ShareFileClien
-0000eff0: 7428 0a20 2020 2020 2020 2020 2020 2073  t(.            s
-0000f000: 656c 662e 6163 636f 756e 745f 7572 6c28  elf.account_url(
-0000f010: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-0000f020: 6e61 6d65 2c20 2266 696c 6522 292c 0a20  name, "file"),. 
-0000f030: 2020 2020 2020 2020 2020 2073 6861 7265             share
-0000f040: 5f6e 616d 653d 7365 6c66 2e73 6861 7265  _name=self.share
-0000f050: 5f6e 616d 652c 0a20 2020 2020 2020 2020  _name,.         
-0000f060: 2020 2066 696c 655f 7061 7468 3d27 6669     file_path='fi
-0000f070: 6c65 3163 6f70 7927 2c0a 2020 2020 2020  le1copy',.      
-0000f080: 2020 2020 2020 6372 6564 656e 7469 616c        credential
-0000f090: 3d73 746f 7261 6765 5f61 6363 6f75 6e74  =storage_account
-0000f0a0: 5f6b 6579 290a 0a20 2020 2020 2020 2066  _key)..        f
-0000f0b0: 696c 655f 6174 7472 6962 7574 6573 203d  ile_attributes =
-0000f0c0: 204e 5446 5341 7474 7269 6275 7465 7328   NTFSAttributes(
-0000f0d0: 7265 6164 5f6f 6e6c 793d 5472 7565 290a  read_only=True).
-0000f0e0: 2020 2020 2020 2020 6177 6169 7420 6465          await de
-0000f0f0: 7374 5f66 696c 652e 6372 6561 7465 5f66  st_file.create_f
-0000f100: 696c 6528 3130 3234 2c20 6669 6c65 5f61  ile(1024, file_a
-0000f110: 7474 7269 6275 7465 733d 6669 6c65 5f61  ttributes=file_a
-0000f120: 7474 7269 6275 7465 7329 0a0a 2020 2020  ttributes)..    
-0000f130: 2020 2020 2320 4163 740a 2020 2020 2020      # Act.      
-0000f140: 2020 7769 7468 2073 656c 662e 6173 7365    with self.asse
-0000f150: 7274 5261 6973 6573 2848 7474 7052 6573  rtRaises(HttpRes
-0000f160: 706f 6e73 6545 7272 6f72 293a 0a20 2020  ponseError):.   
-0000f170: 2020 2020 2020 2020 2061 7761 6974 2064           await d
-0000f180: 6573 745f 6669 6c65 2e73 7461 7274 5f63  est_file.start_c
-0000f190: 6f70 795f 6672 6f6d 5f75 726c 2873 6f75  opy_from_url(sou
-0000f1a0: 7263 655f 6669 6c65 2e75 726c 290a 0a20  rce_file.url).. 
-0000f1b0: 2020 2020 2020 2063 6f70 7920 3d20 6177         copy = aw
-0000f1c0: 6169 7420 6465 7374 5f66 696c 652e 7374  ait dest_file.st
-0000f1d0: 6172 745f 636f 7079 5f66 726f 6d5f 7572  art_copy_from_ur
-0000f1e0: 6c28 736f 7572 6365 5f66 696c 652e 7572  l(source_file.ur
-0000f1f0: 6c2c 2069 676e 6f72 655f 7265 6164 5f6f  l, ignore_read_o
-0000f200: 6e6c 793d 5472 7565 290a 0a20 2020 2020  nly=True)..     
-0000f210: 2020 2023 2041 7373 6572 740a 2020 2020     # Assert.    
-0000f220: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
-0000f230: 734e 6f74 4e6f 6e65 2863 6f70 7929 0a20  sNotNone(copy). 
-0000f240: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0000f250: 7274 4571 7561 6c28 636f 7079 5b27 636f  rtEqual(copy['co
-0000f260: 7079 5f73 7461 7475 7327 5d2c 2027 7375  py_status'], 'su
-0000f270: 6363 6573 7327 290a 2020 2020 2020 2020  ccess').        
-0000f280: 7365 6c66 2e61 7373 6572 7449 734e 6f74  self.assertIsNot
-0000f290: 4e6f 6e65 2863 6f70 795b 2763 6f70 795f  None(copy['copy_
-0000f2a0: 6964 275d 290a 0a20 2020 2020 2020 2063  id'])..        c
-0000f2b0: 6f70 795f 6669 6c65 203d 2061 7761 6974  opy_file = await
-0000f2c0: 2064 6573 745f 6669 6c65 2e64 6f77 6e6c   dest_file.downl
-0000f2d0: 6f61 645f 6669 6c65 2829 0a20 2020 2020  oad_file().     
-0000f2e0: 2020 2063 6f6e 7465 6e74 203d 2061 7761     content = awa
-0000f2f0: 6974 2063 6f70 795f 6669 6c65 2e72 6561  it copy_file.rea
-0000f300: 6461 6c6c 2829 0a20 2020 2020 2020 2073  dall().        s
-0000f310: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-0000f320: 636f 6e74 656e 742c 2073 656c 662e 7368  content, self.sh
-0000f330: 6f72 745f 6279 7465 5f64 6174 6129 0a0a  ort_byte_data)..
-0000f340: 2020 2020 4046 696c 6553 6861 7265 5072      @FileSharePr
-0000f350: 6570 6172 6572 2829 0a20 2020 2040 4173  eparer().    @As
-0000f360: 796e 6353 746f 7261 6765 5465 7374 4361  yncStorageTestCa
-0000f370: 7365 2e61 7761 6974 5f70 7265 7061 7265  se.await_prepare
-0000f380: 645f 7465 7374 0a20 2020 2061 7379 6e63  d_test.    async
-0000f390: 2064 6566 2074 6573 745f 636f 7079 5f66   def test_copy_f
-0000f3a0: 696c 655f 7769 7468 5f73 7065 6369 6679  ile_with_specify
-0000f3b0: 696e 675f 6163 6c5f 636f 7079 5f62 6568  ing_acl_copy_beh
-0000f3c0: 6176 696f 725f 6174 7472 6962 7574 6573  avior_attributes
-0000f3d0: 5f61 7379 6e63 2873 656c 662c 2073 746f  _async(self, sto
-0000f3e0: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
-0000f3f0: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
-0000f400: 6e74 5f6b 6579 293a 0a20 2020 2020 2020  nt_key):.       
-0000f410: 2073 656c 662e 5f73 6574 7570 2873 746f   self._setup(sto
-0000f420: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
-0000f430: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
-0000f440: 6e74 5f6b 6579 290a 2020 2020 2020 2020  nt_key).        
-0000f450: 736f 7572 6365 5f63 6c69 656e 7420 3d20  source_client = 
-0000f460: 6177 6169 7420 7365 6c66 2e5f 6372 6561  await self._crea
-0000f470: 7465 5f66 696c 6528 7374 6f72 6167 655f  te_file(storage_
-0000f480: 6163 636f 756e 745f 6e61 6d65 2c20 7374  account_name, st
-0000f490: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
-0000f4a0: 7929 0a20 2020 2020 2020 2066 696c 655f  y).        file_
-0000f4b0: 636c 6965 6e74 203d 2053 6861 7265 4669  client = ShareFi
-0000f4c0: 6c65 436c 6965 6e74 280a 2020 2020 2020  leClient(.      
-0000f4d0: 2020 2020 2020 7365 6c66 2e61 6363 6f75        self.accou
-0000f4e0: 6e74 5f75 726c 2873 746f 7261 6765 5f61  nt_url(storage_a
-0000f4f0: 6363 6f75 6e74 5f6e 616d 652c 2022 6669  ccount_name, "fi
-0000f500: 6c65 2229 2c0a 2020 2020 2020 2020 2020  le"),.          
-0000f510: 2020 7368 6172 655f 6e61 6d65 3d73 656c    share_name=sel
-0000f520: 662e 7368 6172 655f 6e61 6d65 2c0a 2020  f.share_name,.  
-0000f530: 2020 2020 2020 2020 2020 6669 6c65 5f70            file_p
-0000f540: 6174 683d 2766 696c 6531 636f 7079 272c  ath='file1copy',
-0000f550: 0a20 2020 2020 2020 2020 2020 2063 7265  .            cre
-0000f560: 6465 6e74 6961 6c3d 7374 6f72 6167 655f  dential=storage_
-0000f570: 6163 636f 756e 745f 6b65 792c 0a20 2020  account_key,.   
-0000f580: 2020 2020 2020 2020 2074 7261 6e73 706f           transpo
-0000f590: 7274 3d41 696f 6874 7470 5465 7374 5472  rt=AiohttpTestTr
-0000f5a0: 616e 7370 6f72 7428 2929 0a20 2020 2020  ansport()).     
-0000f5b0: 2020 2073 6f75 7263 655f 7072 6f70 7320     source_props 
-0000f5c0: 3d20 6177 6169 7420 736f 7572 6365 5f63  = await source_c
-0000f5d0: 6c69 656e 742e 6765 745f 6669 6c65 5f70  lient.get_file_p
-0000f5e0: 726f 7065 7274 6965 7328 290a 0a20 2020  roperties()..   
-0000f5f0: 2020 2020 2066 696c 655f 6372 6561 7469       file_creati
-0000f600: 6f6e 5f74 696d 6520 3d20 736f 7572 6365  on_time = source
-0000f610: 5f70 726f 7073 2e63 7265 6174 696f 6e5f  _props.creation_
-0000f620: 7469 6d65 202d 2074 696d 6564 656c 7461  time - timedelta
-0000f630: 2868 6f75 7273 3d31 290a 2020 2020 2020  (hours=1).      
-0000f640: 2020 6669 6c65 5f6c 6173 745f 7772 6974    file_last_writ
-0000f650: 655f 7469 6d65 203d 2073 6f75 7263 655f  e_time = source_
-0000f660: 7072 6f70 732e 6c61 7374 5f77 7269 7465  props.last_write
-0000f670: 5f74 696d 6520 2d20 7469 6d65 6465 6c74  _time - timedelt
-0000f680: 6128 686f 7572 733d 3129 0a20 2020 2020  a(hours=1).     
-0000f690: 2020 2066 696c 655f 6368 616e 6765 5f74     file_change_t
-0000f6a0: 696d 6520 3d20 736f 7572 6365 5f70 726f  ime = source_pro
-0000f6b0: 7073 2e63 6861 6e67 655f 7469 6d65 202d  ps.change_time -
-0000f6c0: 2074 696d 6564 656c 7461 2868 6f75 7273   timedelta(hours
-0000f6d0: 3d31 290a 2020 2020 2020 2020 6669 6c65  =1).        file
-0000f6e0: 5f61 7474 7269 6275 7465 7320 3d20 2254  _attributes = "T
-0000f6f0: 656d 706f 7261 7279 7c4e 6f53 6372 7562  emporary|NoScrub
-0000f700: 4461 7461 220a 0a20 2020 2020 2020 2023  Data"..        #
-0000f710: 2041 6374 0a20 2020 2020 2020 2063 6f70   Act.        cop
-0000f720: 7920 3d20 6177 6169 7420 6669 6c65 5f63  y = await file_c
-0000f730: 6c69 656e 742e 7374 6172 745f 636f 7079  lient.start_copy
-0000f740: 5f66 726f 6d5f 7572 6c28 0a20 2020 2020  _from_url(.     
-0000f750: 2020 2020 2020 2073 6f75 7263 655f 636c         source_cl
-0000f760: 6965 6e74 2e75 726c 2c0a 2020 2020 2020  ient.url,.      
-0000f770: 2020 2020 2020 6967 6e6f 7265 5f72 6561        ignore_rea
-0000f780: 645f 6f6e 6c79 3d54 7275 652c 0a20 2020  d_only=True,.   
-0000f790: 2020 2020 2020 2020 2066 696c 655f 7065           file_pe
-0000f7a0: 726d 6973 7369 6f6e 3d54 4553 545f 4649  rmission=TEST_FI
-0000f7b0: 4c45 5f50 4552 4d49 5353 494f 4e53 2c0a  LE_PERMISSIONS,.
-0000f7c0: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-0000f7d0: 5f61 7474 7269 6275 7465 733d 6669 6c65  _attributes=file
-0000f7e0: 5f61 7474 7269 6275 7465 732c 0a20 2020  _attributes,.   
-0000f7f0: 2020 2020 2020 2020 2066 696c 655f 6372           file_cr
-0000f800: 6561 7469 6f6e 5f74 696d 653d 6669 6c65  eation_time=file
-0000f810: 5f63 7265 6174 696f 6e5f 7469 6d65 2c0a  _creation_time,.
-0000f820: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-0000f830: 5f6c 6173 745f 7772 6974 655f 7469 6d65  _last_write_time
-0000f840: 3d66 696c 655f 6c61 7374 5f77 7269 7465  =file_last_write
-0000f850: 5f74 696d 652c 0a20 2020 2020 2020 2020  _time,.         
-0000f860: 2020 2066 696c 655f 6368 616e 6765 5f74     file_change_t
-0000f870: 696d 653d 6669 6c65 5f63 6861 6e67 655f  ime=file_change_
-0000f880: 7469 6d65 2c0a 2020 2020 2020 2020 290a  time,.        ).
-0000f890: 0a20 2020 2020 2020 2023 2041 7373 6572  .        # Asser
-0000f8a0: 740a 2020 2020 2020 2020 6465 7374 5f70  t.        dest_p
-0000f8b0: 726f 7020 3d20 6177 6169 7420 6669 6c65  rop = await file
-0000f8c0: 5f63 6c69 656e 742e 6765 745f 6669 6c65  _client.get_file
-0000f8d0: 5f70 726f 7065 7274 6965 7328 290a 2020  _properties().  
-0000f8e0: 2020 2020 2020 2320 746f 206d 616b 6520        # to make 
-0000f8f0: 7375 7265 2074 6865 2061 7474 7269 6275  sure the attribu
-0000f900: 7465 7320 6172 6520 7468 6520 7361 6d65  tes are the same
-0000f910: 2061 7320 7468 6520 7365 7420 6f6e 6573   as the set ones
-0000f920: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-0000f930: 7365 7274 4571 7561 6c28 6669 6c65 5f63  sertEqual(file_c
-0000f940: 7265 6174 696f 6e5f 7469 6d65 2c20 6465  reation_time, de
-0000f950: 7374 5f70 726f 705b 2763 7265 6174 696f  st_prop['creatio
-0000f960: 6e5f 7469 6d65 275d 290a 2020 2020 2020  n_time']).      
-0000f970: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-0000f980: 616c 2866 696c 655f 6c61 7374 5f77 7269  al(file_last_wri
-0000f990: 7465 5f74 696d 652c 2064 6573 745f 7072  te_time, dest_pr
-0000f9a0: 6f70 5b27 6c61 7374 5f77 7269 7465 5f74  op['last_write_t
-0000f9b0: 696d 6527 5d29 0a20 2020 2020 2020 2073  ime']).        s
-0000f9c0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-0000f9d0: 6669 6c65 5f63 6861 6e67 655f 7469 6d65  file_change_time
-0000f9e0: 2c20 6465 7374 5f70 726f 705b 2763 6861  , dest_prop['cha
-0000f9f0: 6e67 655f 7469 6d65 275d 290a 2020 2020  nge_time']).    
-0000fa00: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
-0000fa10: 6e28 2754 656d 706f 7261 7279 272c 2064  n('Temporary', d
-0000fa20: 6573 745f 7072 6f70 5b27 6669 6c65 5f61  est_prop['file_a
-0000fa30: 7474 7269 6275 7465 7327 5d29 0a20 2020  ttributes']).   
-0000fa40: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000fa50: 496e 2827 4e6f 5363 7275 6244 6174 6127  In('NoScrubData'
-0000fa60: 2c20 6465 7374 5f70 726f 705b 2766 696c  , dest_prop['fil
-0000fa70: 655f 6174 7472 6962 7574 6573 275d 290a  e_attributes']).
-0000fa80: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-0000fa90: 7365 7274 4973 4e6f 744e 6f6e 6528 636f  sertIsNotNone(co
-0000faa0: 7079 290a 2020 2020 2020 2020 7365 6c66  py).        self
-0000fab0: 2e61 7373 6572 7445 7175 616c 2863 6f70  .assertEqual(cop
-0000fac0: 795b 2763 6f70 795f 7374 6174 7573 275d  y['copy_status']
-0000fad0: 2c20 2773 7563 6365 7373 2729 0a20 2020  , 'success').   
-0000fae0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000faf0: 4973 4e6f 744e 6f6e 6528 636f 7079 5b27  IsNotNone(copy['
-0000fb00: 636f 7079 5f69 6427 5d29 0a0a 2020 2020  copy_id'])..    
-0000fb10: 2020 2020 636f 7079 5f66 696c 6520 3d20      copy_file = 
-0000fb20: 6177 6169 7420 6669 6c65 5f63 6c69 656e  await file_clien
-0000fb30: 742e 646f 776e 6c6f 6164 5f66 696c 6528  t.download_file(
-0000fb40: 290a 2020 2020 2020 2020 636f 6e74 656e  ).        conten
-0000fb50: 7420 3d20 6177 6169 7420 636f 7079 5f66  t = await copy_f
-0000fb60: 696c 652e 7265 6164 616c 6c28 290a 2020  ile.readall().  
-0000fb70: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0000fb80: 7445 7175 616c 2863 6f6e 7465 6e74 2c20  tEqual(content, 
-0000fb90: 7365 6c66 2e73 686f 7274 5f62 7974 655f  self.short_byte_
-0000fba0: 6461 7461 290a 0a20 2020 2040 4669 6c65  data)..    @File
-0000fbb0: 5368 6172 6550 7265 7061 7265 7228 290a  SharePreparer().
-0000fbc0: 2020 2020 4041 7379 6e63 5374 6f72 6167      @AsyncStorag
-0000fbd0: 6554 6573 7443 6173 652e 6177 6169 745f  eTestCase.await_
-0000fbe0: 7072 6570 6172 6564 5f74 6573 740a 2020  prepared_test.  
-0000fbf0: 2020 6173 796e 6320 6465 6620 7465 7374    async def test
-0000fc00: 5f63 6f70 795f 6669 6c65 5f77 6974 685f  _copy_file_with_
-0000fc10: 7370 6563 6966 7969 6e67 5f61 636c 5f61  specifying_acl_a
-0000fc20: 6e64 5f61 7474 7269 6275 7465 735f 6672  nd_attributes_fr
-0000fc30: 6f6d 5f73 6f75 7263 655f 6173 796e 6328  om_source_async(
-0000fc40: 7365 6c66 2c20 7374 6f72 6167 655f 6163  self, storage_ac
-0000fc50: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
-0000fc60: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
-0000fc70: 3a0a 2020 2020 2020 2020 7365 6c66 2e5f  :.        self._
-0000fc80: 7365 7475 7028 7374 6f72 6167 655f 6163  setup(storage_ac
-0000fc90: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
-0000fca0: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
-0000fcb0: 0a20 2020 2020 2020 2073 6f75 7263 655f  .        source_
-0000fcc0: 636c 6965 6e74 203d 2061 7761 6974 2073  client = await s
-0000fcd0: 656c 662e 5f63 7265 6174 655f 6669 6c65  elf._create_file
-0000fce0: 2873 746f 7261 6765 5f61 6363 6f75 6e74  (storage_account
-0000fcf0: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
-0000fd00: 6363 6f75 6e74 5f6b 6579 290a 2020 2020  ccount_key).    
-0000fd10: 2020 2020 736f 7572 6365 5f70 726f 7020      source_prop 
-0000fd20: 3d20 6177 6169 7420 736f 7572 6365 5f63  = await source_c
-0000fd30: 6c69 656e 742e 6765 745f 6669 6c65 5f70  lient.get_file_p
-0000fd40: 726f 7065 7274 6965 7328 290a 2020 2020  roperties().    
-0000fd50: 2020 2020 6669 6c65 5f63 6c69 656e 7420      file_client 
-0000fd60: 3d20 5368 6172 6546 696c 6543 6c69 656e  = ShareFileClien
-0000fd70: 7428 0a20 2020 2020 2020 2020 2020 2073  t(.            s
-0000fd80: 656c 662e 6163 636f 756e 745f 7572 6c28  elf.account_url(
-0000fd90: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-0000fda0: 6e61 6d65 2c20 2266 696c 6522 292c 0a20  name, "file"),. 
-0000fdb0: 2020 2020 2020 2020 2020 2073 6861 7265             share
-0000fdc0: 5f6e 616d 653d 7365 6c66 2e73 6861 7265  _name=self.share
-0000fdd0: 5f6e 616d 652c 0a20 2020 2020 2020 2020  _name,.         
-0000fde0: 2020 2066 696c 655f 7061 7468 3d27 6669     file_path='fi
-0000fdf0: 6c65 3163 6f70 7927 2c0a 2020 2020 2020  le1copy',.      
-0000fe00: 2020 2020 2020 6372 6564 656e 7469 616c        credential
-0000fe10: 3d73 746f 7261 6765 5f61 6363 6f75 6e74  =storage_account
-0000fe20: 5f6b 6579 2c0a 2020 2020 2020 2020 2020  _key,.          
-0000fe30: 2020 7472 616e 7370 6f72 743d 4169 6f68    transport=Aioh
-0000fe40: 7474 7054 6573 7454 7261 6e73 706f 7274  ttpTestTransport
-0000fe50: 2829 290a 0a20 2020 2020 2020 2023 2041  ())..        # A
-0000fe60: 6374 0a20 2020 2020 2020 2063 6f70 7920  ct.        copy 
-0000fe70: 3d20 6177 6169 7420 6669 6c65 5f63 6c69  = await file_cli
-0000fe80: 656e 742e 7374 6172 745f 636f 7079 5f66  ent.start_copy_f
-0000fe90: 726f 6d5f 7572 6c28 0a20 2020 2020 2020  rom_url(.       
-0000fea0: 2020 2020 2073 6f75 7263 655f 636c 6965       source_clie
-0000feb0: 6e74 2e75 726c 2c0a 2020 2020 2020 2020  nt.url,.        
-0000fec0: 2020 2020 7065 726d 6973 7369 6f6e 5f6b      permission_k
-0000fed0: 6579 3d27 736f 7572 6365 270a 2020 2020  ey='source'.    
-0000fee0: 2020 2020 290a 0a20 2020 2020 2020 2023      )..        #
-0000fef0: 2041 7373 6572 740a 2020 2020 2020 2020   Assert.        
-0000ff00: 6465 7374 5f70 726f 7020 3d20 6177 6169  dest_prop = awai
-0000ff10: 7420 6669 6c65 5f63 6c69 656e 742e 6765  t file_client.ge
-0000ff20: 745f 6669 6c65 5f70 726f 7065 7274 6965  t_file_propertie
-0000ff30: 7328 290a 2020 2020 2020 2020 2320 746f  s().        # to
-0000ff40: 206d 616b 6520 7375 7265 2074 6865 2061   make sure the a
-0000ff50: 636c 2069 7320 636f 7069 6564 2066 726f  cl is copied fro
-0000ff60: 6d20 736f 7572 6365 0a20 2020 2020 2020  m source.       
-0000ff70: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-0000ff80: 6c28 736f 7572 6365 5f70 726f 705b 2770  l(source_prop['p
-0000ff90: 6572 6d69 7373 696f 6e5f 6b65 7927 5d2c  ermission_key'],
-0000ffa0: 2064 6573 745f 7072 6f70 5b27 7065 726d   dest_prop['perm
-0000ffb0: 6973 7369 6f6e 5f6b 6579 275d 290a 0a20  ission_key']).. 
-0000ffc0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0000ffd0: 7274 4973 4e6f 744e 6f6e 6528 636f 7079  rtIsNotNone(copy
-0000ffe0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-0000fff0: 7373 6572 7445 7175 616c 2863 6f70 795b  ssertEqual(copy[
-00010000: 2763 6f70 795f 7374 6174 7573 275d 2c20  'copy_status'], 
-00010010: 2773 7563 6365 7373 2729 0a20 2020 2020  'success').     
-00010020: 2020 2073 656c 662e 6173 7365 7274 4973     self.assertIs
-00010030: 4e6f 744e 6f6e 6528 636f 7079 5b27 636f  NotNone(copy['co
-00010040: 7079 5f69 6427 5d29 0a0a 2020 2020 2020  py_id'])..      
-00010050: 2020 636f 7079 5f66 696c 6520 3d20 6177    copy_file = aw
-00010060: 6169 7420 6669 6c65 5f63 6c69 656e 742e  ait file_client.
-00010070: 646f 776e 6c6f 6164 5f66 696c 6528 290a  download_file().
-00010080: 2020 2020 2020 2020 636f 6e74 656e 7420          content 
-00010090: 3d20 6177 6169 7420 636f 7079 5f66 696c  = await copy_fil
-000100a0: 652e 7265 6164 616c 6c28 290a 2020 2020  e.readall().    
-000100b0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-000100c0: 7175 616c 2863 6f6e 7465 6e74 2c20 7365  qual(content, se
-000100d0: 6c66 2e73 686f 7274 5f62 7974 655f 6461  lf.short_byte_da
-000100e0: 7461 290a 0a20 2020 2040 4669 6c65 5368  ta)..    @FileSh
-000100f0: 6172 6550 7265 7061 7265 7228 290a 2020  arePreparer().  
-00010100: 2020 4041 7379 6e63 5374 6f72 6167 6554    @AsyncStorageT
-00010110: 6573 7443 6173 652e 6177 6169 745f 7072  estCase.await_pr
-00010120: 6570 6172 6564 5f74 6573 740a 2020 2020  epared_test.    
-00010130: 6173 796e 6320 6465 6620 7465 7374 5f63  async def test_c
-00010140: 6f70 795f 6669 6c65 5f61 7379 6e63 5f70  opy_file_async_p
-00010150: 7269 7661 7465 5f66 696c 655f 6173 796e  rivate_file_asyn
-00010160: 6328 7365 6c66 2c20 7374 6f72 6167 655f  c(self, storage_
-00010170: 6163 636f 756e 745f 6e61 6d65 2c20 7374  account_name, st
-00010180: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
-00010190: 792c 2073 6563 6f6e 6461 7279 5f73 746f  y, secondary_sto
-000101a0: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
-000101b0: 652c 2073 6563 6f6e 6461 7279 5f73 746f  e, secondary_sto
-000101c0: 7261 6765 5f61 6363 6f75 6e74 5f6b 6579  rage_account_key
-000101d0: 293a 0a20 2020 2020 2020 2073 656c 662e  ):.        self.
-000101e0: 5f73 6574 7570 2873 746f 7261 6765 5f61  _setup(storage_a
-000101f0: 6363 6f75 6e74 5f6e 616d 652c 2073 746f  ccount_name, sto
-00010200: 7261 6765 5f61 6363 6f75 6e74 5f6b 6579  rage_account_key
-00010210: 2c20 7365 636f 6e64 6172 795f 7374 6f72  , secondary_stor
-00010220: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
-00010230: 2c20 7365 636f 6e64 6172 795f 7374 6f72  , secondary_stor
-00010240: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
-00010250: 0a20 2020 2020 2020 2061 7761 6974 2073  .        await s
-00010260: 656c 662e 5f73 6574 7570 5f73 6861 7265  elf._setup_share
-00010270: 2873 746f 7261 6765 5f61 6363 6f75 6e74  (storage_account
-00010280: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
-00010290: 6363 6f75 6e74 5f6b 6579 290a 2020 2020  ccount_key).    
-000102a0: 2020 2020 6177 6169 7420 7365 6c66 2e5f      await self._
-000102b0: 6372 6561 7465 5f72 656d 6f74 655f 7368  create_remote_sh
-000102c0: 6172 6528 290a 2020 2020 2020 2020 736f  are().        so
-000102d0: 7572 6365 5f66 696c 6520 3d20 6177 6169  urce_file = awai
-000102e0: 7420 7365 6c66 2e5f 6372 6561 7465 5f72  t self._create_r
-000102f0: 656d 6f74 655f 6669 6c65 2829 0a0a 2020  emote_file()..  
-00010300: 2020 2020 2020 2320 4163 740a 2020 2020        # Act.    
-00010310: 2020 2020 7461 7267 6574 5f66 696c 655f      target_file_
-00010320: 6e61 6d65 203d 2027 7461 7267 6574 6669  name = 'targetfi
-00010330: 6c65 270a 2020 2020 2020 2020 6669 6c65  le'.        file
-00010340: 5f63 6c69 656e 7420 3d20 5368 6172 6546  _client = ShareF
-00010350: 696c 6543 6c69 656e 7428 0a20 2020 2020  ileClient(.     
-00010360: 2020 2020 2020 2073 656c 662e 6163 636f         self.acco
-00010370: 756e 745f 7572 6c28 7374 6f72 6167 655f  unt_url(storage_
-00010380: 6163 636f 756e 745f 6e61 6d65 2c20 2266  account_name, "f
-00010390: 696c 6522 292c 0a20 2020 2020 2020 2020  ile"),.         
-000103a0: 2020 2073 6861 7265 5f6e 616d 653d 7365     share_name=se
-000103b0: 6c66 2e73 6861 7265 5f6e 616d 652c 0a20  lf.share_name,. 
-000103c0: 2020 2020 2020 2020 2020 2066 696c 655f             file_
-000103d0: 7061 7468 3d74 6172 6765 745f 6669 6c65  path=target_file
-000103e0: 5f6e 616d 652c 0a20 2020 2020 2020 2020  _name,.         
-000103f0: 2020 2063 7265 6465 6e74 6961 6c3d 7374     credential=st
-00010400: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
-00010410: 792c 0a20 2020 2020 2020 2020 2020 2074  y,.            t
-00010420: 7261 6e73 706f 7274 3d41 696f 6874 7470  ransport=Aiohttp
-00010430: 5465 7374 5472 616e 7370 6f72 7428 2929  TestTransport())
-00010440: 0a20 2020 2020 2020 2077 6974 6820 7365  .        with se
-00010450: 6c66 2e61 7373 6572 7452 6169 7365 7328  lf.assertRaises(
-00010460: 4874 7470 5265 7370 6f6e 7365 4572 726f  HttpResponseErro
-00010470: 7229 2061 7320 653a 0a20 2020 2020 2020  r) as e:.       
-00010480: 2020 2020 2061 7761 6974 2066 696c 655f       await file_
-00010490: 636c 6965 6e74 2e73 7461 7274 5f63 6f70  client.start_cop
-000104a0: 795f 6672 6f6d 5f75 726c 2873 6f75 7263  y_from_url(sourc
-000104b0: 655f 6669 6c65 2e75 726c 290a 0a20 2020  e_file.url)..   
-000104c0: 2020 2020 2023 2041 7373 6572 740a 2020       # Assert.  
-000104d0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-000104e0: 7445 7175 616c 2865 2e65 7863 6570 7469  tEqual(e.excepti
-000104f0: 6f6e 2e65 7272 6f72 5f63 6f64 652c 2053  on.error_code, S
-00010500: 746f 7261 6765 4572 726f 7243 6f64 652e  torageErrorCode.
-00010510: 6361 6e6e 6f74 5f76 6572 6966 795f 636f  cannot_verify_co
-00010520: 7079 5f73 6f75 7263 6529 0a20 2020 2020  py_source).     
-00010530: 2020 2061 7761 6974 2073 656c 662e 6673     await self.fs
-00010540: 6332 2e64 656c 6574 655f 7368 6172 6528  c2.delete_share(
-00010550: 7365 6c66 2e72 656d 6f74 655f 7368 6172  self.remote_shar
-00010560: 655f 6e61 6d65 290a 0a20 2020 2040 4669  e_name)..    @Fi
-00010570: 6c65 5368 6172 6550 7265 7061 7265 7228  leSharePreparer(
-00010580: 290a 2020 2020 4041 7379 6e63 5374 6f72  ).    @AsyncStor
-00010590: 6167 6554 6573 7443 6173 652e 6177 6169  ageTestCase.awai
-000105a0: 745f 7072 6570 6172 6564 5f74 6573 740a  t_prepared_test.
-000105b0: 2020 2020 6173 796e 6320 6465 6620 7465      async def te
-000105c0: 7374 5f63 6f70 795f 6669 6c65 5f61 7379  st_copy_file_asy
-000105d0: 6e63 5f70 7269 7661 7465 5f66 696c 655f  nc_private_file_
-000105e0: 7769 7468 5f73 6173 5f61 7379 6e63 2873  with_sas_async(s
-000105f0: 656c 662c 2073 746f 7261 6765 5f61 6363  elf, storage_acc
-00010600: 6f75 6e74 5f6e 616d 652c 2073 746f 7261  ount_name, stora
-00010610: 6765 5f61 6363 6f75 6e74 5f6b 6579 2c20  ge_account_key, 
-00010620: 7365 636f 6e64 6172 795f 7374 6f72 6167  secondary_storag
-00010630: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
-00010640: 7365 636f 6e64 6172 795f 7374 6f72 6167  secondary_storag
-00010650: 655f 6163 636f 756e 745f 6b65 7929 3a0a  e_account_key):.
-00010660: 2020 2020 2020 2020 7365 6c66 2e5f 7365          self._se
-00010670: 7475 7028 7374 6f72 6167 655f 6163 636f  tup(storage_acco
-00010680: 756e 745f 6e61 6d65 2c20 7374 6f72 6167  unt_name, storag
-00010690: 655f 6163 636f 756e 745f 6b65 792c 2073  e_account_key, s
-000106a0: 6563 6f6e 6461 7279 5f73 746f 7261 6765  econdary_storage
-000106b0: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
-000106c0: 6563 6f6e 6461 7279 5f73 746f 7261 6765  econdary_storage
-000106d0: 5f61 6363 6f75 6e74 5f6b 6579 290a 2020  _account_key).  
-000106e0: 2020 2020 2020 6461 7461 203d 2062 2731        data = b'1
-000106f0: 3233 3435 3637 3827 202a 2031 3032 3420  2345678' * 1024 
-00010700: 2a20 3130 3234 0a20 2020 2020 2020 2061  * 1024.        a
-00010710: 7761 6974 2073 656c 662e 5f63 7265 6174  wait self._creat
-00010720: 655f 7265 6d6f 7465 5f73 6861 7265 2829  e_remote_share()
-00010730: 0a20 2020 2020 2020 2073 6f75 7263 655f  .        source_
-00010740: 6669 6c65 203d 2061 7761 6974 2073 656c  file = await sel
-00010750: 662e 5f63 7265 6174 655f 7265 6d6f 7465  f._create_remote
-00010760: 5f66 696c 6528 6669 6c65 5f64 6174 613d  _file(file_data=
-00010770: 6461 7461 290a 2020 2020 2020 2020 7361  data).        sa
-00010780: 735f 746f 6b65 6e20 3d20 6765 6e65 7261  s_token = genera
-00010790: 7465 5f66 696c 655f 7361 7328 0a20 2020  te_file_sas(.   
-000107a0: 2020 2020 2020 2020 2073 6f75 7263 655f           source_
-000107b0: 6669 6c65 2e61 6363 6f75 6e74 5f6e 616d  file.account_nam
-000107c0: 652c 0a20 2020 2020 2020 2020 2020 2073  e,.            s
-000107d0: 6f75 7263 655f 6669 6c65 2e73 6861 7265  ource_file.share
-000107e0: 5f6e 616d 652c 0a20 2020 2020 2020 2020  _name,.         
-000107f0: 2020 2073 6f75 7263 655f 6669 6c65 2e66     source_file.f
-00010800: 696c 655f 7061 7468 2c0a 2020 2020 2020  ile_path,.      
-00010810: 2020 2020 2020 736f 7572 6365 5f66 696c        source_fil
-00010820: 652e 6372 6564 656e 7469 616c 2e61 6363  e.credential.acc
-00010830: 6f75 6e74 5f6b 6579 2c0a 2020 2020 2020  ount_key,.      
-00010840: 2020 2020 2020 7065 726d 6973 7369 6f6e        permission
-00010850: 3d46 696c 6553 6173 5065 726d 6973 7369  =FileSasPermissi
-00010860: 6f6e 7328 7265 6164 3d54 7275 6529 2c0a  ons(read=True),.
-00010870: 2020 2020 2020 2020 2020 2020 6578 7069              expi
-00010880: 7279 3d64 6174 6574 696d 652e 7574 636e  ry=datetime.utcn
-00010890: 6f77 2829 202b 2074 696d 6564 656c 7461  ow() + timedelta
-000108a0: 2868 6f75 7273 3d31 292c 0a20 2020 2020  (hours=1),.     
-000108b0: 2020 2029 0a20 2020 2020 2020 2073 6f75     ).        sou
-000108c0: 7263 655f 7572 6c20 3d20 736f 7572 6365  rce_url = source
-000108d0: 5f66 696c 652e 7572 6c20 2b20 273f 2720  _file.url + '?' 
-000108e0: 2b20 7361 735f 746f 6b65 6e0a 0a20 2020  + sas_token..   
-000108f0: 2020 2020 2023 2041 6374 0a20 2020 2020       # Act.     
-00010900: 2020 2074 6172 6765 745f 6669 6c65 5f6e     target_file_n
-00010910: 616d 6520 3d20 2774 6172 6765 7466 696c  ame = 'targetfil
-00010920: 6527 0a20 2020 2020 2020 2061 7761 6974  e'.        await
-00010930: 2073 656c 662e 5f73 6574 7570 5f73 6861   self._setup_sha
-00010940: 7265 2873 746f 7261 6765 5f61 6363 6f75  re(storage_accou
-00010950: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
-00010960: 5f61 6363 6f75 6e74 5f6b 6579 290a 2020  _account_key).  
-00010970: 2020 2020 2020 6669 6c65 5f63 6c69 656e        file_clien
-00010980: 7420 3d20 5368 6172 6546 696c 6543 6c69  t = ShareFileCli
-00010990: 656e 7428 0a20 2020 2020 2020 2020 2020  ent(.           
-000109a0: 2073 656c 662e 6163 636f 756e 745f 7572   self.account_ur
-000109b0: 6c28 7374 6f72 6167 655f 6163 636f 756e  l(storage_accoun
-000109c0: 745f 6e61 6d65 2c20 2266 696c 6522 292c  t_name, "file"),
-000109d0: 0a20 2020 2020 2020 2020 2020 2073 6861  .            sha
-000109e0: 7265 5f6e 616d 653d 7365 6c66 2e73 6861  re_name=self.sha
-000109f0: 7265 5f6e 616d 652c 0a20 2020 2020 2020  re_name,.       
-00010a00: 2020 2020 2066 696c 655f 7061 7468 3d74       file_path=t
-00010a10: 6172 6765 745f 6669 6c65 5f6e 616d 652c  arget_file_name,
-00010a20: 0a20 2020 2020 2020 2020 2020 2063 7265  .            cre
-00010a30: 6465 6e74 6961 6c3d 7374 6f72 6167 655f  dential=storage_
-00010a40: 6163 636f 756e 745f 6b65 792c 0a20 2020  account_key,.   
-00010a50: 2020 2020 2020 2020 2074 7261 6e73 706f           transpo
-00010a60: 7274 3d41 696f 6874 7470 5465 7374 5472  rt=AiohttpTestTr
-00010a70: 616e 7370 6f72 7428 2929 0a20 2020 2020  ansport()).     
-00010a80: 2020 2063 6f70 795f 7265 7370 203d 2061     copy_resp = a
-00010a90: 7761 6974 2066 696c 655f 636c 6965 6e74  wait file_client
-00010aa0: 2e73 7461 7274 5f63 6f70 795f 6672 6f6d  .start_copy_from
-00010ab0: 5f75 726c 2873 6f75 7263 655f 7572 6c29  _url(source_url)
-00010ac0: 0a0a 2020 2020 2020 2020 2320 4173 7365  ..        # Asse
-00010ad0: 7274 0a20 2020 2020 2020 2073 656c 662e  rt.        self.
-00010ae0: 6173 7365 7274 5472 7565 2863 6f70 795f  assertTrue(copy_
-00010af0: 7265 7370 5b27 636f 7079 5f73 7461 7475  resp['copy_statu
-00010b00: 7327 5d20 696e 205b 2773 7563 6365 7373  s'] in ['success
-00010b10: 272c 2027 7065 6e64 696e 6727 5d29 0a20  ', 'pending']). 
-00010b20: 2020 2020 2020 2061 7761 6974 2073 656c         await sel
-00010b30: 662e 5f77 6169 745f 666f 725f 6173 796e  f._wait_for_asyn
-00010b40: 635f 636f 7079 2873 656c 662e 7368 6172  c_copy(self.shar
-00010b50: 655f 6e61 6d65 2c20 7461 7267 6574 5f66  e_name, target_f
-00010b60: 696c 655f 6e61 6d65 2920 0a0a 2020 2020  ile_name) ..    
-00010b70: 2020 2020 636f 6e74 656e 7420 3d20 6177      content = aw
-00010b80: 6169 7420 6669 6c65 5f63 6c69 656e 742e  ait file_client.
-00010b90: 646f 776e 6c6f 6164 5f66 696c 6528 290a  download_file().
-00010ba0: 2020 2020 2020 2020 6163 7475 616c 5f64          actual_d
-00010bb0: 6174 6120 3d20 6177 6169 7420 636f 6e74  ata = await cont
-00010bc0: 656e 742e 7265 6164 616c 6c28 290a 2020  ent.readall().  
-00010bd0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00010be0: 7445 7175 616c 2861 6374 7561 6c5f 6461  tEqual(actual_da
-00010bf0: 7461 2c20 6461 7461 290a 0a20 2020 2040  ta, data)..    @
-00010c00: 4669 6c65 5368 6172 6550 7265 7061 7265  FileSharePrepare
-00010c10: 7228 290a 2020 2020 4041 7379 6e63 5374  r().    @AsyncSt
-00010c20: 6f72 6167 6554 6573 7443 6173 652e 6177  orageTestCase.aw
-00010c30: 6169 745f 7072 6570 6172 6564 5f74 6573  ait_prepared_tes
-00010c40: 740a 2020 2020 6173 796e 6320 6465 6620  t.    async def 
-00010c50: 7465 7374 5f61 626f 7274 5f63 6f70 795f  test_abort_copy_
-00010c60: 6669 6c65 5f61 7379 6e63 2873 656c 662c  file_async(self,
-00010c70: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
-00010c80: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
-00010c90: 6363 6f75 6e74 5f6b 6579 2c20 7365 636f  ccount_key, seco
-00010ca0: 6e64 6172 795f 7374 6f72 6167 655f 6163  ndary_storage_ac
-00010cb0: 636f 756e 745f 6e61 6d65 2c20 7365 636f  count_name, seco
-00010cc0: 6e64 6172 795f 7374 6f72 6167 655f 6163  ndary_storage_ac
-00010cd0: 636f 756e 745f 6b65 7929 3a0a 2020 2020  count_key):.    
-00010ce0: 2020 2020 7365 6c66 2e5f 7365 7475 7028      self._setup(
-00010cf0: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-00010d00: 6e61 6d65 2c20 7374 6f72 6167 655f 6163  name, storage_ac
-00010d10: 636f 756e 745f 6b65 792c 2073 6563 6f6e  count_key, secon
-00010d20: 6461 7279 5f73 746f 7261 6765 5f61 6363  dary_storage_acc
-00010d30: 6f75 6e74 5f6e 616d 652c 2073 6563 6f6e  ount_name, secon
-00010d40: 6461 7279 5f73 746f 7261 6765 5f61 6363  dary_storage_acc
-00010d50: 6f75 6e74 5f6b 6579 290a 2020 2020 2020  ount_key).      
-00010d60: 2020 6461 7461 203d 2062 2731 3233 3435    data = b'12345
-00010d70: 3637 3827 202a 2031 3032 3420 2a20 3130  678' * 1024 * 10
-00010d80: 3234 0a20 2020 2020 2020 2061 7761 6974  24.        await
-00010d90: 2073 656c 662e 5f73 6574 7570 5f73 6861   self._setup_sha
-00010da0: 7265 2873 746f 7261 6765 5f61 6363 6f75  re(storage_accou
-00010db0: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
-00010dc0: 5f61 6363 6f75 6e74 5f6b 6579 290a 2020  _account_key).  
-00010dd0: 2020 2020 2020 6177 6169 7420 7365 6c66        await self
-00010de0: 2e5f 6372 6561 7465 5f72 656d 6f74 655f  ._create_remote_
-00010df0: 7368 6172 6528 290a 2020 2020 2020 2020  share().        
-00010e00: 736f 7572 6365 5f66 696c 6520 3d20 6177  source_file = aw
-00010e10: 6169 7420 7365 6c66 2e5f 6372 6561 7465  ait self._create
-00010e20: 5f72 656d 6f74 655f 6669 6c65 2866 696c  _remote_file(fil
-00010e30: 655f 6461 7461 3d64 6174 6129 0a20 2020  e_data=data).   
-00010e40: 2020 2020 2073 6173 5f74 6f6b 656e 203d       sas_token =
-00010e50: 2067 656e 6572 6174 655f 6669 6c65 5f73   generate_file_s
-00010e60: 6173 280a 2020 2020 2020 2020 2020 2020  as(.            
-00010e70: 736f 7572 6365 5f66 696c 652e 6163 636f  source_file.acco
-00010e80: 756e 745f 6e61 6d65 2c0a 2020 2020 2020  unt_name,.      
-00010e90: 2020 2020 2020 736f 7572 6365 5f66 696c        source_fil
-00010ea0: 652e 7368 6172 655f 6e61 6d65 2c0a 2020  e.share_name,.  
-00010eb0: 2020 2020 2020 2020 2020 736f 7572 6365            source
-00010ec0: 5f66 696c 652e 6669 6c65 5f70 6174 682c  _file.file_path,
-00010ed0: 0a20 2020 2020 2020 2020 2020 2073 6f75  .            sou
-00010ee0: 7263 655f 6669 6c65 2e63 7265 6465 6e74  rce_file.credent
-00010ef0: 6961 6c2e 6163 636f 756e 745f 6b65 792c  ial.account_key,
-00010f00: 0a20 2020 2020 2020 2020 2020 2070 6572  .            per
-00010f10: 6d69 7373 696f 6e3d 4669 6c65 5361 7350  mission=FileSasP
-00010f20: 6572 6d69 7373 696f 6e73 2872 6561 643d  ermissions(read=
-00010f30: 5472 7565 292c 0a20 2020 2020 2020 2020  True),.         
-00010f40: 2020 2065 7870 6972 793d 6461 7465 7469     expiry=dateti
-00010f50: 6d65 2e75 7463 6e6f 7728 2920 2b20 7469  me.utcnow() + ti
-00010f60: 6d65 6465 6c74 6128 686f 7572 733d 3129  medelta(hours=1)
-00010f70: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
-00010f80: 2020 2020 736f 7572 6365 5f75 726c 203d      source_url =
-00010f90: 2073 6f75 7263 655f 6669 6c65 2e75 726c   source_file.url
-00010fa0: 202b 2027 3f27 202b 2073 6173 5f74 6f6b   + '?' + sas_tok
-00010fb0: 656e 0a0a 2020 2020 2020 2020 2320 4163  en..        # Ac
-00010fc0: 740a 2020 2020 2020 2020 7461 7267 6574  t.        target
-00010fd0: 5f66 696c 655f 6e61 6d65 203d 2027 7461  _file_name = 'ta
-00010fe0: 7267 6574 6669 6c65 270a 2020 2020 2020  rgetfile'.      
-00010ff0: 2020 6669 6c65 5f63 6c69 656e 7420 3d20    file_client = 
-00011000: 5368 6172 6546 696c 6543 6c69 656e 7428  ShareFileClient(
-00011010: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00011020: 662e 6163 636f 756e 745f 7572 6c28 7374  f.account_url(st
-00011030: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
-00011040: 6d65 2c20 2266 696c 6522 292c 0a20 2020  me, "file"),.   
-00011050: 2020 2020 2020 2020 2073 6861 7265 5f6e           share_n
-00011060: 616d 653d 7365 6c66 2e73 6861 7265 5f6e  ame=self.share_n
-00011070: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
-00011080: 2066 696c 655f 7061 7468 3d74 6172 6765   file_path=targe
-00011090: 745f 6669 6c65 5f6e 616d 652c 0a20 2020  t_file_name,.   
-000110a0: 2020 2020 2020 2020 2063 7265 6465 6e74           credent
-000110b0: 6961 6c3d 7374 6f72 6167 655f 6163 636f  ial=storage_acco
-000110c0: 756e 745f 6b65 792c 0a20 2020 2020 2020  unt_key,.       
-000110d0: 2020 2020 2074 7261 6e73 706f 7274 3d41       transport=A
-000110e0: 696f 6874 7470 5465 7374 5472 616e 7370  iohttpTestTransp
-000110f0: 6f72 7428 2929 0a20 2020 2020 2020 2063  ort()).        c
-00011100: 6f70 795f 7265 7370 203d 2061 7761 6974  opy_resp = await
-00011110: 2066 696c 655f 636c 6965 6e74 2e73 7461   file_client.sta
-00011120: 7274 5f63 6f70 795f 6672 6f6d 5f75 726c  rt_copy_from_url
-00011130: 2873 6f75 7263 655f 7572 6c29 0a20 2020  (source_url).   
-00011140: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00011150: 4571 7561 6c28 636f 7079 5f72 6573 705b  Equal(copy_resp[
-00011160: 2763 6f70 795f 7374 6174 7573 275d 2c20  'copy_status'], 
-00011170: 2770 656e 6469 6e67 2729 0a20 2020 2020  'pending').     
-00011180: 2020 2061 7761 6974 2066 696c 655f 636c     await file_cl
-00011190: 6965 6e74 2e61 626f 7274 5f63 6f70 7928  ient.abort_copy(
-000111a0: 636f 7079 5f72 6573 7029 0a0a 2020 2020  copy_resp)..    
-000111b0: 2020 2020 2320 4173 7365 7274 0a20 2020      # Assert.   
-000111c0: 2020 2020 2074 6172 6765 745f 6669 6c65       target_file
-000111d0: 203d 2061 7761 6974 2066 696c 655f 636c   = await file_cl
-000111e0: 6965 6e74 2e64 6f77 6e6c 6f61 645f 6669  ient.download_fi
-000111f0: 6c65 2829 0a20 2020 2020 2020 2063 6f6e  le().        con
-00011200: 7465 6e74 203d 2061 7761 6974 2074 6172  tent = await tar
-00011210: 6765 745f 6669 6c65 2e72 6561 6461 6c6c  get_file.readall
-00011220: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
-00011230: 6173 7365 7274 4571 7561 6c28 636f 6e74  assertEqual(cont
-00011240: 656e 742c 2062 2727 290a 2020 2020 2020  ent, b'').      
-00011250: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00011260: 616c 2874 6172 6765 745f 6669 6c65 2e70  al(target_file.p
-00011270: 726f 7065 7274 6965 732e 636f 7079 2e73  roperties.copy.s
-00011280: 7461 7475 732c 2027 6162 6f72 7465 6427  tatus, 'aborted'
-00011290: 290a 0a20 2020 2040 4669 6c65 5368 6172  )..    @FileShar
-000112a0: 6550 7265 7061 7265 7228 290a 2020 2020  ePreparer().    
-000112b0: 4041 7379 6e63 5374 6f72 6167 6554 6573  @AsyncStorageTes
-000112c0: 7443 6173 652e 6177 6169 745f 7072 6570  tCase.await_prep
-000112d0: 6172 6564 5f74 6573 740a 2020 2020 6173  ared_test.    as
-000112e0: 796e 6320 6465 6620 7465 7374 5f61 626f  ync def test_abo
-000112f0: 7274 5f63 6f70 795f 6669 6c65 5f77 6974  rt_copy_file_wit
-00011300: 685f 7379 6e63 6872 6f6e 6f75 735f 636f  h_synchronous_co
-00011310: 7079 5f66 6169 6c73 5f61 7379 6e63 2873  py_fails_async(s
-00011320: 656c 662c 2073 746f 7261 6765 5f61 6363  elf, storage_acc
-00011330: 6f75 6e74 5f6e 616d 652c 2073 746f 7261  ount_name, stora
-00011340: 6765 5f61 6363 6f75 6e74 5f6b 6579 293a  ge_account_key):
-00011350: 0a20 2020 2020 2020 2073 656c 662e 5f73  .        self._s
-00011360: 6574 7570 2873 746f 7261 6765 5f61 6363  etup(storage_acc
-00011370: 6f75 6e74 5f6e 616d 652c 2073 746f 7261  ount_name, stora
-00011380: 6765 5f61 6363 6f75 6e74 5f6b 6579 290a  ge_account_key).
-00011390: 2020 2020 2020 2020 736f 7572 6365 5f66          source_f
-000113a0: 696c 6520 3d20 6177 6169 7420 7365 6c66  ile = await self
-000113b0: 2e5f 6372 6561 7465 5f66 696c 6528 7374  ._create_file(st
-000113c0: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
-000113d0: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
-000113e0: 756e 745f 6b65 7929 0a0a 2020 2020 2020  unt_key)..      
-000113f0: 2020 2320 4163 740a 2020 2020 2020 2020    # Act.        
-00011400: 7461 7267 6574 5f66 696c 655f 6e61 6d65  target_file_name
-00011410: 203d 2027 7461 7267 6574 6669 6c65 270a   = 'targetfile'.
-00011420: 2020 2020 2020 2020 6669 6c65 5f63 6c69          file_cli
-00011430: 656e 7420 3d20 5368 6172 6546 696c 6543  ent = ShareFileC
-00011440: 6c69 656e 7428 0a20 2020 2020 2020 2020  lient(.         
-00011450: 2020 2073 656c 662e 6163 636f 756e 745f     self.account_
-00011460: 7572 6c28 7374 6f72 6167 655f 6163 636f  url(storage_acco
-00011470: 756e 745f 6e61 6d65 2c20 2266 696c 6522  unt_name, "file"
-00011480: 292c 0a20 2020 2020 2020 2020 2020 2073  ),.            s
-00011490: 6861 7265 5f6e 616d 653d 7365 6c66 2e73  hare_name=self.s
-000114a0: 6861 7265 5f6e 616d 652c 0a20 2020 2020  hare_name,.     
-000114b0: 2020 2020 2020 2066 696c 655f 7061 7468         file_path
-000114c0: 3d74 6172 6765 745f 6669 6c65 5f6e 616d  =target_file_nam
-000114d0: 652c 0a20 2020 2020 2020 2020 2020 2063  e,.            c
-000114e0: 7265 6465 6e74 6961 6c3d 7374 6f72 6167  redential=storag
-000114f0: 655f 6163 636f 756e 745f 6b65 792c 0a20  e_account_key,. 
-00011500: 2020 2020 2020 2020 2020 2074 7261 6e73             trans
-00011510: 706f 7274 3d41 696f 6874 7470 5465 7374  port=AiohttpTest
-00011520: 5472 616e 7370 6f72 7428 2929 0a20 2020  Transport()).   
-00011530: 2020 2020 2063 6f70 795f 7265 7370 203d       copy_resp =
-00011540: 2061 7761 6974 2066 696c 655f 636c 6965   await file_clie
-00011550: 6e74 2e73 7461 7274 5f63 6f70 795f 6672  nt.start_copy_fr
-00011560: 6f6d 5f75 726c 2873 6f75 7263 655f 6669  om_url(source_fi
-00011570: 6c65 2e75 726c 290a 0a20 2020 2020 2020  le.url)..       
-00011580: 2077 6974 6820 7365 6c66 2e61 7373 6572   with self.asser
-00011590: 7452 6169 7365 7328 4874 7470 5265 7370  tRaises(HttpResp
-000115a0: 6f6e 7365 4572 726f 7229 3a0a 2020 2020  onseError):.    
-000115b0: 2020 2020 2020 2020 6177 6169 7420 6669          await fi
-000115c0: 6c65 5f63 6c69 656e 742e 6162 6f72 745f  le_client.abort_
-000115d0: 636f 7079 2863 6f70 795f 7265 7370 290a  copy(copy_resp).
-000115e0: 0a20 2020 2020 2020 2023 2041 7373 6572  .        # Asser
-000115f0: 740a 2020 2020 2020 2020 7365 6c66 2e61  t.        self.a
-00011600: 7373 6572 7445 7175 616c 2863 6f70 795f  ssertEqual(copy_
-00011610: 7265 7370 5b27 636f 7079 5f73 7461 7475  resp['copy_statu
-00011620: 7327 5d2c 2027 7375 6363 6573 7327 290a  s'], 'success').
-00011630: 0a20 2020 2040 4669 6c65 5368 6172 6550  .    @FileShareP
-00011640: 7265 7061 7265 7228 290a 2020 2020 4041  reparer().    @A
-00011650: 7379 6e63 5374 6f72 6167 6554 6573 7443  syncStorageTestC
-00011660: 6173 652e 6177 6169 745f 7072 6570 6172  ase.await_prepar
-00011670: 6564 5f74 6573 740a 2020 2020 6173 796e  ed_test.    asyn
-00011680: 6320 6465 6620 7465 7374 5f75 6e69 636f  c def test_unico
-00011690: 6465 5f67 6574 5f66 696c 655f 756e 6963  de_get_file_unic
-000116a0: 6f64 655f 6e61 6d65 5f61 7379 6e63 2873  ode_name_async(s
-000116b0: 656c 662c 2073 746f 7261 6765 5f61 6363  elf, storage_acc
-000116c0: 6f75 6e74 5f6e 616d 652c 2073 746f 7261  ount_name, stora
-000116d0: 6765 5f61 6363 6f75 6e74 5f6b 6579 293a  ge_account_key):
-000116e0: 0a20 2020 2020 2020 2073 656c 662e 5f73  .        self._s
-000116f0: 6574 7570 2873 746f 7261 6765 5f61 6363  etup(storage_acc
-00011700: 6f75 6e74 5f6e 616d 652c 2073 746f 7261  ount_name, stora
-00011710: 6765 5f61 6363 6f75 6e74 5f6b 6579 290a  ge_account_key).
-00011720: 2020 2020 2020 2020 6669 6c65 5f6e 616d          file_nam
-00011730: 6520 3d20 27e5 958a e9bd 84e4 b882 e78b  e = '...........
-00011740: 9be7 8b9c 270a 2020 2020 2020 2020 6177  ....'.        aw
-00011750: 6169 7420 7365 6c66 2e5f 7365 7475 705f  ait self._setup_
-00011760: 7368 6172 6528 7374 6f72 6167 655f 6163  share(storage_ac
-00011770: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
-00011780: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
-00011790: 0a20 2020 2020 2020 2066 696c 655f 636c  .        file_cl
-000117a0: 6965 6e74 203d 2053 6861 7265 4669 6c65  ient = ShareFile
-000117b0: 436c 6965 6e74 280a 2020 2020 2020 2020  Client(.        
-000117c0: 2020 2020 7365 6c66 2e61 6363 6f75 6e74      self.account
-000117d0: 5f75 726c 2873 746f 7261 6765 5f61 6363  _url(storage_acc
-000117e0: 6f75 6e74 5f6e 616d 652c 2022 6669 6c65  ount_name, "file
-000117f0: 2229 2c0a 2020 2020 2020 2020 2020 2020  "),.            
-00011800: 7368 6172 655f 6e61 6d65 3d73 656c 662e  share_name=self.
-00011810: 7368 6172 655f 6e61 6d65 2c0a 2020 2020  share_name,.    
-00011820: 2020 2020 2020 2020 6669 6c65 5f70 6174          file_pat
-00011830: 683d 6669 6c65 5f6e 616d 652c 0a20 2020  h=file_name,.   
-00011840: 2020 2020 2020 2020 2063 7265 6465 6e74           credent
-00011850: 6961 6c3d 7374 6f72 6167 655f 6163 636f  ial=storage_acco
-00011860: 756e 745f 6b65 792c 0a20 2020 2020 2020  unt_key,.       
-00011870: 2020 2020 2074 7261 6e73 706f 7274 3d41       transport=A
-00011880: 696f 6874 7470 5465 7374 5472 616e 7370  iohttpTestTransp
-00011890: 6f72 7428 2929 0a20 2020 2020 2020 2061  ort()).        a
-000118a0: 7761 6974 2066 696c 655f 636c 6965 6e74  wait file_client
-000118b0: 2e75 706c 6f61 645f 6669 6c65 2862 2768  .upload_file(b'h
-000118c0: 656c 6c6f 2077 6f72 6c64 2729 0a0a 2020  ello world')..  
-000118d0: 2020 2020 2020 2320 4163 740a 2020 2020        # Act.    
-000118e0: 2020 2020 636f 6e74 656e 7420 3d20 6177      content = aw
-000118f0: 6169 7420 6669 6c65 5f63 6c69 656e 742e  ait file_client.
-00011900: 646f 776e 6c6f 6164 5f66 696c 6528 290a  download_file().
-00011910: 2020 2020 2020 2020 636f 6e74 656e 7420          content 
-00011920: 3d20 6177 6169 7420 636f 6e74 656e 742e  = await content.
-00011930: 7265 6164 616c 6c28 290a 0a20 2020 2020  readall()..     
-00011940: 2020 2023 2041 7373 6572 740a 2020 2020     # Assert.    
-00011950: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00011960: 7175 616c 2863 6f6e 7465 6e74 2c20 6227  qual(content, b'
-00011970: 6865 6c6c 6f20 776f 726c 6427 290a 0a20  hello world').. 
-00011980: 2020 2040 4669 6c65 5368 6172 6550 7265     @FileSharePre
-00011990: 7061 7265 7228 290a 2020 2020 4041 7379  parer().    @Asy
-000119a0: 6e63 5374 6f72 6167 6554 6573 7443 6173  ncStorageTestCas
-000119b0: 652e 6177 6169 745f 7072 6570 6172 6564  e.await_prepared
-000119c0: 5f74 6573 740a 2020 2020 6173 796e 6320  _test.    async 
-000119d0: 6465 6620 7465 7374 5f75 6e69 636f 6465  def test_unicode
-000119e0: 5f67 6574 5f66 696c 655f 756e 6963 6f64  _get_file_unicod
-000119f0: 655f 6e61 6d65 5f77 6974 685f 6c65 6173  e_name_with_leas
-00011a00: 655f 6173 796e 6328 7365 6c66 2c20 7374  e_async(self, st
-00011a10: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
-00011a20: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
-00011a30: 756e 745f 6b65 7929 3a0a 2020 2020 2020  unt_key):.      
-00011a40: 2020 7365 6c66 2e5f 7365 7475 7028 7374    self._setup(st
-00011a50: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
-00011a60: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
-00011a70: 756e 745f 6b65 7929 0a20 2020 2020 2020  unt_key).       
-00011a80: 2066 696c 655f 6e61 6d65 203d 2027 e595   file_name = '..
-00011a90: 8ae9 bd84 e4b8 82e7 8b9b e78b 9c27 0a20  .............'. 
-00011aa0: 2020 2020 2020 2061 7761 6974 2073 656c         await sel
-00011ab0: 662e 5f73 6574 7570 5f73 6861 7265 2873  f._setup_share(s
-00011ac0: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
-00011ad0: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
-00011ae0: 6f75 6e74 5f6b 6579 290a 2020 2020 2020  ount_key).      
-00011af0: 2020 6669 6c65 5f63 6c69 656e 7420 3d20    file_client = 
-00011b00: 5368 6172 6546 696c 6543 6c69 656e 7428  ShareFileClient(
-00011b10: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00011b20: 662e 6163 636f 756e 745f 7572 6c28 7374  f.account_url(st
-00011b30: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
-00011b40: 6d65 2c20 2266 696c 6522 292c 0a20 2020  me, "file"),.   
-00011b50: 2020 2020 2020 2020 2073 6861 7265 5f6e           share_n
-00011b60: 616d 653d 7365 6c66 2e73 6861 7265 5f6e  ame=self.share_n
-00011b70: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
-00011b80: 2066 696c 655f 7061 7468 3d66 696c 655f   file_path=file_
-00011b90: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
-00011ba0: 2020 6372 6564 656e 7469 616c 3d73 746f    credential=sto
-00011bb0: 7261 6765 5f61 6363 6f75 6e74 5f6b 6579  rage_account_key
-00011bc0: 2c0a 2020 2020 2020 2020 2020 2020 7472  ,.            tr
-00011bd0: 616e 7370 6f72 743d 4169 6f68 7474 7054  ansport=AiohttpT
-00011be0: 6573 7454 7261 6e73 706f 7274 2829 290a  estTransport()).
-00011bf0: 2020 2020 2020 2020 6177 6169 7420 6669          await fi
-00011c00: 6c65 5f63 6c69 656e 742e 6372 6561 7465  le_client.create
-00011c10: 5f66 696c 6528 3130 3234 290a 2020 2020  _file(1024).    
-00011c20: 2020 2020 6c65 6173 6520 3d20 6177 6169      lease = awai
-00011c30: 7420 6669 6c65 5f63 6c69 656e 742e 6163  t file_client.ac
-00011c40: 7175 6972 655f 6c65 6173 6528 290a 0a20  quire_lease().. 
-00011c50: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
-00011c60: 2e61 7373 6572 7452 6169 7365 7328 4874  .assertRaises(Ht
-00011c70: 7470 5265 7370 6f6e 7365 4572 726f 7229  tpResponseError)
-00011c80: 3a0a 2020 2020 2020 2020 2020 2020 6177  :.            aw
-00011c90: 6169 7420 6669 6c65 5f63 6c69 656e 742e  ait file_client.
-00011ca0: 7570 6c6f 6164 5f66 696c 6528 6227 6865  upload_file(b'he
-00011cb0: 6c6c 6f20 776f 726c 6427 290a 0a20 2020  llo world')..   
-00011cc0: 2020 2020 2061 7761 6974 2066 696c 655f       await file_
-00011cd0: 636c 6965 6e74 2e75 706c 6f61 645f 6669  client.upload_fi
-00011ce0: 6c65 2862 2768 656c 6c6f 2077 6f72 6c64  le(b'hello world
-00011cf0: 272c 206c 6561 7365 3d6c 6561 7365 290a  ', lease=lease).
-00011d00: 0a20 2020 2020 2020 2023 2041 6374 0a20  .        # Act. 
-00011d10: 2020 2020 2020 2023 2064 6f77 6e6c 6f61         # downloa
-00011d20: 6420 7468 6520 6669 6c65 2077 6974 6820  d the file with 
-00011d30: 6120 7772 6f6e 6720 6c65 6173 6520 6964  a wrong lease id
-00011d40: 2077 696c 6c20 6661 696c 0a20 2020 2020   will fail.     
-00011d50: 2020 2077 6974 6820 7365 6c66 2e61 7373     with self.ass
-00011d60: 6572 7452 6169 7365 7328 4874 7470 5265  ertRaises(HttpRe
-00011d70: 7370 6f6e 7365 4572 726f 7229 3a0a 2020  sponseError):.  
-00011d80: 2020 2020 2020 2020 2020 6177 6169 7420            await 
-00011d90: 6669 6c65 5f63 6c69 656e 742e 7570 6c6f  file_client.uplo
-00011da0: 6164 5f66 696c 6528 6227 6865 6c6c 6f20  ad_file(b'hello 
-00011db0: 776f 726c 6427 2c20 6c65 6173 653d 7374  world', lease=st
-00011dc0: 7228 7575 6964 2e75 7569 6434 2829 2929  r(uuid.uuid4()))
-00011dd0: 0a0a 2020 2020 2020 2020 636f 6e74 656e  ..        conten
-00011de0: 7420 3d20 6177 6169 7420 6669 6c65 5f63  t = await file_c
-00011df0: 6c69 656e 742e 646f 776e 6c6f 6164 5f66  lient.download_f
-00011e00: 696c 6528 290a 2020 2020 2020 2020 636f  ile().        co
-00011e10: 6e74 656e 7420 3d20 6177 6169 7420 636f  ntent = await co
-00011e20: 6e74 656e 742e 7265 6164 616c 6c28 290a  ntent.readall().
-00011e30: 0a20 2020 2020 2020 2023 2041 7373 6572  .        # Asser
-00011e40: 740a 2020 2020 2020 2020 7365 6c66 2e61  t.        self.a
-00011e50: 7373 6572 7445 7175 616c 2863 6f6e 7465  ssertEqual(conte
-00011e60: 6e74 2c20 6227 6865 6c6c 6f20 776f 726c  nt, b'hello worl
-00011e70: 6427 290a 0a20 2020 2040 4669 6c65 5368  d')..    @FileSh
-00011e80: 6172 6550 7265 7061 7265 7228 290a 2020  arePreparer().  
-00011e90: 2020 4041 7379 6e63 5374 6f72 6167 6554    @AsyncStorageT
-00011ea0: 6573 7443 6173 652e 6177 6169 745f 7072  estCase.await_pr
-00011eb0: 6570 6172 6564 5f74 6573 740a 2020 2020  epared_test.    
-00011ec0: 6173 796e 6320 6465 6620 7465 7374 5f66  async def test_f
-00011ed0: 696c 655f 756e 6963 6f64 655f 6461 7461  ile_unicode_data
-00011ee0: 5f61 7379 6e63 2873 656c 662c 2073 746f  _async(self, sto
-00011ef0: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
-00011f00: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
-00011f10: 6e74 5f6b 6579 293a 0a20 2020 2020 2020  nt_key):.       
-00011f20: 2073 656c 662e 5f73 6574 7570 2873 746f   self._setup(sto
-00011f30: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
-00011f40: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
-00011f50: 6e74 5f6b 6579 290a 2020 2020 2020 2020  nt_key).        
-00011f60: 6669 6c65 5f6e 616d 6520 3d20 7365 6c66  file_name = self
-00011f70: 2e5f 6765 745f 6669 6c65 5f72 6566 6572  ._get_file_refer
-00011f80: 656e 6365 2829 0a20 2020 2020 2020 2061  ence().        a
-00011f90: 7761 6974 2073 656c 662e 5f73 6574 7570  wait self._setup
-00011fa0: 5f73 6861 7265 2873 746f 7261 6765 5f61  _share(storage_a
-00011fb0: 6363 6f75 6e74 5f6e 616d 652c 2073 746f  ccount_name, sto
-00011fc0: 7261 6765 5f61 6363 6f75 6e74 5f6b 6579  rage_account_key
-00011fd0: 290a 2020 2020 2020 2020 6669 6c65 5f63  ).        file_c
-00011fe0: 6c69 656e 7420 3d20 5368 6172 6546 696c  lient = ShareFil
-00011ff0: 6543 6c69 656e 7428 0a20 2020 2020 2020  eClient(.       
-00012000: 2020 2020 2073 656c 662e 6163 636f 756e       self.accoun
-00012010: 745f 7572 6c28 7374 6f72 6167 655f 6163  t_url(storage_ac
-00012020: 636f 756e 745f 6e61 6d65 2c20 2266 696c  count_name, "fil
-00012030: 6522 292c 0a20 2020 2020 2020 2020 2020  e"),.           
-00012040: 2073 6861 7265 5f6e 616d 653d 7365 6c66   share_name=self
-00012050: 2e73 6861 7265 5f6e 616d 652c 0a20 2020  .share_name,.   
-00012060: 2020 2020 2020 2020 2066 696c 655f 7061           file_pa
-00012070: 7468 3d66 696c 655f 6e61 6d65 2c0a 2020  th=file_name,.  
-00012080: 2020 2020 2020 2020 2020 6372 6564 656e            creden
-00012090: 7469 616c 3d73 746f 7261 6765 5f61 6363  tial=storage_acc
-000120a0: 6f75 6e74 5f6b 6579 290a 0a20 2020 2020  ount_key)..     
-000120b0: 2020 2023 2041 6374 0a20 2020 2020 2020     # Act.       
-000120c0: 2064 6174 6120 3d20 7527 6865 6c6c 6f20   data = u'hello 
-000120d0: 776f 726c 64e5 958a e9bd 84e4 b882 e78b  world...........
-000120e0: 9be7 8b9c 272e 656e 636f 6465 2827 7574  ....'.encode('ut
-000120f0: 662d 3827 290a 2020 2020 2020 2020 6177  f-8').        aw
-00012100: 6169 7420 6669 6c65 5f63 6c69 656e 742e  ait file_client.
-00012110: 7570 6c6f 6164 5f66 696c 6528 6461 7461  upload_file(data
-00012120: 290a 0a20 2020 2020 2020 2023 2041 7373  )..        # Ass
-00012130: 6572 740a 2020 2020 2020 2020 636f 6e74  ert.        cont
-00012140: 656e 7420 3d20 6177 6169 7420 6669 6c65  ent = await file
-00012150: 5f63 6c69 656e 742e 646f 776e 6c6f 6164  _client.download
-00012160: 5f66 696c 6528 290a 2020 2020 2020 2020  _file().        
-00012170: 636f 6e74 656e 7420 3d20 6177 6169 7420  content = await 
-00012180: 636f 6e74 656e 742e 7265 6164 616c 6c28  content.readall(
-00012190: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-000121a0: 7373 6572 7445 7175 616c 2863 6f6e 7465  ssertEqual(conte
-000121b0: 6e74 2c20 6461 7461 290a 0a20 2020 2040  nt, data)..    @
-000121c0: 4669 6c65 5368 6172 6550 7265 7061 7265  FileSharePrepare
-000121d0: 7228 290a 2020 2020 4041 7379 6e63 5374  r().    @AsyncSt
-000121e0: 6f72 6167 6554 6573 7443 6173 652e 6177  orageTestCase.aw
-000121f0: 6169 745f 7072 6570 6172 6564 5f74 6573  ait_prepared_tes
-00012200: 740a 2020 2020 6173 796e 6320 6465 6620  t.    async def 
-00012210: 7465 7374 5f66 696c 655f 756e 6963 6f64  test_file_unicod
-00012220: 655f 6461 7461 5f61 6e64 5f66 696c 655f  e_data_and_file_
-00012230: 6174 7472 6962 7574 6573 2873 656c 662c  attributes(self,
-00012240: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
-00012250: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
-00012260: 6363 6f75 6e74 5f6b 6579 293a 0a20 2020  ccount_key):.   
-00012270: 2020 2020 2073 656c 662e 5f73 6574 7570       self._setup
-00012280: 2873 746f 7261 6765 5f61 6363 6f75 6e74  (storage_account
-00012290: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
-000122a0: 6363 6f75 6e74 5f6b 6579 290a 2020 2020  ccount_key).    
-000122b0: 2020 2020 6669 6c65 5f63 6c69 656e 7420      file_client 
-000122c0: 3d20 6177 6169 7420 7365 6c66 2e5f 6765  = await self._ge
-000122d0: 745f 6669 6c65 5f63 6c69 656e 7428 7374  t_file_client(st
-000122e0: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
-000122f0: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
-00012300: 756e 745f 6b65 7929 0a0a 2020 2020 2020  unt_key)..      
-00012310: 2020 2320 4163 740a 2020 2020 2020 2020    # Act.        
-00012320: 6461 7461 203d 2075 2768 656c 6c6f 2077  data = u'hello w
-00012330: 6f72 6c64 e595 8ae9 bd84 e4b8 82e7 8b9b  orld............
-00012340: e78b 9c27 2e65 6e63 6f64 6528 2775 7466  ...'.encode('utf
-00012350: 2d38 2729 0a20 2020 2020 2020 2061 7761  -8').        awa
-00012360: 6974 2066 696c 655f 636c 6965 6e74 2e75  it file_client.u
-00012370: 706c 6f61 645f 6669 6c65 2864 6174 612c  pload_file(data,
-00012380: 2066 696c 655f 6174 7472 6962 7574 6573   file_attributes
-00012390: 3d4e 5446 5341 7474 7269 6275 7465 7328  =NTFSAttributes(
-000123a0: 7465 6d70 6f72 6172 793d 5472 7565 2929  temporary=True))
-000123b0: 0a0a 2020 2020 2020 2020 2320 4173 7365  ..        # Asse
-000123c0: 7274 0a20 2020 2020 2020 2063 6f6e 7465  rt.        conte
-000123d0: 6e74 203d 2061 7761 6974 2066 696c 655f  nt = await file_
-000123e0: 636c 6965 6e74 2e64 6f77 6e6c 6f61 645f  client.download_
-000123f0: 6669 6c65 2829 0a20 2020 2020 2020 2074  file().        t
-00012400: 7261 6e73 666f 726d 6564 5f63 6f6e 7465  ransformed_conte
-00012410: 6e74 203d 2061 7761 6974 2063 6f6e 7465  nt = await conte
-00012420: 6e74 2e72 6561 6461 6c6c 2829 0a20 2020  nt.readall().   
-00012430: 2020 2020 2070 726f 7065 7274 6965 7320       properties 
-00012440: 3d20 6177 6169 7420 6669 6c65 5f63 6c69  = await file_cli
-00012450: 656e 742e 6765 745f 6669 6c65 5f70 726f  ent.get_file_pro
-00012460: 7065 7274 6965 7328 290a 2020 2020 2020  perties().      
-00012470: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00012480: 616c 2874 7261 6e73 666f 726d 6564 5f63  al(transformed_c
-00012490: 6f6e 7465 6e74 2c20 6461 7461 290a 2020  ontent, data).  
-000124a0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-000124b0: 7449 6e28 2754 656d 706f 7261 7279 272c  tIn('Temporary',
-000124c0: 2070 726f 7065 7274 6965 732e 6669 6c65   properties.file
-000124d0: 5f61 7474 7269 6275 7465 7329 0a0a 2020  _attributes)..  
-000124e0: 2020 4046 696c 6553 6861 7265 5072 6570    @FileSharePrep
-000124f0: 6172 6572 2829 0a20 2020 2040 4173 796e  arer().    @Asyn
-00012500: 6353 746f 7261 6765 5465 7374 4361 7365  cStorageTestCase
-00012510: 2e61 7761 6974 5f70 7265 7061 7265 645f  .await_prepared_
-00012520: 7465 7374 0a20 2020 2061 7379 6e63 2064  test.    async d
-00012530: 6566 2074 6573 745f 756e 6963 6f64 655f  ef test_unicode_
-00012540: 6765 745f 6669 6c65 5f62 696e 6172 795f  get_file_binary_
-00012550: 6461 7461 5f61 7379 6e63 2873 656c 662c  data_async(self,
-00012560: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
-00012570: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
-00012580: 6363 6f75 6e74 5f6b 6579 293a 0a20 2020  ccount_key):.   
-00012590: 2020 2020 2073 656c 662e 5f73 6574 7570       self._setup
-000125a0: 2873 746f 7261 6765 5f61 6363 6f75 6e74  (storage_account
-000125b0: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
-000125c0: 6363 6f75 6e74 5f6b 6579 290a 2020 2020  ccount_key).    
-000125d0: 2020 2020 6261 7365 3634 5f64 6174 6120      base64_data 
-000125e0: 3d20 2741 4145 4341 7751 4642 6763 4943  = 'AAECAwQFBgcIC
-000125f0: 516f 4c44 4130 4f44 7841 5245 684d 5546  QoLDA0ODxAREhMUF
-00012600: 5259 5847 426b 6147 7877 6448 6838 6749  RYXGBkaGxwdHh8gI
-00012610: 5349 6a4a 4355 6d4a 7967 704b 6973 734c  SIjJCUmJygpKissL
-00012620: 5334 764d 4445 794d 7a51 314e 6a63 344f  S4vMDEyMzQ1Njc4O
-00012630: 546f 3750 4430 2b50 3042 4251 6b4e 4552  To7PD0+P0BBQkNER
-00012640: 555a 4853 456c 4b53 3078 4e54 6b39 5155  UZHSElKS0xNTk9QU
-00012650: 564a 5456 4656 5756 3168 5a57 6c74 6358  VJTVFVWV1hZWltcX
-00012660: 5635 6659 4746 6959 3252 6c5a 6d64 6f61  V5fYGFiY2RlZmdoa
-00012670: 5770 7262 4731 7562 3342 7863 6e4e 3064  WprbG1ub3BxcnN0d
-00012680: 585a 3365 486c 3665 3378 3966 6e2b 4167  XZ3eHl6e3x9fn+Ag
-00012690: 594b 4468 4957 4768 3469 4a69 6f75 4d6a  YKDhIWGh4iJiouMj
-000126a0: 5936 506b 4a47 536b 3553 566c 7065 596d  Y6PkJGSk5SVlpeYm
-000126b0: 5a71 626e 4a32 656e 3643 686f 714f 6b70  ZqbnJ2en6ChoqOkp
-000126c0: 6161 6e71 4b6d 7171 3679 7472 712b 7773  aanqKmqq6ytrq+ws
-000126d0: 624b 7a74 4c57 3274 3769 3575 7275 3876  bKztLW2t7i5uru8v
-000126e0: 6236 2f77 4d48 4377 3854 4678 7366 4979  b6/wMHCw8TFxsfIy
-000126f0: 6372 4c7a 4d33 4f7a 3944 5230 7450 5531  crLzM3Oz9DR0tPU1
-00012700: 6462 5832 4e6e 6132 397a 6433 742f 6734  dbX2Nna29zd3t/g4
-00012710: 654c 6a35 4f58 6d35 2b6a 7036 7576 7337  eLj5OXm5+jp6uvs7
-00012720: 6537 7638 5048 7938 2f54 3139 7666 342b  e7v8PHy8/T19vf4+
-00012730: 6672 372f 5033 2b2f 7741 4241 674d 4542  fr7/P3+/wABAgMEB
-00012740: 5159 4843 416b 4b43 7777 4e44 6738 5145  QYHCAkKCwwNDg8QE
-00012750: 5249 5446 4255 5746 7867 5a47 6873 6348  RITFBUWFxgZGhscH
-00012760: 5234 6649 4345 6949 7951 6c4a 6963 6f4b  R4fICEiIyQlJicoK
-00012770: 536f 724c 4330 754c 7a41 784d 6a4d 304e  SorLC0uLzAxMjM0N
-00012780: 5459 334f 446b 364f 7a77 3950 6a39 4151  TY3ODk6Ozw9Pj9AQ
-00012790: 554a 4452 4556 4752 3068 4a53 6b74 4d54  UJDREVGR0hJSktMT
-000127a0: 5535 5055 4646 5355 3152 5656 6c64 5957  U5PUFFSU1RVVldYW
-000127b0: 5670 6258 4631 6558 3242 6859 6d4e 6b5a  VpbXF1eX2BhYmNkZ
-000127c0: 575a 6e61 476c 7161 3278 7462 6d39 7763  WZnaGlqa2xtbm9wc
-000127d0: 584a 7a64 4856 3264 3368 3565 6e74 3866  XJzdHV2d3h5ent8f
-000127e0: 5835 2f67 4947 4367 3453 4668 6f65 4969  X5/gIGCg4SFhoeIi
-000127f0: 5971 4c6a 4932 4f6a 3543 526b 704f 556c  YqLjI2Oj5CRkpOUl
-00012800: 5a61 586d 4a6d 616d 3579 646e 702b 676f  ZaXmJmam5ydnp+go
-00012810: 614b 6a70 4b57 6d70 3669 7071 7175 7372  aKjpKWmp6ipqqusr
-00012820: 6136 7673 4c47 7973 3753 3174 7265 3475  a6vsLGys7S1tre4u
-00012830: 6271 3776 4c32 2b76 3844 4277 7350 4578  bq7vL2+v8DBwsPEx
-00012840: 6362 4879 4d6e 4b79 387a 4e7a 732f 5130  cbHyMnKy8zNzs/Q0
-00012850: 644c 5431 4e58 5731 396a 5a32 7476 6333  dLT1NXW19jZ2tvc3
-00012860: 6437 6634 4f48 6934 2b54 6c35 7566 6f36  d7f4OHi4+Tl5ufo6
-00012870: 6572 7237 4f33 7537 2f44 7838 7650 3039  err7O3u7/Dx8vP09
-00012880: 6662 332b 506e 362b 2f7a 392f 7638 4141  fb3+Pn6+/z9/v8AA
-00012890: 5149 4442 4155 4742 7767 4a43 6773 4d44  QIDBAUGBwgJCgsMD
-000128a0: 5134 5045 4245 5345 7851 5646 6863 5947  Q4PEBESExQVFhcYG
-000128b0: 526f 6248 4230 6548 7941 6849 694d 6b4a  RobHB0eHyAhIiMkJ
-000128c0: 5359 6e4b 436b 714b 7977 744c 6938 774d  SYnKCkqKywtLi8wM
-000128d0: 5449 7a4e 4455 324e 7a67 354f 6a73 3850  TIzNDU2Nzg5Ojs8P
-000128e0: 5434 2f51 4546 4351 3052 4652 6b64 4953  T4/QEFCQ0RFRkdIS
-000128f0: 5570 4c54 4531 4f54 3142 5255 6c4e 5556  UpLTE1OT1BRUlNUV
-00012900: 565a 5857 466c 6157 3178 6458 6c39 6759  VZXWFlaW1xdXl9gY
-00012910: 574a 6a5a 4756 6d5a 3268 7061 6d74 7362  WJjZGVmZ2hpamtsb
-00012920: 5735 7663 4846 7963 3352 3164 6e64 3465  W5vcHFyc3R1dnd4e
-00012930: 5870 3766 4831 2b66 3443 4267 6f4f 4568  Xp7fH1+f4CBgoOEh
-00012940: 5961 4869 496d 4b69 3479 4e6a 6f2b 516b  YaHiImKi4yNjo+Qk
-00012950: 5a4b 546c 4a57 576c 3569 5a6d 7075 636e  ZKTlJWWl5iZmpucn
-00012960: 5a36 666f 4b47 696f 3653 6c70 7165 6f71  Z6foKGio6Slpqeoq
-00012970: 6171 7272 4b32 7572 3743 7873 724f 3074  aqrrK2ur7CxsrO0t
-00012980: 6261 3375 4c6d 3675 3779 3976 722f 4177  ba3uLm6u7y9vr/Aw
-00012990: 634c 4478 4d58 4778 386a 4a79 7376 4d7a  cLDxMXGx8jJysvMz
-000129a0: 6337 5030 4e48 5330 3954 5631 7466 5932  c7P0NHS09TV1tfY2
-000129b0: 6472 6233 4e33 6533 2b44 6834 7550 6b35  drb3N3e3+Dh4uPk5
-000129c0: 6562 6e36 4f6e 7136 2b7a 7437 752f 7738  ebn6Onq6+zt7u/w8
-000129d0: 664c 7a39 5058 3239 2f6a 352b 7676 382f  fLz9PX29/j5+vv8/
-000129e0: 6637 2f41 4145 4341 7751 4642 6763 4943  f7/AAECAwQFBgcIC
-000129f0: 516f 4c44 4130 4f44 7841 5245 684d 5546  QoLDA0ODxAREhMUF
-00012a00: 5259 5847 426b 6147 7877 6448 6838 6749  RYXGBkaGxwdHh8gI
-00012a10: 5349 6a4a 4355 6d4a 7967 704b 6973 734c  SIjJCUmJygpKissL
-00012a20: 5334 764d 4445 794d 7a51 314e 6a63 344f  S4vMDEyMzQ1Njc4O
-00012a30: 546f 3750 4430 2b50 3042 4251 6b4e 4552  To7PD0+P0BBQkNER
-00012a40: 555a 4853 456c 4b53 3078 4e54 6b39 5155  UZHSElKS0xNTk9QU
-00012a50: 564a 5456 4656 5756 3168 5a57 6c74 6358  VJTVFVWV1hZWltcX
-00012a60: 5635 6659 4746 6959 3252 6c5a 6d64 6f61  V5fYGFiY2RlZmdoa
-00012a70: 5770 7262 4731 7562 3342 7863 6e4e 3064  WprbG1ub3BxcnN0d
-00012a80: 585a 3365 486c 3665 3378 3966 6e2b 4167  XZ3eHl6e3x9fn+Ag
-00012a90: 594b 4468 4957 4768 3469 4a69 6f75 4d6a  YKDhIWGh4iJiouMj
-00012aa0: 5936 506b 4a47 536b 3553 566c 7065 596d  Y6PkJGSk5SVlpeYm
-00012ab0: 5a71 626e 4a32 656e 3643 686f 714f 6b70  ZqbnJ2en6ChoqOkp
-00012ac0: 6161 6e71 4b6d 7171 3679 7472 712b 7773  aanqKmqq6ytrq+ws
-00012ad0: 624b 7a74 4c57 3274 3769 3575 7275 3876  bKztLW2t7i5uru8v
-00012ae0: 6236 2f77 4d48 4377 3854 4678 7366 4979  b6/wMHCw8TFxsfIy
-00012af0: 6372 4c7a 4d33 4f7a 3944 5230 7450 5531  crLzM3Oz9DR0tPU1
-00012b00: 6462 5832 4e6e 6132 397a 6433 742f 6734  dbX2Nna29zd3t/g4
-00012b10: 654c 6a35 4f58 6d35 2b6a 7036 7576 7337  eLj5OXm5+jp6uvs7
-00012b20: 6537 7638 5048 7938 2f54 3139 7666 342b  e7v8PHy8/T19vf4+
-00012b30: 6672 372f 5033 2b2f 773d 3d27 0a20 2020  fr7/P3+/w=='.   
-00012b40: 2020 2020 2062 696e 6172 795f 6461 7461       binary_data
-00012b50: 203d 2062 6173 6536 342e 6236 3464 6563   = base64.b64dec
-00012b60: 6f64 6528 6261 7365 3634 5f64 6174 6129  ode(base64_data)
-00012b70: 0a20 2020 2020 2020 2061 7761 6974 2073  .        await s
-00012b80: 656c 662e 5f73 6574 7570 5f73 6861 7265  elf._setup_share
-00012b90: 2873 746f 7261 6765 5f61 6363 6f75 6e74  (storage_account
-00012ba0: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
-00012bb0: 6363 6f75 6e74 5f6b 6579 290a 0a20 2020  ccount_key)..   
-00012bc0: 2020 2020 2066 696c 655f 6e61 6d65 203d       file_name =
-00012bd0: 2073 656c 662e 5f67 6574 5f66 696c 655f   self._get_file_
-00012be0: 7265 6665 7265 6e63 6528 290a 2020 2020  reference().    
-00012bf0: 2020 2020 6669 6c65 5f63 6c69 656e 7420      file_client 
-00012c00: 3d20 5368 6172 6546 696c 6543 6c69 656e  = ShareFileClien
-00012c10: 7428 0a20 2020 2020 2020 2020 2020 2073  t(.            s
-00012c20: 656c 662e 6163 636f 756e 745f 7572 6c28  elf.account_url(
-00012c30: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-00012c40: 6e61 6d65 2c20 2266 696c 6522 292c 0a20  name, "file"),. 
-00012c50: 2020 2020 2020 2020 2020 2073 6861 7265             share
-00012c60: 5f6e 616d 653d 7365 6c66 2e73 6861 7265  _name=self.share
-00012c70: 5f6e 616d 652c 0a20 2020 2020 2020 2020  _name,.         
-00012c80: 2020 2066 696c 655f 7061 7468 3d66 696c     file_path=fil
-00012c90: 655f 6e61 6d65 2c0a 2020 2020 2020 2020  e_name,.        
-00012ca0: 2020 2020 6372 6564 656e 7469 616c 3d73      credential=s
-00012cb0: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
-00012cc0: 6579 290a 2020 2020 2020 2020 6177 6169  ey).        awai
-00012cd0: 7420 6669 6c65 5f63 6c69 656e 742e 7570  t file_client.up
-00012ce0: 6c6f 6164 5f66 696c 6528 6269 6e61 7279  load_file(binary
-00012cf0: 5f64 6174 6129 0a0a 2020 2020 2020 2020  _data)..        
-00012d00: 2320 4163 740a 2020 2020 2020 2020 636f  # Act.        co
-00012d10: 6e74 656e 7420 3d20 6177 6169 7420 6669  ntent = await fi
-00012d20: 6c65 5f63 6c69 656e 742e 646f 776e 6c6f  le_client.downlo
-00012d30: 6164 5f66 696c 6528 290a 2020 2020 2020  ad_file().      
-00012d40: 2020 636f 6e74 656e 7420 3d20 6177 6169    content = awai
-00012d50: 7420 636f 6e74 656e 742e 7265 6164 616c  t content.readal
-00012d60: 6c28 290a 0a20 2020 2020 2020 2023 2041  l()..        # A
-00012d70: 7373 6572 740a 2020 2020 2020 2020 7365  ssert.        se
-00012d80: 6c66 2e61 7373 6572 7445 7175 616c 2863  lf.assertEqual(c
-00012d90: 6f6e 7465 6e74 2c20 6269 6e61 7279 5f64  ontent, binary_d
-00012da0: 6174 6129 0a0a 0a20 2020 2040 4669 6c65  ata)...    @File
-00012db0: 5368 6172 6550 7265 7061 7265 7228 290a  SharePreparer().
-00012dc0: 2020 2020 4041 7379 6e63 5374 6f72 6167      @AsyncStorag
-00012dd0: 6554 6573 7443 6173 652e 6177 6169 745f  eTestCase.await_
-00012de0: 7072 6570 6172 6564 5f74 6573 740a 2020  prepared_test.  
-00012df0: 2020 6173 796e 6320 6465 6620 7465 7374    async def test
-00012e00: 5f63 7265 6174 655f 6669 6c65 5f66 726f  _create_file_fro
-00012e10: 6d5f 6279 7465 735f 7769 7468 5f70 726f  m_bytes_with_pro
-00012e20: 6772 6573 735f 6173 796e 6328 7365 6c66  gress_async(self
-00012e30: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
-00012e40: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
-00012e50: 6163 636f 756e 745f 6b65 7929 3a0a 2020  account_key):.  
-00012e60: 2020 2020 2020 2320 7061 7261 6c6c 656c        # parallel
-00012e70: 2074 6573 7473 2069 6e74 726f 6475 6365   tests introduce
-00012e80: 2072 616e 646f 6d20 6f72 6465 7220 6f66   random order of
-00012e90: 2072 6571 7565 7374 732c 2063 616e 206f   requests, can o
-00012ea0: 6e6c 7920 7275 6e20 6c69 7665 0a20 2020  nly run live.   
-00012eb0: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
-00012ec0: 2e69 735f 6c69 7665 3a0a 2020 2020 2020  .is_live:.      
-00012ed0: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
-00012ee0: 2020 2020 2020 7365 6c66 2e5f 7365 7475        self._setu
-00012ef0: 7028 7374 6f72 6167 655f 6163 636f 756e  p(storage_accoun
-00012f00: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
-00012f10: 6163 636f 756e 745f 6b65 7929 0a20 2020  account_key).   
-00012f20: 2020 2020 2061 7761 6974 2073 656c 662e       await self.
-00012f30: 5f73 6574 7570 5f73 6861 7265 2873 746f  _setup_share(sto
-00012f40: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
-00012f50: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
-00012f60: 6e74 5f6b 6579 290a 2020 2020 2020 2020  nt_key).        
-00012f70: 6669 6c65 5f6e 616d 6520 3d20 7365 6c66  file_name = self
-00012f80: 2e5f 6765 745f 6669 6c65 5f72 6566 6572  ._get_file_refer
-00012f90: 656e 6365 2829 0a20 2020 2020 2020 2064  ence().        d
-00012fa0: 6174 6120 3d20 7365 6c66 2e67 6574 5f72  ata = self.get_r
-00012fb0: 616e 646f 6d5f 6279 7465 7328 4c41 5247  andom_bytes(LARG
-00012fc0: 455f 4649 4c45 5f53 495a 4529 0a20 2020  E_FILE_SIZE).   
-00012fd0: 2020 2020 2066 696c 655f 636c 6965 6e74       file_client
-00012fe0: 203d 2053 6861 7265 4669 6c65 436c 6965   = ShareFileClie
-00012ff0: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
-00013000: 7365 6c66 2e61 6363 6f75 6e74 5f75 726c  self.account_url
-00013010: 2873 746f 7261 6765 5f61 6363 6f75 6e74  (storage_account
-00013020: 5f6e 616d 652c 2022 6669 6c65 2229 2c0a  _name, "file"),.
-00013030: 2020 2020 2020 2020 2020 2020 7368 6172              shar
-00013040: 655f 6e61 6d65 3d73 656c 662e 7368 6172  e_name=self.shar
-00013050: 655f 6e61 6d65 2c0a 2020 2020 2020 2020  e_name,.        
-00013060: 2020 2020 6669 6c65 5f70 6174 683d 6669      file_path=fi
-00013070: 6c65 5f6e 616d 652c 0a20 2020 2020 2020  le_name,.       
-00013080: 2020 2020 2063 7265 6465 6e74 6961 6c3d       credential=
-00013090: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-000130a0: 6b65 792c 0a20 2020 2020 2020 2020 2020  key,.           
-000130b0: 206d 6178 5f72 616e 6765 5f73 697a 653d   max_range_size=
-000130c0: 3420 2a20 3130 3234 290a 0a20 2020 2020  4 * 1024)..     
-000130d0: 2020 2023 2041 6374 0a20 2020 2020 2020     # Act.       
-000130e0: 2070 726f 6772 6573 7320 3d20 5b5d 0a20   progress = []. 
-000130f0: 2020 2020 2020 2064 6566 2063 616c 6c62         def callb
-00013100: 6163 6b28 7265 7370 6f6e 7365 293a 0a20  ack(response):. 
-00013110: 2020 2020 2020 2020 2020 2063 7572 7265             curre
-00013120: 6e74 203d 2072 6573 706f 6e73 652e 636f  nt = response.co
-00013130: 6e74 6578 745b 2775 706c 6f61 645f 7374  ntext['upload_st
-00013140: 7265 616d 5f63 7572 7265 6e74 275d 0a20  ream_current']. 
-00013150: 2020 2020 2020 2020 2020 2074 6f74 616c             total
-00013160: 203d 2072 6573 706f 6e73 652e 636f 6e74   = response.cont
-00013170: 6578 745b 2764 6174 615f 7374 7265 616d  ext['data_stream
-00013180: 5f74 6f74 616c 275d 0a20 2020 2020 2020  _total'].       
-00013190: 2020 2020 2069 6620 6375 7272 656e 7420       if current 
-000131a0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-000131b0: 2020 2020 2020 2020 2020 2020 2070 726f               pro
-000131c0: 6772 6573 732e 6170 7065 6e64 2828 6375  gress.append((cu
-000131d0: 7272 656e 742c 2074 6f74 616c 2929 0a0a  rrent, total))..
-000131e0: 2020 2020 2020 2020 6177 6169 7420 6669          await fi
-000131f0: 6c65 5f63 6c69 656e 742e 7570 6c6f 6164  le_client.upload
-00013200: 5f66 696c 6528 6461 7461 2c20 6d61 785f  _file(data, max_
-00013210: 636f 6e63 7572 7265 6e63 793d 322c 2072  concurrency=2, r
-00013220: 6177 5f72 6573 706f 6e73 655f 686f 6f6b  aw_response_hook
-00013230: 3d63 616c 6c62 6163 6b29 0a0a 2020 2020  =callback)..    
-00013240: 2020 2020 2320 4173 7365 7274 0a20 2020      # Assert.   
-00013250: 2020 2020 2061 7761 6974 2073 656c 662e       await self.
-00013260: 6173 7365 7274 4669 6c65 4571 7561 6c28  assertFileEqual(
-00013270: 6669 6c65 5f63 6c69 656e 742c 2064 6174  file_client, dat
-00013280: 6129 0a0a 2020 2020 4046 696c 6553 6861  a)..    @FileSha
-00013290: 7265 5072 6570 6172 6572 2829 0a20 2020  rePreparer().   
-000132a0: 2040 4173 796e 6353 746f 7261 6765 5465   @AsyncStorageTe
-000132b0: 7374 4361 7365 2e61 7761 6974 5f70 7265  stCase.await_pre
-000132c0: 7061 7265 645f 7465 7374 0a20 2020 2061  pared_test.    a
-000132d0: 7379 6e63 2064 6566 2074 6573 745f 6372  sync def test_cr
-000132e0: 6561 7465 5f66 696c 655f 6672 6f6d 5f62  eate_file_from_b
-000132f0: 7974 6573 5f77 6974 685f 696e 6465 785f  ytes_with_index_
-00013300: 6173 796e 6328 7365 6c66 2c20 7374 6f72  async(self, stor
-00013310: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
-00013320: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
-00013330: 745f 6b65 7929 3a0a 2020 2020 2020 2020  t_key):.        
-00013340: 2320 7061 7261 6c6c 656c 2074 6573 7473  # parallel tests
-00013350: 2069 6e74 726f 6475 6365 2072 616e 646f   introduce rando
-00013360: 6d20 6f72 6465 7220 6f66 2072 6571 7565  m order of reque
-00013370: 7374 732c 2063 616e 206f 6e6c 7920 7275  sts, can only ru
-00013380: 6e20 6c69 7665 0a20 2020 2020 2020 2069  n live.        i
-00013390: 6620 6e6f 7420 7365 6c66 2e69 735f 6c69  f not self.is_li
-000133a0: 7665 3a0a 2020 2020 2020 2020 2020 2020  ve:.            
-000133b0: 7265 7475 726e 0a0a 2020 2020 2020 2020  return..        
-000133c0: 7365 6c66 2e5f 7365 7475 7028 7374 6f72  self._setup(stor
-000133d0: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
-000133e0: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
-000133f0: 745f 6b65 7929 0a20 2020 2020 2020 2066  t_key).        f
-00013400: 696c 655f 6e61 6d65 203d 2073 656c 662e  ile_name = self.
-00013410: 5f67 6574 5f66 696c 655f 7265 6665 7265  _get_file_refere
-00013420: 6e63 6528 290a 2020 2020 2020 2020 6177  nce().        aw
-00013430: 6169 7420 7365 6c66 2e5f 7365 7475 705f  ait self._setup_
-00013440: 7368 6172 6528 7374 6f72 6167 655f 6163  share(storage_ac
-00013450: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
-00013460: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
-00013470: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
-00013480: 7365 6c66 2e67 6574 5f72 616e 646f 6d5f  self.get_random_
-00013490: 6279 7465 7328 4c41 5247 455f 4649 4c45  bytes(LARGE_FILE
-000134a0: 5f53 495a 4529 0a20 2020 2020 2020 2069  _SIZE).        i
-000134b0: 6e64 6578 203d 2031 3032 340a 2020 2020  ndex = 1024.    
-000134c0: 2020 2020 6669 6c65 5f63 6c69 656e 7420      file_client 
-000134d0: 3d20 5368 6172 6546 696c 6543 6c69 656e  = ShareFileClien
-000134e0: 7428 0a20 2020 2020 2020 2020 2020 2073  t(.            s
-000134f0: 656c 662e 6163 636f 756e 745f 7572 6c28  elf.account_url(
-00013500: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-00013510: 6e61 6d65 2c20 2266 696c 6522 292c 0a20  name, "file"),. 
-00013520: 2020 2020 2020 2020 2020 2073 6861 7265             share
-00013530: 5f6e 616d 653d 7365 6c66 2e73 6861 7265  _name=self.share
-00013540: 5f6e 616d 652c 0a20 2020 2020 2020 2020  _name,.         
-00013550: 2020 2066 696c 655f 7061 7468 3d66 696c     file_path=fil
-00013560: 655f 6e61 6d65 2c0a 2020 2020 2020 2020  e_name,.        
-00013570: 2020 2020 6372 6564 656e 7469 616c 3d73      credential=s
-00013580: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
-00013590: 6579 2c0a 2020 2020 2020 2020 2020 2020  ey,.            
-000135a0: 6d61 785f 7261 6e67 655f 7369 7a65 3d34  max_range_size=4
-000135b0: 202a 2031 3032 3429 0a0a 2020 2020 2020   * 1024)..      
-000135c0: 2020 2320 4163 740a 2020 2020 2020 2020    # Act.        
-000135d0: 7265 7370 6f6e 7365 203d 2061 7761 6974  response = await
-000135e0: 2066 696c 655f 636c 6965 6e74 2e75 706c   file_client.upl
-000135f0: 6f61 645f 6669 6c65 2864 6174 615b 696e  oad_file(data[in
-00013600: 6465 783a 5d2c 206d 6178 5f63 6f6e 6375  dex:], max_concu
-00013610: 7272 656e 6379 3d32 290a 2020 2020 2020  rrency=2).      
-00013620: 2020 6173 7365 7274 2069 7369 6e73 7461    assert isinsta
-00013630: 6e63 6528 7265 7370 6f6e 7365 2c20 6469  nce(response, di
-00013640: 6374 290a 2020 2020 2020 2020 6173 7365  ct).        asse
-00013650: 7274 2027 6c61 7374 5f6d 6f64 6966 6965  rt 'last_modifie
-00013660: 6427 2069 6e20 7265 7370 6f6e 7365 0a20  d' in response. 
-00013670: 2020 2020 2020 2061 7373 6572 7420 2765         assert 'e
-00013680: 7461 6727 2069 6e20 7265 7370 6f6e 7365  tag' in response
-00013690: 0a0a 2020 2020 2020 2020 2320 4173 7365  ..        # Asse
-000136a0: 7274 0a20 2020 2020 2020 2061 7761 6974  rt.        await
-000136b0: 2073 656c 662e 6173 7365 7274 4669 6c65   self.assertFile
-000136c0: 4571 7561 6c28 6669 6c65 5f63 6c69 656e  Equal(file_clien
-000136d0: 742c 2064 6174 615b 3130 3234 3a5d 290a  t, data[1024:]).
-000136e0: 0a20 2020 2040 4669 6c65 5368 6172 6550  .    @FileShareP
-000136f0: 7265 7061 7265 7228 290a 2020 2020 4041  reparer().    @A
-00013700: 7379 6e63 5374 6f72 6167 6554 6573 7443  syncStorageTestC
-00013710: 6173 652e 6177 6169 745f 7072 6570 6172  ase.await_prepar
-00013720: 6564 5f74 6573 740a 2020 2020 6173 796e  ed_test.    asyn
-00013730: 6320 6465 6620 7465 7374 5f63 7265 6174  c def test_creat
-00013740: 655f 6669 6c65 5f66 726f 6d5f 6279 7465  e_file_from_byte
-00013750: 735f 7769 7468 5f69 6e64 6578 5f61 6e64  s_with_index_and
-00013760: 5f63 6f75 6e74 5f61 7379 6e63 2873 656c  _count_async(sel
-00013770: 662c 2073 746f 7261 6765 5f61 6363 6f75  f, storage_accou
-00013780: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
-00013790: 5f61 6363 6f75 6e74 5f6b 6579 293a 0a20  _account_key):. 
-000137a0: 2020 2020 2020 2023 2070 6172 616c 6c65         # paralle
-000137b0: 6c20 7465 7374 7320 696e 7472 6f64 7563  l tests introduc
-000137c0: 6520 7261 6e64 6f6d 206f 7264 6572 206f  e random order o
-000137d0: 6620 7265 7175 6573 7473 2c20 6361 6e20  f requests, can 
-000137e0: 6f6e 6c79 2072 756e 206c 6976 650a 2020  only run live.  
-000137f0: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-00013800: 662e 6973 5f6c 6976 653a 0a20 2020 2020  f.is_live:.     
-00013810: 2020 2020 2020 2072 6574 7572 6e0a 0a20         return.. 
-00013820: 2020 2020 2020 2073 656c 662e 5f73 6574         self._set
-00013830: 7570 2873 746f 7261 6765 5f61 6363 6f75  up(storage_accou
-00013840: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
-00013850: 5f61 6363 6f75 6e74 5f6b 6579 290a 2020  _account_key).  
-00013860: 2020 2020 2020 6669 6c65 5f6e 616d 6520        file_name 
-00013870: 3d20 7365 6c66 2e5f 6765 745f 6669 6c65  = self._get_file
-00013880: 5f72 6566 6572 656e 6365 2829 0a20 2020  _reference().   
-00013890: 2020 2020 2061 7761 6974 2073 656c 662e       await self.
-000138a0: 5f73 6574 7570 5f73 6861 7265 2873 746f  _setup_share(sto
-000138b0: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
-000138c0: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
-000138d0: 6e74 5f6b 6579 290a 2020 2020 2020 2020  nt_key).        
-000138e0: 6461 7461 203d 2073 656c 662e 6765 745f  data = self.get_
-000138f0: 7261 6e64 6f6d 5f62 7974 6573 284c 4152  random_bytes(LAR
-00013900: 4745 5f46 494c 455f 5349 5a45 290a 2020  GE_FILE_SIZE).  
-00013910: 2020 2020 2020 696e 6465 7820 3d20 3531        index = 51
-00013920: 320a 2020 2020 2020 2020 636f 756e 7420  2.        count 
-00013930: 3d20 3130 3234 0a20 2020 2020 2020 2066  = 1024.        f
-00013940: 696c 655f 636c 6965 6e74 203d 2053 6861  ile_client = Sha
-00013950: 7265 4669 6c65 436c 6965 6e74 280a 2020  reFileClient(.  
-00013960: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00013970: 6363 6f75 6e74 5f75 726c 2873 746f 7261  ccount_url(stora
-00013980: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
-00013990: 2022 6669 6c65 2229 2c0a 2020 2020 2020   "file"),.      
-000139a0: 2020 2020 2020 7368 6172 655f 6e61 6d65        share_name
-000139b0: 3d73 656c 662e 7368 6172 655f 6e61 6d65  =self.share_name
-000139c0: 2c0a 2020 2020 2020 2020 2020 2020 6669  ,.            fi
-000139d0: 6c65 5f70 6174 683d 6669 6c65 5f6e 616d  le_path=file_nam
-000139e0: 652c 0a20 2020 2020 2020 2020 2020 2063  e,.            c
-000139f0: 7265 6465 6e74 6961 6c3d 7374 6f72 6167  redential=storag
-00013a00: 655f 6163 636f 756e 745f 6b65 792c 0a20  e_account_key,. 
-00013a10: 2020 2020 2020 2020 2020 206d 6178 5f72             max_r
-00013a20: 616e 6765 5f73 697a 653d 3420 2a20 3130  ange_size=4 * 10
-00013a30: 3234 290a 0a20 2020 2020 2020 2023 2041  24)..        # A
-00013a40: 6374 0a20 2020 2020 2020 2072 6573 706f  ct.        respo
-00013a50: 6e73 6520 3d20 6177 6169 7420 6669 6c65  nse = await file
-00013a60: 5f63 6c69 656e 742e 7570 6c6f 6164 5f66  _client.upload_f
-00013a70: 696c 6528 6461 7461 5b69 6e64 6578 3a5d  ile(data[index:]
-00013a80: 2c20 6c65 6e67 7468 3d63 6f75 6e74 2c20  , length=count, 
-00013a90: 6d61 785f 636f 6e63 7572 7265 6e63 793d  max_concurrency=
-00013aa0: 3229 0a20 2020 2020 2020 2061 7373 6572  2).        asser
-00013ab0: 7420 6973 696e 7374 616e 6365 2872 6573  t isinstance(res
-00013ac0: 706f 6e73 652c 2064 6963 7429 0a20 2020  ponse, dict).   
-00013ad0: 2020 2020 2061 7373 6572 7420 276c 6173       assert 'las
-00013ae0: 745f 6d6f 6469 6669 6564 2720 696e 2072  t_modified' in r
-00013af0: 6573 706f 6e73 650a 2020 2020 2020 2020  esponse.        
-00013b00: 6173 7365 7274 2027 6574 6167 2720 696e  assert 'etag' in
-00013b10: 2072 6573 706f 6e73 650a 0a20 2020 2020   response..     
-00013b20: 2020 2023 2041 7373 6572 740a 2020 2020     # Assert.    
-00013b30: 2020 2020 6177 6169 7420 7365 6c66 2e61      await self.a
-00013b40: 7373 6572 7446 696c 6545 7175 616c 2866  ssertFileEqual(f
-00013b50: 696c 655f 636c 6965 6e74 2c20 6461 7461  ile_client, data
-00013b60: 5b69 6e64 6578 3a69 6e64 6578 202b 2063  [index:index + c
-00013b70: 6f75 6e74 5d29 0a0a 2020 2020 4046 696c  ount])..    @Fil
-00013b80: 6553 6861 7265 5072 6570 6172 6572 2829  eSharePreparer()
-00013b90: 0a20 2020 2040 4173 796e 6353 746f 7261  .    @AsyncStora
-00013ba0: 6765 5465 7374 4361 7365 2e61 7761 6974  geTestCase.await
-00013bb0: 5f70 7265 7061 7265 645f 7465 7374 0a20  _prepared_test. 
-00013bc0: 2020 2061 7379 6e63 2064 6566 2074 6573     async def tes
-00013bd0: 745f 6372 6561 7465 5f66 696c 655f 6672  t_create_file_fr
-00013be0: 6f6d 5f70 6174 685f 6173 796e 6328 7365  om_path_async(se
-00013bf0: 6c66 2c20 7374 6f72 6167 655f 6163 636f  lf, storage_acco
-00013c00: 756e 745f 6e61 6d65 2c20 7374 6f72 6167  unt_name, storag
-00013c10: 655f 6163 636f 756e 745f 6b65 7929 3a0a  e_account_key):.
-00013c20: 2020 2020 2020 2020 2320 7061 7261 6c6c          # parall
-00013c30: 656c 2074 6573 7473 2069 6e74 726f 6475  el tests introdu
-00013c40: 6365 2072 616e 646f 6d20 6f72 6465 7220  ce random order 
-00013c50: 6f66 2072 6571 7565 7374 732c 2063 616e  of requests, can
-00013c60: 206f 6e6c 7920 7275 6e20 6c69 7665 0a20   only run live. 
-00013c70: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
-00013c80: 6c66 2e69 735f 6c69 7665 3a0a 2020 2020  lf.is_live:.    
-00013c90: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
-00013ca0: 2020 2020 2020 2020 7365 6c66 2e5f 7365          self._se
-00013cb0: 7475 7028 7374 6f72 6167 655f 6163 636f  tup(storage_acco
-00013cc0: 756e 745f 6e61 6d65 2c20 7374 6f72 6167  unt_name, storag
-00013cd0: 655f 6163 636f 756e 745f 6b65 7929 0a20  e_account_key). 
-00013ce0: 2020 2020 2020 2066 696c 655f 6e61 6d65         file_name
-00013cf0: 203d 2073 656c 662e 5f67 6574 5f66 696c   = self._get_fil
-00013d00: 655f 7265 6665 7265 6e63 6528 290a 2020  e_reference().  
-00013d10: 2020 2020 2020 6177 6169 7420 7365 6c66        await self
-00013d20: 2e5f 7365 7475 705f 7368 6172 6528 7374  ._setup_share(st
-00013d30: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
-00013d40: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
-00013d50: 756e 745f 6b65 7929 0a20 2020 2020 2020  unt_key).       
-00013d60: 2064 6174 6120 3d20 7365 6c66 2e67 6574   data = self.get
-00013d70: 5f72 616e 646f 6d5f 6279 7465 7328 4c41  _random_bytes(LA
-00013d80: 5247 455f 4649 4c45 5f53 495a 4529 0a20  RGE_FILE_SIZE). 
-00013d90: 2020 2020 2020 2077 6974 6820 6f70 656e         with open
-00013da0: 2849 4e50 5554 5f46 494c 455f 5041 5448  (INPUT_FILE_PATH
-00013db0: 2c20 2777 6227 2920 6173 2073 7472 6561  , 'wb') as strea
-00013dc0: 6d3a 0a20 2020 2020 2020 2020 2020 2073  m:.            s
-00013dd0: 7472 6561 6d2e 7772 6974 6528 6461 7461  tream.write(data
-00013de0: 290a 2020 2020 2020 2020 6669 6c65 5f63  ).        file_c
-00013df0: 6c69 656e 7420 3d20 5368 6172 6546 696c  lient = ShareFil
-00013e00: 6543 6c69 656e 7428 0a20 2020 2020 2020  eClient(.       
-00013e10: 2020 2020 2073 656c 662e 6163 636f 756e       self.accoun
-00013e20: 745f 7572 6c28 7374 6f72 6167 655f 6163  t_url(storage_ac
-00013e30: 636f 756e 745f 6e61 6d65 2c20 2266 696c  count_name, "fil
-00013e40: 6522 292c 0a20 2020 2020 2020 2020 2020  e"),.           
-00013e50: 2073 6861 7265 5f6e 616d 653d 7365 6c66   share_name=self
-00013e60: 2e73 6861 7265 5f6e 616d 652c 0a20 2020  .share_name,.   
-00013e70: 2020 2020 2020 2020 2066 696c 655f 7061           file_pa
-00013e80: 7468 3d66 696c 655f 6e61 6d65 2c0a 2020  th=file_name,.  
-00013e90: 2020 2020 2020 2020 2020 6372 6564 656e            creden
-00013ea0: 7469 616c 3d73 746f 7261 6765 5f61 6363  tial=storage_acc
-00013eb0: 6f75 6e74 5f6b 6579 2c0a 2020 2020 2020  ount_key,.      
-00013ec0: 2020 2020 2020 6d61 785f 7261 6e67 655f        max_range_
-00013ed0: 7369 7a65 3d34 202a 2031 3032 3429 0a0a  size=4 * 1024)..
-00013ee0: 2020 2020 2020 2020 2320 4163 740a 2020          # Act.  
-00013ef0: 2020 2020 2020 7769 7468 206f 7065 6e28        with open(
-00013f00: 494e 5055 545f 4649 4c45 5f50 4154 482c  INPUT_FILE_PATH,
-00013f10: 2027 7262 2729 2061 7320 7374 7265 616d   'rb') as stream
-00013f20: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00013f30: 7370 6f6e 7365 203d 2061 7761 6974 2066  sponse = await f
-00013f40: 696c 655f 636c 6965 6e74 2e75 706c 6f61  ile_client.uploa
-00013f50: 645f 6669 6c65 2873 7472 6561 6d2c 206d  d_file(stream, m
-00013f60: 6178 5f63 6f6e 6375 7272 656e 6379 3d32  ax_concurrency=2
-00013f70: 290a 2020 2020 2020 2020 2020 2020 6173  ).            as
-00013f80: 7365 7274 2069 7369 6e73 7461 6e63 6528  sert isinstance(
-00013f90: 7265 7370 6f6e 7365 2c20 6469 6374 290a  response, dict).
-00013fa0: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-00013fb0: 7274 2027 6c61 7374 5f6d 6f64 6966 6965  rt 'last_modifie
-00013fc0: 6427 2069 6e20 7265 7370 6f6e 7365 0a20  d' in response. 
-00013fd0: 2020 2020 2020 2020 2020 2061 7373 6572             asser
-00013fe0: 7420 2765 7461 6727 2069 6e20 7265 7370  t 'etag' in resp
-00013ff0: 6f6e 7365 0a0a 2020 2020 2020 2020 2320  onse..        # 
-00014000: 4173 7365 7274 0a20 2020 2020 2020 2061  Assert.        a
-00014010: 7761 6974 2073 656c 662e 6173 7365 7274  wait self.assert
-00014020: 4669 6c65 4571 7561 6c28 6669 6c65 5f63  FileEqual(file_c
-00014030: 6c69 656e 742c 2064 6174 6129 0a20 2020  lient, data).   
-00014040: 2020 2020 2073 656c 662e 5f74 6561 7264       self._teard
-00014050: 6f77 6e28 494e 5055 545f 4649 4c45 5f50  own(INPUT_FILE_P
-00014060: 4154 4829 0a0a 2020 2020 4046 696c 6553  ATH)..    @FileS
-00014070: 6861 7265 5072 6570 6172 6572 2829 0a20  harePreparer(). 
-00014080: 2020 2040 4173 796e 6353 746f 7261 6765     @AsyncStorage
-00014090: 5465 7374 4361 7365 2e61 7761 6974 5f70  TestCase.await_p
-000140a0: 7265 7061 7265 645f 7465 7374 0a20 2020  repared_test.   
-000140b0: 2061 7379 6e63 2064 6566 2074 6573 745f   async def test_
-000140c0: 6372 6561 7465 5f66 696c 655f 6672 6f6d  create_file_from
-000140d0: 5f70 6174 685f 7769 7468 5f70 726f 6772  _path_with_progr
-000140e0: 6573 735f 6173 796e 6328 7365 6c66 2c20  ess_async(self, 
-000140f0: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-00014100: 6e61 6d65 2c20 7374 6f72 6167 655f 6163  name, storage_ac
-00014110: 636f 756e 745f 6b65 7929 3a0a 2020 2020  count_key):.    
-00014120: 2020 2020 2320 7061 7261 6c6c 656c 2074      # parallel t
-00014130: 6573 7473 2069 6e74 726f 6475 6365 2072  ests introduce r
-00014140: 616e 646f 6d20 6f72 6465 7220 6f66 2072  andom order of r
-00014150: 6571 7565 7374 732c 2063 616e 206f 6e6c  equests, can onl
-00014160: 7920 7275 6e20 6c69 7665 0a20 2020 2020  y run live.     
-00014170: 2020 2069 6620 6e6f 7420 7365 6c66 2e69     if not self.i
-00014180: 735f 6c69 7665 3a0a 2020 2020 2020 2020  s_live:.        
-00014190: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
-000141a0: 2020 2020 7365 6c66 2e5f 7365 7475 7028      self._setup(
-000141b0: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-000141c0: 6e61 6d65 2c20 7374 6f72 6167 655f 6163  name, storage_ac
-000141d0: 636f 756e 745f 6b65 7929 0a20 2020 2020  count_key).     
-000141e0: 2020 2066 696c 655f 6e61 6d65 203d 2073     file_name = s
-000141f0: 656c 662e 5f67 6574 5f66 696c 655f 7265  elf._get_file_re
-00014200: 6665 7265 6e63 6528 290a 2020 2020 2020  ference().      
-00014210: 2020 6177 6169 7420 7365 6c66 2e5f 7365    await self._se
-00014220: 7475 705f 7368 6172 6528 7374 6f72 6167  tup_share(storag
-00014230: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
-00014240: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-00014250: 6b65 7929 0a20 2020 2020 2020 2064 6174  key).        dat
-00014260: 6120 3d20 7365 6c66 2e67 6574 5f72 616e  a = self.get_ran
-00014270: 646f 6d5f 6279 7465 7328 4c41 5247 455f  dom_bytes(LARGE_
-00014280: 4649 4c45 5f53 495a 4529 0a20 2020 2020  FILE_SIZE).     
-00014290: 2020 2077 6974 6820 6f70 656e 2849 4e50     with open(INP
-000142a0: 5554 5f46 494c 455f 5041 5448 2c20 2777  UT_FILE_PATH, 'w
-000142b0: 6227 2920 6173 2073 7472 6561 6d3a 0a20  b') as stream:. 
-000142c0: 2020 2020 2020 2020 2020 2073 7472 6561             strea
-000142d0: 6d2e 7772 6974 6528 6461 7461 290a 2020  m.write(data).  
-000142e0: 2020 2020 2020 6669 6c65 5f63 6c69 656e        file_clien
-000142f0: 7420 3d20 5368 6172 6546 696c 6543 6c69  t = ShareFileCli
-00014300: 656e 7428 0a20 2020 2020 2020 2020 2020  ent(.           
-00014310: 2073 656c 662e 6163 636f 756e 745f 7572   self.account_ur
-00014320: 6c28 7374 6f72 6167 655f 6163 636f 756e  l(storage_accoun
-00014330: 745f 6e61 6d65 2c20 2266 696c 6522 292c  t_name, "file"),
-00014340: 0a20 2020 2020 2020 2020 2020 2073 6861  .            sha
-00014350: 7265 5f6e 616d 653d 7365 6c66 2e73 6861  re_name=self.sha
-00014360: 7265 5f6e 616d 652c 0a20 2020 2020 2020  re_name,.       
-00014370: 2020 2020 2066 696c 655f 7061 7468 3d66       file_path=f
-00014380: 696c 655f 6e61 6d65 2c0a 2020 2020 2020  ile_name,.      
-00014390: 2020 2020 2020 6372 6564 656e 7469 616c        credential
-000143a0: 3d73 746f 7261 6765 5f61 6363 6f75 6e74  =storage_account
-000143b0: 5f6b 6579 2c0a 2020 2020 2020 2020 2020  _key,.          
-000143c0: 2020 6d61 785f 7261 6e67 655f 7369 7a65    max_range_size
-000143d0: 3d34 202a 2031 3032 3429 0a0a 2020 2020  =4 * 1024)..    
-000143e0: 2020 2020 2320 4163 740a 2020 2020 2020      # Act.      
-000143f0: 2020 7072 6f67 7265 7373 203d 205b 5d0a    progress = [].
-00014400: 2020 2020 2020 2020 6465 6620 6361 6c6c          def call
-00014410: 6261 636b 2872 6573 706f 6e73 6529 3a0a  back(response):.
-00014420: 2020 2020 2020 2020 2020 2020 6375 7272              curr
-00014430: 656e 7420 3d20 7265 7370 6f6e 7365 2e63  ent = response.c
-00014440: 6f6e 7465 7874 5b27 7570 6c6f 6164 5f73  ontext['upload_s
-00014450: 7472 6561 6d5f 6375 7272 656e 7427 5d0a  tream_current'].
-00014460: 2020 2020 2020 2020 2020 2020 746f 7461              tota
-00014470: 6c20 3d20 7265 7370 6f6e 7365 2e63 6f6e  l = response.con
-00014480: 7465 7874 5b27 6461 7461 5f73 7472 6561  text['data_strea
-00014490: 6d5f 746f 7461 6c27 5d0a 2020 2020 2020  m_total'].      
-000144a0: 2020 2020 2020 6966 2063 7572 7265 6e74        if current
-000144b0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-000144c0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-000144d0: 6f67 7265 7373 2e61 7070 656e 6428 2863  ogress.append((c
-000144e0: 7572 7265 6e74 2c20 746f 7461 6c29 290a  urrent, total)).
-000144f0: 0a20 2020 2020 2020 2077 6974 6820 6f70  .        with op
-00014500: 656e 2849 4e50 5554 5f46 494c 455f 5041  en(INPUT_FILE_PA
-00014510: 5448 2c20 2772 6227 2920 6173 2073 7472  TH, 'rb') as str
-00014520: 6561 6d3a 0a20 2020 2020 2020 2020 2020  eam:.           
-00014530: 2072 6573 706f 6e73 6520 3d20 6177 6169   response = awai
-00014540: 7420 6669 6c65 5f63 6c69 656e 742e 7570  t file_client.up
-00014550: 6c6f 6164 5f66 696c 6528 7374 7265 616d  load_file(stream
-00014560: 2c20 6d61 785f 636f 6e63 7572 7265 6e63  , max_concurrenc
-00014570: 793d 322c 2072 6177 5f72 6573 706f 6e73  y=2, raw_respons
-00014580: 655f 686f 6f6b 3d63 616c 6c62 6163 6b29  e_hook=callback)
-00014590: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
-000145a0: 6572 7420 6973 696e 7374 616e 6365 2872  ert isinstance(r
-000145b0: 6573 706f 6e73 652c 2064 6963 7429 0a20  esponse, dict). 
-000145c0: 2020 2020 2020 2020 2020 2061 7373 6572             asser
-000145d0: 7420 276c 6173 745f 6d6f 6469 6669 6564  t 'last_modified
-000145e0: 2720 696e 2072 6573 706f 6e73 650a 2020  ' in response.  
-000145f0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-00014600: 2027 6574 6167 2720 696e 2072 6573 706f   'etag' in respo
-00014610: 6e73 650a 0a20 2020 2020 2020 2023 2041  nse..        # A
-00014620: 7373 6572 740a 2020 2020 2020 2020 6177  ssert.        aw
-00014630: 6169 7420 7365 6c66 2e61 7373 6572 7446  ait self.assertF
-00014640: 696c 6545 7175 616c 2866 696c 655f 636c  ileEqual(file_cl
-00014650: 6965 6e74 2c20 6461 7461 290a 2020 2020  ient, data).    
-00014660: 2020 2020 7365 6c66 2e61 7373 6572 745f      self.assert_
-00014670: 7570 6c6f 6164 5f70 726f 6772 6573 7328  upload_progress(
-00014680: 0a20 2020 2020 2020 2020 2020 206c 656e  .            len
-00014690: 2864 6174 6129 2c0a 2020 2020 2020 2020  (data),.        
-000146a0: 2020 2020 7365 6c66 2e66 7363 2e5f 636f      self.fsc._co
-000146b0: 6e66 6967 2e6d 6178 5f72 616e 6765 5f73  nfig.max_range_s
-000146c0: 697a 652c 0a20 2020 2020 2020 2020 2020  ize,.           
-000146d0: 2070 726f 6772 6573 732c 2075 6e6b 6e6f   progress, unkno
-000146e0: 776e 5f73 697a 653d 4661 6c73 6529 0a20  wn_size=False). 
-000146f0: 2020 2020 2020 2073 656c 662e 5f74 6561         self._tea
-00014700: 7264 6f77 6e28 494e 5055 545f 4649 4c45  rdown(INPUT_FILE
-00014710: 5f50 4154 4829 0a0a 2020 2020 4046 696c  _PATH)..    @Fil
-00014720: 6553 6861 7265 5072 6570 6172 6572 2829  eSharePreparer()
-00014730: 0a20 2020 2040 4173 796e 6353 746f 7261  .    @AsyncStora
-00014740: 6765 5465 7374 4361 7365 2e61 7761 6974  geTestCase.await
-00014750: 5f70 7265 7061 7265 645f 7465 7374 0a20  _prepared_test. 
-00014760: 2020 2061 7379 6e63 2064 6566 2074 6573     async def tes
-00014770: 745f 6372 6561 7465 5f66 696c 655f 6672  t_create_file_fr
-00014780: 6f6d 5f73 7472 6561 6d5f 6173 796e 6328  om_stream_async(
-00014790: 7365 6c66 2c20 7374 6f72 6167 655f 6163  self, storage_ac
-000147a0: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
-000147b0: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
-000147c0: 3a0a 2020 2020 2020 2020 2320 7061 7261  :.        # para
-000147d0: 6c6c 656c 2074 6573 7473 2069 6e74 726f  llel tests intro
-000147e0: 6475 6365 2072 616e 646f 6d20 6f72 6465  duce random orde
-000147f0: 7220 6f66 2072 6571 7565 7374 732c 2063  r of requests, c
-00014800: 616e 206f 6e6c 7920 7275 6e20 6c69 7665  an only run live
-00014810: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00014820: 7365 6c66 2e69 735f 6c69 7665 3a0a 2020  self.is_live:.  
-00014830: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00014840: 0a0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
-00014850: 7365 7475 7028 7374 6f72 6167 655f 6163  setup(storage_ac
-00014860: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
-00014870: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
-00014880: 0a20 2020 2020 2020 2066 696c 655f 6e61  .        file_na
-00014890: 6d65 203d 2073 656c 662e 5f67 6574 5f66  me = self._get_f
-000148a0: 696c 655f 7265 6665 7265 6e63 6528 290a  ile_reference().
-000148b0: 2020 2020 2020 2020 6177 6169 7420 7365          await se
-000148c0: 6c66 2e5f 7365 7475 705f 7368 6172 6528  lf._setup_share(
-000148d0: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-000148e0: 6e61 6d65 2c20 7374 6f72 6167 655f 6163  name, storage_ac
-000148f0: 636f 756e 745f 6b65 7929 0a20 2020 2020  count_key).     
-00014900: 2020 2064 6174 6120 3d20 7365 6c66 2e67     data = self.g
-00014910: 6574 5f72 616e 646f 6d5f 6279 7465 7328  et_random_bytes(
-00014920: 4c41 5247 455f 4649 4c45 5f53 495a 4529  LARGE_FILE_SIZE)
-00014930: 0a20 2020 2020 2020 2077 6974 6820 6f70  .        with op
-00014940: 656e 2849 4e50 5554 5f46 494c 455f 5041  en(INPUT_FILE_PA
-00014950: 5448 2c20 2777 6227 2920 6173 2073 7472  TH, 'wb') as str
-00014960: 6561 6d3a 0a20 2020 2020 2020 2020 2020  eam:.           
-00014970: 2073 7472 6561 6d2e 7772 6974 6528 6461   stream.write(da
-00014980: 7461 290a 2020 2020 2020 2020 6669 6c65  ta).        file
-00014990: 5f63 6c69 656e 7420 3d20 5368 6172 6546  _client = ShareF
-000149a0: 696c 6543 6c69 656e 7428 0a20 2020 2020  ileClient(.     
-000149b0: 2020 2020 2020 2073 656c 662e 6163 636f         self.acco
-000149c0: 756e 745f 7572 6c28 7374 6f72 6167 655f  unt_url(storage_
-000149d0: 6163 636f 756e 745f 6e61 6d65 2c20 2266  account_name, "f
-000149e0: 696c 6522 292c 0a20 2020 2020 2020 2020  ile"),.         
-000149f0: 2020 2073 6861 7265 5f6e 616d 653d 7365     share_name=se
-00014a00: 6c66 2e73 6861 7265 5f6e 616d 652c 0a20  lf.share_name,. 
-00014a10: 2020 2020 2020 2020 2020 2066 696c 655f             file_
-00014a20: 7061 7468 3d66 696c 655f 6e61 6d65 2c0a  path=file_name,.
-00014a30: 2020 2020 2020 2020 2020 2020 6372 6564              cred
-00014a40: 656e 7469 616c 3d73 746f 7261 6765 5f61  ential=storage_a
-00014a50: 6363 6f75 6e74 5f6b 6579 2c0a 2020 2020  ccount_key,.    
-00014a60: 2020 2020 2020 2020 6d61 785f 7261 6e67          max_rang
-00014a70: 655f 7369 7a65 3d34 202a 2031 3032 3429  e_size=4 * 1024)
-00014a80: 0a0a 2020 2020 2020 2020 2320 4163 740a  ..        # Act.
-00014a90: 2020 2020 2020 2020 6669 6c65 5f73 697a          file_siz
-00014aa0: 6520 3d20 6c65 6e28 6461 7461 290a 2020  e = len(data).  
-00014ab0: 2020 2020 2020 7769 7468 206f 7065 6e28        with open(
-00014ac0: 494e 5055 545f 4649 4c45 5f50 4154 482c  INPUT_FILE_PATH,
-00014ad0: 2027 7262 2729 2061 7320 7374 7265 616d   'rb') as stream
-00014ae0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00014af0: 7370 6f6e 7365 203d 2061 7761 6974 2066  sponse = await f
-00014b00: 696c 655f 636c 6965 6e74 2e75 706c 6f61  ile_client.uploa
-00014b10: 645f 6669 6c65 2873 7472 6561 6d2c 206d  d_file(stream, m
-00014b20: 6178 5f63 6f6e 6375 7272 656e 6379 3d32  ax_concurrency=2
-00014b30: 290a 2020 2020 2020 2020 2020 2020 6173  ).            as
-00014b40: 7365 7274 2069 7369 6e73 7461 6e63 6528  sert isinstance(
-00014b50: 7265 7370 6f6e 7365 2c20 6469 6374 290a  response, dict).
-00014b60: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-00014b70: 7274 2027 6c61 7374 5f6d 6f64 6966 6965  rt 'last_modifie
-00014b80: 6427 2069 6e20 7265 7370 6f6e 7365 0a20  d' in response. 
-00014b90: 2020 2020 2020 2020 2020 2061 7373 6572             asser
-00014ba0: 7420 2765 7461 6727 2069 6e20 7265 7370  t 'etag' in resp
-00014bb0: 6f6e 7365 0a0a 2020 2020 2020 2020 2320  onse..        # 
-00014bc0: 4173 7365 7274 0a20 2020 2020 2020 2061  Assert.        a
-00014bd0: 7761 6974 2073 656c 662e 6173 7365 7274  wait self.assert
-00014be0: 4669 6c65 4571 7561 6c28 6669 6c65 5f63  FileEqual(file_c
-00014bf0: 6c69 656e 742c 2064 6174 615b 3a66 696c  lient, data[:fil
-00014c00: 655f 7369 7a65 5d29 0a20 2020 2020 2020  e_size]).       
-00014c10: 2073 656c 662e 5f74 6561 7264 6f77 6e28   self._teardown(
-00014c20: 494e 5055 545f 4649 4c45 5f50 4154 4829  INPUT_FILE_PATH)
-00014c30: 0a0a 2020 2020 4046 696c 6553 6861 7265  ..    @FileShare
-00014c40: 5072 6570 6172 6572 2829 0a20 2020 2040  Preparer().    @
-00014c50: 4173 796e 6353 746f 7261 6765 5465 7374  AsyncStorageTest
-00014c60: 4361 7365 2e61 7761 6974 5f70 7265 7061  Case.await_prepa
-00014c70: 7265 645f 7465 7374 0a20 2020 2061 7379  red_test.    asy
-00014c80: 6e63 2064 6566 2074 6573 745f 6372 6561  nc def test_crea
-00014c90: 7465 5f66 696c 655f 6672 6f6d 5f73 7472  te_file_from_str
-00014ca0: 6561 6d5f 6e6f 6e5f 7365 656b 6162 6c65  eam_non_seekable
-00014cb0: 5f61 7379 6e63 2873 656c 662c 2073 746f  _async(self, sto
-00014cc0: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
-00014cd0: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
-00014ce0: 6e74 5f6b 6579 293a 0a20 2020 2020 2020  nt_key):.       
-00014cf0: 2023 2070 6172 616c 6c65 6c20 7465 7374   # parallel test
-00014d00: 7320 696e 7472 6f64 7563 6520 7261 6e64  s introduce rand
-00014d10: 6f6d 206f 7264 6572 206f 6620 7265 7175  om order of requ
-00014d20: 6573 7473 2c20 6361 6e20 6f6e 6c79 2072  ests, can only r
-00014d30: 756e 206c 6976 650a 2020 2020 2020 2020  un live.        
-00014d40: 6966 206e 6f74 2073 656c 662e 6973 5f6c  if not self.is_l
-00014d50: 6976 653a 0a20 2020 2020 2020 2020 2020  ive:.           
-00014d60: 2072 6574 7572 6e0a 0a20 2020 2020 2020   return..       
-00014d70: 2073 656c 662e 5f73 6574 7570 2873 746f   self._setup(sto
-00014d80: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
-00014d90: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
-00014da0: 6e74 5f6b 6579 290a 2020 2020 2020 2020  nt_key).        
-00014db0: 6669 6c65 5f6e 616d 6520 3d20 7365 6c66  file_name = self
-00014dc0: 2e5f 6765 745f 6669 6c65 5f72 6566 6572  ._get_file_refer
-00014dd0: 656e 6365 2829 0a20 2020 2020 2020 2061  ence().        a
-00014de0: 7761 6974 2073 656c 662e 5f73 6574 7570  wait self._setup
-00014df0: 5f73 6861 7265 2873 746f 7261 6765 5f61  _share(storage_a
-00014e00: 6363 6f75 6e74 5f6e 616d 652c 2073 746f  ccount_name, sto
-00014e10: 7261 6765 5f61 6363 6f75 6e74 5f6b 6579  rage_account_key
-00014e20: 290a 2020 2020 2020 2020 6461 7461 203d  ).        data =
-00014e30: 2073 656c 662e 6765 745f 7261 6e64 6f6d   self.get_random
-00014e40: 5f62 7974 6573 284c 4152 4745 5f46 494c  _bytes(LARGE_FIL
-00014e50: 455f 5349 5a45 290a 2020 2020 2020 2020  E_SIZE).        
-00014e60: 7769 7468 206f 7065 6e28 494e 5055 545f  with open(INPUT_
-00014e70: 4649 4c45 5f50 4154 482c 2027 7762 2729  FILE_PATH, 'wb')
-00014e80: 2061 7320 7374 7265 616d 3a0a 2020 2020   as stream:.    
-00014e90: 2020 2020 2020 2020 7374 7265 616d 2e77          stream.w
-00014ea0: 7269 7465 2864 6174 6129 0a20 2020 2020  rite(data).     
-00014eb0: 2020 2066 696c 655f 636c 6965 6e74 203d     file_client =
-00014ec0: 2053 6861 7265 4669 6c65 436c 6965 6e74   ShareFileClient
-00014ed0: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
-00014ee0: 6c66 2e61 6363 6f75 6e74 5f75 726c 2873  lf.account_url(s
-00014ef0: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
-00014f00: 616d 652c 2022 6669 6c65 2229 2c0a 2020  ame, "file"),.  
-00014f10: 2020 2020 2020 2020 2020 7368 6172 655f            share_
-00014f20: 6e61 6d65 3d73 656c 662e 7368 6172 655f  name=self.share_
-00014f30: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
-00014f40: 2020 6669 6c65 5f70 6174 683d 6669 6c65    file_path=file
-00014f50: 5f6e 616d 652c 0a20 2020 2020 2020 2020  _name,.         
-00014f60: 2020 2063 7265 6465 6e74 6961 6c3d 7374     credential=st
-00014f70: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
-00014f80: 792c 0a20 2020 2020 2020 2020 2020 206d  y,.            m
-00014f90: 6178 5f72 616e 6765 5f73 697a 653d 3420  ax_range_size=4 
-00014fa0: 2a20 3130 3234 290a 0a20 2020 2020 2020  * 1024)..       
-00014fb0: 2023 2041 6374 0a20 2020 2020 2020 2066   # Act.        f
-00014fc0: 696c 655f 7369 7a65 203d 206c 656e 2864  ile_size = len(d
-00014fd0: 6174 6129 0a20 2020 2020 2020 2077 6974  ata).        wit
-00014fe0: 6820 6f70 656e 2849 4e50 5554 5f46 494c  h open(INPUT_FIL
-00014ff0: 455f 5041 5448 2c20 2772 6227 2920 6173  E_PATH, 'rb') as
-00015000: 2073 7472 6561 6d3a 0a20 2020 2020 2020   stream:.       
-00015010: 2020 2020 206e 6f6e 5f73 6565 6b61 626c       non_seekabl
-00015020: 655f 6669 6c65 203d 2053 746f 7261 6765  e_file = Storage
-00015030: 4669 6c65 4173 796e 6354 6573 742e 4e6f  FileAsyncTest.No
-00015040: 6e53 6565 6b61 626c 6546 696c 6528 7374  nSeekableFile(st
-00015050: 7265 616d 290a 2020 2020 2020 2020 2020  ream).          
-00015060: 2020 6177 6169 7420 6669 6c65 5f63 6c69    await file_cli
-00015070: 656e 742e 7570 6c6f 6164 5f66 696c 6528  ent.upload_file(
-00015080: 6e6f 6e5f 7365 656b 6162 6c65 5f66 696c  non_seekable_fil
-00015090: 652c 206c 656e 6774 683d 6669 6c65 5f73  e, length=file_s
-000150a0: 697a 652c 206d 6178 5f63 6f6e 6375 7272  ize, max_concurr
-000150b0: 656e 6379 3d31 290a 0a20 2020 2020 2020  ency=1)..       
-000150c0: 2023 2041 7373 6572 740a 2020 2020 2020   # Assert.      
-000150d0: 2020 6177 6169 7420 7365 6c66 2e61 7373    await self.ass
-000150e0: 6572 7446 696c 6545 7175 616c 2866 696c  ertFileEqual(fil
-000150f0: 655f 636c 6965 6e74 2c20 6461 7461 5b3a  e_client, data[:
-00015100: 6669 6c65 5f73 697a 655d 290a 2020 2020  file_size]).    
-00015110: 2020 2020 7365 6c66 2e5f 7465 6172 646f      self._teardo
-00015120: 776e 2849 4e50 5554 5f46 494c 455f 5041  wn(INPUT_FILE_PA
-00015130: 5448 290a 0a20 2020 2040 4669 6c65 5368  TH)..    @FileSh
-00015140: 6172 6550 7265 7061 7265 7228 290a 2020  arePreparer().  
-00015150: 2020 4041 7379 6e63 5374 6f72 6167 6554    @AsyncStorageT
-00015160: 6573 7443 6173 652e 6177 6169 745f 7072  estCase.await_pr
-00015170: 6570 6172 6564 5f74 6573 740a 2020 2020  epared_test.    
-00015180: 6173 796e 6320 6465 6620 7465 7374 5f63  async def test_c
-00015190: 7265 6174 655f 6669 6c65 5f66 726f 6d5f  reate_file_from_
-000151a0: 7374 7265 616d 5f77 6974 685f 7072 6f67  stream_with_prog
-000151b0: 7265 7373 5f61 7379 6e63 2873 656c 662c  ress_async(self,
-000151c0: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
-000151d0: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
-000151e0: 6363 6f75 6e74 5f6b 6579 293a 0a20 2020  ccount_key):.   
-000151f0: 2020 2020 2023 2070 6172 616c 6c65 6c20       # parallel 
-00015200: 7465 7374 7320 696e 7472 6f64 7563 6520  tests introduce 
-00015210: 7261 6e64 6f6d 206f 7264 6572 206f 6620  random order of 
-00015220: 7265 7175 6573 7473 2c20 6361 6e20 6f6e  requests, can on
-00015230: 6c79 2072 756e 206c 6976 650a 2020 2020  ly run live.    
-00015240: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
-00015250: 6973 5f6c 6976 653a 0a20 2020 2020 2020  is_live:.       
-00015260: 2020 2020 2072 6574 7572 6e0a 0a20 2020       return..   
-00015270: 2020 2020 2073 656c 662e 5f73 6574 7570       self._setup
-00015280: 2873 746f 7261 6765 5f61 6363 6f75 6e74  (storage_account
-00015290: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
-000152a0: 6363 6f75 6e74 5f6b 6579 290a 2020 2020  ccount_key).    
-000152b0: 2020 2020 6669 6c65 5f6e 616d 6520 3d20      file_name = 
-000152c0: 7365 6c66 2e5f 6765 745f 6669 6c65 5f72  self._get_file_r
-000152d0: 6566 6572 656e 6365 2829 0a20 2020 2020  eference().     
-000152e0: 2020 2061 7761 6974 2073 656c 662e 5f73     await self._s
-000152f0: 6574 7570 5f73 6861 7265 2873 746f 7261  etup_share(stora
-00015300: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
-00015310: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
-00015320: 5f6b 6579 290a 2020 2020 2020 2020 6461  _key).        da
-00015330: 7461 203d 2073 656c 662e 6765 745f 7261  ta = self.get_ra
-00015340: 6e64 6f6d 5f62 7974 6573 284c 4152 4745  ndom_bytes(LARGE
-00015350: 5f46 494c 455f 5349 5a45 290a 2020 2020  _FILE_SIZE).    
-00015360: 2020 2020 7769 7468 206f 7065 6e28 494e      with open(IN
-00015370: 5055 545f 4649 4c45 5f50 4154 482c 2027  PUT_FILE_PATH, '
-00015380: 7762 2729 2061 7320 7374 7265 616d 3a0a  wb') as stream:.
-00015390: 2020 2020 2020 2020 2020 2020 7374 7265              stre
-000153a0: 616d 2e77 7269 7465 2864 6174 6129 0a20  am.write(data). 
-000153b0: 2020 2020 2020 2066 696c 655f 636c 6965         file_clie
-000153c0: 6e74 203d 2053 6861 7265 4669 6c65 436c  nt = ShareFileCl
-000153d0: 6965 6e74 280a 2020 2020 2020 2020 2020  ient(.          
-000153e0: 2020 7365 6c66 2e61 6363 6f75 6e74 5f75    self.account_u
-000153f0: 726c 2873 746f 7261 6765 5f61 6363 6f75  rl(storage_accou
-00015400: 6e74 5f6e 616d 652c 2022 6669 6c65 2229  nt_name, "file")
-00015410: 2c0a 2020 2020 2020 2020 2020 2020 7368  ,.            sh
-00015420: 6172 655f 6e61 6d65 3d73 656c 662e 7368  are_name=self.sh
-00015430: 6172 655f 6e61 6d65 2c0a 2020 2020 2020  are_name,.      
-00015440: 2020 2020 2020 6669 6c65 5f70 6174 683d        file_path=
-00015450: 6669 6c65 5f6e 616d 652c 0a20 2020 2020  file_name,.     
-00015460: 2020 2020 2020 2063 7265 6465 6e74 6961         credentia
-00015470: 6c3d 7374 6f72 6167 655f 6163 636f 756e  l=storage_accoun
-00015480: 745f 6b65 792c 0a20 2020 2020 2020 2020  t_key,.         
-00015490: 2020 206d 6178 5f72 616e 6765 5f73 697a     max_range_siz
-000154a0: 653d 3420 2a20 3130 3234 290a 0a20 2020  e=4 * 1024)..   
-000154b0: 2020 2020 2023 2041 6374 0a20 2020 2020       # Act.     
-000154c0: 2020 2070 726f 6772 6573 7320 3d20 5b5d     progress = []
-000154d0: 0a20 2020 2020 2020 2064 6566 2063 616c  .        def cal
-000154e0: 6c62 6163 6b28 7265 7370 6f6e 7365 293a  lback(response):
-000154f0: 0a20 2020 2020 2020 2020 2020 2063 7572  .            cur
-00015500: 7265 6e74 203d 2072 6573 706f 6e73 652e  rent = response.
-00015510: 636f 6e74 6578 745b 2775 706c 6f61 645f  context['upload_
-00015520: 7374 7265 616d 5f63 7572 7265 6e74 275d  stream_current']
-00015530: 0a20 2020 2020 2020 2020 2020 2074 6f74  .            tot
-00015540: 616c 203d 2072 6573 706f 6e73 652e 636f  al = response.co
-00015550: 6e74 6578 745b 2764 6174 615f 7374 7265  ntext['data_stre
-00015560: 616d 5f74 6f74 616c 275d 0a20 2020 2020  am_total'].     
-00015570: 2020 2020 2020 2069 6620 6375 7272 656e         if curren
-00015580: 7420 6973 206e 6f74 204e 6f6e 653a 0a20  t is not None:. 
-00015590: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000155a0: 726f 6772 6573 732e 6170 7065 6e64 2828  rogress.append((
-000155b0: 6375 7272 656e 742c 2074 6f74 616c 2929  current, total))
-000155c0: 0a0a 2020 2020 2020 2020 6669 6c65 5f73  ..        file_s
-000155d0: 697a 6520 3d20 6c65 6e28 6461 7461 290a  ize = len(data).
-000155e0: 2020 2020 2020 2020 7769 7468 206f 7065          with ope
-000155f0: 6e28 494e 5055 545f 4649 4c45 5f50 4154  n(INPUT_FILE_PAT
-00015600: 482c 2027 7262 2729 2061 7320 7374 7265  H, 'rb') as stre
-00015610: 616d 3a0a 2020 2020 2020 2020 2020 2020  am:.            
-00015620: 6177 6169 7420 6669 6c65 5f63 6c69 656e  await file_clien
-00015630: 742e 7570 6c6f 6164 5f66 696c 6528 7374  t.upload_file(st
-00015640: 7265 616d 2c20 6d61 785f 636f 6e63 7572  ream, max_concur
-00015650: 7265 6e63 793d 322c 2072 6177 5f72 6573  rency=2, raw_res
-00015660: 706f 6e73 655f 686f 6f6b 3d63 616c 6c62  ponse_hook=callb
-00015670: 6163 6b29 0a0a 2020 2020 2020 2020 2320  ack)..        # 
-00015680: 4173 7365 7274 0a20 2020 2020 2020 2061  Assert.        a
-00015690: 7761 6974 2073 656c 662e 6173 7365 7274  wait self.assert
-000156a0: 4669 6c65 4571 7561 6c28 6669 6c65 5f63  FileEqual(file_c
-000156b0: 6c69 656e 742c 2064 6174 615b 3a66 696c  lient, data[:fil
-000156c0: 655f 7369 7a65 5d29 0a20 2020 2020 2020  e_size]).       
-000156d0: 2073 656c 662e 6173 7365 7274 5f75 706c   self.assert_upl
-000156e0: 6f61 645f 7072 6f67 7265 7373 280a 2020  oad_progress(.  
-000156f0: 2020 2020 2020 2020 2020 6c65 6e28 6461            len(da
-00015700: 7461 292c 0a20 2020 2020 2020 2020 2020  ta),.           
-00015710: 2073 656c 662e 6673 632e 5f63 6f6e 6669   self.fsc._confi
-00015720: 672e 6d61 785f 7261 6e67 655f 7369 7a65  g.max_range_size
-00015730: 2c0a 2020 2020 2020 2020 2020 2020 7072  ,.            pr
-00015740: 6f67 7265 7373 2c20 756e 6b6e 6f77 6e5f  ogress, unknown_
-00015750: 7369 7a65 3d46 616c 7365 290a 2020 2020  size=False).    
-00015760: 2020 2020 7365 6c66 2e5f 7465 6172 646f      self._teardo
-00015770: 776e 2849 4e50 5554 5f46 494c 455f 5041  wn(INPUT_FILE_PA
-00015780: 5448 290a 0a20 2020 2040 4669 6c65 5368  TH)..    @FileSh
-00015790: 6172 6550 7265 7061 7265 7228 290a 2020  arePreparer().  
-000157a0: 2020 4041 7379 6e63 5374 6f72 6167 6554    @AsyncStorageT
-000157b0: 6573 7443 6173 652e 6177 6169 745f 7072  estCase.await_pr
-000157c0: 6570 6172 6564 5f74 6573 740a 2020 2020  epared_test.    
-000157d0: 6173 796e 6320 6465 6620 7465 7374 5f63  async def test_c
-000157e0: 7265 6174 655f 6669 6c65 5f66 726f 6d5f  reate_file_from_
-000157f0: 7374 7265 616d 5f74 7275 6e63 6174 6564  stream_truncated
-00015800: 5f61 7379 6e63 2873 656c 662c 2073 746f  _async(self, sto
-00015810: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
-00015820: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
-00015830: 6e74 5f6b 6579 293a 0a20 2020 2020 2020  nt_key):.       
-00015840: 2023 2070 6172 616c 6c65 6c20 7465 7374   # parallel test
-00015850: 7320 696e 7472 6f64 7563 6520 7261 6e64  s introduce rand
-00015860: 6f6d 206f 7264 6572 206f 6620 7265 7175  om order of requ
-00015870: 6573 7473 2c20 6361 6e20 6f6e 6c79 2072  ests, can only r
-00015880: 756e 206c 6976 650a 2020 2020 2020 2020  un live.        
-00015890: 6966 206e 6f74 2073 656c 662e 6973 5f6c  if not self.is_l
-000158a0: 6976 653a 0a20 2020 2020 2020 2020 2020  ive:.           
-000158b0: 2072 6574 7572 6e0a 0a20 2020 2020 2020   return..       
-000158c0: 2073 656c 662e 5f73 6574 7570 2873 746f   self._setup(sto
-000158d0: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
-000158e0: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
-000158f0: 6e74 5f6b 6579 290a 2020 2020 2020 2020  nt_key).        
-00015900: 6669 6c65 5f6e 616d 6520 3d20 7365 6c66  file_name = self
-00015910: 2e5f 6765 745f 6669 6c65 5f72 6566 6572  ._get_file_refer
-00015920: 656e 6365 2829 0a20 2020 2020 2020 2061  ence().        a
-00015930: 7761 6974 2073 656c 662e 5f73 6574 7570  wait self._setup
-00015940: 5f73 6861 7265 2873 746f 7261 6765 5f61  _share(storage_a
-00015950: 6363 6f75 6e74 5f6e 616d 652c 2073 746f  ccount_name, sto
-00015960: 7261 6765 5f61 6363 6f75 6e74 5f6b 6579  rage_account_key
-00015970: 290a 2020 2020 2020 2020 6461 7461 203d  ).        data =
-00015980: 2073 656c 662e 6765 745f 7261 6e64 6f6d   self.get_random
-00015990: 5f62 7974 6573 284c 4152 4745 5f46 494c  _bytes(LARGE_FIL
-000159a0: 455f 5349 5a45 290a 2020 2020 2020 2020  E_SIZE).        
-000159b0: 7769 7468 206f 7065 6e28 494e 5055 545f  with open(INPUT_
-000159c0: 4649 4c45 5f50 4154 482c 2027 7762 2729  FILE_PATH, 'wb')
-000159d0: 2061 7320 7374 7265 616d 3a0a 2020 2020   as stream:.    
-000159e0: 2020 2020 2020 2020 7374 7265 616d 2e77          stream.w
-000159f0: 7269 7465 2864 6174 6129 0a20 2020 2020  rite(data).     
-00015a00: 2020 2066 696c 655f 636c 6965 6e74 203d     file_client =
-00015a10: 2053 6861 7265 4669 6c65 436c 6965 6e74   ShareFileClient
-00015a20: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
-00015a30: 6c66 2e61 6363 6f75 6e74 5f75 726c 2873  lf.account_url(s
-00015a40: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
-00015a50: 616d 652c 2022 6669 6c65 2229 2c0a 2020  ame, "file"),.  
-00015a60: 2020 2020 2020 2020 2020 7368 6172 655f            share_
-00015a70: 6e61 6d65 3d73 656c 662e 7368 6172 655f  name=self.share_
-00015a80: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
-00015a90: 2020 6669 6c65 5f70 6174 683d 6669 6c65    file_path=file
-00015aa0: 5f6e 616d 652c 0a20 2020 2020 2020 2020  _name,.         
-00015ab0: 2020 2063 7265 6465 6e74 6961 6c3d 7374     credential=st
-00015ac0: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
-00015ad0: 792c 0a20 2020 2020 2020 2020 2020 206d  y,.            m
-00015ae0: 6178 5f72 616e 6765 5f73 697a 653d 3420  ax_range_size=4 
-00015af0: 2a20 3130 3234 290a 0a20 2020 2020 2020  * 1024)..       
-00015b00: 2023 2041 6374 0a20 2020 2020 2020 2066   # Act.        f
-00015b10: 696c 655f 7369 7a65 203d 206c 656e 2864  ile_size = len(d
-00015b20: 6174 6129 202d 2035 3132 0a20 2020 2020  ata) - 512.     
-00015b30: 2020 2077 6974 6820 6f70 656e 2849 4e50     with open(INP
-00015b40: 5554 5f46 494c 455f 5041 5448 2c20 2772  UT_FILE_PATH, 'r
-00015b50: 6227 2920 6173 2073 7472 6561 6d3a 0a20  b') as stream:. 
-00015b60: 2020 2020 2020 2020 2020 2061 7761 6974             await
-00015b70: 2066 696c 655f 636c 6965 6e74 2e75 706c   file_client.upl
-00015b80: 6f61 645f 6669 6c65 2873 7472 6561 6d2c  oad_file(stream,
-00015b90: 206c 656e 6774 683d 6669 6c65 5f73 697a   length=file_siz
-00015ba0: 652c 206d 6178 5f63 6f6e 6375 7272 656e  e, max_concurren
-00015bb0: 6379 3d34 290a 0a20 2020 2020 2020 2023  cy=4)..        #
-00015bc0: 2041 7373 6572 740a 2020 2020 2020 2020   Assert.        
-00015bd0: 6177 6169 7420 7365 6c66 2e61 7373 6572  await self.asser
-00015be0: 7446 696c 6545 7175 616c 2866 696c 655f  tFileEqual(file_
-00015bf0: 636c 6965 6e74 2c20 6461 7461 5b3a 6669  client, data[:fi
-00015c00: 6c65 5f73 697a 655d 290a 2020 2020 2020  le_size]).      
-00015c10: 2020 7365 6c66 2e5f 7465 6172 646f 776e    self._teardown
-00015c20: 2849 4e50 5554 5f46 494c 455f 5041 5448  (INPUT_FILE_PATH
-00015c30: 290a 0a20 2020 2040 4669 6c65 5368 6172  )..    @FileShar
-00015c40: 6550 7265 7061 7265 7228 290a 2020 2020  ePreparer().    
-00015c50: 4041 7379 6e63 5374 6f72 6167 6554 6573  @AsyncStorageTes
-00015c60: 7443 6173 652e 6177 6169 745f 7072 6570  tCase.await_prep
-00015c70: 6172 6564 5f74 6573 740a 2020 2020 6173  ared_test.    as
-00015c80: 796e 6320 6465 6620 7465 7374 5f63 7265  ync def test_cre
-00015c90: 6174 655f 6669 6c65 5f66 726f 6d5f 7374  ate_file_from_st
-00015ca0: 7265 616d 5f77 6974 685f 7072 6f67 7265  ream_with_progre
-00015cb0: 7373 5f74 7275 6e63 6174 6564 5f61 7379  ss_truncated_asy
-00015cc0: 6e63 2873 656c 662c 2073 746f 7261 6765  nc(self, storage
-00015cd0: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
-00015ce0: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
-00015cf0: 6579 293a 0a20 2020 2020 2020 2023 2070  ey):.        # p
-00015d00: 6172 616c 6c65 6c20 7465 7374 7320 696e  arallel tests in
-00015d10: 7472 6f64 7563 6520 7261 6e64 6f6d 206f  troduce random o
-00015d20: 7264 6572 206f 6620 7265 7175 6573 7473  rder of requests
-00015d30: 2c20 6361 6e20 6f6e 6c79 2072 756e 206c  , can only run l
-00015d40: 6976 650a 2020 2020 2020 2020 6966 206e  ive.        if n
-00015d50: 6f74 2073 656c 662e 6973 5f6c 6976 653a  ot self.is_live:
-00015d60: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00015d70: 7572 6e0a 0a20 2020 2020 2020 2073 656c  urn..        sel
-00015d80: 662e 5f73 6574 7570 2873 746f 7261 6765  f._setup(storage
-00015d90: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
-00015da0: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
-00015db0: 6579 290a 2020 2020 2020 2020 6669 6c65  ey).        file
-00015dc0: 5f6e 616d 6520 3d20 7365 6c66 2e5f 6765  _name = self._ge
-00015dd0: 745f 6669 6c65 5f72 6566 6572 656e 6365  t_file_reference
-00015de0: 2829 0a20 2020 2020 2020 2061 7761 6974  ().        await
-00015df0: 2073 656c 662e 5f73 6574 7570 5f73 6861   self._setup_sha
-00015e00: 7265 2873 746f 7261 6765 5f61 6363 6f75  re(storage_accou
-00015e10: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
-00015e20: 5f61 6363 6f75 6e74 5f6b 6579 290a 2020  _account_key).  
-00015e30: 2020 2020 2020 6461 7461 203d 2073 656c        data = sel
-00015e40: 662e 6765 745f 7261 6e64 6f6d 5f62 7974  f.get_random_byt
-00015e50: 6573 284c 4152 4745 5f46 494c 455f 5349  es(LARGE_FILE_SI
-00015e60: 5a45 290a 2020 2020 2020 2020 7769 7468  ZE).        with
-00015e70: 206f 7065 6e28 494e 5055 545f 4649 4c45   open(INPUT_FILE
-00015e80: 5f50 4154 482c 2027 7762 2729 2061 7320  _PATH, 'wb') as 
-00015e90: 7374 7265 616d 3a0a 2020 2020 2020 2020  stream:.        
-00015ea0: 2020 2020 7374 7265 616d 2e77 7269 7465      stream.write
-00015eb0: 2864 6174 6129 0a20 2020 2020 2020 2066  (data).        f
-00015ec0: 696c 655f 636c 6965 6e74 203d 2053 6861  ile_client = Sha
-00015ed0: 7265 4669 6c65 436c 6965 6e74 280a 2020  reFileClient(.  
-00015ee0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00015ef0: 6363 6f75 6e74 5f75 726c 2873 746f 7261  ccount_url(stora
-00015f00: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
-00015f10: 2022 6669 6c65 2229 2c0a 2020 2020 2020   "file"),.      
-00015f20: 2020 2020 2020 7368 6172 655f 6e61 6d65        share_name
-00015f30: 3d73 656c 662e 7368 6172 655f 6e61 6d65  =self.share_name
-00015f40: 2c0a 2020 2020 2020 2020 2020 2020 6669  ,.            fi
-00015f50: 6c65 5f70 6174 683d 6669 6c65 5f6e 616d  le_path=file_nam
-00015f60: 652c 0a20 2020 2020 2020 2020 2020 2063  e,.            c
-00015f70: 7265 6465 6e74 6961 6c3d 7374 6f72 6167  redential=storag
-00015f80: 655f 6163 636f 756e 745f 6b65 792c 0a20  e_account_key,. 
-00015f90: 2020 2020 2020 2020 2020 206d 6178 5f72             max_r
-00015fa0: 616e 6765 5f73 697a 653d 3420 2a20 3130  ange_size=4 * 10
-00015fb0: 3234 290a 0a20 2020 2020 2020 2023 2041  24)..        # A
-00015fc0: 6374 0a20 2020 2020 2020 2070 726f 6772  ct.        progr
-00015fd0: 6573 7320 3d20 5b5d 0a20 2020 2020 2020  ess = [].       
-00015fe0: 2064 6566 2063 616c 6c62 6163 6b28 7265   def callback(re
-00015ff0: 7370 6f6e 7365 293a 0a20 2020 2020 2020  sponse):.       
-00016000: 2020 2020 2063 7572 7265 6e74 203d 2072       current = r
-00016010: 6573 706f 6e73 652e 636f 6e74 6578 745b  esponse.context[
-00016020: 2775 706c 6f61 645f 7374 7265 616d 5f63  'upload_stream_c
-00016030: 7572 7265 6e74 275d 0a20 2020 2020 2020  urrent'].       
-00016040: 2020 2020 2074 6f74 616c 203d 2072 6573       total = res
-00016050: 706f 6e73 652e 636f 6e74 6578 745b 2764  ponse.context['d
-00016060: 6174 615f 7374 7265 616d 5f74 6f74 616c  ata_stream_total
-00016070: 275d 0a20 2020 2020 2020 2020 2020 2069  '].            i
-00016080: 6620 6375 7272 656e 7420 6973 206e 6f74  f current is not
-00016090: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-000160a0: 2020 2020 2020 2070 726f 6772 6573 732e         progress.
-000160b0: 6170 7065 6e64 2828 6375 7272 656e 742c  append((current,
-000160c0: 2074 6f74 616c 2929 0a0a 2020 2020 2020   total))..      
-000160d0: 2020 6669 6c65 5f73 697a 6520 3d20 6c65    file_size = le
-000160e0: 6e28 6461 7461 2920 2d20 350a 2020 2020  n(data) - 5.    
-000160f0: 2020 2020 7769 7468 206f 7065 6e28 494e      with open(IN
-00016100: 5055 545f 4649 4c45 5f50 4154 482c 2027  PUT_FILE_PATH, '
-00016110: 7262 2729 2061 7320 7374 7265 616d 3a0a  rb') as stream:.
-00016120: 2020 2020 2020 2020 2020 2020 6177 6169              awai
-00016130: 7420 6669 6c65 5f63 6c69 656e 742e 7570  t file_client.up
-00016140: 6c6f 6164 5f66 696c 6528 7374 7265 616d  load_file(stream
-00016150: 2c20 6c65 6e67 7468 3d66 696c 655f 7369  , length=file_si
-00016160: 7a65 2c20 6d61 785f 636f 6e63 7572 7265  ze, max_concurre
-00016170: 6e63 793d 322c 2072 6177 5f72 6573 706f  ncy=2, raw_respo
-00016180: 6e73 655f 686f 6f6b 3d63 616c 6c62 6163  nse_hook=callbac
-00016190: 6b29 0a0a 0a20 2020 2020 2020 2023 2041  k)...        # A
-000161a0: 7373 6572 740a 2020 2020 2020 2020 6177  ssert.        aw
-000161b0: 6169 7420 7365 6c66 2e61 7373 6572 7446  ait self.assertF
-000161c0: 696c 6545 7175 616c 2866 696c 655f 636c  ileEqual(file_cl
-000161d0: 6965 6e74 2c20 6461 7461 5b3a 6669 6c65  ient, data[:file
-000161e0: 5f73 697a 655d 290a 2020 2020 2020 2020  _size]).        
-000161f0: 7365 6c66 2e61 7373 6572 745f 7570 6c6f  self.assert_uplo
-00016200: 6164 5f70 726f 6772 6573 7328 0a20 2020  ad_progress(.   
-00016210: 2020 2020 2020 2020 2066 696c 655f 7369           file_si
-00016220: 7a65 2c0a 2020 2020 2020 2020 2020 2020  ze,.            
-00016230: 7365 6c66 2e66 7363 2e5f 636f 6e66 6967  self.fsc._config
-00016240: 2e6d 6178 5f72 616e 6765 5f73 697a 652c  .max_range_size,
-00016250: 0a20 2020 2020 2020 2020 2020 2070 726f  .            pro
-00016260: 6772 6573 732c 2075 6e6b 6e6f 776e 5f73  gress, unknown_s
-00016270: 697a 653d 4661 6c73 6529 0a20 2020 2020  ize=False).     
-00016280: 2020 2073 656c 662e 5f74 6561 7264 6f77     self._teardow
-00016290: 6e28 494e 5055 545f 4649 4c45 5f50 4154  n(INPUT_FILE_PAT
-000162a0: 4829 0a0a 2020 2020 4046 696c 6553 6861  H)..    @FileSha
-000162b0: 7265 5072 6570 6172 6572 2829 0a20 2020  rePreparer().   
-000162c0: 2040 4173 796e 6353 746f 7261 6765 5465   @AsyncStorageTe
-000162d0: 7374 4361 7365 2e61 7761 6974 5f70 7265  stCase.await_pre
-000162e0: 7061 7265 645f 7465 7374 0a20 2020 2061  pared_test.    a
-000162f0: 7379 6e63 2064 6566 2074 6573 745f 6372  sync def test_cr
-00016300: 6561 7465 5f66 696c 655f 6672 6f6d 5f74  eate_file_from_t
-00016310: 6578 745f 6173 796e 6328 7365 6c66 2c20  ext_async(self, 
-00016320: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-00016330: 6e61 6d65 2c20 7374 6f72 6167 655f 6163  name, storage_ac
-00016340: 636f 756e 745f 6b65 7929 3a0a 2020 2020  count_key):.    
-00016350: 2020 2020 7365 6c66 2e5f 7365 7475 7028      self._setup(
-00016360: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-00016370: 6e61 6d65 2c20 7374 6f72 6167 655f 6163  name, storage_ac
-00016380: 636f 756e 745f 6b65 7929 0a20 2020 2020  count_key).     
-00016390: 2020 2066 696c 655f 6e61 6d65 203d 2073     file_name = s
-000163a0: 656c 662e 5f67 6574 5f66 696c 655f 7265  elf._get_file_re
-000163b0: 6665 7265 6e63 6528 290a 2020 2020 2020  ference().      
-000163c0: 2020 6177 6169 7420 7365 6c66 2e5f 7365    await self._se
-000163d0: 7475 705f 7368 6172 6528 7374 6f72 6167  tup_share(storag
-000163e0: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
-000163f0: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-00016400: 6b65 7929 0a20 2020 2020 2020 2074 6578  key).        tex
-00016410: 7420 3d20 7527 6865 6c6c 6f20 e595 8ae9  t = u'hello ....
-00016420: bd84 e4b8 82e7 8b9b e78b 9c20 776f 726c  ........... worl
-00016430: 6427 0a20 2020 2020 2020 2064 6174 6120  d'.        data 
-00016440: 3d20 7465 7874 2e65 6e63 6f64 6528 2775  = text.encode('u
-00016450: 7466 2d38 2729 0a20 2020 2020 2020 2066  tf-8').        f
-00016460: 696c 655f 636c 6965 6e74 203d 2053 6861  ile_client = Sha
-00016470: 7265 4669 6c65 436c 6965 6e74 280a 2020  reFileClient(.  
-00016480: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00016490: 6363 6f75 6e74 5f75 726c 2873 746f 7261  ccount_url(stora
-000164a0: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
-000164b0: 2022 6669 6c65 2229 2c0a 2020 2020 2020   "file"),.      
-000164c0: 2020 2020 2020 7368 6172 655f 6e61 6d65        share_name
-000164d0: 3d73 656c 662e 7368 6172 655f 6e61 6d65  =self.share_name
-000164e0: 2c0a 2020 2020 2020 2020 2020 2020 6669  ,.            fi
-000164f0: 6c65 5f70 6174 683d 6669 6c65 5f6e 616d  le_path=file_nam
-00016500: 652c 0a20 2020 2020 2020 2020 2020 2063  e,.            c
-00016510: 7265 6465 6e74 6961 6c3d 7374 6f72 6167  redential=storag
-00016520: 655f 6163 636f 756e 745f 6b65 792c 0a20  e_account_key,. 
-00016530: 2020 2020 2020 2020 2020 206d 6178 5f72             max_r
-00016540: 616e 6765 5f73 697a 653d 3420 2a20 3130  ange_size=4 * 10
-00016550: 3234 290a 0a20 2020 2020 2020 2023 2041  24)..        # A
-00016560: 6374 0a20 2020 2020 2020 2061 7761 6974  ct.        await
-00016570: 2066 696c 655f 636c 6965 6e74 2e75 706c   file_client.upl
-00016580: 6f61 645f 6669 6c65 2874 6578 7429 0a0a  oad_file(text)..
-00016590: 2020 2020 2020 2020 2320 4173 7365 7274          # Assert
-000165a0: 0a20 2020 2020 2020 2061 7761 6974 2073  .        await s
-000165b0: 656c 662e 6173 7365 7274 4669 6c65 4571  elf.assertFileEq
-000165c0: 7561 6c28 6669 6c65 5f63 6c69 656e 742c  ual(file_client,
-000165d0: 2064 6174 6129 0a0a 2020 2020 4046 696c   data)..    @Fil
-000165e0: 6553 6861 7265 5072 6570 6172 6572 2829  eSharePreparer()
-000165f0: 0a20 2020 2040 4173 796e 6353 746f 7261  .    @AsyncStora
-00016600: 6765 5465 7374 4361 7365 2e61 7761 6974  geTestCase.await
-00016610: 5f70 7265 7061 7265 645f 7465 7374 0a20  _prepared_test. 
-00016620: 2020 2061 7379 6e63 2064 6566 2074 6573     async def tes
-00016630: 745f 6372 6561 7465 5f66 696c 655f 6672  t_create_file_fr
-00016640: 6f6d 5f74 6578 745f 7769 7468 5f65 6e63  om_text_with_enc
-00016650: 6f64 696e 675f 6173 796e 6328 7365 6c66  oding_async(self
-00016660: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
-00016670: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
-00016680: 6163 636f 756e 745f 6b65 7929 3a0a 2020  account_key):.  
-00016690: 2020 2020 2020 7365 6c66 2e5f 7365 7475        self._setu
-000166a0: 7028 7374 6f72 6167 655f 6163 636f 756e  p(storage_accoun
-000166b0: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
-000166c0: 6163 636f 756e 745f 6b65 7929 0a20 2020  account_key).   
-000166d0: 2020 2020 2066 696c 655f 6e61 6d65 203d       file_name =
-000166e0: 2073 656c 662e 5f67 6574 5f66 696c 655f   self._get_file_
-000166f0: 7265 6665 7265 6e63 6528 290a 2020 2020  reference().    
-00016700: 2020 2020 6177 6169 7420 7365 6c66 2e5f      await self._
-00016710: 7365 7475 705f 7368 6172 6528 7374 6f72  setup_share(stor
-00016720: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
-00016730: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
-00016740: 745f 6b65 7929 0a20 2020 2020 2020 2074  t_key).        t
-00016750: 6578 7420 3d20 7527 6865 6c6c 6f20 e595  ext = u'hello ..
-00016760: 8ae9 bd84 e4b8 82e7 8b9b e78b 9c20 776f  ............. wo
-00016770: 726c 6427 0a20 2020 2020 2020 2064 6174  rld'.        dat
-00016780: 6120 3d20 7465 7874 2e65 6e63 6f64 6528  a = text.encode(
-00016790: 2775 7466 2d31 3627 290a 2020 2020 2020  'utf-16').      
-000167a0: 2020 6669 6c65 5f63 6c69 656e 7420 3d20    file_client = 
-000167b0: 5368 6172 6546 696c 6543 6c69 656e 7428  ShareFileClient(
-000167c0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000167d0: 662e 6163 636f 756e 745f 7572 6c28 7374  f.account_url(st
-000167e0: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
-000167f0: 6d65 2c20 2266 696c 6522 292c 0a20 2020  me, "file"),.   
-00016800: 2020 2020 2020 2020 2073 6861 7265 5f6e           share_n
-00016810: 616d 653d 7365 6c66 2e73 6861 7265 5f6e  ame=self.share_n
-00016820: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
-00016830: 2066 696c 655f 7061 7468 3d66 696c 655f   file_path=file_
-00016840: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
-00016850: 2020 6372 6564 656e 7469 616c 3d73 746f    credential=sto
-00016860: 7261 6765 5f61 6363 6f75 6e74 5f6b 6579  rage_account_key
-00016870: 2c0a 2020 2020 2020 2020 2020 2020 6d61  ,.            ma
-00016880: 785f 7261 6e67 655f 7369 7a65 3d34 202a  x_range_size=4 *
-00016890: 2031 3032 3429 0a0a 2020 2020 2020 2020   1024)..        
-000168a0: 2320 4163 740a 2020 2020 2020 2020 6177  # Act.        aw
-000168b0: 6169 7420 6669 6c65 5f63 6c69 656e 742e  ait file_client.
-000168c0: 7570 6c6f 6164 5f66 696c 6528 7465 7874  upload_file(text
-000168d0: 2c20 656e 636f 6469 6e67 3d27 5554 462d  , encoding='UTF-
-000168e0: 3136 2729 0a0a 2020 2020 2020 2020 2320  16')..        # 
-000168f0: 4173 7365 7274 0a20 2020 2020 2020 2061  Assert.        a
-00016900: 7761 6974 2073 656c 662e 6173 7365 7274  wait self.assert
-00016910: 4669 6c65 4571 7561 6c28 6669 6c65 5f63  FileEqual(file_c
-00016920: 6c69 656e 742c 2064 6174 6129 0a20 2020  lient, data).   
-00016930: 2020 2020 2073 656c 662e 5f74 6561 7264       self._teard
-00016940: 6f77 6e28 6669 6c65 5f6e 616d 6529 0a0a  own(file_name)..
-00016950: 2020 2020 4046 696c 6553 6861 7265 5072      @FileSharePr
-00016960: 6570 6172 6572 2829 0a20 2020 2040 4173  eparer().    @As
-00016970: 796e 6353 746f 7261 6765 5465 7374 4361  yncStorageTestCa
-00016980: 7365 2e61 7761 6974 5f70 7265 7061 7265  se.await_prepare
-00016990: 645f 7465 7374 0a20 2020 2061 7379 6e63  d_test.    async
-000169a0: 2064 6566 2074 6573 745f 6372 6561 7465   def test_create
-000169b0: 5f66 696c 655f 6672 6f6d 5f74 6578 745f  _file_from_text_
-000169c0: 6368 756e 6b65 645f 7570 6c6f 6164 5f61  chunked_upload_a
-000169d0: 7379 6e63 2873 656c 662c 2073 746f 7261  sync(self, stora
-000169e0: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
-000169f0: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
-00016a00: 5f6b 6579 293a 0a20 2020 2020 2020 2023  _key):.        #
-00016a10: 2070 6172 616c 6c65 6c20 7465 7374 7320   parallel tests 
-00016a20: 696e 7472 6f64 7563 6520 7261 6e64 6f6d  introduce random
-00016a30: 206f 7264 6572 206f 6620 7265 7175 6573   order of reques
-00016a40: 7473 2c20 6361 6e20 6f6e 6c79 2072 756e  ts, can only run
-00016a50: 206c 6976 650a 2020 2020 2020 2020 6966   live.        if
-00016a60: 206e 6f74 2073 656c 662e 6973 5f6c 6976   not self.is_liv
-00016a70: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-00016a80: 6574 7572 6e0a 0a20 2020 2020 2020 2073  eturn..        s
-00016a90: 656c 662e 5f73 6574 7570 2873 746f 7261  elf._setup(stora
-00016aa0: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
-00016ab0: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
-00016ac0: 5f6b 6579 290a 2020 2020 2020 2020 6669  _key).        fi
-00016ad0: 6c65 5f6e 616d 6520 3d20 7365 6c66 2e5f  le_name = self._
-00016ae0: 6765 745f 6669 6c65 5f72 6566 6572 656e  get_file_referen
-00016af0: 6365 2829 0a20 2020 2020 2020 2061 7761  ce().        awa
-00016b00: 6974 2073 656c 662e 5f73 6574 7570 5f73  it self._setup_s
-00016b10: 6861 7265 2873 746f 7261 6765 5f61 6363  hare(storage_acc
-00016b20: 6f75 6e74 5f6e 616d 652c 2073 746f 7261  ount_name, stora
-00016b30: 6765 5f61 6363 6f75 6e74 5f6b 6579 290a  ge_account_key).
-00016b40: 2020 2020 2020 2020 6461 7461 203d 2073          data = s
-00016b50: 656c 662e 6765 745f 7261 6e64 6f6d 5f74  elf.get_random_t
-00016b60: 6578 745f 6461 7461 284c 4152 4745 5f46  ext_data(LARGE_F
-00016b70: 494c 455f 5349 5a45 290a 2020 2020 2020  ILE_SIZE).      
-00016b80: 2020 656e 636f 6465 645f 6461 7461 203d    encoded_data =
-00016b90: 2064 6174 612e 656e 636f 6465 2827 7574   data.encode('ut
-00016ba0: 662d 3827 290a 2020 2020 2020 2020 6669  f-8').        fi
-00016bb0: 6c65 5f63 6c69 656e 7420 3d20 5368 6172  le_client = Shar
-00016bc0: 6546 696c 6543 6c69 656e 7428 0a20 2020  eFileClient(.   
-00016bd0: 2020 2020 2020 2020 2073 656c 662e 6163           self.ac
-00016be0: 636f 756e 745f 7572 6c28 7374 6f72 6167  count_url(storag
-00016bf0: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
-00016c00: 2266 696c 6522 292c 0a20 2020 2020 2020  "file"),.       
-00016c10: 2020 2020 2073 6861 7265 5f6e 616d 653d       share_name=
-00016c20: 7365 6c66 2e73 6861 7265 5f6e 616d 652c  self.share_name,
-00016c30: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
-00016c40: 655f 7061 7468 3d66 696c 655f 6e61 6d65  e_path=file_name
-00016c50: 2c0a 2020 2020 2020 2020 2020 2020 6372  ,.            cr
-00016c60: 6564 656e 7469 616c 3d73 746f 7261 6765  edential=storage
-00016c70: 5f61 6363 6f75 6e74 5f6b 6579 2c0a 2020  _account_key,.  
-00016c80: 2020 2020 2020 2020 2020 6d61 785f 7261            max_ra
-00016c90: 6e67 655f 7369 7a65 3d34 202a 2031 3032  nge_size=4 * 102
-00016ca0: 3429 0a0a 2020 2020 2020 2020 2320 4163  4)..        # Ac
-00016cb0: 740a 2020 2020 2020 2020 6177 6169 7420  t.        await 
-00016cc0: 6669 6c65 5f63 6c69 656e 742e 7570 6c6f  file_client.uplo
-00016cd0: 6164 5f66 696c 6528 6461 7461 290a 0a20  ad_file(data).. 
-00016ce0: 2020 2020 2020 2023 2041 7373 6572 740a         # Assert.
-00016cf0: 2020 2020 2020 2020 6177 6169 7420 7365          await se
-00016d00: 6c66 2e61 7373 6572 7446 696c 6545 7175  lf.assertFileEqu
-00016d10: 616c 2866 696c 655f 636c 6965 6e74 2c20  al(file_client, 
-00016d20: 656e 636f 6465 645f 6461 7461 290a 2020  encoded_data).  
-00016d30: 2020 2020 2020 7365 6c66 2e5f 7465 6172        self._tear
-00016d40: 646f 776e 2866 696c 655f 6e61 6d65 290a  down(file_name).
-00016d50: 0a20 2020 2040 4669 6c65 5368 6172 6550  .    @FileShareP
-00016d60: 7265 7061 7265 7228 290a 2020 2020 4041  reparer().    @A
-00016d70: 7379 6e63 5374 6f72 6167 6554 6573 7443  syncStorageTestC
-00016d80: 6173 652e 6177 6169 745f 7072 6570 6172  ase.await_prepar
-00016d90: 6564 5f74 6573 740a 2020 2020 6173 796e  ed_test.    asyn
-00016da0: 6320 6465 6620 7465 7374 5f63 7265 6174  c def test_creat
-00016db0: 655f 6669 6c65 5f77 6974 685f 6d64 355f  e_file_with_md5_
-00016dc0: 736d 616c 6c5f 6173 796e 6328 7365 6c66  small_async(self
-00016dd0: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
-00016de0: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
-00016df0: 6163 636f 756e 745f 6b65 7929 3a0a 2020  account_key):.  
-00016e00: 2020 2020 2020 7365 6c66 2e5f 7365 7475        self._setu
-00016e10: 7028 7374 6f72 6167 655f 6163 636f 756e  p(storage_accoun
-00016e20: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
-00016e30: 6163 636f 756e 745f 6b65 7929 0a20 2020  account_key).   
-00016e40: 2020 2020 2066 696c 655f 6e61 6d65 203d       file_name =
-00016e50: 2073 656c 662e 5f67 6574 5f66 696c 655f   self._get_file_
-00016e60: 7265 6665 7265 6e63 6528 290a 2020 2020  reference().    
-00016e70: 2020 2020 6177 6169 7420 7365 6c66 2e5f      await self._
-00016e80: 7365 7475 705f 7368 6172 6528 7374 6f72  setup_share(stor
-00016e90: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
-00016ea0: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
-00016eb0: 745f 6b65 7929 0a20 2020 2020 2020 2064  t_key).        d
-00016ec0: 6174 6120 3d20 7365 6c66 2e67 6574 5f72  ata = self.get_r
-00016ed0: 616e 646f 6d5f 6279 7465 7328 3531 3229  andom_bytes(512)
-00016ee0: 0a20 2020 2020 2020 2066 696c 655f 636c  .        file_cl
-00016ef0: 6965 6e74 203d 2053 6861 7265 4669 6c65  ient = ShareFile
-00016f00: 436c 6965 6e74 280a 2020 2020 2020 2020  Client(.        
-00016f10: 2020 2020 7365 6c66 2e61 6363 6f75 6e74      self.account
-00016f20: 5f75 726c 2873 746f 7261 6765 5f61 6363  _url(storage_acc
-00016f30: 6f75 6e74 5f6e 616d 652c 2022 6669 6c65  ount_name, "file
-00016f40: 2229 2c0a 2020 2020 2020 2020 2020 2020  "),.            
-00016f50: 7368 6172 655f 6e61 6d65 3d73 656c 662e  share_name=self.
-00016f60: 7368 6172 655f 6e61 6d65 2c0a 2020 2020  share_name,.    
-00016f70: 2020 2020 2020 2020 6669 6c65 5f70 6174          file_pat
-00016f80: 683d 6669 6c65 5f6e 616d 652c 0a20 2020  h=file_name,.   
-00016f90: 2020 2020 2020 2020 2063 7265 6465 6e74           credent
-00016fa0: 6961 6c3d 7374 6f72 6167 655f 6163 636f  ial=storage_acco
-00016fb0: 756e 745f 6b65 792c 0a20 2020 2020 2020  unt_key,.       
-00016fc0: 2020 2020 206d 6178 5f72 616e 6765 5f73       max_range_s
-00016fd0: 697a 653d 3420 2a20 3130 3234 290a 0a20  ize=4 * 1024).. 
-00016fe0: 2020 2020 2020 2023 2041 6374 0a20 2020         # Act.   
-00016ff0: 2020 2020 2061 7761 6974 2066 696c 655f       await file_
-00017000: 636c 6965 6e74 2e75 706c 6f61 645f 6669  client.upload_fi
-00017010: 6c65 2864 6174 612c 2076 616c 6964 6174  le(data, validat
-00017020: 655f 636f 6e74 656e 743d 5472 7565 290a  e_content=True).
-00017030: 2020 2020 2020 2020 7365 6c66 2e5f 7465          self._te
-00017040: 6172 646f 776e 2866 696c 655f 6e61 6d65  ardown(file_name
-00017050: 290a 2020 2020 2020 2020 2320 4173 7365  ).        # Asse
-00017060: 7274 0a0a 2020 2020 4046 696c 6553 6861  rt..    @FileSha
-00017070: 7265 5072 6570 6172 6572 2829 0a20 2020  rePreparer().   
-00017080: 2040 4173 796e 6353 746f 7261 6765 5465   @AsyncStorageTe
-00017090: 7374 4361 7365 2e61 7761 6974 5f70 7265  stCase.await_pre
-000170a0: 7061 7265 645f 7465 7374 0a20 2020 2061  pared_test.    a
-000170b0: 7379 6e63 2064 6566 2074 6573 745f 6372  sync def test_cr
-000170c0: 6561 7465 5f66 696c 655f 7769 7468 5f6d  eate_file_with_m
-000170d0: 6435 5f6c 6172 6765 5f61 7379 6e63 2873  d5_large_async(s
-000170e0: 656c 662c 2073 746f 7261 6765 5f61 6363  elf, storage_acc
-000170f0: 6f75 6e74 5f6e 616d 652c 2073 746f 7261  ount_name, stora
-00017100: 6765 5f61 6363 6f75 6e74 5f6b 6579 293a  ge_account_key):
-00017110: 0a20 2020 2020 2020 2023 2070 6172 616c  .        # paral
-00017120: 6c65 6c20 7465 7374 7320 696e 7472 6f64  lel tests introd
-00017130: 7563 6520 7261 6e64 6f6d 206f 7264 6572  uce random order
-00017140: 206f 6620 7265 7175 6573 7473 2c20 6361   of requests, ca
-00017150: 6e20 6f6e 6c79 2072 756e 206c 6976 650a  n only run live.
-00017160: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-00017170: 656c 662e 6973 5f6c 6976 653a 0a20 2020  elf.is_live:.   
-00017180: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
-00017190: 0a20 2020 2020 2020 2073 656c 662e 5f73  .        self._s
-000171a0: 6574 7570 2873 746f 7261 6765 5f61 6363  etup(storage_acc
-000171b0: 6f75 6e74 5f6e 616d 652c 2073 746f 7261  ount_name, stora
-000171c0: 6765 5f61 6363 6f75 6e74 5f6b 6579 290a  ge_account_key).
-000171d0: 2020 2020 2020 2020 6669 6c65 5f6e 616d          file_nam
-000171e0: 6520 3d20 7365 6c66 2e5f 6765 745f 6669  e = self._get_fi
-000171f0: 6c65 5f72 6566 6572 656e 6365 2829 0a20  le_reference(). 
-00017200: 2020 2020 2020 2061 7761 6974 2073 656c         await sel
-00017210: 662e 5f73 6574 7570 5f73 6861 7265 2873  f._setup_share(s
-00017220: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
-00017230: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
-00017240: 6f75 6e74 5f6b 6579 290a 2020 2020 2020  ount_key).      
-00017250: 2020 6461 7461 203d 2073 656c 662e 6765    data = self.ge
-00017260: 745f 7261 6e64 6f6d 5f62 7974 6573 284c  t_random_bytes(L
-00017270: 4152 4745 5f46 494c 455f 5349 5a45 290a  ARGE_FILE_SIZE).
-00017280: 2020 2020 2020 2020 6669 6c65 5f63 6c69          file_cli
-00017290: 656e 7420 3d20 5368 6172 6546 696c 6543  ent = ShareFileC
-000172a0: 6c69 656e 7428 0a20 2020 2020 2020 2020  lient(.         
-000172b0: 2020 2073 656c 662e 6163 636f 756e 745f     self.account_
-000172c0: 7572 6c28 7374 6f72 6167 655f 6163 636f  url(storage_acco
-000172d0: 756e 745f 6e61 6d65 2c20 2266 696c 6522  unt_name, "file"
-000172e0: 292c 0a20 2020 2020 2020 2020 2020 2073  ),.            s
-000172f0: 6861 7265 5f6e 616d 653d 7365 6c66 2e73  hare_name=self.s
-00017300: 6861 7265 5f6e 616d 652c 0a20 2020 2020  hare_name,.     
-00017310: 2020 2020 2020 2066 696c 655f 7061 7468         file_path
-00017320: 3d66 696c 655f 6e61 6d65 2c0a 2020 2020  =file_name,.    
-00017330: 2020 2020 2020 2020 6372 6564 656e 7469          credenti
-00017340: 616c 3d73 746f 7261 6765 5f61 6363 6f75  al=storage_accou
-00017350: 6e74 5f6b 6579 2c0a 2020 2020 2020 2020  nt_key,.        
-00017360: 2020 2020 6d61 785f 7261 6e67 655f 7369      max_range_si
-00017370: 7a65 3d34 202a 2031 3032 3429 0a0a 2020  ze=4 * 1024)..  
-00017380: 2020 2020 2020 2320 4163 740a 2020 2020        # Act.    
-00017390: 2020 2020 6177 6169 7420 6669 6c65 5f63      await file_c
-000173a0: 6c69 656e 742e 7570 6c6f 6164 5f66 696c  lient.upload_fil
-000173b0: 6528 6461 7461 2c20 7661 6c69 6461 7465  e(data, validate
-000173c0: 5f63 6f6e 7465 6e74 3d54 7275 652c 206d  _content=True, m
-000173d0: 6178 5f63 6f6e 6375 7272 656e 6379 3d32  ax_concurrency=2
-000173e0: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
-000173f0: 7465 6172 646f 776e 2866 696c 655f 6e61  teardown(file_na
-00017400: 6d65 290a 2020 2020 2020 2020 2320 4173  me).        # As
-00017410: 7365 7274 0a0a 2020 2020 4046 696c 6553  sert..    @FileS
-00017420: 6861 7265 5072 6570 6172 6572 2829 0a20  harePreparer(). 
-00017430: 2020 2061 7379 6e63 2064 6566 2074 6573     async def tes
-00017440: 745f 6372 6561 7465 5f66 696c 655f 7072  t_create_file_pr
-00017450: 6f67 7265 7373 2873 656c 662c 2073 746f  ogress(self, sto
-00017460: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
-00017470: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
-00017480: 6e74 5f6b 6579 293a 0a20 2020 2020 2020  nt_key):.       
-00017490: 2073 656c 662e 5f73 6574 7570 2873 746f   self._setup(sto
-000174a0: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
-000174b0: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
-000174c0: 6e74 5f6b 6579 290a 2020 2020 2020 2020  nt_key).        
-000174d0: 6177 6169 7420 7365 6c66 2e5f 7365 7475  await self._setu
-000174e0: 705f 7368 6172 6528 7374 6f72 6167 655f  p_share(storage_
-000174f0: 6163 636f 756e 745f 6e61 6d65 2c20 7374  account_name, st
-00017500: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
-00017510: 7929 0a0a 2020 2020 2020 2020 6669 6c65  y)..        file
-00017520: 5f6e 616d 6520 3d20 7365 6c66 2e5f 6765  _name = self._ge
-00017530: 745f 6669 6c65 5f72 6566 6572 656e 6365  t_file_reference
-00017540: 2829 0a20 2020 2020 2020 2066 696c 655f  ().        file_
-00017550: 636c 6965 6e74 203d 2053 6861 7265 4669  client = ShareFi
-00017560: 6c65 436c 6965 6e74 280a 2020 2020 2020  leClient(.      
-00017570: 2020 2020 2020 7365 6c66 2e61 6363 6f75        self.accou
-00017580: 6e74 5f75 726c 2873 746f 7261 6765 5f61  nt_url(storage_a
-00017590: 6363 6f75 6e74 5f6e 616d 652c 2022 6669  ccount_name, "fi
-000175a0: 6c65 2229 2c0a 2020 2020 2020 2020 2020  le"),.          
-000175b0: 2020 7368 6172 655f 6e61 6d65 3d73 656c    share_name=sel
-000175c0: 662e 7368 6172 655f 6e61 6d65 2c0a 2020  f.share_name,.  
-000175d0: 2020 2020 2020 2020 2020 6669 6c65 5f70            file_p
-000175e0: 6174 683d 6669 6c65 5f6e 616d 652c 0a20  ath=file_name,. 
-000175f0: 2020 2020 2020 2020 2020 2063 7265 6465             crede
-00017600: 6e74 6961 6c3d 7374 6f72 6167 655f 6163  ntial=storage_ac
-00017610: 636f 756e 745f 6b65 792c 0a20 2020 2020  count_key,.     
-00017620: 2020 2020 2020 206d 6178 5f72 616e 6765         max_range
-00017630: 5f73 697a 653d 3130 3234 290a 0a20 2020  _size=1024)..   
-00017640: 2020 2020 2064 6174 6120 3d20 6227 6127       data = b'a'
-00017650: 202a 2035 202a 2031 3032 340a 2020 2020   * 5 * 1024.    
-00017660: 2020 2020 7072 6f67 7265 7373 203d 2050      progress = P
-00017670: 726f 6772 6573 7354 7261 636b 6572 286c  rogressTracker(l
-00017680: 656e 2864 6174 6129 2c20 3130 3234 290a  en(data), 1024).
-00017690: 0a20 2020 2020 2020 2023 2041 6374 0a20  .        # Act. 
-000176a0: 2020 2020 2020 2061 7761 6974 2066 696c         await fil
-000176b0: 655f 636c 6965 6e74 2e75 706c 6f61 645f  e_client.upload_
-000176c0: 6669 6c65 2864 6174 612c 2070 726f 6772  file(data, progr
-000176d0: 6573 735f 686f 6f6b 3d70 726f 6772 6573  ess_hook=progres
-000176e0: 732e 6173 7365 7274 5f70 726f 6772 6573  s.assert_progres
-000176f0: 7329 0a0a 2020 2020 2020 2020 2320 4173  s)..        # As
-00017700: 7365 7274 0a20 2020 2020 2020 2070 726f  sert.        pro
-00017710: 6772 6573 732e 6173 7365 7274 5f63 6f6d  gress.assert_com
-00017720: 706c 6574 6528 290a 0a20 2020 2040 7079  plete()..    @py
-00017730: 7465 7374 2e6d 6172 6b2e 6c69 7665 5f74  test.mark.live_t
-00017740: 6573 745f 6f6e 6c79 0a20 2020 2040 4669  est_only.    @Fi
-00017750: 6c65 5368 6172 6550 7265 7061 7265 7228  leSharePreparer(
-00017760: 290a 2020 2020 6173 796e 6320 6465 6620  ).    async def 
-00017770: 7465 7374 5f63 7265 6174 655f 6669 6c65  test_create_file
-00017780: 5f70 726f 6772 6573 735f 7061 7261 6c6c  _progress_parall
-00017790: 656c 2873 656c 662c 2073 746f 7261 6765  el(self, storage
-000177a0: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
-000177b0: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
-000177c0: 6579 293a 0a20 2020 2020 2020 2023 2070  ey):.        # p
-000177d0: 6172 616c 6c65 6c20 7465 7374 7320 696e  arallel tests in
-000177e0: 7472 6f64 7563 6520 7261 6e64 6f6d 206f  troduce random o
-000177f0: 7264 6572 206f 6620 7265 7175 6573 7473  rder of requests
-00017800: 2c20 6361 6e20 6f6e 6c79 2072 756e 206c  , can only run l
-00017810: 6976 650a 2020 2020 2020 2020 7365 6c66  ive.        self
-00017820: 2e5f 7365 7475 7028 7374 6f72 6167 655f  ._setup(storage_
-00017830: 6163 636f 756e 745f 6e61 6d65 2c20 7374  account_name, st
-00017840: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
-00017850: 7929 0a20 2020 2020 2020 2061 7761 6974  y).        await
-00017860: 2073 656c 662e 5f73 6574 7570 5f73 6861   self._setup_sha
-00017870: 7265 2873 746f 7261 6765 5f61 6363 6f75  re(storage_accou
-00017880: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
-00017890: 5f61 6363 6f75 6e74 5f6b 6579 290a 0a20  _account_key).. 
-000178a0: 2020 2020 2020 2066 696c 655f 6e61 6d65         file_name
-000178b0: 203d 2073 656c 662e 5f67 6574 5f66 696c   = self._get_fil
-000178c0: 655f 7265 6665 7265 6e63 6528 290a 2020  e_reference().  
-000178d0: 2020 2020 2020 6669 6c65 5f63 6c69 656e        file_clien
-000178e0: 7420 3d20 5368 6172 6546 696c 6543 6c69  t = ShareFileCli
-000178f0: 656e 7428 0a20 2020 2020 2020 2020 2020  ent(.           
-00017900: 2073 656c 662e 6163 636f 756e 745f 7572   self.account_ur
-00017910: 6c28 7374 6f72 6167 655f 6163 636f 756e  l(storage_accoun
-00017920: 745f 6e61 6d65 2c20 2266 696c 6522 292c  t_name, "file"),
-00017930: 0a20 2020 2020 2020 2020 2020 2073 6861  .            sha
-00017940: 7265 5f6e 616d 653d 7365 6c66 2e73 6861  re_name=self.sha
-00017950: 7265 5f6e 616d 652c 0a20 2020 2020 2020  re_name,.       
-00017960: 2020 2020 2066 696c 655f 7061 7468 3d66       file_path=f
-00017970: 696c 655f 6e61 6d65 2c0a 2020 2020 2020  ile_name,.      
-00017980: 2020 2020 2020 6372 6564 656e 7469 616c        credential
-00017990: 3d73 746f 7261 6765 5f61 6363 6f75 6e74  =storage_account
-000179a0: 5f6b 6579 2c0a 2020 2020 2020 2020 2020  _key,.          
-000179b0: 2020 6d61 785f 7261 6e67 655f 7369 7a65    max_range_size
-000179c0: 3d31 3032 3429 0a0a 2020 2020 2020 2020  =1024)..        
-000179d0: 6461 7461 203d 2062 2761 2720 2a20 3520  data = b'a' * 5 
-000179e0: 2a20 3130 3234 0a20 2020 2020 2020 2070  * 1024.        p
-000179f0: 726f 6772 6573 7320 3d20 5072 6f67 7265  rogress = Progre
-00017a00: 7373 5472 6163 6b65 7228 6c65 6e28 6461  ssTracker(len(da
-00017a10: 7461 292c 2031 3032 3429 0a0a 2020 2020  ta), 1024)..    
-00017a20: 2020 2020 2320 4163 740a 2020 2020 2020      # Act.      
-00017a30: 2020 6177 6169 7420 6669 6c65 5f63 6c69    await file_cli
-00017a40: 656e 742e 7570 6c6f 6164 5f66 696c 6528  ent.upload_file(
-00017a50: 6461 7461 2c20 7072 6f67 7265 7373 5f68  data, progress_h
-00017a60: 6f6f 6b3d 7072 6f67 7265 7373 2e61 7373  ook=progress.ass
-00017a70: 6572 745f 7072 6f67 7265 7373 2c20 6d61  ert_progress, ma
-00017a80: 785f 636f 6e63 7572 7265 6e63 793d 3329  x_concurrency=3)
-00017a90: 0a0a 2020 2020 2020 2020 2320 4173 7365  ..        # Asse
-00017aa0: 7274 0a20 2020 2020 2020 2070 726f 6772  rt.        progr
-00017ab0: 6573 732e 6173 7365 7274 5f63 6f6d 706c  ess.assert_compl
-00017ac0: 6574 6528 290a 0a20 2020 2023 202d 2d54  ete()..    # --T
-00017ad0: 6573 7420 6361 7365 7320 666f 7220 7361  est cases for sa
-00017ae0: 7320 2620 6163 6c20 2d2d 2d2d 2d2d 2d2d  s & acl --------
-00017af0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00017b00: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00017b10: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2040 4669  --------.    @Fi
-00017b20: 6c65 5368 6172 6550 7265 7061 7265 7228  leSharePreparer(
-00017b30: 290a 2020 2020 4041 7379 6e63 5374 6f72  ).    @AsyncStor
-00017b40: 6167 6554 6573 7443 6173 652e 6177 6169  ageTestCase.awai
-00017b50: 745f 7072 6570 6172 6564 5f74 6573 740a  t_prepared_test.
-00017b60: 2020 2020 6173 796e 6320 6465 6620 7465      async def te
-00017b70: 7374 5f73 6173 5f61 6363 6573 735f 6669  st_sas_access_fi
-00017b80: 6c65 5f61 7379 6e63 2873 656c 662c 2073  le_async(self, s
-00017b90: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
-00017ba0: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
-00017bb0: 6f75 6e74 5f6b 6579 293a 0a20 2020 2020  ount_key):.     
-00017bc0: 2020 2023 2053 4153 2055 524c 2069 7320     # SAS URL is 
-00017bd0: 6361 6c63 756c 6174 6564 2066 726f 6d20  calculated from 
-00017be0: 7374 6f72 6167 6520 6b65 792c 2073 6f20  storage key, so 
-00017bf0: 7468 6973 2074 6573 7420 7275 6e73 206c  this test runs l
-00017c00: 6976 6520 6f6e 6c79 0a20 2020 2020 2020  ive only.       
-00017c10: 2069 6620 6e6f 7420 7365 6c66 2e69 735f   if not self.is_
-00017c20: 6c69 7665 3a0a 2020 2020 2020 2020 2020  live:.          
-00017c30: 2020 7265 7475 726e 0a0a 2020 2020 2020    return..      
-00017c40: 2020 7365 6c66 2e5f 7365 7475 7028 7374    self._setup(st
-00017c50: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
-00017c60: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
-00017c70: 756e 745f 6b65 7929 0a20 2020 2020 2020  unt_key).       
-00017c80: 2066 696c 655f 636c 6965 6e74 203d 2061   file_client = a
-00017c90: 7761 6974 2073 656c 662e 5f63 7265 6174  wait self._creat
-00017ca0: 655f 6669 6c65 2873 746f 7261 6765 5f61  e_file(storage_a
-00017cb0: 6363 6f75 6e74 5f6e 616d 652c 2073 746f  ccount_name, sto
-00017cc0: 7261 6765 5f61 6363 6f75 6e74 5f6b 6579  rage_account_key
-00017cd0: 290a 2020 2020 2020 2020 746f 6b65 6e20  ).        token 
-00017ce0: 3d20 6765 6e65 7261 7465 5f66 696c 655f  = generate_file_
-00017cf0: 7361 7328 0a20 2020 2020 2020 2020 2020  sas(.           
-00017d00: 2066 696c 655f 636c 6965 6e74 2e61 6363   file_client.acc
-00017d10: 6f75 6e74 5f6e 616d 652c 0a20 2020 2020  ount_name,.     
-00017d20: 2020 2020 2020 2066 696c 655f 636c 6965         file_clie
-00017d30: 6e74 2e73 6861 7265 5f6e 616d 652c 0a20  nt.share_name,. 
-00017d40: 2020 2020 2020 2020 2020 2066 696c 655f             file_
-00017d50: 636c 6965 6e74 2e66 696c 655f 7061 7468  client.file_path
-00017d60: 2c0a 2020 2020 2020 2020 2020 2020 6669  ,.            fi
-00017d70: 6c65 5f63 6c69 656e 742e 6372 6564 656e  le_client.creden
-00017d80: 7469 616c 2e61 6363 6f75 6e74 5f6b 6579  tial.account_key
-00017d90: 2c0a 2020 2020 2020 2020 2020 2020 7065  ,.            pe
-00017da0: 726d 6973 7369 6f6e 3d46 696c 6553 6173  rmission=FileSas
-00017db0: 5065 726d 6973 7369 6f6e 7328 7265 6164  Permissions(read
-00017dc0: 3d54 7275 6529 2c0a 2020 2020 2020 2020  =True),.        
-00017dd0: 2020 2020 6578 7069 7279 3d64 6174 6574      expiry=datet
-00017de0: 696d 652e 7574 636e 6f77 2829 202b 2074  ime.utcnow() + t
-00017df0: 696d 6564 656c 7461 2868 6f75 7273 3d31  imedelta(hours=1
-00017e00: 292c 0a20 2020 2020 2020 2029 0a0a 2020  ),.        )..  
-00017e10: 2020 2020 2020 2320 4163 740a 2020 2020        # Act.    
-00017e20: 2020 2020 6669 6c65 5f63 6c69 656e 7420      file_client 
-00017e30: 3d20 5368 6172 6546 696c 6543 6c69 656e  = ShareFileClien
-00017e40: 7428 0a20 2020 2020 2020 2020 2020 2073  t(.            s
-00017e50: 656c 662e 6163 636f 756e 745f 7572 6c28  elf.account_url(
-00017e60: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-00017e70: 6e61 6d65 2c20 2266 696c 6522 292c 0a20  name, "file"),. 
-00017e80: 2020 2020 2020 2020 2020 2073 6861 7265             share
-00017e90: 5f6e 616d 653d 7365 6c66 2e73 6861 7265  _name=self.share
-00017ea0: 5f6e 616d 652c 0a20 2020 2020 2020 2020  _name,.         
-00017eb0: 2020 2066 696c 655f 7061 7468 3d66 696c     file_path=fil
-00017ec0: 655f 636c 6965 6e74 2e66 696c 655f 6e61  e_client.file_na
-00017ed0: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
-00017ee0: 6372 6564 656e 7469 616c 3d74 6f6b 656e  credential=token
-00017ef0: 290a 2020 2020 2020 2020 636f 6e74 656e  ).        conten
-00017f00: 7420 3d20 6177 6169 7420 6669 6c65 5f63  t = await file_c
-00017f10: 6c69 656e 742e 646f 776e 6c6f 6164 5f66  lient.download_f
-00017f20: 696c 6528 290a 2020 2020 2020 2020 636f  ile().        co
-00017f30: 6e74 656e 7420 3d20 6177 6169 7420 636f  ntent = await co
-00017f40: 6e74 656e 742e 7265 6164 616c 6c28 290a  ntent.readall().
-00017f50: 0a20 2020 2020 2020 2023 2041 7373 6572  .        # Asser
-00017f60: 740a 2020 2020 2020 2020 7365 6c66 2e61  t.        self.a
-00017f70: 7373 6572 7445 7175 616c 2873 656c 662e  ssertEqual(self.
-00017f80: 7368 6f72 745f 6279 7465 5f64 6174 612c  short_byte_data,
-00017f90: 2063 6f6e 7465 6e74 290a 0a20 2020 2040   content)..    @
-00017fa0: 4669 6c65 5368 6172 6550 7265 7061 7265  FileSharePrepare
-00017fb0: 7228 290a 2020 2020 4041 7379 6e63 5374  r().    @AsyncSt
-00017fc0: 6f72 6167 6554 6573 7443 6173 652e 6177  orageTestCase.aw
-00017fd0: 6169 745f 7072 6570 6172 6564 5f74 6573  ait_prepared_tes
-00017fe0: 740a 2020 2020 6173 796e 6320 6465 6620  t.    async def 
-00017ff0: 7465 7374 5f73 6173 5f73 6967 6e65 645f  test_sas_signed_
-00018000: 6964 656e 7469 6669 6572 5f61 7379 6e63  identifier_async
-00018010: 2873 656c 662c 2073 746f 7261 6765 5f61  (self, storage_a
-00018020: 6363 6f75 6e74 5f6e 616d 652c 2073 746f  ccount_name, sto
-00018030: 7261 6765 5f61 6363 6f75 6e74 5f6b 6579  rage_account_key
-00018040: 293a 0a20 2020 2020 2020 2023 2053 4153  ):.        # SAS
-00018050: 2055 524c 2069 7320 6361 6c63 756c 6174   URL is calculat
-00018060: 6564 2066 726f 6d20 7374 6f72 6167 6520  ed from storage 
-00018070: 6b65 792c 2073 6f20 7468 6973 2074 6573  key, so this tes
-00018080: 7420 7275 6e73 206c 6976 6520 6f6e 6c79  t runs live only
-00018090: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-000180a0: 7365 6c66 2e69 735f 6c69 7665 3a0a 2020  self.is_live:.  
-000180b0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000180c0: 0a0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
-000180d0: 7365 7475 7028 7374 6f72 6167 655f 6163  setup(storage_ac
-000180e0: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
-000180f0: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
-00018100: 0a20 2020 2020 2020 2066 696c 655f 636c  .        file_cl
-00018110: 6965 6e74 203d 2061 7761 6974 2073 656c  ient = await sel
-00018120: 662e 5f63 7265 6174 655f 6669 6c65 2873  f._create_file(s
-00018130: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
-00018140: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
-00018150: 6f75 6e74 5f6b 6579 290a 2020 2020 2020  ount_key).      
-00018160: 2020 7368 6172 655f 636c 6965 6e74 203d    share_client =
-00018170: 2073 656c 662e 6673 632e 6765 745f 7368   self.fsc.get_sh
-00018180: 6172 655f 636c 6965 6e74 2873 656c 662e  are_client(self.
-00018190: 7368 6172 655f 6e61 6d65 290a 0a20 2020  share_name)..   
-000181a0: 2020 2020 2061 6363 6573 735f 706f 6c69       access_poli
-000181b0: 6379 203d 2041 6363 6573 7350 6f6c 6963  cy = AccessPolic
-000181c0: 7928 290a 2020 2020 2020 2020 6163 6365  y().        acce
-000181d0: 7373 5f70 6f6c 6963 792e 7374 6172 7420  ss_policy.start 
-000181e0: 3d20 6461 7465 7469 6d65 2e75 7463 6e6f  = datetime.utcno
-000181f0: 7728 2920 2d20 7469 6d65 6465 6c74 6128  w() - timedelta(
-00018200: 686f 7572 733d 3129 0a20 2020 2020 2020  hours=1).       
-00018210: 2061 6363 6573 735f 706f 6c69 6379 2e65   access_policy.e
-00018220: 7870 6972 7920 3d20 6461 7465 7469 6d65  xpiry = datetime
-00018230: 2e75 7463 6e6f 7728 2920 2b20 7469 6d65  .utcnow() + time
-00018240: 6465 6c74 6128 686f 7572 733d 3129 0a20  delta(hours=1). 
-00018250: 2020 2020 2020 2061 6363 6573 735f 706f         access_po
-00018260: 6c69 6379 2e70 6572 6d69 7373 696f 6e20  licy.permission 
-00018270: 3d20 4669 6c65 5361 7350 6572 6d69 7373  = FileSasPermiss
-00018280: 696f 6e73 2872 6561 643d 5472 7565 290a  ions(read=True).
-00018290: 2020 2020 2020 2020 6964 656e 7469 6669          identifi
-000182a0: 6572 7320 3d20 7b27 7465 7374 6964 273a  ers = {'testid':
-000182b0: 2061 6363 6573 735f 706f 6c69 6379 7d0a   access_policy}.
-000182c0: 2020 2020 2020 2020 6177 6169 7420 7368          await sh
-000182d0: 6172 655f 636c 6965 6e74 2e73 6574 5f73  are_client.set_s
-000182e0: 6861 7265 5f61 6363 6573 735f 706f 6c69  hare_access_poli
-000182f0: 6379 2869 6465 6e74 6966 6965 7273 290a  cy(identifiers).
-00018300: 0a20 2020 2020 2020 2074 6f6b 656e 203d  .        token =
-00018310: 2067 656e 6572 6174 655f 6669 6c65 5f73   generate_file_s
-00018320: 6173 280a 2020 2020 2020 2020 2020 2020  as(.            
-00018330: 6669 6c65 5f63 6c69 656e 742e 6163 636f  file_client.acco
-00018340: 756e 745f 6e61 6d65 2c0a 2020 2020 2020  unt_name,.      
-00018350: 2020 2020 2020 6669 6c65 5f63 6c69 656e        file_clien
-00018360: 742e 7368 6172 655f 6e61 6d65 2c0a 2020  t.share_name,.  
-00018370: 2020 2020 2020 2020 2020 6669 6c65 5f63            file_c
-00018380: 6c69 656e 742e 6669 6c65 5f70 6174 682c  lient.file_path,
-00018390: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
-000183a0: 655f 636c 6965 6e74 2e63 7265 6465 6e74  e_client.credent
-000183b0: 6961 6c2e 6163 636f 756e 745f 6b65 792c  ial.account_key,
-000183c0: 0a20 2020 2020 2020 2020 2020 2070 6f6c  .            pol
-000183d0: 6963 795f 6964 3d27 7465 7374 6964 2729  icy_id='testid')
-000183e0: 0a0a 2020 2020 2020 2020 2320 4163 740a  ..        # Act.
-000183f0: 2020 2020 2020 2020 7361 735f 6669 6c65          sas_file
-00018400: 203d 2053 6861 7265 4669 6c65 436c 6965   = ShareFileClie
-00018410: 6e74 2e66 726f 6d5f 6669 6c65 5f75 726c  nt.from_file_url
-00018420: 280a 2020 2020 2020 2020 2020 2020 6669  (.            fi
-00018430: 6c65 5f63 6c69 656e 742e 7572 6c2c 0a20  le_client.url,. 
-00018440: 2020 2020 2020 2020 2020 2063 7265 6465             crede
-00018450: 6e74 6961 6c3d 746f 6b65 6e29 0a0a 2020  ntial=token)..  
-00018460: 2020 2020 2020 636f 6e74 656e 7420 3d20        content = 
-00018470: 6177 6169 7420 6669 6c65 5f63 6c69 656e  await file_clien
-00018480: 742e 646f 776e 6c6f 6164 5f66 696c 6528  t.download_file(
-00018490: 290a 2020 2020 2020 2020 636f 6e74 656e  ).        conten
-000184a0: 7420 3d20 6177 6169 7420 636f 6e74 656e  t = await conten
-000184b0: 742e 7265 6164 616c 6c28 290a 0a20 2020  t.readall()..   
-000184c0: 2020 2020 2023 2041 7373 6572 740a 2020       # Assert.  
-000184d0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-000184e0: 7445 7175 616c 2873 656c 662e 7368 6f72  tEqual(self.shor
-000184f0: 745f 6279 7465 5f64 6174 612c 2063 6f6e  t_byte_data, con
-00018500: 7465 6e74 290a 0a20 2020 2040 4669 6c65  tent)..    @File
-00018510: 5368 6172 6550 7265 7061 7265 7228 290a  SharePreparer().
-00018520: 2020 2020 4041 7379 6e63 5374 6f72 6167      @AsyncStorag
-00018530: 6554 6573 7443 6173 652e 6177 6169 745f  eTestCase.await_
-00018540: 7072 6570 6172 6564 5f74 6573 740a 2020  prepared_test.  
-00018550: 2020 6173 796e 6320 6465 6620 7465 7374    async def test
-00018560: 5f61 6363 6f75 6e74 5f73 6173 5f61 7379  _account_sas_asy
-00018570: 6e63 2873 656c 662c 2073 746f 7261 6765  nc(self, storage
-00018580: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
-00018590: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
-000185a0: 6579 293a 0a20 2020 2020 2020 2023 2053  ey):.        # S
-000185b0: 4153 2055 524c 2069 7320 6361 6c63 756c  AS URL is calcul
-000185c0: 6174 6564 2066 726f 6d20 7374 6f72 6167  ated from storag
-000185d0: 6520 6b65 792c 2073 6f20 7468 6973 2074  e key, so this t
-000185e0: 6573 7420 7275 6e73 206c 6976 6520 6f6e  est runs live on
-000185f0: 6c79 0a20 2020 2020 2020 2069 6620 6e6f  ly.        if no
-00018600: 7420 7365 6c66 2e69 735f 6c69 7665 3a0a  t self.is_live:.
-00018610: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00018620: 726e 0a0a 2020 2020 2020 2020 7365 6c66  rn..        self
-00018630: 2e5f 7365 7475 7028 7374 6f72 6167 655f  ._setup(storage_
-00018640: 6163 636f 756e 745f 6e61 6d65 2c20 7374  account_name, st
-00018650: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
-00018660: 7929 0a20 2020 2020 2020 2066 696c 655f  y).        file_
-00018670: 636c 6965 6e74 203d 2061 7761 6974 2073  client = await s
-00018680: 656c 662e 5f63 7265 6174 655f 6669 6c65  elf._create_file
-00018690: 2873 746f 7261 6765 5f61 6363 6f75 6e74  (storage_account
-000186a0: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
-000186b0: 6363 6f75 6e74 5f6b 6579 290a 2020 2020  ccount_key).    
-000186c0: 2020 2020 746f 6b65 6e20 3d20 6765 6e65      token = gene
-000186d0: 7261 7465 5f61 6363 6f75 6e74 5f73 6173  rate_account_sas
-000186e0: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
-000186f0: 6c66 2e66 7363 2e61 6363 6f75 6e74 5f6e  lf.fsc.account_n
-00018700: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
-00018710: 2073 656c 662e 6673 632e 6372 6564 656e   self.fsc.creden
-00018720: 7469 616c 2e61 6363 6f75 6e74 5f6b 6579  tial.account_key
-00018730: 2c0a 2020 2020 2020 2020 2020 2020 5265  ,.            Re
-00018740: 736f 7572 6365 5479 7065 7328 6f62 6a65  sourceTypes(obje
-00018750: 6374 3d54 7275 6529 2c0a 2020 2020 2020  ct=True),.      
-00018760: 2020 2020 2020 4163 636f 756e 7453 6173        AccountSas
-00018770: 5065 726d 6973 7369 6f6e 7328 7265 6164  Permissions(read
-00018780: 3d54 7275 6529 2c0a 2020 2020 2020 2020  =True),.        
-00018790: 2020 2020 6461 7465 7469 6d65 2e75 7463      datetime.utc
-000187a0: 6e6f 7728 2920 2b20 7469 6d65 6465 6c74  now() + timedelt
-000187b0: 6128 686f 7572 733d 3129 2c0a 2020 2020  a(hours=1),.    
-000187c0: 2020 2020 290a 0a20 2020 2020 2020 2023      )..        #
-000187d0: 2041 6374 0a20 2020 2020 2020 2066 696c   Act.        fil
-000187e0: 655f 636c 6965 6e74 203d 2053 6861 7265  e_client = Share
-000187f0: 4669 6c65 436c 6965 6e74 280a 2020 2020  FileClient(.    
-00018800: 2020 2020 2020 2020 7365 6c66 2e61 6363          self.acc
-00018810: 6f75 6e74 5f75 726c 2873 746f 7261 6765  ount_url(storage
-00018820: 5f61 6363 6f75 6e74 5f6e 616d 652c 2022  _account_name, "
-00018830: 6669 6c65 2229 2c0a 2020 2020 2020 2020  file"),.        
-00018840: 2020 2020 7368 6172 655f 6e61 6d65 3d73      share_name=s
-00018850: 656c 662e 7368 6172 655f 6e61 6d65 2c0a  elf.share_name,.
-00018860: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-00018870: 5f70 6174 683d 6669 6c65 5f63 6c69 656e  _path=file_clien
-00018880: 742e 6669 6c65 5f6e 616d 652c 0a20 2020  t.file_name,.   
-00018890: 2020 2020 2020 2020 2063 7265 6465 6e74           credent
-000188a0: 6961 6c3d 746f 6b65 6e29 0a0a 2020 2020  ial=token)..    
-000188b0: 2020 2020 7265 7370 6f6e 7365 203d 2072      response = r
-000188c0: 6571 7565 7374 732e 6765 7428 6669 6c65  equests.get(file
-000188d0: 5f63 6c69 656e 742e 7572 6c29 0a0a 2020  _client.url)..  
-000188e0: 2020 2020 2020 2320 4173 7365 7274 0a20        # Assert. 
-000188f0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00018900: 7274 5472 7565 2872 6573 706f 6e73 652e  rtTrue(response.
-00018910: 6f6b 290a 2020 2020 2020 2020 7365 6c66  ok).        self
-00018920: 2e61 7373 6572 7445 7175 616c 2873 656c  .assertEqual(sel
-00018930: 662e 7368 6f72 745f 6279 7465 5f64 6174  f.short_byte_dat
-00018940: 612c 2072 6573 706f 6e73 652e 636f 6e74  a, response.cont
-00018950: 656e 7429 0a0a 2020 2020 4046 696c 6553  ent)..    @FileS
-00018960: 6861 7265 5072 6570 6172 6572 2829 0a20  harePreparer(). 
-00018970: 2020 2040 4173 796e 6353 746f 7261 6765     @AsyncStorage
-00018980: 5465 7374 4361 7365 2e61 7761 6974 5f70  TestCase.await_p
-00018990: 7265 7061 7265 645f 7465 7374 0a20 2020  repared_test.   
-000189a0: 2061 7379 6e63 2064 6566 2074 6573 745f   async def test_
-000189b0: 6163 636f 756e 745f 7361 735f 6372 6564  account_sas_cred
-000189c0: 656e 7469 616c 5f61 7379 6e63 2873 656c  ential_async(sel
-000189d0: 662c 2073 746f 7261 6765 5f61 6363 6f75  f, storage_accou
-000189e0: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
-000189f0: 5f61 6363 6f75 6e74 5f6b 6579 293a 0a20  _account_key):. 
-00018a00: 2020 2020 2020 2023 2053 4153 2055 524c         # SAS URL
-00018a10: 2069 7320 6361 6c63 756c 6174 6564 2066   is calculated f
-00018a20: 726f 6d20 7374 6f72 6167 6520 6b65 792c  rom storage key,
-00018a30: 2073 6f20 7468 6973 2074 6573 7420 7275   so this test ru
-00018a40: 6e73 206c 6976 6520 6f6e 6c79 0a20 2020  ns live only.   
-00018a50: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
-00018a60: 2e69 735f 6c69 7665 3a0a 2020 2020 2020  .is_live:.      
-00018a70: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
-00018a80: 2020 2020 2020 7365 6c66 2e5f 7365 7475        self._setu
-00018a90: 7028 7374 6f72 6167 655f 6163 636f 756e  p(storage_accoun
-00018aa0: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
-00018ab0: 6163 636f 756e 745f 6b65 7929 0a20 2020  account_key).   
-00018ac0: 2020 2020 2066 696c 655f 636c 6965 6e74       file_client
-00018ad0: 203d 2061 7761 6974 2073 656c 662e 5f63   = await self._c
-00018ae0: 7265 6174 655f 6669 6c65 2873 746f 7261  reate_file(stora
-00018af0: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
-00018b00: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
-00018b10: 5f6b 6579 290a 2020 2020 2020 2020 746f  _key).        to
-00018b20: 6b65 6e20 3d20 6765 6e65 7261 7465 5f61  ken = generate_a
-00018b30: 6363 6f75 6e74 5f73 6173 280a 2020 2020  ccount_sas(.    
-00018b40: 2020 2020 2020 2020 7365 6c66 2e66 7363          self.fsc
-00018b50: 2e61 6363 6f75 6e74 5f6e 616d 652c 0a20  .account_name,. 
-00018b60: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00018b70: 6673 632e 6372 6564 656e 7469 616c 2e61  fsc.credential.a
-00018b80: 6363 6f75 6e74 5f6b 6579 2c0a 2020 2020  ccount_key,.    
-00018b90: 2020 2020 2020 2020 5265 736f 7572 6365          Resource
-00018ba0: 5479 7065 7328 6f62 6a65 6374 3d54 7275  Types(object=Tru
-00018bb0: 6529 2c0a 2020 2020 2020 2020 2020 2020  e),.            
-00018bc0: 4163 636f 756e 7453 6173 5065 726d 6973  AccountSasPermis
-00018bd0: 7369 6f6e 7328 7265 6164 3d54 7275 6529  sions(read=True)
-00018be0: 2c0a 2020 2020 2020 2020 2020 2020 6461  ,.            da
-00018bf0: 7465 7469 6d65 2e75 7463 6e6f 7728 2920  tetime.utcnow() 
-00018c00: 2b20 7469 6d65 6465 6c74 6128 686f 7572  + timedelta(hour
-00018c10: 733d 3129 2c0a 2020 2020 2020 2020 290a  s=1),.        ).
-00018c20: 0a20 2020 2020 2020 2023 2041 6374 0a20  .        # Act. 
-00018c30: 2020 2020 2020 2066 696c 655f 636c 6965         file_clie
-00018c40: 6e74 203d 2053 6861 7265 4669 6c65 436c  nt = ShareFileCl
-00018c50: 6965 6e74 280a 2020 2020 2020 2020 2020  ient(.          
-00018c60: 2020 7365 6c66 2e61 6363 6f75 6e74 5f75    self.account_u
-00018c70: 726c 2873 746f 7261 6765 5f61 6363 6f75  rl(storage_accou
-00018c80: 6e74 5f6e 616d 652c 2022 6669 6c65 2229  nt_name, "file")
-00018c90: 2c0a 2020 2020 2020 2020 2020 2020 7368  ,.            sh
-00018ca0: 6172 655f 6e61 6d65 3d73 656c 662e 7368  are_name=self.sh
-00018cb0: 6172 655f 6e61 6d65 2c0a 2020 2020 2020  are_name,.      
-00018cc0: 2020 2020 2020 6669 6c65 5f70 6174 683d        file_path=
-00018cd0: 6669 6c65 5f63 6c69 656e 742e 6669 6c65  file_client.file
-00018ce0: 5f6e 616d 652c 0a20 2020 2020 2020 2020  _name,.         
-00018cf0: 2020 2063 7265 6465 6e74 6961 6c3d 417a     credential=Az
-00018d00: 7572 6553 6173 4372 6564 656e 7469 616c  ureSasCredential
-00018d10: 2874 6f6b 656e 2929 0a0a 2020 2020 2020  (token))..      
-00018d20: 2020 7072 6f70 6572 7469 6573 203d 2061    properties = a
-00018d30: 7761 6974 2066 696c 655f 636c 6965 6e74  wait file_client
-00018d40: 2e67 6574 5f66 696c 655f 7072 6f70 6572  .get_file_proper
-00018d50: 7469 6573 2829 0a0a 2020 2020 2020 2020  ties()..        
-00018d60: 2320 4173 7365 7274 0a20 2020 2020 2020  # Assert.       
-00018d70: 2073 656c 662e 6173 7365 7274 4973 4e6f   self.assertIsNo
-00018d80: 744e 6f6e 6528 7072 6f70 6572 7469 6573  tNone(properties
-00018d90: 290a 0a20 2020 2040 4669 6c65 5368 6172  )..    @FileShar
-00018da0: 6550 7265 7061 7265 7228 290a 2020 2020  ePreparer().    
-00018db0: 6465 6620 7465 7374 5f61 6363 6f75 6e74  def test_account
-00018dc0: 5f73 6173 5f72 6169 7365 735f 6966 5f73  _sas_raises_if_s
-00018dd0: 6173 5f61 6c72 6561 6479 5f69 6e5f 7572  as_already_in_ur
-00018de0: 6928 7365 6c66 2c20 7374 6f72 6167 655f  i(self, storage_
-00018df0: 6163 636f 756e 745f 6e61 6d65 2c20 7374  account_name, st
-00018e00: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
-00018e10: 7929 3a0a 2020 2020 2020 2020 7769 7468  y):.        with
-00018e20: 2073 656c 662e 6173 7365 7274 5261 6973   self.assertRais
-00018e30: 6573 2856 616c 7565 4572 726f 7229 3a0a  es(ValueError):.
-00018e40: 2020 2020 2020 2020 2020 2020 5368 6172              Shar
-00018e50: 6546 696c 6543 6c69 656e 7428 0a20 2020  eFileClient(.   
-00018e60: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00018e70: 662e 6163 636f 756e 745f 7572 6c28 7374  f.account_url(st
-00018e80: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
-00018e90: 6d65 2c20 2266 696c 6522 2920 2b20 223f  me, "file") + "?
-00018ea0: 7369 673d 666f 6f22 2c0a 2020 2020 2020  sig=foo",.      
-00018eb0: 2020 2020 2020 2020 2020 7368 6172 655f            share_
-00018ec0: 6e61 6d65 3d22 666f 6f22 2c0a 2020 2020  name="foo",.    
-00018ed0: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-00018ee0: 5f70 6174 683d 2266 6f6f 222c 0a20 2020  _path="foo",.   
-00018ef0: 2020 2020 2020 2020 2020 2020 2063 7265               cre
-00018f00: 6465 6e74 6961 6c3d 417a 7572 6553 6173  dential=AzureSas
-00018f10: 4372 6564 656e 7469 616c 2822 3f66 6f6f  Credential("?foo
-00018f20: 3d62 6172 2229 290a 0a20 2020 2040 4669  =bar"))..    @Fi
-00018f30: 6c65 5368 6172 6550 7265 7061 7265 7228  leSharePreparer(
-00018f40: 290a 2020 2020 4041 7379 6e63 5374 6f72  ).    @AsyncStor
-00018f50: 6167 6554 6573 7443 6173 652e 6177 6169  ageTestCase.awai
-00018f60: 745f 7072 6570 6172 6564 5f74 6573 740a  t_prepared_test.
-00018f70: 2020 2020 6173 796e 6320 6465 6620 7465      async def te
-00018f80: 7374 5f73 6861 7265 645f 7265 6164 5f61  st_shared_read_a
-00018f90: 6363 6573 735f 6669 6c65 5f61 7379 6e63  ccess_file_async
-00018fa0: 2873 656c 662c 2073 746f 7261 6765 5f61  (self, storage_a
-00018fb0: 6363 6f75 6e74 5f6e 616d 652c 2073 746f  ccount_name, sto
-00018fc0: 7261 6765 5f61 6363 6f75 6e74 5f6b 6579  rage_account_key
-00018fd0: 293a 0a20 2020 2020 2020 2023 2053 4153  ):.        # SAS
-00018fe0: 2055 524c 2069 7320 6361 6c63 756c 6174   URL is calculat
-00018ff0: 6564 2066 726f 6d20 7374 6f72 6167 6520  ed from storage 
-00019000: 6b65 792c 2073 6f20 7468 6973 2074 6573  key, so this tes
-00019010: 7420 7275 6e73 206c 6976 6520 6f6e 6c79  t runs live only
-00019020: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00019030: 7365 6c66 2e69 735f 6c69 7665 3a0a 2020  self.is_live:.  
-00019040: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00019050: 0a0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
-00019060: 7365 7475 7028 7374 6f72 6167 655f 6163  setup(storage_ac
-00019070: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
-00019080: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
-00019090: 0a20 2020 2020 2020 2066 696c 655f 636c  .        file_cl
-000190a0: 6965 6e74 203d 2061 7761 6974 2073 656c  ient = await sel
-000190b0: 662e 5f63 7265 6174 655f 6669 6c65 2873  f._create_file(s
-000190c0: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
-000190d0: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
-000190e0: 6f75 6e74 5f6b 6579 290a 2020 2020 2020  ount_key).      
-000190f0: 2020 746f 6b65 6e20 3d20 6765 6e65 7261    token = genera
-00019100: 7465 5f66 696c 655f 7361 7328 0a20 2020  te_file_sas(.   
-00019110: 2020 2020 2020 2020 2066 696c 655f 636c           file_cl
-00019120: 6965 6e74 2e61 6363 6f75 6e74 5f6e 616d  ient.account_nam
-00019130: 652c 0a20 2020 2020 2020 2020 2020 2066  e,.            f
-00019140: 696c 655f 636c 6965 6e74 2e73 6861 7265  ile_client.share
-00019150: 5f6e 616d 652c 0a20 2020 2020 2020 2020  _name,.         
-00019160: 2020 2066 696c 655f 636c 6965 6e74 2e66     file_client.f
-00019170: 696c 655f 7061 7468 2c0a 2020 2020 2020  ile_path,.      
-00019180: 2020 2020 2020 6669 6c65 5f63 6c69 656e        file_clien
-00019190: 742e 6372 6564 656e 7469 616c 2e61 6363  t.credential.acc
-000191a0: 6f75 6e74 5f6b 6579 2c0a 2020 2020 2020  ount_key,.      
-000191b0: 2020 2020 2020 7065 726d 6973 7369 6f6e        permission
-000191c0: 3d46 696c 6553 6173 5065 726d 6973 7369  =FileSasPermissi
-000191d0: 6f6e 7328 7265 6164 3d54 7275 6529 2c0a  ons(read=True),.
-000191e0: 2020 2020 2020 2020 2020 2020 6578 7069              expi
-000191f0: 7279 3d64 6174 6574 696d 652e 7574 636e  ry=datetime.utcn
-00019200: 6f77 2829 202b 2074 696d 6564 656c 7461  ow() + timedelta
-00019210: 2868 6f75 7273 3d31 292c 0a20 2020 2020  (hours=1),.     
-00019220: 2020 2029 0a0a 2020 2020 2020 2020 2320     )..        # 
-00019230: 4163 740a 2020 2020 2020 2020 6669 6c65  Act.        file
-00019240: 5f63 6c69 656e 7420 3d20 5368 6172 6546  _client = ShareF
-00019250: 696c 6543 6c69 656e 7428 0a20 2020 2020  ileClient(.     
-00019260: 2020 2020 2020 2073 656c 662e 6163 636f         self.acco
-00019270: 756e 745f 7572 6c28 7374 6f72 6167 655f  unt_url(storage_
-00019280: 6163 636f 756e 745f 6e61 6d65 2c20 2266  account_name, "f
-00019290: 696c 6522 292c 0a20 2020 2020 2020 2020  ile"),.         
-000192a0: 2020 2073 6861 7265 5f6e 616d 653d 7365     share_name=se
-000192b0: 6c66 2e73 6861 7265 5f6e 616d 652c 0a20  lf.share_name,. 
-000192c0: 2020 2020 2020 2020 2020 2066 696c 655f             file_
-000192d0: 7061 7468 3d66 696c 655f 636c 6965 6e74  path=file_client
-000192e0: 2e66 696c 655f 6e61 6d65 2c0a 2020 2020  .file_name,.    
-000192f0: 2020 2020 2020 2020 6372 6564 656e 7469          credenti
-00019300: 616c 3d74 6f6b 656e 290a 2020 2020 2020  al=token).      
-00019310: 2020 7265 7370 6f6e 7365 203d 2072 6571    response = req
-00019320: 7565 7374 732e 6765 7428 6669 6c65 5f63  uests.get(file_c
-00019330: 6c69 656e 742e 7572 6c29 0a0a 2020 2020  lient.url)..    
-00019340: 2020 2020 2320 4173 7365 7274 0a20 2020      # Assert.   
-00019350: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00019360: 5472 7565 2872 6573 706f 6e73 652e 6f6b  True(response.ok
-00019370: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00019380: 7373 6572 7445 7175 616c 2873 656c 662e  ssertEqual(self.
-00019390: 7368 6f72 745f 6279 7465 5f64 6174 612c  short_byte_data,
-000193a0: 2072 6573 706f 6e73 652e 636f 6e74 656e   response.conten
-000193b0: 7429 0a0a 2020 2020 4046 696c 6553 6861  t)..    @FileSha
-000193c0: 7265 5072 6570 6172 6572 2829 0a20 2020  rePreparer().   
-000193d0: 2040 4173 796e 6353 746f 7261 6765 5465   @AsyncStorageTe
-000193e0: 7374 4361 7365 2e61 7761 6974 5f70 7265  stCase.await_pre
-000193f0: 7061 7265 645f 7465 7374 0a20 2020 2061  pared_test.    a
-00019400: 7379 6e63 2064 6566 2074 6573 745f 7368  sync def test_sh
-00019410: 6172 6564 5f72 6561 645f 6163 6365 7373  ared_read_access
-00019420: 5f66 696c 655f 7769 7468 5f63 6f6e 7465  _file_with_conte
-00019430: 6e74 5f71 7565 7279 5f70 6172 616d 735f  nt_query_params_
-00019440: 6173 796e 6328 7365 6c66 2c20 7374 6f72  async(self, stor
-00019450: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
-00019460: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
-00019470: 745f 6b65 7929 3a0a 2020 2020 2020 2020  t_key):.        
-00019480: 2320 5341 5320 5552 4c20 6973 2063 616c  # SAS URL is cal
-00019490: 6375 6c61 7465 6420 6672 6f6d 2073 746f  culated from sto
-000194a0: 7261 6765 206b 6579 2c20 736f 2074 6869  rage key, so thi
-000194b0: 7320 7465 7374 2072 756e 7320 6c69 7665  s test runs live
-000194c0: 206f 6e6c 790a 2020 2020 2020 2020 6966   only.        if
-000194d0: 206e 6f74 2073 656c 662e 6973 5f6c 6976   not self.is_liv
-000194e0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-000194f0: 6574 7572 6e0a 0a20 2020 2020 2020 2073  eturn..        s
-00019500: 656c 662e 5f73 6574 7570 2873 746f 7261  elf._setup(stora
-00019510: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
-00019520: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
-00019530: 5f6b 6579 290a 2020 2020 2020 2020 6669  _key).        fi
-00019540: 6c65 5f63 6c69 656e 7420 3d20 6177 6169  le_client = awai
-00019550: 7420 7365 6c66 2e5f 6372 6561 7465 5f66  t self._create_f
-00019560: 696c 6528 7374 6f72 6167 655f 6163 636f  ile(storage_acco
-00019570: 756e 745f 6e61 6d65 2c20 7374 6f72 6167  unt_name, storag
-00019580: 655f 6163 636f 756e 745f 6b65 7929 0a20  e_account_key). 
-00019590: 2020 2020 2020 2074 6f6b 656e 203d 2067         token = g
-000195a0: 656e 6572 6174 655f 6669 6c65 5f73 6173  enerate_file_sas
-000195b0: 280a 2020 2020 2020 2020 2020 2020 6669  (.            fi
-000195c0: 6c65 5f63 6c69 656e 742e 6163 636f 756e  le_client.accoun
-000195d0: 745f 6e61 6d65 2c0a 2020 2020 2020 2020  t_name,.        
-000195e0: 2020 2020 6669 6c65 5f63 6c69 656e 742e      file_client.
-000195f0: 7368 6172 655f 6e61 6d65 2c0a 2020 2020  share_name,.    
-00019600: 2020 2020 2020 2020 6669 6c65 5f63 6c69          file_cli
-00019610: 656e 742e 6669 6c65 5f70 6174 682c 0a20  ent.file_path,. 
-00019620: 2020 2020 2020 2020 2020 2066 696c 655f             file_
-00019630: 636c 6965 6e74 2e63 7265 6465 6e74 6961  client.credentia
-00019640: 6c2e 6163 636f 756e 745f 6b65 792c 0a20  l.account_key,. 
-00019650: 2020 2020 2020 2020 2020 2070 6572 6d69             permi
-00019660: 7373 696f 6e3d 4669 6c65 5361 7350 6572  ssion=FileSasPer
-00019670: 6d69 7373 696f 6e73 2872 6561 643d 5472  missions(read=Tr
-00019680: 7565 292c 0a20 2020 2020 2020 2020 2020  ue),.           
-00019690: 2065 7870 6972 793d 6461 7465 7469 6d65   expiry=datetime
-000196a0: 2e75 7463 6e6f 7728 2920 2b20 7469 6d65  .utcnow() + time
-000196b0: 6465 6c74 6128 686f 7572 733d 3129 2c0a  delta(hours=1),.
-000196c0: 2020 2020 2020 2020 2020 2020 6361 6368              cach
-000196d0: 655f 636f 6e74 726f 6c3d 276e 6f2d 6361  e_control='no-ca
-000196e0: 6368 6527 2c0a 2020 2020 2020 2020 2020  che',.          
-000196f0: 2020 636f 6e74 656e 745f 6469 7370 6f73    content_dispos
-00019700: 6974 696f 6e3d 2769 6e6c 696e 6527 2c0a  ition='inline',.
-00019710: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-00019720: 656e 745f 656e 636f 6469 6e67 3d27 7574  ent_encoding='ut
-00019730: 662d 3827 2c0a 2020 2020 2020 2020 2020  f-8',.          
-00019740: 2020 636f 6e74 656e 745f 6c61 6e67 7561    content_langua
-00019750: 6765 3d27 6672 272c 0a20 2020 2020 2020  ge='fr',.       
-00019760: 2020 2020 2063 6f6e 7465 6e74 5f74 7970       content_typ
-00019770: 653d 2774 6578 7427 2c0a 2020 2020 2020  e='text',.      
-00019780: 2020 290a 0a20 2020 2020 2020 2023 2041    )..        # A
-00019790: 6374 0a20 2020 2020 2020 2066 696c 655f  ct.        file_
-000197a0: 636c 6965 6e74 203d 2053 6861 7265 4669  client = ShareFi
-000197b0: 6c65 436c 6965 6e74 280a 2020 2020 2020  leClient(.      
-000197c0: 2020 2020 2020 7365 6c66 2e61 6363 6f75        self.accou
-000197d0: 6e74 5f75 726c 2873 746f 7261 6765 5f61  nt_url(storage_a
-000197e0: 6363 6f75 6e74 5f6e 616d 652c 2022 6669  ccount_name, "fi
-000197f0: 6c65 2229 2c0a 2020 2020 2020 2020 2020  le"),.          
-00019800: 2020 7368 6172 655f 6e61 6d65 3d73 656c    share_name=sel
-00019810: 662e 7368 6172 655f 6e61 6d65 2c0a 2020  f.share_name,.  
-00019820: 2020 2020 2020 2020 2020 6669 6c65 5f70            file_p
-00019830: 6174 683d 6669 6c65 5f63 6c69 656e 742e  ath=file_client.
-00019840: 6669 6c65 5f6e 616d 652c 0a20 2020 2020  file_name,.     
-00019850: 2020 2020 2020 2063 7265 6465 6e74 6961         credentia
-00019860: 6c3d 746f 6b65 6e29 0a20 2020 2020 2020  l=token).       
-00019870: 2072 6573 706f 6e73 6520 3d20 7265 7175   response = requ
-00019880: 6573 7473 2e67 6574 2866 696c 655f 636c  ests.get(file_cl
-00019890: 6965 6e74 2e75 726c 290a 0a20 2020 2020  ient.url)..     
-000198a0: 2020 2023 2041 7373 6572 740a 2020 2020     # Assert.    
-000198b0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-000198c0: 7175 616c 2873 656c 662e 7368 6f72 745f  qual(self.short_
-000198d0: 6279 7465 5f64 6174 612c 2072 6573 706f  byte_data, respo
-000198e0: 6e73 652e 636f 6e74 656e 7429 0a20 2020  nse.content).   
-000198f0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00019900: 4571 7561 6c28 7265 7370 6f6e 7365 2e68  Equal(response.h
-00019910: 6561 6465 7273 5b27 6361 6368 652d 636f  eaders['cache-co
-00019920: 6e74 726f 6c27 5d2c 2027 6e6f 2d63 6163  ntrol'], 'no-cac
-00019930: 6865 2729 0a20 2020 2020 2020 2073 656c  he').        sel
-00019940: 662e 6173 7365 7274 4571 7561 6c28 7265  f.assertEqual(re
-00019950: 7370 6f6e 7365 2e68 6561 6465 7273 5b27  sponse.headers['
-00019960: 636f 6e74 656e 742d 6469 7370 6f73 6974  content-disposit
-00019970: 696f 6e27 5d2c 2027 696e 6c69 6e65 2729  ion'], 'inline')
-00019980: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00019990: 7365 7274 4571 7561 6c28 7265 7370 6f6e  sertEqual(respon
-000199a0: 7365 2e68 6561 6465 7273 5b27 636f 6e74  se.headers['cont
-000199b0: 656e 742d 656e 636f 6469 6e67 275d 2c20  ent-encoding'], 
-000199c0: 2775 7466 2d38 2729 0a20 2020 2020 2020  'utf-8').       
-000199d0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-000199e0: 6c28 7265 7370 6f6e 7365 2e68 6561 6465  l(response.heade
-000199f0: 7273 5b27 636f 6e74 656e 742d 6c61 6e67  rs['content-lang
-00019a00: 7561 6765 275d 2c20 2766 7227 290a 2020  uage'], 'fr').  
-00019a10: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00019a20: 7445 7175 616c 2872 6573 706f 6e73 652e  tEqual(response.
-00019a30: 6865 6164 6572 735b 2763 6f6e 7465 6e74  headers['content
-00019a40: 2d74 7970 6527 5d2c 2027 7465 7874 2729  -type'], 'text')
-00019a50: 0a0a 2020 2020 4046 696c 6553 6861 7265  ..    @FileShare
-00019a60: 5072 6570 6172 6572 2829 0a20 2020 2040  Preparer().    @
-00019a70: 4173 796e 6353 746f 7261 6765 5465 7374  AsyncStorageTest
-00019a80: 4361 7365 2e61 7761 6974 5f70 7265 7061  Case.await_prepa
-00019a90: 7265 645f 7465 7374 0a20 2020 2061 7379  red_test.    asy
-00019aa0: 6e63 2064 6566 2074 6573 745f 7368 6172  nc def test_shar
-00019ab0: 6564 5f77 7269 7465 5f61 6363 6573 735f  ed_write_access_
-00019ac0: 6669 6c65 5f61 7379 6e63 2873 656c 662c  file_async(self,
-00019ad0: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
-00019ae0: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
-00019af0: 6363 6f75 6e74 5f6b 6579 293a 0a20 2020  ccount_key):.   
-00019b00: 2020 2020 2023 2053 4153 2055 524c 2069       # SAS URL i
-00019b10: 7320 6361 6c63 756c 6174 6564 2066 726f  s calculated fro
-00019b20: 6d20 7374 6f72 6167 6520 6b65 792c 2073  m storage key, s
-00019b30: 6f20 7468 6973 2074 6573 7420 7275 6e73  o this test runs
-00019b40: 206c 6976 6520 6f6e 6c79 0a20 2020 2020   live only.     
-00019b50: 2020 2069 6620 6e6f 7420 7365 6c66 2e69     if not self.i
-00019b60: 735f 6c69 7665 3a0a 2020 2020 2020 2020  s_live:.        
-00019b70: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
-00019b80: 2020 2020 7365 6c66 2e5f 7365 7475 7028      self._setup(
-00019b90: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-00019ba0: 6e61 6d65 2c20 7374 6f72 6167 655f 6163  name, storage_ac
-00019bb0: 636f 756e 745f 6b65 7929 0a20 2020 2020  count_key).     
-00019bc0: 2020 2075 7064 6174 6564 5f64 6174 6120     updated_data 
-00019bd0: 3d20 6227 7570 6461 7465 6420 6669 6c65  = b'updated file
-00019be0: 2064 6174 6127 0a20 2020 2020 2020 2066   data'.        f
-00019bf0: 696c 655f 636c 6965 6e74 5f61 646d 696e  ile_client_admin
-00019c00: 203d 2061 7761 6974 2073 656c 662e 5f63   = await self._c
-00019c10: 7265 6174 655f 6669 6c65 2873 746f 7261  reate_file(stora
-00019c20: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
-00019c30: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
-00019c40: 5f6b 6579 290a 2020 2020 2020 2020 746f  _key).        to
-00019c50: 6b65 6e20 3d20 6765 6e65 7261 7465 5f66  ken = generate_f
-00019c60: 696c 655f 7361 7328 0a20 2020 2020 2020  ile_sas(.       
-00019c70: 2020 2020 2066 696c 655f 636c 6965 6e74       file_client
-00019c80: 5f61 646d 696e 2e61 6363 6f75 6e74 5f6e  _admin.account_n
-00019c90: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
-00019ca0: 2066 696c 655f 636c 6965 6e74 5f61 646d   file_client_adm
-00019cb0: 696e 2e73 6861 7265 5f6e 616d 652c 0a20  in.share_name,. 
-00019cc0: 2020 2020 2020 2020 2020 2066 696c 655f             file_
-00019cd0: 636c 6965 6e74 5f61 646d 696e 2e66 696c  client_admin.fil
-00019ce0: 655f 7061 7468 2c0a 2020 2020 2020 2020  e_path,.        
-00019cf0: 2020 2020 6669 6c65 5f63 6c69 656e 745f      file_client_
-00019d00: 6164 6d69 6e2e 6372 6564 656e 7469 616c  admin.credential
-00019d10: 2e61 6363 6f75 6e74 5f6b 6579 2c0a 2020  .account_key,.  
-00019d20: 2020 2020 2020 2020 2020 7065 726d 6973            permis
-00019d30: 7369 6f6e 3d46 696c 6553 6173 5065 726d  sion=FileSasPerm
-00019d40: 6973 7369 6f6e 7328 7772 6974 653d 5472  issions(write=Tr
-00019d50: 7565 292c 0a20 2020 2020 2020 2020 2020  ue),.           
-00019d60: 2065 7870 6972 793d 6461 7465 7469 6d65   expiry=datetime
-00019d70: 2e75 7463 6e6f 7728 2920 2b20 7469 6d65  .utcnow() + time
-00019d80: 6465 6c74 6128 686f 7572 733d 3129 2c0a  delta(hours=1),.
-00019d90: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00019da0: 2020 6669 6c65 5f63 6c69 656e 7420 3d20    file_client = 
-00019db0: 5368 6172 6546 696c 6543 6c69 656e 7428  ShareFileClient(
-00019dc0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00019dd0: 662e 6163 636f 756e 745f 7572 6c28 7374  f.account_url(st
-00019de0: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
-00019df0: 6d65 2c20 2266 696c 6522 292c 0a20 2020  me, "file"),.   
-00019e00: 2020 2020 2020 2020 2073 6861 7265 5f6e           share_n
-00019e10: 616d 653d 7365 6c66 2e73 6861 7265 5f6e  ame=self.share_n
-00019e20: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
-00019e30: 2066 696c 655f 7061 7468 3d66 696c 655f   file_path=file_
-00019e40: 636c 6965 6e74 5f61 646d 696e 2e66 696c  client_admin.fil
-00019e50: 655f 6e61 6d65 2c0a 2020 2020 2020 2020  e_name,.        
-00019e60: 2020 2020 6372 6564 656e 7469 616c 3d74      credential=t
-00019e70: 6f6b 656e 290a 0a20 2020 2020 2020 2023  oken)..        #
-00019e80: 2041 6374 0a20 2020 2020 2020 2068 6561   Act.        hea
-00019e90: 6465 7273 203d 207b 2778 2d6d 732d 7261  ders = {'x-ms-ra
-00019ea0: 6e67 6527 3a20 2762 7974 6573 3d30 2d31  nge': 'bytes=0-1
-00019eb0: 3627 2c20 2778 2d6d 732d 7772 6974 6527  6', 'x-ms-write'
-00019ec0: 3a20 2775 7064 6174 6527 7d0a 2020 2020  : 'update'}.    
-00019ed0: 2020 2020 7265 7370 6f6e 7365 203d 2072      response = r
-00019ee0: 6571 7565 7374 732e 7075 7428 6669 6c65  equests.put(file
-00019ef0: 5f63 6c69 656e 742e 7572 6c20 2b20 2726  _client.url + '&
-00019f00: 636f 6d70 3d72 616e 6765 272c 2068 6561  comp=range', hea
-00019f10: 6465 7273 3d68 6561 6465 7273 2c20 6461  ders=headers, da
-00019f20: 7461 3d75 7064 6174 6564 5f64 6174 6129  ta=updated_data)
-00019f30: 0a0a 2020 2020 2020 2020 2320 4173 7365  ..        # Asse
-00019f40: 7274 0a20 2020 2020 2020 2073 656c 662e  rt.        self.
-00019f50: 6173 7365 7274 5472 7565 2872 6573 706f  assertTrue(respo
-00019f60: 6e73 652e 6f6b 290a 2020 2020 2020 2020  nse.ok).        
-00019f70: 6669 6c65 5f63 6f6e 7465 6e74 203d 2061  file_content = a
-00019f80: 7761 6974 2066 696c 655f 636c 6965 6e74  wait file_client
-00019f90: 5f61 646d 696e 2e64 6f77 6e6c 6f61 645f  _admin.download_
-00019fa0: 6669 6c65 2829 0a20 2020 2020 2020 2066  file().        f
-00019fb0: 696c 655f 636f 6e74 656e 7420 3d20 6177  ile_content = aw
-00019fc0: 6169 7420 6669 6c65 5f63 6f6e 7465 6e74  ait file_content
-00019fd0: 2e72 6561 6461 6c6c 2829 0a20 2020 2020  .readall().     
-00019fe0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00019ff0: 7561 6c28 7570 6461 7465 645f 6461 7461  ual(updated_data
-0001a000: 2c20 6669 6c65 5f63 6f6e 7465 6e74 5b3a  , file_content[:
-0001a010: 6c65 6e28 7570 6461 7465 645f 6461 7461  len(updated_data
-0001a020: 295d 290a 0a20 2020 2040 4669 6c65 5368  )])..    @FileSh
-0001a030: 6172 6550 7265 7061 7265 7228 290a 2020  arePreparer().  
-0001a040: 2020 4041 7379 6e63 5374 6f72 6167 6554    @AsyncStorageT
-0001a050: 6573 7443 6173 652e 6177 6169 745f 7072  estCase.await_pr
-0001a060: 6570 6172 6564 5f74 6573 740a 2020 2020  epared_test.    
-0001a070: 6173 796e 6320 6465 6620 7465 7374 5f73  async def test_s
-0001a080: 6861 7265 645f 6465 6c65 7465 5f61 6363  hared_delete_acc
-0001a090: 6573 735f 6669 6c65 5f61 7379 6e63 2873  ess_file_async(s
-0001a0a0: 656c 662c 2073 746f 7261 6765 5f61 6363  elf, storage_acc
-0001a0b0: 6f75 6e74 5f6e 616d 652c 2073 746f 7261  ount_name, stora
-0001a0c0: 6765 5f61 6363 6f75 6e74 5f6b 6579 293a  ge_account_key):
-0001a0d0: 0a20 2020 2020 2020 2023 2053 4153 2055  .        # SAS U
-0001a0e0: 524c 2069 7320 6361 6c63 756c 6174 6564  RL is calculated
-0001a0f0: 2066 726f 6d20 7374 6f72 6167 6520 6b65   from storage ke
-0001a100: 792c 2073 6f20 7468 6973 2074 6573 7420  y, so this test 
-0001a110: 7275 6e73 206c 6976 6520 6f6e 6c79 0a20  runs live only. 
-0001a120: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
-0001a130: 6c66 2e69 735f 6c69 7665 3a0a 2020 2020  lf.is_live:.    
-0001a140: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
-0001a150: 2020 2020 2020 2020 7365 6c66 2e5f 7365          self._se
-0001a160: 7475 7028 7374 6f72 6167 655f 6163 636f  tup(storage_acco
+000015c0: 6363 6f75 6e74 5f6b 6579 2c20 6669 6c65  ccount_key, file
+000015d0: 5f6e 616d 653d 4e6f 6e65 2c20 6669 6c65  _name=None, file
+000015e0: 5f73 697a 653d 3230 3438 293a 0a20 2020  _size=2048):.   
+000015f0: 2020 2020 2061 7761 6974 2073 656c 662e       await self.
+00001600: 5f73 6574 7570 5f73 6861 7265 2873 746f  _setup_share(sto
+00001610: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
+00001620: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
+00001630: 6e74 5f6b 6579 290a 2020 2020 2020 2020  nt_key).        
+00001640: 6669 6c65 5f6e 616d 6520 3d20 7365 6c66  file_name = self
+00001650: 2e5f 6765 745f 6669 6c65 5f72 6566 6572  ._get_file_refer
+00001660: 656e 6365 2829 2069 6620 6669 6c65 5f6e  ence() if file_n
+00001670: 616d 6520 6973 204e 6f6e 6520 656c 7365  ame is None else
+00001680: 2066 696c 655f 6e61 6d65 0a20 2020 2020   file_name.     
+00001690: 2020 2073 6861 7265 5f63 6c69 656e 7420     share_client 
+000016a0: 3d20 7365 6c66 2e66 7363 2e67 6574 5f73  = self.fsc.get_s
+000016b0: 6861 7265 5f63 6c69 656e 7428 7365 6c66  hare_client(self
+000016c0: 2e73 6861 7265 5f6e 616d 6529 0a20 2020  .share_name).   
+000016d0: 2020 2020 2066 696c 655f 636c 6965 6e74       file_client
+000016e0: 203d 2073 6861 7265 5f63 6c69 656e 742e   = share_client.
+000016f0: 6765 745f 6669 6c65 5f63 6c69 656e 7428  get_file_client(
+00001700: 6669 6c65 5f6e 616d 6529 0a20 2020 2020  file_name).     
+00001710: 2020 2061 7761 6974 2066 696c 655f 636c     await file_cl
+00001720: 6965 6e74 2e63 7265 6174 655f 6669 6c65  ient.create_file
+00001730: 2866 696c 655f 7369 7a65 290a 2020 2020  (file_size).    
+00001740: 2020 2020 7265 7475 726e 2066 696c 655f      return file_
+00001750: 636c 6965 6e74 0a0a 2020 2020 6173 796e  client..    asyn
+00001760: 6320 6465 6620 5f67 6574 5f66 696c 655f  c def _get_file_
+00001770: 636c 6965 6e74 2873 656c 662c 2073 746f  client(self, sto
+00001780: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
+00001790: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
+000017a0: 6e74 5f6b 6579 293a 0a20 2020 2020 2020  nt_key):.       
+000017b0: 2061 7761 6974 2073 656c 662e 5f73 6574   await self._set
+000017c0: 7570 5f73 6861 7265 2873 746f 7261 6765  up_share(storage
+000017d0: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
+000017e0: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
+000017f0: 6579 290a 2020 2020 2020 2020 6669 6c65  ey).        file
+00001800: 5f6e 616d 6520 3d20 7365 6c66 2e5f 6765  _name = self._ge
+00001810: 745f 6669 6c65 5f72 6566 6572 656e 6365  t_file_reference
+00001820: 2829 0a20 2020 2020 2020 2073 6861 7265  ().        share
+00001830: 5f63 6c69 656e 7420 3d20 7365 6c66 2e66  _client = self.f
+00001840: 7363 2e67 6574 5f73 6861 7265 5f63 6c69  sc.get_share_cli
+00001850: 656e 7428 7365 6c66 2e73 6861 7265 5f6e  ent(self.share_n
+00001860: 616d 6529 0a20 2020 2020 2020 2066 696c  ame).        fil
+00001870: 655f 636c 6965 6e74 203d 2073 6861 7265  e_client = share
+00001880: 5f63 6c69 656e 742e 6765 745f 6669 6c65  _client.get_file
+00001890: 5f63 6c69 656e 7428 6669 6c65 5f6e 616d  _client(file_nam
+000018a0: 6529 0a20 2020 2020 2020 2072 6574 7572  e).        retur
+000018b0: 6e20 6669 6c65 5f63 6c69 656e 740a 0a20  n file_client.. 
+000018c0: 2020 2061 7379 6e63 2064 6566 205f 6372     async def _cr
+000018d0: 6561 7465 5f72 656d 6f74 655f 7368 6172  eate_remote_shar
+000018e0: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
+000018f0: 2073 656c 662e 7265 6d6f 7465 5f73 6861   self.remote_sha
+00001900: 7265 5f6e 616d 6520 3d20 7365 6c66 2e67  re_name = self.g
+00001910: 6574 5f72 6573 6f75 7263 655f 6e61 6d65  et_resource_name
+00001920: 2827 7265 6d6f 7465 7368 6172 6527 290a  ('remoteshare').
+00001930: 2020 2020 2020 2020 7265 6d6f 7465 5f73          remote_s
+00001940: 6861 7265 203d 2073 656c 662e 6673 6332  hare = self.fsc2
+00001950: 2e67 6574 5f73 6861 7265 5f63 6c69 656e  .get_share_clien
+00001960: 7428 7365 6c66 2e72 656d 6f74 655f 7368  t(self.remote_sh
+00001970: 6172 655f 6e61 6d65 290a 2020 2020 2020  are_name).      
+00001980: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00001990: 2020 2061 7761 6974 2072 656d 6f74 655f     await remote_
+000019a0: 7368 6172 652e 6372 6561 7465 5f73 6861  share.create_sha
+000019b0: 7265 2829 0a20 2020 2020 2020 2065 7863  re().        exc
+000019c0: 6570 7420 5265 736f 7572 6365 4578 6973  ept ResourceExis
+000019d0: 7473 4572 726f 723a 0a20 2020 2020 2020  tsError:.       
+000019e0: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
+000019f0: 2020 7265 7475 726e 2072 656d 6f74 655f    return remote_
+00001a00: 7368 6172 650a 0a20 2020 2061 7379 6e63  share..    async
+00001a10: 2064 6566 205f 6372 6561 7465 5f72 656d   def _create_rem
+00001a20: 6f74 655f 6669 6c65 2873 656c 662c 2066  ote_file(self, f
+00001a30: 696c 655f 6461 7461 3d4e 6f6e 6529 3a0a  ile_data=None):.
+00001a40: 2020 2020 2020 2020 6966 206e 6f74 2066          if not f
+00001a50: 696c 655f 6461 7461 3a0a 2020 2020 2020  ile_data:.      
+00001a60: 2020 2020 2020 6669 6c65 5f64 6174 6120        file_data 
+00001a70: 3d20 6227 3132 3334 3536 3738 2720 2a20  = b'12345678' * 
+00001a80: 3130 3234 202a 2031 3032 340a 2020 2020  1024 * 1024.    
+00001a90: 2020 2020 736f 7572 6365 5f66 696c 655f      source_file_
+00001aa0: 6e61 6d65 203d 2073 656c 662e 5f67 6574  name = self._get
+00001ab0: 5f66 696c 655f 7265 6665 7265 6e63 6528  _file_reference(
+00001ac0: 290a 2020 2020 2020 2020 7265 6d6f 7465  ).        remote
+00001ad0: 5f73 6861 7265 203d 2073 656c 662e 6673  _share = self.fs
+00001ae0: 6332 2e67 6574 5f73 6861 7265 5f63 6c69  c2.get_share_cli
+00001af0: 656e 7428 7365 6c66 2e72 656d 6f74 655f  ent(self.remote_
+00001b00: 7368 6172 655f 6e61 6d65 290a 2020 2020  share_name).    
+00001b10: 2020 2020 7265 6d6f 7465 5f66 696c 6520      remote_file 
+00001b20: 3d20 7265 6d6f 7465 5f73 6861 7265 2e67  = remote_share.g
+00001b30: 6574 5f66 696c 655f 636c 6965 6e74 2873  et_file_client(s
+00001b40: 6f75 7263 655f 6669 6c65 5f6e 616d 6529  ource_file_name)
+00001b50: 0a20 2020 2020 2020 2061 7761 6974 2072  .        await r
+00001b60: 656d 6f74 655f 6669 6c65 2e75 706c 6f61  emote_file.uploa
+00001b70: 645f 6669 6c65 2866 696c 655f 6461 7461  d_file(file_data
+00001b80: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00001b90: 2072 656d 6f74 655f 6669 6c65 0a0a 2020   remote_file..  
+00001ba0: 2020 6173 796e 6320 6465 6620 5f77 6169    async def _wai
+00001bb0: 745f 666f 725f 6173 796e 635f 636f 7079  t_for_async_copy
+00001bc0: 2873 656c 662c 2073 6861 7265 5f6e 616d  (self, share_nam
+00001bd0: 652c 2066 696c 655f 7061 7468 293a 0a20  e, file_path):. 
+00001be0: 2020 2020 2020 2063 6f75 6e74 203d 2030         count = 0
+00001bf0: 0a20 2020 2020 2020 2073 6861 7265 5f63  .        share_c
+00001c00: 6c69 656e 7420 3d20 7365 6c66 2e66 7363  lient = self.fsc
+00001c10: 2e67 6574 5f73 6861 7265 5f63 6c69 656e  .get_share_clien
+00001c20: 7428 7368 6172 655f 6e61 6d65 290a 2020  t(share_name).  
+00001c30: 2020 2020 2020 6669 6c65 5f63 6c69 656e        file_clien
+00001c40: 7420 3d20 7368 6172 655f 636c 6965 6e74  t = share_client
+00001c50: 2e67 6574 5f66 696c 655f 636c 6965 6e74  .get_file_client
+00001c60: 2866 696c 655f 7061 7468 290a 2020 2020  (file_path).    
+00001c70: 2020 2020 7072 6f70 6572 7469 6573 203d      properties =
+00001c80: 2061 7761 6974 2066 696c 655f 636c 6965   await file_clie
+00001c90: 6e74 2e67 6574 5f66 696c 655f 7072 6f70  nt.get_file_prop
+00001ca0: 6572 7469 6573 2829 0a20 2020 2020 2020  erties().       
+00001cb0: 2077 6869 6c65 2070 726f 7065 7274 6965   while propertie
+00001cc0: 732e 636f 7079 2e73 7461 7475 7320 213d  s.copy.status !=
+00001cd0: 2027 7375 6363 6573 7327 3a0a 2020 2020   'success':.    
+00001ce0: 2020 2020 2020 2020 636f 756e 7420 3d20          count = 
+00001cf0: 636f 756e 7420 2b20 310a 2020 2020 2020  count + 1.      
+00001d00: 2020 2020 2020 6966 2063 6f75 6e74 203e        if count >
+00001d10: 2031 303a 0a20 2020 2020 2020 2020 2020   10:.           
+00001d20: 2020 2020 2073 656c 662e 6661 696c 2827       self.fail('
+00001d30: 5469 6d65 6420 6f75 7420 7761 6974 696e  Timed out waitin
+00001d40: 6720 666f 7220 6173 796e 6320 636f 7079  g for async copy
+00001d50: 2074 6f20 636f 6d70 6c65 7465 2e27 290a   to complete.').
+00001d60: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00001d70: 2e73 6c65 6570 2836 290a 2020 2020 2020  .sleep(6).      
+00001d80: 2020 2020 2020 7072 6f70 6572 7469 6573        properties
+00001d90: 203d 2061 7761 6974 2066 696c 655f 636c   = await file_cl
+00001da0: 6965 6e74 2e67 6574 5f66 696c 655f 7072  ient.get_file_pr
+00001db0: 6f70 6572 7469 6573 2829 0a20 2020 2020  operties().     
+00001dc0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00001dd0: 7561 6c28 7072 6f70 6572 7469 6573 2e63  ual(properties.c
+00001de0: 6f70 792e 7374 6174 7573 2c20 2773 7563  opy.status, 'suc
+00001df0: 6365 7373 2729 0a0a 2020 2020 6173 796e  cess')..    asyn
+00001e00: 6320 6465 6620 6173 7365 7274 4669 6c65  c def assertFile
+00001e10: 4571 7561 6c28 7365 6c66 2c20 6669 6c65  Equal(self, file
+00001e20: 5f63 6c69 656e 742c 2065 7870 6563 7465  _client, expecte
+00001e30: 645f 6461 7461 293a 0a20 2020 2020 2020  d_data):.       
+00001e40: 2063 6f6e 7465 6e74 203d 2061 7761 6974   content = await
+00001e50: 2066 696c 655f 636c 6965 6e74 2e64 6f77   file_client.dow
+00001e60: 6e6c 6f61 645f 6669 6c65 2829 0a20 2020  nload_file().   
+00001e70: 2020 2020 2061 6374 7561 6c5f 6461 7461       actual_data
+00001e80: 203d 2061 7761 6974 2063 6f6e 7465 6e74   = await content
+00001e90: 2e72 6561 6461 6c6c 2829 0a20 2020 2020  .readall().     
+00001ea0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00001eb0: 7561 6c28 6163 7475 616c 5f64 6174 612c  ual(actual_data,
+00001ec0: 2065 7870 6563 7465 645f 6461 7461 290a   expected_data).
+00001ed0: 0a20 2020 2063 6c61 7373 204e 6f6e 5365  .    class NonSe
+00001ee0: 656b 6162 6c65 4669 6c65 286f 626a 6563  ekableFile(objec
+00001ef0: 7429 3a0a 2020 2020 2020 2020 6465 6620  t):.        def 
+00001f00: 5f5f 696e 6974 5f5f 2873 656c 662c 2077  __init__(self, w
+00001f10: 7261 7070 6564 5f66 696c 6529 3a0a 2020  rapped_file):.  
+00001f20: 2020 2020 2020 2020 2020 7365 6c66 2e77            self.w
+00001f30: 7261 7070 6564 5f66 696c 6520 3d20 7772  rapped_file = wr
+00001f40: 6170 7065 645f 6669 6c65 0a0a 2020 2020  apped_file..    
+00001f50: 2020 2020 6465 6620 7772 6974 6528 7365      def write(se
+00001f60: 6c66 2c20 6461 7461 293a 0a20 2020 2020  lf, data):.     
+00001f70: 2020 2020 2020 2073 656c 662e 7772 6170         self.wrap
+00001f80: 7065 645f 6669 6c65 2e77 7269 7465 2864  ped_file.write(d
+00001f90: 6174 6129 0a0a 2020 2020 2020 2020 6465  ata)..        de
+00001fa0: 6620 7265 6164 2873 656c 662c 2063 6f75  f read(self, cou
+00001fb0: 6e74 293a 0a20 2020 2020 2020 2020 2020  nt):.           
+00001fc0: 2072 6574 7572 6e20 7365 6c66 2e77 7261   return self.wra
+00001fd0: 7070 6564 5f66 696c 652e 7265 6164 2863  pped_file.read(c
+00001fe0: 6f75 6e74 290a 0a20 2020 2023 202d 2d54  ount)..    # --T
+00001ff0: 6573 7420 6361 7365 7320 666f 7220 6669  est cases for fi
+00002000: 6c65 7320 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  les ------------
+00002010: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00002020: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00002030: 2d2d 0a20 2020 2040 4669 6c65 5368 6172  --.    @FileShar
+00002040: 6550 7265 7061 7265 7228 290a 2020 2020  ePreparer().    
+00002050: 4041 7379 6e63 5374 6f72 6167 6554 6573  @AsyncStorageTes
+00002060: 7443 6173 652e 6177 6169 745f 7072 6570  tCase.await_prep
+00002070: 6172 6564 5f74 6573 740a 2020 2020 6173  ared_test.    as
+00002080: 796e 6320 6465 6620 7465 7374 5f6d 616b  ync def test_mak
+00002090: 655f 6669 6c65 5f75 726c 5f61 7379 6e63  e_file_url_async
+000020a0: 2873 656c 662c 2073 746f 7261 6765 5f61  (self, storage_a
+000020b0: 6363 6f75 6e74 5f6e 616d 652c 2073 746f  ccount_name, sto
+000020c0: 7261 6765 5f61 6363 6f75 6e74 5f6b 6579  rage_account_key
+000020d0: 293a 0a20 2020 2020 2020 2073 656c 662e  ):.        self.
+000020e0: 5f73 6574 7570 2873 746f 7261 6765 5f61  _setup(storage_a
+000020f0: 6363 6f75 6e74 5f6e 616d 652c 2073 746f  ccount_name, sto
+00002100: 7261 6765 5f61 6363 6f75 6e74 5f6b 6579  rage_account_key
+00002110: 290a 0a20 2020 2020 2020 2073 6861 7265  )..        share
+00002120: 203d 2073 656c 662e 6673 632e 6765 745f   = self.fsc.get_
+00002130: 7368 6172 655f 636c 6965 6e74 2822 7668  share_client("vh
+00002140: 6473 2229 0a20 2020 2020 2020 2066 696c  ds").        fil
+00002150: 655f 636c 6965 6e74 203d 2073 6861 7265  e_client = share
+00002160: 2e67 6574 5f66 696c 655f 636c 6965 6e74  .get_file_client
+00002170: 2822 7668 645f 6469 722f 6d79 2e76 6864  ("vhd_dir/my.vhd
+00002180: 2229 0a0a 2020 2020 2020 2020 2320 4163  ")..        # Ac
+00002190: 740a 2020 2020 2020 2020 7265 7320 3d20  t.        res = 
+000021a0: 6669 6c65 5f63 6c69 656e 742e 7572 6c0a  file_client.url.
+000021b0: 0a20 2020 2020 2020 2023 2041 7373 6572  .        # Asser
+000021c0: 740a 2020 2020 2020 2020 7365 6c66 2e61  t.        self.a
+000021d0: 7373 6572 7445 7175 616c 2872 6573 2c20  ssertEqual(res, 
+000021e0: 2768 7474 7073 3a2f 2f27 202b 2073 746f  'https://' + sto
+000021f0: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
+00002200: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00002210: 2020 2020 2020 2020 2020 202b 2027 2e66             + '.f
+00002220: 696c 652e 636f 7265 2e77 696e 646f 7773  ile.core.windows
+00002230: 2e6e 6574 2f76 6864 732f 7668 645f 6469  .net/vhds/vhd_di
+00002240: 722f 6d79 2e76 6864 2729 0a0a 2020 2020  r/my.vhd')..    
+00002250: 4046 696c 6553 6861 7265 5072 6570 6172  @FileSharePrepar
+00002260: 6572 2829 0a20 2020 2040 4173 796e 6353  er().    @AsyncS
+00002270: 746f 7261 6765 5465 7374 4361 7365 2e61  torageTestCase.a
+00002280: 7761 6974 5f70 7265 7061 7265 645f 7465  wait_prepared_te
+00002290: 7374 0a20 2020 2061 7379 6e63 2064 6566  st.    async def
+000022a0: 2074 6573 745f 6d61 6b65 5f66 696c 655f   test_make_file_
+000022b0: 7572 6c5f 6e6f 5f64 6972 6563 746f 7279  url_no_directory
+000022c0: 5f61 7379 6e63 2873 656c 662c 2073 746f  _async(self, sto
+000022d0: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
+000022e0: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
+000022f0: 6e74 5f6b 6579 293a 0a20 2020 2020 2020  nt_key):.       
+00002300: 2073 656c 662e 5f73 6574 7570 2873 746f   self._setup(sto
+00002310: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
+00002320: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
+00002330: 6e74 5f6b 6579 290a 2020 2020 2020 2020  nt_key).        
+00002340: 7368 6172 6520 3d20 7365 6c66 2e66 7363  share = self.fsc
+00002350: 2e67 6574 5f73 6861 7265 5f63 6c69 656e  .get_share_clien
+00002360: 7428 2276 6864 7322 290a 2020 2020 2020  t("vhds").      
+00002370: 2020 6669 6c65 5f63 6c69 656e 7420 3d20    file_client = 
+00002380: 7368 6172 652e 6765 745f 6669 6c65 5f63  share.get_file_c
+00002390: 6c69 656e 7428 226d 792e 7668 6422 290a  lient("my.vhd").
+000023a0: 0a20 2020 2020 2020 2023 2041 6374 0a20  .        # Act. 
+000023b0: 2020 2020 2020 2072 6573 203d 2066 696c         res = fil
+000023c0: 655f 636c 6965 6e74 2e75 726c 0a0a 2020  e_client.url..  
+000023d0: 2020 2020 2020 2320 4173 7365 7274 0a20        # Assert. 
+000023e0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+000023f0: 7274 4571 7561 6c28 7265 732c 2027 6874  rtEqual(res, 'ht
+00002400: 7470 733a 2f2f 2720 2b20 7374 6f72 6167  tps://' + storag
+00002410: 655f 6163 636f 756e 745f 6e61 6d65 0a20  e_account_name. 
+00002420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002430: 2020 2020 2020 2020 2b20 272e 6669 6c65          + '.file
+00002440: 2e63 6f72 652e 7769 6e64 6f77 732e 6e65  .core.windows.ne
+00002450: 742f 7668 6473 2f6d 792e 7668 6427 290a  t/vhds/my.vhd').
+00002460: 0a20 2020 2040 4669 6c65 5368 6172 6550  .    @FileShareP
+00002470: 7265 7061 7265 7228 290a 2020 2020 4041  reparer().    @A
+00002480: 7379 6e63 5374 6f72 6167 6554 6573 7443  syncStorageTestC
+00002490: 6173 652e 6177 6169 745f 7072 6570 6172  ase.await_prepar
+000024a0: 6564 5f74 6573 740a 2020 2020 6173 796e  ed_test.    asyn
+000024b0: 6320 6465 6620 7465 7374 5f6d 616b 655f  c def test_make_
+000024c0: 6669 6c65 5f75 726c 5f77 6974 685f 7072  file_url_with_pr
+000024d0: 6f74 6f63 6f6c 2873 656c 662c 2073 746f  otocol(self, sto
+000024e0: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
+000024f0: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
+00002500: 6e74 5f6b 6579 293a 0a20 2020 2020 2020  nt_key):.       
+00002510: 2073 656c 662e 5f73 6574 7570 2873 746f   self._setup(sto
+00002520: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
+00002530: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
+00002540: 6e74 5f6b 6579 290a 2020 2020 2020 2020  nt_key).        
+00002550: 7572 6c20 3d20 7365 6c66 2e61 6363 6f75  url = self.accou
+00002560: 6e74 5f75 726c 2873 746f 7261 6765 5f61  nt_url(storage_a
+00002570: 6363 6f75 6e74 5f6e 616d 652c 2022 6669  ccount_name, "fi
+00002580: 6c65 2229 2e72 6570 6c61 6365 2827 6874  le").replace('ht
+00002590: 7470 7327 2c20 2768 7474 7027 290a 2020  tps', 'http').  
+000025a0: 2020 2020 2020 6673 6320 3d20 5368 6172        fsc = Shar
+000025b0: 6553 6572 7669 6365 436c 6965 6e74 2875  eServiceClient(u
+000025c0: 726c 2c20 6372 6564 656e 7469 616c 3d73  rl, credential=s
+000025d0: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
+000025e0: 6579 290a 2020 2020 2020 2020 7368 6172  ey).        shar
+000025f0: 6520 3d20 6673 632e 6765 745f 7368 6172  e = fsc.get_shar
+00002600: 655f 636c 6965 6e74 2822 7668 6473 2229  e_client("vhds")
+00002610: 0a20 2020 2020 2020 2066 696c 655f 636c  .        file_cl
+00002620: 6965 6e74 203d 2073 6861 7265 2e67 6574  ient = share.get
+00002630: 5f66 696c 655f 636c 6965 6e74 2822 7668  _file_client("vh
+00002640: 645f 6469 722f 6d79 2e76 6864 2229 0a0a  d_dir/my.vhd")..
+00002650: 2020 2020 2020 2020 2320 4163 740a 2020          # Act.  
+00002660: 2020 2020 2020 7265 7320 3d20 6669 6c65        res = file
+00002670: 5f63 6c69 656e 742e 7572 6c0a 0a20 2020  _client.url..   
+00002680: 2020 2020 2023 2041 7373 6572 740a 2020       # Assert.  
+00002690: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+000026a0: 7445 7175 616c 2872 6573 2c20 2768 7474  tEqual(res, 'htt
+000026b0: 703a 2f2f 2720 2b20 7374 6f72 6167 655f  p://' + storage_
+000026c0: 6163 636f 756e 745f 6e61 6d65 0a20 2020  account_name.   
+000026d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000026e0: 2020 2020 2020 2b20 272e 6669 6c65 2e63        + '.file.c
+000026f0: 6f72 652e 7769 6e64 6f77 732e 6e65 742f  ore.windows.net/
+00002700: 7668 6473 2f76 6864 5f64 6972 2f6d 792e  vhds/vhd_dir/my.
+00002710: 7668 6427 290a 0a20 2020 2040 4669 6c65  vhd')..    @File
+00002720: 5368 6172 6550 7265 7061 7265 7228 290a  SharePreparer().
+00002730: 2020 2020 4041 7379 6e63 5374 6f72 6167      @AsyncStorag
+00002740: 6554 6573 7443 6173 652e 6177 6169 745f  eTestCase.await_
+00002750: 7072 6570 6172 6564 5f74 6573 740a 2020  prepared_test.  
+00002760: 2020 6173 796e 6320 6465 6620 7465 7374    async def test
+00002770: 5f6d 616b 655f 6669 6c65 5f75 726c 5f77  _make_file_url_w
+00002780: 6974 685f 7361 7328 7365 6c66 2c20 7374  ith_sas(self, st
+00002790: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
+000027a0: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
+000027b0: 756e 745f 6b65 7929 3a0a 2020 2020 2020  unt_key):.      
+000027c0: 2020 7365 6c66 2e5f 7365 7475 7028 7374    self._setup(st
+000027d0: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
+000027e0: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
+000027f0: 756e 745f 6b65 7929 0a20 2020 2020 2020  unt_key).       
+00002800: 2073 6173 203d 2027 3f73 763d 3230 3135   sas = '?sv=2015
+00002810: 2d30 342d 3035 2673 743d 3230 3135 2d30  -04-05&st=2015-0
+00002820: 342d 3239 5432 3225 3341 3138 2533 4132  4-29T22%3A18%3A2
+00002830: 365a 2673 653d 3230 3135 2d30 342d 3330  6Z&se=2015-04-30
+00002840: 5430 3225 3341 3233 2533 4132 365a 2673  T02%3A23%3A26Z&s
+00002850: 723d 6226 7370 3d72 7726 7369 703d 3136  r=b&sp=rw&sip=16
+00002860: 382e 312e 352e 3630 2d31 3638 2e31 2e35  8.1.5.60-168.1.5
+00002870: 2e37 3026 7370 723d 6874 7470 7326 7369  .70&spr=https&si
+00002880: 673d 5a25 3246 5248 4958 3558 6367 304d  g=Z%2FRHIX5Xcg0M
+00002890: 7132 7271 4933 4f6c 5754 6a45 6732 7459  q2rqI3OlWTjEg2tY
+000028a0: 6b62 6f58 7231 5039 5a55 5844 746b 6b25  kboXr1P9ZUXDtkk%
+000028b0: 3344 270a 2020 2020 2020 2020 6669 6c65  3D'.        file
+000028c0: 5f63 6c69 656e 7420 3d20 5368 6172 6546  _client = ShareF
+000028d0: 696c 6543 6c69 656e 7428 0a20 2020 2020  ileClient(.     
+000028e0: 2020 2020 2020 2073 656c 662e 6163 636f         self.acco
+000028f0: 756e 745f 7572 6c28 7374 6f72 6167 655f  unt_url(storage_
+00002900: 6163 636f 756e 745f 6e61 6d65 2c20 2266  account_name, "f
+00002910: 696c 6522 292c 0a20 2020 2020 2020 2020  ile"),.         
+00002920: 2020 2073 6861 7265 5f6e 616d 653d 2276     share_name="v
+00002930: 6864 7322 2c0a 2020 2020 2020 2020 2020  hds",.          
+00002940: 2020 6669 6c65 5f70 6174 683d 2276 6864    file_path="vhd
+00002950: 5f64 6972 2f6d 792e 7668 6422 2c0a 2020  _dir/my.vhd",.  
+00002960: 2020 2020 2020 2020 2020 6372 6564 656e            creden
+00002970: 7469 616c 3d73 6173 0a20 2020 2020 2020  tial=sas.       
+00002980: 2029 0a0a 2020 2020 2020 2020 2320 4163   )..        # Ac
+00002990: 740a 2020 2020 2020 2020 7265 7320 3d20  t.        res = 
+000029a0: 6669 6c65 5f63 6c69 656e 742e 7572 6c0a  file_client.url.
+000029b0: 0a20 2020 2020 2020 2023 2041 7373 6572  .        # Asser
+000029c0: 740a 2020 2020 2020 2020 7365 6c66 2e61  t.        self.a
+000029d0: 7373 6572 7445 7175 616c 2872 6573 2c20  ssertEqual(res, 
+000029e0: 2768 7474 7073 3a2f 2f27 202b 2073 746f  'https://' + sto
+000029f0: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
+00002a00: 6520 2b0a 2020 2020 2020 2020 2020 2020  e +.            
+00002a10: 2020 2020 2020 2020 2020 2020 2027 2e66               '.f
+00002a20: 696c 652e 636f 7265 2e77 696e 646f 7773  ile.core.windows
+00002a30: 2e6e 6574 2f76 6864 732f 7668 645f 6469  .net/vhds/vhd_di
+00002a40: 722f 6d79 2e76 6864 7b7d 272e 666f 726d  r/my.vhd{}'.form
+00002a50: 6174 2873 6173 2929 0a0a 2020 2020 4046  at(sas))..    @F
+00002a60: 696c 6553 6861 7265 5072 6570 6172 6572  ileSharePreparer
+00002a70: 2829 0a20 2020 2040 4173 796e 6353 746f  ().    @AsyncSto
+00002a80: 7261 6765 5465 7374 4361 7365 2e61 7761  rageTestCase.awa
+00002a90: 6974 5f70 7265 7061 7265 645f 7465 7374  it_prepared_test
+00002aa0: 0a20 2020 2061 7379 6e63 2064 6566 2074  .    async def t
+00002ab0: 6573 745f 6372 6561 7465 5f66 696c 655f  est_create_file_
+00002ac0: 6173 796e 6328 7365 6c66 2c20 7374 6f72  async(self, stor
+00002ad0: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
+00002ae0: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
+00002af0: 745f 6b65 7929 3a0a 2020 2020 2020 2020  t_key):.        
+00002b00: 7365 6c66 2e5f 7365 7475 7028 7374 6f72  self._setup(stor
+00002b10: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
+00002b20: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
+00002b30: 745f 6b65 7929 0a20 2020 2020 2020 2061  t_key).        a
+00002b40: 7761 6974 2073 656c 662e 5f73 6574 7570  wait self._setup
+00002b50: 5f73 6861 7265 2873 746f 7261 6765 5f61  _share(storage_a
+00002b60: 6363 6f75 6e74 5f6e 616d 652c 2073 746f  ccount_name, sto
+00002b70: 7261 6765 5f61 6363 6f75 6e74 5f6b 6579  rage_account_key
+00002b80: 290a 2020 2020 2020 2020 6669 6c65 5f6e  ).        file_n
+00002b90: 616d 6520 3d20 7365 6c66 2e5f 6765 745f  ame = self._get_
+00002ba0: 6669 6c65 5f72 6566 6572 656e 6365 2829  file_reference()
+00002bb0: 0a20 2020 2020 2020 2061 7379 6e63 2077  .        async w
+00002bc0: 6974 6820 5368 6172 6546 696c 6543 6c69  ith ShareFileCli
+00002bd0: 656e 7428 0a20 2020 2020 2020 2020 2020  ent(.           
+00002be0: 2073 656c 662e 6163 636f 756e 745f 7572   self.account_ur
+00002bf0: 6c28 7374 6f72 6167 655f 6163 636f 756e  l(storage_accoun
+00002c00: 745f 6e61 6d65 2c20 2266 696c 6522 292c  t_name, "file"),
+00002c10: 0a20 2020 2020 2020 2020 2020 2073 6861  .            sha
+00002c20: 7265 5f6e 616d 653d 7365 6c66 2e73 6861  re_name=self.sha
+00002c30: 7265 5f6e 616d 652c 0a20 2020 2020 2020  re_name,.       
+00002c40: 2020 2020 2066 696c 655f 7061 7468 3d66       file_path=f
+00002c50: 696c 655f 6e61 6d65 2c0a 2020 2020 2020  ile_name,.      
+00002c60: 2020 2020 2020 6372 6564 656e 7469 616c        credential
+00002c70: 3d73 746f 7261 6765 5f61 6363 6f75 6e74  =storage_account
+00002c80: 5f6b 6579 2920 6173 2066 696c 655f 636c  _key) as file_cl
+00002c90: 6965 6e74 3a0a 0a20 2020 2020 2020 2020  ient:..         
+00002ca0: 2020 2023 2041 6374 0a20 2020 2020 2020     # Act.       
+00002cb0: 2020 2020 2072 6573 7020 3d20 6177 6169       resp = awai
+00002cc0: 7420 6669 6c65 5f63 6c69 656e 742e 6372  t file_client.cr
+00002cd0: 6561 7465 5f66 696c 6528 3130 3234 290a  eate_file(1024).
+00002ce0: 0a20 2020 2020 2020 2020 2020 2023 2041  .            # A
+00002cf0: 7373 6572 740a 2020 2020 2020 2020 2020  ssert.          
+00002d00: 2020 7072 6f70 7320 3d20 6177 6169 7420    props = await 
+00002d10: 6669 6c65 5f63 6c69 656e 742e 6765 745f  file_client.get_
+00002d20: 6669 6c65 5f70 726f 7065 7274 6965 7328  file_properties(
+00002d30: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00002d40: 6c66 2e61 7373 6572 7449 734e 6f74 4e6f  lf.assertIsNotNo
+00002d50: 6e65 2870 726f 7073 290a 2020 2020 2020  ne(props).      
+00002d60: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00002d70: 7445 7175 616c 2870 726f 7073 2e65 7461  tEqual(props.eta
+00002d80: 672c 2072 6573 705b 2765 7461 6727 5d29  g, resp['etag'])
+00002d90: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00002da0: 662e 6173 7365 7274 4571 7561 6c28 7072  f.assertEqual(pr
+00002db0: 6f70 732e 6c61 7374 5f6d 6f64 6966 6965  ops.last_modifie
+00002dc0: 642c 2072 6573 705b 276c 6173 745f 6d6f  d, resp['last_mo
+00002dd0: 6469 6669 6564 275d 290a 0a20 2020 2040  dified'])..    @
+00002de0: 4669 6c65 5368 6172 6550 7265 7061 7265  FileSharePrepare
+00002df0: 7228 290a 2020 2020 4041 7379 6e63 5374  r().    @AsyncSt
+00002e00: 6f72 6167 6554 6573 7443 6173 652e 6177  orageTestCase.aw
+00002e10: 6169 745f 7072 6570 6172 6564 5f74 6573  ait_prepared_tes
+00002e20: 740a 2020 2020 6173 796e 6320 6465 6620  t.    async def 
+00002e30: 7465 7374 5f63 7265 6174 655f 6669 6c65  test_create_file
+00002e40: 5f77 6974 685f 6d65 7461 6461 7461 5f61  _with_metadata_a
+00002e50: 7379 6e63 2873 656c 662c 2073 746f 7261  sync(self, stora
+00002e60: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
+00002e70: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
+00002e80: 5f6b 6579 293a 0a20 2020 2020 2020 2073  _key):.        s
+00002e90: 656c 662e 5f73 6574 7570 2873 746f 7261  elf._setup(stora
+00002ea0: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
+00002eb0: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
+00002ec0: 5f6b 6579 290a 2020 2020 2020 2020 6177  _key).        aw
+00002ed0: 6169 7420 7365 6c66 2e5f 7365 7475 705f  ait self._setup_
+00002ee0: 7368 6172 6528 7374 6f72 6167 655f 6163  share(storage_ac
+00002ef0: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
+00002f00: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
+00002f10: 0a20 2020 2020 2020 206d 6574 6164 6174  .        metadat
+00002f20: 6120 3d20 7b27 6865 6c6c 6f27 3a20 2777  a = {'hello': 'w
+00002f30: 6f72 6c64 272c 2027 6e75 6d62 6572 273a  orld', 'number':
+00002f40: 2027 3432 277d 0a20 2020 2020 2020 2066   '42'}.        f
+00002f50: 696c 655f 6e61 6d65 203d 2073 656c 662e  ile_name = self.
+00002f60: 5f67 6574 5f66 696c 655f 7265 6665 7265  _get_file_refere
+00002f70: 6e63 6528 290a 2020 2020 2020 2020 6173  nce().        as
+00002f80: 796e 6320 7769 7468 2053 6861 7265 4669  ync with ShareFi
+00002f90: 6c65 436c 6965 6e74 280a 2020 2020 2020  leClient(.      
+00002fa0: 2020 2020 2020 7365 6c66 2e61 6363 6f75        self.accou
+00002fb0: 6e74 5f75 726c 2873 746f 7261 6765 5f61  nt_url(storage_a
+00002fc0: 6363 6f75 6e74 5f6e 616d 652c 2022 6669  ccount_name, "fi
+00002fd0: 6c65 2229 2c0a 2020 2020 2020 2020 2020  le"),.          
+00002fe0: 2020 7368 6172 655f 6e61 6d65 3d73 656c    share_name=sel
+00002ff0: 662e 7368 6172 655f 6e61 6d65 2c0a 2020  f.share_name,.  
+00003000: 2020 2020 2020 2020 2020 6669 6c65 5f70            file_p
+00003010: 6174 683d 6669 6c65 5f6e 616d 652c 0a20  ath=file_name,. 
+00003020: 2020 2020 2020 2020 2020 2063 7265 6465             crede
+00003030: 6e74 6961 6c3d 7374 6f72 6167 655f 6163  ntial=storage_ac
+00003040: 636f 756e 745f 6b65 7929 2061 7320 6669  count_key) as fi
+00003050: 6c65 5f63 6c69 656e 743a 0a0a 2020 2020  le_client:..    
+00003060: 2020 2020 2020 2020 2320 4163 740a 2020          # Act.  
+00003070: 2020 2020 2020 2020 2020 7265 7370 203d            resp =
+00003080: 2061 7761 6974 2066 696c 655f 636c 6965   await file_clie
+00003090: 6e74 2e63 7265 6174 655f 6669 6c65 2831  nt.create_file(1
+000030a0: 3032 342c 206d 6574 6164 6174 613d 6d65  024, metadata=me
+000030b0: 7461 6461 7461 290a 0a20 2020 2020 2020  tadata)..       
+000030c0: 2020 2020 2023 2041 7373 6572 740a 2020       # Assert.  
+000030d0: 2020 2020 2020 2020 2020 7072 6f70 7320            props 
+000030e0: 3d20 6177 6169 7420 6669 6c65 5f63 6c69  = await file_cli
+000030f0: 656e 742e 6765 745f 6669 6c65 5f70 726f  ent.get_file_pro
+00003100: 7065 7274 6965 7328 290a 2020 2020 2020  perties().      
+00003110: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00003120: 7449 734e 6f74 4e6f 6e65 2870 726f 7073  tIsNotNone(props
+00003130: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00003140: 6c66 2e61 7373 6572 7445 7175 616c 2870  lf.assertEqual(p
+00003150: 726f 7073 2e65 7461 672c 2072 6573 705b  rops.etag, resp[
+00003160: 2765 7461 6727 5d29 0a20 2020 2020 2020  'etag']).       
+00003170: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00003180: 4571 7561 6c28 7072 6f70 732e 6c61 7374  Equal(props.last
+00003190: 5f6d 6f64 6966 6965 642c 2072 6573 705b  _modified, resp[
+000031a0: 276c 6173 745f 6d6f 6469 6669 6564 275d  'last_modified']
+000031b0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+000031c0: 6c66 2e61 7373 6572 7444 6963 7445 7175  lf.assertDictEqu
+000031d0: 616c 2870 726f 7073 2e6d 6574 6164 6174  al(props.metadat
+000031e0: 612c 206d 6574 6164 6174 6129 0a0a 2020  a, metadata)..  
+000031f0: 2020 4046 696c 6553 6861 7265 5072 6570    @FileSharePrep
+00003200: 6172 6572 2829 0a20 2020 2040 4173 796e  arer().    @Asyn
+00003210: 6353 746f 7261 6765 5465 7374 4361 7365  cStorageTestCase
+00003220: 2e61 7761 6974 5f70 7265 7061 7265 645f  .await_prepared_
+00003230: 7465 7374 0a20 2020 2061 7379 6e63 2064  test.    async d
+00003240: 6566 2074 6573 745f 6372 6561 7465 5f66  ef test_create_f
+00003250: 696c 655f 7768 656e 5f66 696c 655f 7065  ile_when_file_pe
+00003260: 726d 6973 7369 6f6e 5f69 735f 746f 6f5f  rmission_is_too_
+00003270: 6c6f 6e67 2873 656c 662c 2073 746f 7261  long(self, stora
+00003280: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
+00003290: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
+000032a0: 5f6b 6579 293a 0a20 2020 2020 2020 2073  _key):.        s
+000032b0: 656c 662e 5f73 6574 7570 2873 746f 7261  elf._setup(stora
+000032c0: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
+000032d0: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
+000032e0: 5f6b 6579 290a 2020 2020 2020 2020 6669  _key).        fi
+000032f0: 6c65 5f63 6c69 656e 7420 3d20 6177 6169  le_client = awai
+00003300: 7420 7365 6c66 2e5f 6765 745f 6669 6c65  t self._get_file
+00003310: 5f63 6c69 656e 7428 7374 6f72 6167 655f  _client(storage_
+00003320: 6163 636f 756e 745f 6e61 6d65 2c20 7374  account_name, st
+00003330: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
+00003340: 7929 0a20 2020 2020 2020 2070 6572 6d69  y).        permi
+00003350: 7373 696f 6e20 3d20 7374 7228 7365 6c66  ssion = str(self
+00003360: 2e67 6574 5f72 616e 646f 6d5f 6279 7465  .get_random_byte
+00003370: 7328 3820 2a20 3130 3234 202b 2031 2929  s(8 * 1024 + 1))
+00003380: 0a20 2020 2020 2020 2077 6974 6820 7365  .        with se
+00003390: 6c66 2e61 7373 6572 7452 6169 7365 7328  lf.assertRaises(
+000033a0: 5661 6c75 6545 7272 6f72 293a 0a20 2020  ValueError):.   
+000033b0: 2020 2020 2020 2020 2061 7761 6974 2066           await f
+000033c0: 696c 655f 636c 6965 6e74 2e63 7265 6174  ile_client.creat
+000033d0: 655f 6669 6c65 2831 3032 342c 2066 696c  e_file(1024, fil
+000033e0: 655f 7065 726d 6973 7369 6f6e 3d70 6572  e_permission=per
+000033f0: 6d69 7373 696f 6e29 0a0a 2020 2020 4046  mission)..    @F
+00003400: 696c 6553 6861 7265 5072 6570 6172 6572  ileSharePreparer
+00003410: 2829 0a20 2020 2040 4173 796e 6353 746f  ().    @AsyncSto
+00003420: 7261 6765 5465 7374 4361 7365 2e61 7761  rageTestCase.awa
+00003430: 6974 5f70 7265 7061 7265 645f 7465 7374  it_prepared_test
+00003440: 0a20 2020 2061 7379 6e63 2064 6566 2074  .    async def t
+00003450: 6573 745f 6372 6561 7465 5f66 696c 655f  est_create_file_
+00003460: 7769 7468 5f69 6e76 616c 6964 5f66 696c  with_invalid_fil
+00003470: 655f 7065 726d 6973 7369 6f6e 2873 656c  e_permission(sel
+00003480: 662c 2073 746f 7261 6765 5f61 6363 6f75  f, storage_accou
+00003490: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
+000034a0: 5f61 6363 6f75 6e74 5f6b 6579 293a 0a20  _account_key):. 
+000034b0: 2020 2020 2020 2073 656c 662e 5f73 6574         self._set
+000034c0: 7570 2873 746f 7261 6765 5f61 6363 6f75  up(storage_accou
+000034d0: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
+000034e0: 5f61 6363 6f75 6e74 5f6b 6579 290a 2020  _account_key).  
+000034f0: 2020 2020 2020 6669 6c65 5f6e 616d 6520        file_name 
+00003500: 3d20 6177 6169 7420 7365 6c66 2e5f 6765  = await self._ge
+00003510: 745f 6669 6c65 5f63 6c69 656e 7428 7374  t_file_client(st
+00003520: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
+00003530: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
+00003540: 756e 745f 6b65 7929 0a0a 2020 2020 2020  unt_key)..      
+00003550: 2020 7769 7468 2073 656c 662e 6173 7365    with self.asse
+00003560: 7274 5261 6973 6573 2848 7474 7052 6573  rtRaises(HttpRes
+00003570: 706f 6e73 6545 7272 6f72 293a 0a20 2020  ponseError):.   
+00003580: 2020 2020 2020 2020 2061 7761 6974 2066           await f
+00003590: 696c 655f 6e61 6d65 2e63 7265 6174 655f  ile_name.create_
+000035a0: 6669 6c65 2831 3032 342c 2066 696c 655f  file(1024, file_
+000035b0: 7065 726d 6973 7369 6f6e 3d22 6162 6364  permission="abcd
+000035c0: 6522 290a 0a20 2020 2040 4669 6c65 5368  e")..    @FileSh
+000035d0: 6172 6550 7265 7061 7265 7228 290a 2020  arePreparer().  
+000035e0: 2020 4041 7379 6e63 5374 6f72 6167 6554    @AsyncStorageT
+000035f0: 6573 7443 6173 652e 6177 6169 745f 7072  estCase.await_pr
+00003600: 6570 6172 6564 5f74 6573 740a 2020 2020  epared_test.    
+00003610: 6173 796e 6320 6465 6620 7465 7374 5f63  async def test_c
+00003620: 7265 6174 655f 6669 6c65 5f77 6974 685f  reate_file_with_
+00003630: 6c65 6173 655f 6173 796e 6328 7365 6c66  lease_async(self
+00003640: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
+00003650: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
+00003660: 6163 636f 756e 745f 6b65 7929 3a0a 2020  account_key):.  
+00003670: 2020 2020 2020 7365 6c66 2e5f 7365 7475        self._setu
+00003680: 7028 7374 6f72 6167 655f 6163 636f 756e  p(storage_accoun
+00003690: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
+000036a0: 6163 636f 756e 745f 6b65 7929 0a20 2020  account_key).   
+000036b0: 2020 2020 2066 696c 655f 636c 6965 6e74       file_client
+000036c0: 203d 2061 7761 6974 2073 656c 662e 5f67   = await self._g
+000036d0: 6574 5f66 696c 655f 636c 6965 6e74 2873  et_file_client(s
+000036e0: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
+000036f0: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
+00003700: 6f75 6e74 5f6b 6579 290a 2020 2020 2020  ount_key).      
+00003710: 2020 6177 6169 7420 6669 6c65 5f63 6c69    await file_cli
+00003720: 656e 742e 6372 6561 7465 5f66 696c 6528  ent.create_file(
+00003730: 3130 3234 290a 0a20 2020 2020 2020 206c  1024)..        l
+00003740: 6561 7365 203d 2061 7761 6974 2066 696c  ease = await fil
+00003750: 655f 636c 6965 6e74 2e61 6371 7569 7265  e_client.acquire
+00003760: 5f6c 6561 7365 2829 0a20 2020 2020 2020  _lease().       
+00003770: 2072 6573 7020 3d20 6177 6169 7420 6669   resp = await fi
+00003780: 6c65 5f63 6c69 656e 742e 6372 6561 7465  le_client.create
+00003790: 5f66 696c 6528 3130 3234 2c20 6c65 6173  _file(1024, leas
+000037a0: 653d 6c65 6173 6529 0a20 2020 2020 2020  e=lease).       
+000037b0: 2073 656c 662e 6173 7365 7274 4973 4e6f   self.assertIsNo
+000037c0: 744e 6f6e 6528 7265 7370 290a 0a20 2020  tNone(resp)..   
+000037d0: 2020 2020 2023 2054 6865 7265 2069 7320       # There is 
+000037e0: 6375 7272 656e 746c 7920 6120 6c65 6173  currently a leas
+000037f0: 6520 6f6e 2074 6865 2066 696c 6520 736f  e on the file so
+00003800: 2074 6865 7265 2073 686f 756c 6420 6265   there should be
+00003810: 2061 6e20 6578 6365 7074 696f 6e20 7768   an exception wh
+00003820: 656e 2064 656c 6574 6520 7468 6520 6669  en delete the fi
+00003830: 6c65 2077 6974 686f 7574 206c 6561 7365  le without lease
+00003840: 0a20 2020 2020 2020 2077 6974 6820 7365  .        with se
+00003850: 6c66 2e61 7373 6572 7452 6169 7365 7328  lf.assertRaises(
+00003860: 4874 7470 5265 7370 6f6e 7365 4572 726f  HttpResponseErro
+00003870: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+00003880: 6177 6169 7420 6669 6c65 5f63 6c69 656e  await file_clien
+00003890: 742e 6465 6c65 7465 5f66 696c 6528 290a  t.delete_file().
+000038a0: 0a20 2020 2020 2020 2023 2054 6865 7265  .        # There
+000038b0: 2069 7320 6375 7272 656e 746c 7920 6120   is currently a 
+000038c0: 6c65 6173 6520 6f6e 2074 6865 2066 696c  lease on the fil
+000038d0: 6520 736f 2064 656c 6574 6520 7468 6520  e so delete the 
+000038e0: 6669 6c65 2077 6974 6820 7468 6520 6c65  file with the le
+000038f0: 6173 6520 7769 6c6c 2073 7563 6365 6564  ase will succeed
+00003900: 0a20 2020 2020 2020 2061 7761 6974 2066  .        await f
+00003910: 696c 655f 636c 6965 6e74 2e64 656c 6574  ile_client.delet
+00003920: 655f 6669 6c65 286c 6561 7365 3d6c 6561  e_file(lease=lea
+00003930: 7365 290a 0a20 2020 2040 4669 6c65 5368  se)..    @FileSh
+00003940: 6172 6550 7265 7061 7265 7228 290a 2020  arePreparer().  
+00003950: 2020 4041 7379 6e63 5374 6f72 6167 6554    @AsyncStorageT
+00003960: 6573 7443 6173 652e 6177 6169 745f 7072  estCase.await_pr
+00003970: 6570 6172 6564 5f74 6573 740a 2020 2020  epared_test.    
+00003980: 6173 796e 6320 6465 6620 7465 7374 5f63  async def test_c
+00003990: 7265 6174 655f 6669 6c65 5f77 6974 685f  reate_file_with_
+000039a0: 6368 616e 6765 645f 6c65 6173 655f 6173  changed_lease_as
+000039b0: 796e 6328 7365 6c66 2c20 7374 6f72 6167  ync(self, storag
+000039c0: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
+000039d0: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
+000039e0: 6b65 7929 3a0a 2020 2020 2020 2020 7365  key):.        se
+000039f0: 6c66 2e5f 7365 7475 7028 7374 6f72 6167  lf._setup(storag
+00003a00: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
+00003a10: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
+00003a20: 6b65 7929 0a20 2020 2020 2020 2066 696c  key).        fil
+00003a30: 655f 636c 6965 6e74 203d 2061 7761 6974  e_client = await
+00003a40: 2073 656c 662e 5f67 6574 5f66 696c 655f   self._get_file_
+00003a50: 636c 6965 6e74 2873 746f 7261 6765 5f61  client(storage_a
+00003a60: 6363 6f75 6e74 5f6e 616d 652c 2073 746f  ccount_name, sto
+00003a70: 7261 6765 5f61 6363 6f75 6e74 5f6b 6579  rage_account_key
+00003a80: 290a 2020 2020 2020 2020 6177 6169 7420  ).        await 
+00003a90: 6669 6c65 5f63 6c69 656e 742e 6372 6561  file_client.crea
+00003aa0: 7465 5f66 696c 6528 3130 3234 290a 0a20  te_file(1024).. 
+00003ab0: 2020 2020 2020 206c 6561 7365 203d 2061         lease = a
+00003ac0: 7761 6974 2066 696c 655f 636c 6965 6e74  wait file_client
+00003ad0: 2e61 6371 7569 7265 5f6c 6561 7365 2829  .acquire_lease()
+00003ae0: 0a20 2020 2020 2020 206f 6c64 5f6c 6561  .        old_lea
+00003af0: 7365 5f69 6420 3d20 6c65 6173 652e 6964  se_id = lease.id
+00003b00: 0a20 2020 2020 2020 2061 7761 6974 206c  .        await l
+00003b10: 6561 7365 2e63 6861 6e67 6528 7374 7228  ease.change(str(
+00003b20: 7575 6964 2e75 7569 6434 2829 2929 0a0a  uuid.uuid4()))..
+00003b30: 2020 2020 2020 2020 2320 7573 6520 7468          # use th
+00003b40: 6520 6f6c 6420 6c65 6173 6520 6964 2074  e old lease id t
+00003b50: 6f20 6372 6561 7465 2066 696c 6520 7769  o create file wi
+00003b60: 6c6c 2074 6872 6f77 2065 7863 6570 7469  ll throw excepti
+00003b70: 6f6e 2e0a 2020 2020 2020 2020 7769 7468  on..        with
+00003b80: 2073 656c 662e 6173 7365 7274 5261 6973   self.assertRais
+00003b90: 6573 2848 7474 7052 6573 706f 6e73 6545  es(HttpResponseE
+00003ba0: 7272 6f72 293a 0a20 2020 2020 2020 2020  rror):.         
+00003bb0: 2020 2061 7761 6974 2066 696c 655f 636c     await file_cl
+00003bc0: 6965 6e74 2e63 7265 6174 655f 6669 6c65  ient.create_file
+00003bd0: 2831 3032 342c 206c 6561 7365 3d6f 6c64  (1024, lease=old
+00003be0: 5f6c 6561 7365 5f69 6429 0a0a 2020 2020  _lease_id)..    
+00003bf0: 2020 2020 2320 7573 6520 7468 6520 6e65      # use the ne
+00003c00: 7720 6c65 6173 6520 746f 2063 7265 6174  w lease to creat
+00003c10: 6520 6669 6c65 2077 696c 6c20 7375 6363  e file will succ
+00003c20: 6565 642e 0a20 2020 2020 2020 2072 6573  eed..        res
+00003c30: 7020 3d20 6177 6169 7420 6669 6c65 5f63  p = await file_c
+00003c40: 6c69 656e 742e 6372 6561 7465 5f66 696c  lient.create_fil
+00003c50: 6528 3130 3234 2c20 6c65 6173 653d 6c65  e(1024, lease=le
+00003c60: 6173 6529 0a0a 2020 2020 2020 2020 7365  ase)..        se
+00003c70: 6c66 2e61 7373 6572 7449 734e 6f74 4e6f  lf.assertIsNotNo
+00003c80: 6e65 2872 6573 7029 0a0a 2020 2020 4046  ne(resp)..    @F
+00003c90: 696c 6553 6861 7265 5072 6570 6172 6572  ileSharePreparer
+00003ca0: 2829 0a20 2020 2040 4173 796e 6353 746f  ().    @AsyncSto
+00003cb0: 7261 6765 5465 7374 4361 7365 2e61 7761  rageTestCase.awa
+00003cc0: 6974 5f70 7265 7061 7265 645f 7465 7374  it_prepared_test
+00003cd0: 0a20 2020 2061 7379 6e63 2064 6566 2074  .    async def t
+00003ce0: 6573 745f 6372 6561 7465 5f66 696c 655f  est_create_file_
+00003cf0: 7769 6c6c 5f73 6574 5f61 6c6c 5f73 6d62  will_set_all_smb
+00003d00: 5f70 726f 7065 7274 6965 7328 7365 6c66  _properties(self
+00003d10: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
+00003d20: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
+00003d30: 6163 636f 756e 745f 6b65 7929 3a0a 2020  account_key):.  
+00003d40: 2020 2020 2020 7365 6c66 2e5f 7365 7475        self._setu
+00003d50: 7028 7374 6f72 6167 655f 6163 636f 756e  p(storage_accoun
+00003d60: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
+00003d70: 6163 636f 756e 745f 6b65 7929 0a20 2020  account_key).   
+00003d80: 2020 2020 2066 696c 655f 636c 6965 6e74       file_client
+00003d90: 203d 2061 7761 6974 2073 656c 662e 5f67   = await self._g
+00003da0: 6574 5f66 696c 655f 636c 6965 6e74 2873  et_file_client(s
+00003db0: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
+00003dc0: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
+00003dd0: 6f75 6e74 5f6b 6579 290a 0a20 2020 2020  ount_key)..     
+00003de0: 2020 2023 2041 6374 0a20 2020 2020 2020     # Act.       
+00003df0: 2061 7761 6974 2066 696c 655f 636c 6965   await file_clie
+00003e00: 6e74 2e63 7265 6174 655f 6669 6c65 2831  nt.create_file(1
+00003e10: 3032 3429 0a20 2020 2020 2020 2066 696c  024).        fil
+00003e20: 655f 7072 6f70 6572 7469 6573 203d 2061  e_properties = a
+00003e30: 7761 6974 2066 696c 655f 636c 6965 6e74  wait file_client
+00003e40: 2e67 6574 5f66 696c 655f 7072 6f70 6572  .get_file_proper
+00003e50: 7469 6573 2829 0a0a 2020 2020 2020 2020  ties()..        
+00003e60: 2320 4173 7365 7274 0a20 2020 2020 2020  # Assert.       
+00003e70: 2073 656c 662e 6173 7365 7274 4973 4e6f   self.assertIsNo
+00003e80: 744e 6f6e 6528 6669 6c65 5f70 726f 7065  tNone(file_prope
+00003e90: 7274 6965 7329 0a20 2020 2020 2020 2073  rties).        s
+00003ea0: 656c 662e 6173 7365 7274 4973 4e6f 744e  elf.assertIsNotN
+00003eb0: 6f6e 6528 6669 6c65 5f70 726f 7065 7274  one(file_propert
+00003ec0: 6965 732e 6368 616e 6765 5f74 696d 6529  ies.change_time)
+00003ed0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00003ee0: 7365 7274 4973 4e6f 744e 6f6e 6528 6669  sertIsNotNone(fi
+00003ef0: 6c65 5f70 726f 7065 7274 6965 732e 6372  le_properties.cr
+00003f00: 6561 7469 6f6e 5f74 696d 6529 0a20 2020  eation_time).   
+00003f10: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00003f20: 4973 4e6f 744e 6f6e 6528 6669 6c65 5f70  IsNotNone(file_p
+00003f30: 726f 7065 7274 6965 732e 6669 6c65 5f61  roperties.file_a
+00003f40: 7474 7269 6275 7465 7329 0a20 2020 2020  ttributes).     
+00003f50: 2020 2073 656c 662e 6173 7365 7274 4973     self.assertIs
+00003f60: 4e6f 744e 6f6e 6528 6669 6c65 5f70 726f  NotNone(file_pro
+00003f70: 7065 7274 6965 732e 6c61 7374 5f77 7269  perties.last_wri
+00003f80: 7465 5f74 696d 6529 0a0a 2020 2020 4046  te_time)..    @F
+00003f90: 696c 6553 6861 7265 5072 6570 6172 6572  ileSharePreparer
+00003fa0: 2829 0a20 2020 2040 4173 796e 6353 746f  ().    @AsyncSto
+00003fb0: 7261 6765 5465 7374 4361 7365 2e61 7761  rageTestCase.awa
+00003fc0: 6974 5f70 7265 7061 7265 645f 7465 7374  it_prepared_test
+00003fd0: 0a20 2020 2061 7379 6e63 2064 6566 2074  .    async def t
+00003fe0: 6573 745f 6372 6561 7465 5f66 696c 655f  est_create_file_
+00003ff0: 7365 745f 736d 625f 7072 6f70 6572 7469  set_smb_properti
+00004000: 6573 2873 656c 662c 2073 746f 7261 6765  es(self, storage
+00004010: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
+00004020: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
+00004030: 6579 293a 0a20 2020 2020 2020 2073 656c  ey):.        sel
+00004040: 662e 5f73 6574 7570 2873 746f 7261 6765  f._setup(storage
+00004050: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
+00004060: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
+00004070: 6579 290a 2020 2020 2020 2020 6669 6c65  ey).        file
+00004080: 5f63 6c69 656e 7420 3d20 6177 6169 7420  _client = await 
+00004090: 7365 6c66 2e5f 6765 745f 6669 6c65 5f63  self._get_file_c
+000040a0: 6c69 656e 7428 7374 6f72 6167 655f 6163  lient(storage_ac
+000040b0: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
+000040c0: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
+000040d0: 0a0a 2020 2020 2020 2020 6669 6c65 5f61  ..        file_a
+000040e0: 7474 7269 6275 7465 7320 3d20 4e54 4653  ttributes = NTFS
+000040f0: 4174 7472 6962 7574 6573 2872 6561 645f  Attributes(read_
+00004100: 6f6e 6c79 3d54 7275 652c 2061 7263 6869  only=True, archi
+00004110: 7665 3d54 7275 6529 0a20 2020 2020 2020  ve=True).       
+00004120: 2066 696c 655f 6372 6561 7469 6f6e 5f74   file_creation_t
+00004130: 696d 6520 3d20 6669 6c65 5f6c 6173 745f  ime = file_last_
+00004140: 7772 6974 655f 7469 6d65 203d 2066 696c  write_time = fil
+00004150: 655f 6368 616e 6765 5f74 696d 6520 3d20  e_change_time = 
+00004160: 6461 7465 7469 6d65 2832 3032 322c 2033  datetime(2022, 3
+00004170: 2c20 3130 2c20 3130 2c20 3134 2c20 3330  , 10, 10, 14, 30
+00004180: 2c20 3530 3030 3030 290a 0a20 2020 2020  , 500000)..     
+00004190: 2020 2023 2041 6374 0a20 2020 2020 2020     # Act.       
+000041a0: 2061 7761 6974 2066 696c 655f 636c 6965   await file_clie
+000041b0: 6e74 2e63 7265 6174 655f 6669 6c65 280a  nt.create_file(.
+000041c0: 2020 2020 2020 2020 2020 2020 7369 7a65              size
+000041d0: 3d31 3032 342c 0a20 2020 2020 2020 2020  =1024,.         
+000041e0: 2020 2066 696c 655f 6174 7472 6962 7574     file_attribut
+000041f0: 6573 3d66 696c 655f 6174 7472 6962 7574  es=file_attribut
+00004200: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
+00004210: 6669 6c65 5f63 7265 6174 696f 6e5f 7469  file_creation_ti
+00004220: 6d65 3d66 696c 655f 6372 6561 7469 6f6e  me=file_creation
+00004230: 5f74 696d 652c 0a20 2020 2020 2020 2020  _time,.         
+00004240: 2020 2066 696c 655f 6c61 7374 5f77 7269     file_last_wri
+00004250: 7465 5f74 696d 653d 6669 6c65 5f6c 6173  te_time=file_las
+00004260: 745f 7772 6974 655f 7469 6d65 2c0a 2020  t_write_time,.  
+00004270: 2020 2020 2020 2020 2020 6669 6c65 5f63            file_c
+00004280: 6861 6e67 655f 7469 6d65 3d66 696c 655f  hange_time=file_
+00004290: 6368 616e 6765 5f74 696d 6529 0a20 2020  change_time).   
+000042a0: 2020 2020 2066 696c 655f 7072 6f70 6572       file_proper
+000042b0: 7469 6573 203d 2061 7761 6974 2066 696c  ties = await fil
+000042c0: 655f 636c 6965 6e74 2e67 6574 5f66 696c  e_client.get_fil
+000042d0: 655f 7072 6f70 6572 7469 6573 2829 0a0a  e_properties()..
+000042e0: 2020 2020 2020 2020 2320 4173 7365 7274          # Assert
+000042f0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00004300: 7365 7274 4973 4e6f 744e 6f6e 6528 6669  sertIsNotNone(fi
+00004310: 6c65 5f70 726f 7065 7274 6965 7329 0a20  le_properties). 
+00004320: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00004330: 7274 4571 7561 6c28 6669 6c65 5f63 7265  rtEqual(file_cre
+00004340: 6174 696f 6e5f 7469 6d65 2c20 6669 6c65  ation_time, file
+00004350: 5f70 726f 7065 7274 6965 732e 6372 6561  _properties.crea
+00004360: 7469 6f6e 5f74 696d 6529 0a20 2020 2020  tion_time).     
+00004370: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00004380: 7561 6c28 6669 6c65 5f6c 6173 745f 7772  ual(file_last_wr
+00004390: 6974 655f 7469 6d65 2c20 6669 6c65 5f70  ite_time, file_p
+000043a0: 726f 7065 7274 6965 732e 6c61 7374 5f77  roperties.last_w
+000043b0: 7269 7465 5f74 696d 6529 0a20 2020 2020  rite_time).     
+000043c0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+000043d0: 7561 6c28 6669 6c65 5f63 6861 6e67 655f  ual(file_change_
+000043e0: 7469 6d65 2c20 6669 6c65 5f70 726f 7065  time, file_prope
+000043f0: 7274 6965 732e 6368 616e 6765 5f74 696d  rties.change_tim
+00004400: 6529 0a20 2020 2020 2020 2073 656c 662e  e).        self.
+00004410: 6173 7365 7274 496e 2827 5265 6164 4f6e  assertIn('ReadOn
+00004420: 6c79 272c 2066 696c 655f 7072 6f70 6572  ly', file_proper
+00004430: 7469 6573 2e66 696c 655f 6174 7472 6962  ties.file_attrib
+00004440: 7574 6573 290a 2020 2020 2020 2020 7365  utes).        se
+00004450: 6c66 2e61 7373 6572 7449 6e28 2741 7263  lf.assertIn('Arc
+00004460: 6869 7665 272c 2066 696c 655f 7072 6f70  hive', file_prop
+00004470: 6572 7469 6573 2e66 696c 655f 6174 7472  erties.file_attr
+00004480: 6962 7574 6573 290a 0a20 2020 2040 4669  ibutes)..    @Fi
+00004490: 6c65 5368 6172 6550 7265 7061 7265 7228  leSharePreparer(
+000044a0: 290a 2020 2020 4041 7379 6e63 5374 6f72  ).    @AsyncStor
+000044b0: 6167 6554 6573 7443 6173 652e 6177 6169  ageTestCase.awai
+000044c0: 745f 7072 6570 6172 6564 5f74 6573 740a  t_prepared_test.
+000044d0: 2020 2020 6173 796e 6320 6465 6620 7465      async def te
+000044e0: 7374 5f66 696c 655f 6578 6973 7473 5f61  st_file_exists_a
+000044f0: 7379 6e63 2873 656c 662c 2073 746f 7261  sync(self, stora
+00004500: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
+00004510: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
+00004520: 5f6b 6579 293a 0a20 2020 2020 2020 2073  _key):.        s
+00004530: 656c 662e 5f73 6574 7570 2873 746f 7261  elf._setup(stora
+00004540: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
+00004550: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
+00004560: 5f6b 6579 290a 2020 2020 2020 2020 6669  _key).        fi
+00004570: 6c65 5f63 6c69 656e 7420 3d20 6177 6169  le_client = awai
+00004580: 7420 7365 6c66 2e5f 6372 6561 7465 5f66  t self._create_f
+00004590: 696c 6528 7374 6f72 6167 655f 6163 636f  ile(storage_acco
+000045a0: 756e 745f 6e61 6d65 2c20 7374 6f72 6167  unt_name, storag
+000045b0: 655f 6163 636f 756e 745f 6b65 7929 0a0a  e_account_key)..
+000045c0: 2020 2020 2020 2020 2320 4163 740a 2020          # Act.  
+000045d0: 2020 2020 2020 6578 6973 7473 203d 2061        exists = a
+000045e0: 7761 6974 2066 696c 655f 636c 6965 6e74  wait file_client
+000045f0: 2e67 6574 5f66 696c 655f 7072 6f70 6572  .get_file_proper
+00004600: 7469 6573 2829 0a0a 2020 2020 2020 2020  ties()..        
+00004610: 2320 4173 7365 7274 0a20 2020 2020 2020  # Assert.       
+00004620: 2073 656c 662e 6173 7365 7274 5472 7565   self.assertTrue
+00004630: 2865 7869 7374 7329 0a0a 2020 2020 4046  (exists)..    @F
+00004640: 696c 6553 6861 7265 5072 6570 6172 6572  ileSharePreparer
+00004650: 2829 0a20 2020 2061 7379 6e63 2064 6566  ().    async def
+00004660: 2074 6573 745f 736e 6170 7368 6f74 5f65   test_snapshot_e
+00004670: 7869 7374 7328 7365 6c66 2c20 7374 6f72  xists(self, stor
+00004680: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
+00004690: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
+000046a0: 745f 6b65 7929 3a0a 2020 2020 2020 2020  t_key):.        
+000046b0: 7365 6c66 2e5f 7365 7475 7028 7374 6f72  self._setup(stor
+000046c0: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
+000046d0: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
+000046e0: 745f 6b65 7929 0a20 2020 2020 2020 2061  t_key).        a
+000046f0: 7761 6974 2073 656c 662e 5f73 6574 7570  wait self._setup
+00004700: 5f73 6861 7265 2873 746f 7261 6765 5f61  _share(storage_a
+00004710: 6363 6f75 6e74 5f6e 616d 652c 2073 746f  ccount_name, sto
+00004720: 7261 6765 5f61 6363 6f75 6e74 5f6b 6579  rage_account_key
+00004730: 290a 2020 2020 2020 2020 7368 6172 655f  ).        share_
+00004740: 636c 6965 6e74 203d 2073 656c 662e 6673  client = self.fs
+00004750: 632e 6765 745f 7368 6172 655f 636c 6965  c.get_share_clie
+00004760: 6e74 2873 656c 662e 7368 6172 655f 6e61  nt(self.share_na
+00004770: 6d65 290a 2020 2020 2020 2020 6469 7265  me).        dire
+00004780: 6374 6f72 795f 6e61 6d65 203d 2073 656c  ctory_name = sel
+00004790: 662e 6765 745f 7265 736f 7572 6365 5f6e  f.get_resource_n
+000047a0: 616d 6528 2264 6972 6563 746f 7279 2229  ame("directory")
+000047b0: 0a20 2020 2020 2020 2064 6972 6563 746f  .        directo
+000047c0: 7279 5f63 6c69 656e 7420 3d20 6177 6169  ry_client = awai
+000047d0: 7420 7368 6172 655f 636c 6965 6e74 2e63  t share_client.c
+000047e0: 7265 6174 655f 6469 7265 6374 6f72 7928  reate_directory(
+000047f0: 6469 7265 6374 6f72 795f 6e61 6d65 290a  directory_name).
+00004800: 2020 2020 2020 2020 6669 6c65 5f6e 616d          file_nam
+00004810: 6520 3d20 7365 6c66 2e5f 6765 745f 6669  e = self._get_fi
+00004820: 6c65 5f72 6566 6572 656e 6365 2829 0a20  le_reference(). 
+00004830: 2020 2020 2020 2066 696c 655f 636c 6965         file_clie
+00004840: 6e74 203d 2064 6972 6563 746f 7279 5f63  nt = directory_c
+00004850: 6c69 656e 742e 6765 745f 6669 6c65 5f63  lient.get_file_c
+00004860: 6c69 656e 7428 6669 6c65 5f6e 616d 6529  lient(file_name)
+00004870: 0a20 2020 2020 2020 2061 7761 6974 2066  .        await f
+00004880: 696c 655f 636c 6965 6e74 2e75 706c 6f61  ile_client.uploa
+00004890: 645f 6669 6c65 2873 656c 662e 7368 6f72  d_file(self.shor
+000048a0: 745f 6279 7465 5f64 6174 6129 0a0a 2020  t_byte_data)..  
+000048b0: 2020 2020 2020 736e 6170 7368 6f74 203d        snapshot =
+000048c0: 2061 7761 6974 2073 6861 7265 5f63 6c69   await share_cli
+000048d0: 656e 742e 6372 6561 7465 5f73 6e61 7073  ent.create_snaps
+000048e0: 686f 7428 290a 2020 2020 2020 2020 7368  hot().        sh
+000048f0: 6172 655f 736e 6170 7368 6f74 5f63 6c69  are_snapshot_cli
+00004900: 656e 7420 3d20 7365 6c66 2e66 7363 2e67  ent = self.fsc.g
+00004910: 6574 5f73 6861 7265 5f63 6c69 656e 7428  et_share_client(
+00004920: 7365 6c66 2e73 6861 7265 5f6e 616d 652c  self.share_name,
+00004930: 2073 6e61 7073 686f 743d 736e 6170 7368   snapshot=snapsh
+00004940: 6f74 290a 2020 2020 2020 2020 6669 6c65  ot).        file
+00004950: 5f73 6e61 7073 686f 745f 636c 6965 6e74  _snapshot_client
+00004960: 203d 2073 6861 7265 5f73 6e61 7073 686f   = share_snapsho
+00004970: 745f 636c 6965 6e74 2e67 6574 5f64 6972  t_client.get_dir
+00004980: 6563 746f 7279 5f63 6c69 656e 7428 6469  ectory_client(di
+00004990: 7265 6374 6f72 795f 6e61 6d65 292e 6765  rectory_name).ge
+000049a0: 745f 6669 6c65 5f63 6c69 656e 7428 6669  t_file_client(fi
+000049b0: 6c65 5f6e 616d 6529 0a0a 2020 2020 2020  le_name)..      
+000049c0: 2020 6177 6169 7420 6669 6c65 5f63 6c69    await file_cli
+000049d0: 656e 742e 6465 6c65 7465 5f66 696c 6528  ent.delete_file(
+000049e0: 290a 0a20 2020 2020 2020 2023 2041 6374  )..        # Act
+000049f0: 0a20 2020 2020 2020 2070 726f 7073 203d  .        props =
+00004a00: 2061 7761 6974 2066 696c 655f 736e 6170   await file_snap
+00004a10: 7368 6f74 5f63 6c69 656e 742e 646f 776e  shot_client.down
+00004a20: 6c6f 6164 5f66 696c 6528 290a 0a20 2020  load_file()..   
+00004a30: 2020 2020 2023 2041 7373 6572 740a 2020       # Assert.  
+00004a40: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00004a50: 7454 7275 6528 7072 6f70 7329 0a0a 2020  tTrue(props)..  
+00004a60: 2020 4046 696c 6553 6861 7265 5072 6570    @FileSharePrep
+00004a70: 6172 6572 2829 0a20 2020 2040 4173 796e  arer().    @Asyn
+00004a80: 6353 746f 7261 6765 5465 7374 4361 7365  cStorageTestCase
+00004a90: 2e61 7761 6974 5f70 7265 7061 7265 645f  .await_prepared_
+00004aa0: 7465 7374 0a20 2020 2061 7379 6e63 2064  test.    async d
+00004ab0: 6566 2074 6573 745f 6669 6c65 5f6e 6f74  ef test_file_not
+00004ac0: 5f65 7869 7374 735f 6173 796e 6328 7365  _exists_async(se
+00004ad0: 6c66 2c20 7374 6f72 6167 655f 6163 636f  lf, storage_acco
+00004ae0: 756e 745f 6e61 6d65 2c20 7374 6f72 6167  unt_name, storag
+00004af0: 655f 6163 636f 756e 745f 6b65 7929 3a0a  e_account_key):.
+00004b00: 2020 2020 2020 2020 7365 6c66 2e5f 7365          self._se
+00004b10: 7475 7028 7374 6f72 6167 655f 6163 636f  tup(storage_acco
+00004b20: 756e 745f 6e61 6d65 2c20 7374 6f72 6167  unt_name, storag
+00004b30: 655f 6163 636f 756e 745f 6b65 7929 0a20  e_account_key). 
+00004b40: 2020 2020 2020 2066 696c 655f 6e61 6d65         file_name
+00004b50: 203d 2073 656c 662e 5f67 6574 5f66 696c   = self._get_fil
+00004b60: 655f 7265 6665 7265 6e63 6528 290a 2020  e_reference().  
+00004b70: 2020 2020 2020 6669 6c65 5f63 6c69 656e        file_clien
+00004b80: 7420 3d20 5368 6172 6546 696c 6543 6c69  t = ShareFileCli
+00004b90: 656e 7428 0a20 2020 2020 2020 2020 2020  ent(.           
+00004ba0: 2073 656c 662e 6163 636f 756e 745f 7572   self.account_ur
+00004bb0: 6c28 7374 6f72 6167 655f 6163 636f 756e  l(storage_accoun
+00004bc0: 745f 6e61 6d65 2c20 2266 696c 6522 292c  t_name, "file"),
+00004bd0: 0a20 2020 2020 2020 2020 2020 2073 6861  .            sha
+00004be0: 7265 5f6e 616d 653d 7365 6c66 2e73 6861  re_name=self.sha
+00004bf0: 7265 5f6e 616d 652c 0a20 2020 2020 2020  re_name,.       
+00004c00: 2020 2020 2066 696c 655f 7061 7468 3d22       file_path="
+00004c10: 6d69 7373 696e 6764 6972 2f22 202b 2066  missingdir/" + f
+00004c20: 696c 655f 6e61 6d65 2c0a 2020 2020 2020  ile_name,.      
+00004c30: 2020 2020 2020 6372 6564 656e 7469 616c        credential
+00004c40: 3d73 746f 7261 6765 5f61 6363 6f75 6e74  =storage_account
+00004c50: 5f6b 6579 290a 0a20 2020 2020 2020 2023  _key)..        #
+00004c60: 2041 6374 0a20 2020 2020 2020 2077 6974   Act.        wit
+00004c70: 6820 7365 6c66 2e61 7373 6572 7452 6169  h self.assertRai
+00004c80: 7365 7328 5265 736f 7572 6365 4e6f 7446  ses(ResourceNotF
+00004c90: 6f75 6e64 4572 726f 7229 3a0a 2020 2020  oundError):.    
+00004ca0: 2020 2020 2020 2020 6177 6169 7420 6669          await fi
+00004cb0: 6c65 5f63 6c69 656e 742e 6765 745f 6669  le_client.get_fi
+00004cc0: 6c65 5f70 726f 7065 7274 6965 7328 290a  le_properties().
+00004cd0: 0a20 2020 2040 4669 6c65 5368 6172 6550  .    @FileShareP
+00004ce0: 7265 7061 7265 7228 290a 2020 2020 4041  reparer().    @A
+00004cf0: 7379 6e63 5374 6f72 6167 6554 6573 7443  syncStorageTestC
+00004d00: 6173 652e 6177 6169 745f 7072 6570 6172  ase.await_prepar
+00004d10: 6564 5f74 6573 740a 2020 2020 6173 796e  ed_test.    asyn
+00004d20: 6320 6465 6620 7465 7374 5f66 696c 655f  c def test_file_
+00004d30: 6578 6973 7473 5f77 6974 685f 736e 6170  exists_with_snap
+00004d40: 7368 6f74 5f61 7379 6e63 2873 656c 662c  shot_async(self,
+00004d50: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
+00004d60: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
+00004d70: 6363 6f75 6e74 5f6b 6579 293a 0a20 2020  ccount_key):.   
+00004d80: 2020 2020 2073 656c 662e 5f73 6574 7570       self._setup
+00004d90: 2873 746f 7261 6765 5f61 6363 6f75 6e74  (storage_account
+00004da0: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
+00004db0: 6363 6f75 6e74 5f6b 6579 290a 2020 2020  ccount_key).    
+00004dc0: 2020 2020 6669 6c65 5f63 6c69 656e 7420      file_client 
+00004dd0: 3d20 6177 6169 7420 7365 6c66 2e5f 6372  = await self._cr
+00004de0: 6561 7465 5f66 696c 6528 7374 6f72 6167  eate_file(storag
+00004df0: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
+00004e00: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
+00004e10: 6b65 7929 0a20 2020 2020 2020 2073 6861  key).        sha
+00004e20: 7265 5f63 6c69 656e 7420 3d20 7365 6c66  re_client = self
+00004e30: 2e66 7363 2e67 6574 5f73 6861 7265 5f63  .fsc.get_share_c
+00004e40: 6c69 656e 7428 7365 6c66 2e73 6861 7265  lient(self.share
+00004e50: 5f6e 616d 6529 0a20 2020 2020 2020 2073  _name).        s
+00004e60: 6e61 7073 686f 7420 3d20 6177 6169 7420  napshot = await 
+00004e70: 7368 6172 655f 636c 6965 6e74 2e63 7265  share_client.cre
+00004e80: 6174 655f 736e 6170 7368 6f74 2829 0a20  ate_snapshot(). 
+00004e90: 2020 2020 2020 2061 7761 6974 2066 696c         await fil
+00004ea0: 655f 636c 6965 6e74 2e64 656c 6574 655f  e_client.delete_
+00004eb0: 6669 6c65 2829 0a0a 2020 2020 2020 2020  file()..        
+00004ec0: 2320 4163 740a 2020 2020 2020 2020 736e  # Act.        sn
+00004ed0: 6170 7368 6f74 5f63 6c69 656e 7420 3d20  apshot_client = 
+00004ee0: 5368 6172 6546 696c 6543 6c69 656e 7428  ShareFileClient(
+00004ef0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00004f00: 662e 6163 636f 756e 745f 7572 6c28 7374  f.account_url(st
+00004f10: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
+00004f20: 6d65 2c20 2266 696c 6522 292c 0a20 2020  me, "file"),.   
+00004f30: 2020 2020 2020 2020 2073 6861 7265 5f6e           share_n
+00004f40: 616d 653d 7365 6c66 2e73 6861 7265 5f6e  ame=self.share_n
+00004f50: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
+00004f60: 2066 696c 655f 7061 7468 3d66 696c 655f   file_path=file_
+00004f70: 636c 6965 6e74 2e66 696c 655f 6e61 6d65  client.file_name
+00004f80: 2c0a 2020 2020 2020 2020 2020 2020 736e  ,.            sn
+00004f90: 6170 7368 6f74 3d73 6e61 7073 686f 742c  apshot=snapshot,
+00004fa0: 0a20 2020 2020 2020 2020 2020 2063 7265  .            cre
+00004fb0: 6465 6e74 6961 6c3d 7374 6f72 6167 655f  dential=storage_
+00004fc0: 6163 636f 756e 745f 6b65 7929 0a20 2020  account_key).   
+00004fd0: 2020 2020 2070 726f 7073 203d 2061 7761       props = awa
+00004fe0: 6974 2073 6e61 7073 686f 745f 636c 6965  it snapshot_clie
+00004ff0: 6e74 2e67 6574 5f66 696c 655f 7072 6f70  nt.get_file_prop
+00005000: 6572 7469 6573 2829 0a0a 2020 2020 2020  erties()..      
+00005010: 2020 2320 4173 7365 7274 0a20 2020 2020    # Assert.     
+00005020: 2020 2073 656c 662e 6173 7365 7274 5472     self.assertTr
+00005030: 7565 2870 726f 7073 290a 0a20 2020 2040  ue(props)..    @
+00005040: 4669 6c65 5368 6172 6550 7265 7061 7265  FileSharePrepare
+00005050: 7228 290a 2020 2020 4041 7379 6e63 5374  r().    @AsyncSt
+00005060: 6f72 6167 6554 6573 7443 6173 652e 6177  orageTestCase.aw
+00005070: 6169 745f 7072 6570 6172 6564 5f74 6573  ait_prepared_tes
+00005080: 740a 2020 2020 6173 796e 6320 6465 6620  t.    async def 
+00005090: 7465 7374 5f66 696c 655f 6e6f 745f 6578  test_file_not_ex
+000050a0: 6973 7473 5f77 6974 685f 736e 6170 7368  ists_with_snapsh
+000050b0: 6f74 5f61 7379 6e63 2873 656c 662c 2073  ot_async(self, s
+000050c0: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
+000050d0: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
+000050e0: 6f75 6e74 5f6b 6579 293a 0a20 2020 2020  ount_key):.     
+000050f0: 2020 2073 656c 662e 5f73 6574 7570 2873     self._setup(s
+00005100: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
+00005110: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
+00005120: 6f75 6e74 5f6b 6579 290a 2020 2020 2020  ount_key).      
+00005130: 2020 6177 6169 7420 7365 6c66 2e5f 7365    await self._se
+00005140: 7475 705f 7368 6172 6528 7374 6f72 6167  tup_share(storag
+00005150: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
+00005160: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
+00005170: 6b65 7929 0a20 2020 2020 2020 2073 6861  key).        sha
+00005180: 7265 5f63 6c69 656e 7420 3d20 7365 6c66  re_client = self
+00005190: 2e66 7363 2e67 6574 5f73 6861 7265 5f63  .fsc.get_share_c
+000051a0: 6c69 656e 7428 7365 6c66 2e73 6861 7265  lient(self.share
+000051b0: 5f6e 616d 6529 0a20 2020 2020 2020 2073  _name).        s
+000051c0: 6e61 7073 686f 7420 3d20 6177 6169 7420  napshot = await 
+000051d0: 7368 6172 655f 636c 6965 6e74 2e63 7265  share_client.cre
+000051e0: 6174 655f 736e 6170 7368 6f74 2829 0a0a  ate_snapshot()..
+000051f0: 2020 2020 2020 2020 6669 6c65 5f63 6c69          file_cli
+00005200: 656e 7420 3d20 6177 6169 7420 7365 6c66  ent = await self
+00005210: 2e5f 6372 6561 7465 5f66 696c 6528 7374  ._create_file(st
+00005220: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
+00005230: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
+00005240: 756e 745f 6b65 7929 0a0a 2020 2020 2020  unt_key)..      
+00005250: 2020 2320 4163 740a 2020 2020 2020 2020    # Act.        
+00005260: 736e 6170 7368 6f74 5f63 6c69 656e 7420  snapshot_client 
+00005270: 3d20 5368 6172 6546 696c 6543 6c69 656e  = ShareFileClien
+00005280: 7428 0a20 2020 2020 2020 2020 2020 2073  t(.            s
+00005290: 656c 662e 6163 636f 756e 745f 7572 6c28  elf.account_url(
+000052a0: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
+000052b0: 6e61 6d65 2c20 2266 696c 6522 292c 0a20  name, "file"),. 
+000052c0: 2020 2020 2020 2020 2020 2073 6861 7265             share
+000052d0: 5f6e 616d 653d 7365 6c66 2e73 6861 7265  _name=self.share
+000052e0: 5f6e 616d 652c 0a20 2020 2020 2020 2020  _name,.         
+000052f0: 2020 2066 696c 655f 7061 7468 3d66 696c     file_path=fil
+00005300: 655f 636c 6965 6e74 2e66 696c 655f 6e61  e_client.file_na
+00005310: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
+00005320: 736e 6170 7368 6f74 3d73 6e61 7073 686f  snapshot=snapsho
+00005330: 742c 0a20 2020 2020 2020 2020 2020 2063  t,.            c
+00005340: 7265 6465 6e74 6961 6c3d 7374 6f72 6167  redential=storag
+00005350: 655f 6163 636f 756e 745f 6b65 7929 0a0a  e_account_key)..
+00005360: 2020 2020 2020 2020 2320 4173 7365 7274          # Assert
+00005370: 0a20 2020 2020 2020 2077 6974 6820 7365  .        with se
+00005380: 6c66 2e61 7373 6572 7452 6169 7365 7328  lf.assertRaises(
+00005390: 5265 736f 7572 6365 4e6f 7446 6f75 6e64  ResourceNotFound
+000053a0: 4572 726f 7229 3a0a 2020 2020 2020 2020  Error):.        
+000053b0: 2020 2020 6177 6169 7420 736e 6170 7368      await snapsh
+000053c0: 6f74 5f63 6c69 656e 742e 6765 745f 6669  ot_client.get_fi
+000053d0: 6c65 5f70 726f 7065 7274 6965 7328 290a  le_properties().
+000053e0: 0a20 2020 2040 4669 6c65 5368 6172 6550  .    @FileShareP
+000053f0: 7265 7061 7265 7228 290a 2020 2020 4041  reparer().    @A
+00005400: 7379 6e63 5374 6f72 6167 6554 6573 7443  syncStorageTestC
+00005410: 6173 652e 6177 6169 745f 7072 6570 6172  ase.await_prepar
+00005420: 6564 5f74 6573 740a 2020 2020 6173 796e  ed_test.    asyn
+00005430: 6320 6465 6620 7465 7374 5f72 6573 697a  c def test_resiz
+00005440: 655f 6669 6c65 5f61 7379 6e63 2873 656c  e_file_async(sel
+00005450: 662c 2073 746f 7261 6765 5f61 6363 6f75  f, storage_accou
+00005460: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
+00005470: 5f61 6363 6f75 6e74 5f6b 6579 293a 0a20  _account_key):. 
+00005480: 2020 2020 2020 2073 656c 662e 5f73 6574         self._set
+00005490: 7570 2873 746f 7261 6765 5f61 6363 6f75  up(storage_accou
+000054a0: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
+000054b0: 5f61 6363 6f75 6e74 5f6b 6579 290a 2020  _account_key).  
+000054c0: 2020 2020 2020 6669 6c65 5f63 6c69 656e        file_clien
+000054d0: 7420 3d20 6177 6169 7420 7365 6c66 2e5f  t = await self._
+000054e0: 6372 6561 7465 5f66 696c 6528 7374 6f72  create_file(stor
+000054f0: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
+00005500: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
+00005510: 745f 6b65 7929 0a0a 2020 2020 2020 2020  t_key)..        
+00005520: 2320 4163 740a 2020 2020 2020 2020 6177  # Act.        aw
+00005530: 6169 7420 6669 6c65 5f63 6c69 656e 742e  ait file_client.
+00005540: 7265 7369 7a65 5f66 696c 6528 3529 0a0a  resize_file(5)..
+00005550: 2020 2020 2020 2020 2320 4173 7365 7274          # Assert
+00005560: 0a20 2020 2020 2020 2070 726f 7073 203d  .        props =
+00005570: 2061 7761 6974 2066 696c 655f 636c 6965   await file_clie
+00005580: 6e74 2e67 6574 5f66 696c 655f 7072 6f70  nt.get_file_prop
+00005590: 6572 7469 6573 2829 0a20 2020 2020 2020  erties().       
+000055a0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+000055b0: 6c28 7072 6f70 732e 7369 7a65 2c20 3529  l(props.size, 5)
+000055c0: 0a0a 2020 2020 4046 696c 6553 6861 7265  ..    @FileShare
+000055d0: 5072 6570 6172 6572 2829 0a20 2020 2040  Preparer().    @
+000055e0: 4173 796e 6353 746f 7261 6765 5465 7374  AsyncStorageTest
+000055f0: 4361 7365 2e61 7761 6974 5f70 7265 7061  Case.await_prepa
+00005600: 7265 645f 7465 7374 0a20 2020 2061 7379  red_test.    asy
+00005610: 6e63 2064 6566 2074 6573 745f 7265 7369  nc def test_resi
+00005620: 7a65 5f66 696c 655f 7769 7468 5f6c 6561  ze_file_with_lea
+00005630: 7365 5f61 7379 6e63 2873 656c 662c 2073  se_async(self, s
+00005640: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
+00005650: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
+00005660: 6f75 6e74 5f6b 6579 293a 0a20 2020 2020  ount_key):.     
+00005670: 2020 2073 656c 662e 5f73 6574 7570 2873     self._setup(s
+00005680: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
+00005690: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
+000056a0: 6f75 6e74 5f6b 6579 290a 2020 2020 2020  ount_key).      
+000056b0: 2020 6669 6c65 5f63 6c69 656e 7420 3d20    file_client = 
+000056c0: 6177 6169 7420 7365 6c66 2e5f 6372 6561  await self._crea
+000056d0: 7465 5f66 696c 6528 7374 6f72 6167 655f  te_file(storage_
+000056e0: 6163 636f 756e 745f 6e61 6d65 2c20 7374  account_name, st
+000056f0: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
+00005700: 7929 0a20 2020 2020 2020 206c 6561 7365  y).        lease
+00005710: 203d 2061 7761 6974 2066 696c 655f 636c   = await file_cl
+00005720: 6965 6e74 2e61 6371 7569 7265 5f6c 6561  ient.acquire_lea
+00005730: 7365 2829 0a0a 2020 2020 2020 2020 2320  se()..        # 
+00005740: 4163 740a 2020 2020 2020 2020 7769 7468  Act.        with
+00005750: 2073 656c 662e 6173 7365 7274 5261 6973   self.assertRais
+00005760: 6573 2848 7474 7052 6573 706f 6e73 6545  es(HttpResponseE
+00005770: 7272 6f72 293a 0a20 2020 2020 2020 2020  rror):.         
+00005780: 2020 2061 7761 6974 2066 696c 655f 636c     await file_cl
+00005790: 6965 6e74 2e72 6573 697a 655f 6669 6c65  ient.resize_file
+000057a0: 2835 290a 2020 2020 2020 2020 6177 6169  (5).        awai
+000057b0: 7420 6669 6c65 5f63 6c69 656e 742e 7265  t file_client.re
+000057c0: 7369 7a65 5f66 696c 6528 352c 206c 6561  size_file(5, lea
+000057d0: 7365 3d6c 6561 7365 290a 0a20 2020 2020  se=lease)..     
+000057e0: 2020 2023 2041 7373 6572 740a 2020 2020     # Assert.    
+000057f0: 2020 2020 7072 6f70 7320 3d20 6177 6169      props = awai
+00005800: 7420 6669 6c65 5f63 6c69 656e 742e 6765  t file_client.ge
+00005810: 745f 6669 6c65 5f70 726f 7065 7274 6965  t_file_propertie
+00005820: 7328 290a 2020 2020 2020 2020 7365 6c66  s().        self
+00005830: 2e61 7373 6572 7445 7175 616c 2870 726f  .assertEqual(pro
+00005840: 7073 2e73 697a 652c 2035 290a 0a20 2020  ps.size, 5)..   
+00005850: 2040 4669 6c65 5368 6172 6550 7265 7061   @FileSharePrepa
+00005860: 7265 7228 290a 2020 2020 4041 7379 6e63  rer().    @Async
+00005870: 5374 6f72 6167 6554 6573 7443 6173 652e  StorageTestCase.
+00005880: 6177 6169 745f 7072 6570 6172 6564 5f74  await_prepared_t
+00005890: 6573 740a 2020 2020 6173 796e 6320 6465  est.    async de
+000058a0: 6620 7465 7374 5f73 6574 5f66 696c 655f  f test_set_file_
+000058b0: 7072 6f70 6572 7469 6573 5f61 7379 6e63  properties_async
+000058c0: 2873 656c 662c 2073 746f 7261 6765 5f61  (self, storage_a
+000058d0: 6363 6f75 6e74 5f6e 616d 652c 2073 746f  ccount_name, sto
+000058e0: 7261 6765 5f61 6363 6f75 6e74 5f6b 6579  rage_account_key
+000058f0: 293a 0a20 2020 2020 2020 2073 656c 662e  ):.        self.
+00005900: 5f73 6574 7570 2873 746f 7261 6765 5f61  _setup(storage_a
+00005910: 6363 6f75 6e74 5f6e 616d 652c 2073 746f  ccount_name, sto
+00005920: 7261 6765 5f61 6363 6f75 6e74 5f6b 6579  rage_account_key
+00005930: 290a 2020 2020 2020 2020 6669 6c65 5f63  ).        file_c
+00005940: 6c69 656e 7420 3d20 6177 6169 7420 7365  lient = await se
+00005950: 6c66 2e5f 6372 6561 7465 5f66 696c 6528  lf._create_file(
+00005960: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
+00005970: 6e61 6d65 2c20 7374 6f72 6167 655f 6163  name, storage_ac
+00005980: 636f 756e 745f 6b65 7929 0a0a 2020 2020  count_key)..    
+00005990: 2020 2020 2320 4163 740a 2020 2020 2020      # Act.      
+000059a0: 2020 636f 6e74 656e 745f 7365 7474 696e    content_settin
+000059b0: 6773 203d 2043 6f6e 7465 6e74 5365 7474  gs = ContentSett
+000059c0: 696e 6773 280a 2020 2020 2020 2020 2020  ings(.          
+000059d0: 2020 636f 6e74 656e 745f 6c61 6e67 7561    content_langua
+000059e0: 6765 3d27 7370 616e 6973 6827 2c0a 2020  ge='spanish',.  
+000059f0: 2020 2020 2020 2020 2020 636f 6e74 656e            conten
+00005a00: 745f 6469 7370 6f73 6974 696f 6e3d 2769  t_disposition='i
+00005a10: 6e6c 696e 6527 290a 2020 2020 2020 2020  nline').        
+00005a20: 7265 7370 203d 2061 7761 6974 2066 696c  resp = await fil
+00005a30: 655f 636c 6965 6e74 2e73 6574 5f68 7474  e_client.set_htt
+00005a40: 705f 6865 6164 6572 7328 636f 6e74 656e  p_headers(conten
+00005a50: 745f 7365 7474 696e 6773 3d63 6f6e 7465  t_settings=conte
+00005a60: 6e74 5f73 6574 7469 6e67 7329 0a0a 2020  nt_settings)..  
+00005a70: 2020 2020 2020 2320 4173 7365 7274 0a20        # Assert. 
+00005a80: 2020 2020 2020 2070 726f 7065 7274 6965         propertie
+00005a90: 7320 3d20 6177 6169 7420 6669 6c65 5f63  s = await file_c
+00005aa0: 6c69 656e 742e 6765 745f 6669 6c65 5f70  lient.get_file_p
+00005ab0: 726f 7065 7274 6965 7328 290a 2020 2020  roperties().    
+00005ac0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00005ad0: 7175 616c 2870 726f 7065 7274 6965 732e  qual(properties.
+00005ae0: 636f 6e74 656e 745f 7365 7474 696e 6773  content_settings
+00005af0: 2e63 6f6e 7465 6e74 5f6c 616e 6775 6167  .content_languag
+00005b00: 652c 2063 6f6e 7465 6e74 5f73 6574 7469  e, content_setti
+00005b10: 6e67 732e 636f 6e74 656e 745f 6c61 6e67  ngs.content_lang
+00005b20: 7561 6765 290a 2020 2020 2020 2020 7365  uage).        se
+00005b30: 6c66 2e61 7373 6572 7445 7175 616c 2870  lf.assertEqual(p
+00005b40: 726f 7065 7274 6965 732e 636f 6e74 656e  roperties.conten
+00005b50: 745f 7365 7474 696e 6773 2e63 6f6e 7465  t_settings.conte
+00005b60: 6e74 5f64 6973 706f 7369 7469 6f6e 2c20  nt_disposition, 
+00005b70: 636f 6e74 656e 745f 7365 7474 696e 6773  content_settings
+00005b80: 2e63 6f6e 7465 6e74 5f64 6973 706f 7369  .content_disposi
+00005b90: 7469 6f6e 290a 2020 2020 2020 2020 7365  tion).        se
+00005ba0: 6c66 2e61 7373 6572 7449 734e 6f74 4e6f  lf.assertIsNotNo
+00005bb0: 6e65 2870 726f 7065 7274 6965 732e 6c61  ne(properties.la
+00005bc0: 7374 5f77 7269 7465 5f74 696d 6529 0a20  st_write_time). 
+00005bd0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00005be0: 7274 4973 4e6f 744e 6f6e 6528 7072 6f70  rtIsNotNone(prop
+00005bf0: 6572 7469 6573 2e63 7265 6174 696f 6e5f  erties.creation_
+00005c00: 7469 6d65 290a 2020 2020 2020 2020 7365  time).        se
+00005c10: 6c66 2e61 7373 6572 7449 734e 6f74 4e6f  lf.assertIsNotNo
+00005c20: 6e65 2870 726f 7065 7274 6965 732e 7065  ne(properties.pe
+00005c30: 726d 6973 7369 6f6e 5f6b 6579 290a 0a20  rmission_key).. 
+00005c40: 2020 2040 4669 6c65 5368 6172 6550 7265     @FileSharePre
+00005c50: 7061 7265 7228 290a 2020 2020 4041 7379  parer().    @Asy
+00005c60: 6e63 5374 6f72 6167 6554 6573 7443 6173  ncStorageTestCas
+00005c70: 652e 6177 6169 745f 7072 6570 6172 6564  e.await_prepared
+00005c80: 5f74 6573 740a 2020 2020 6173 796e 6320  _test.    async 
+00005c90: 6465 6620 7465 7374 5f73 6574 5f66 696c  def test_set_fil
+00005ca0: 655f 7072 6f70 6572 7469 6573 5f77 6974  e_properties_wit
+00005cb0: 685f 6669 6c65 5f70 6572 6d69 7373 696f  h_file_permissio
+00005cc0: 6e28 7365 6c66 2c20 7374 6f72 6167 655f  n(self, storage_
+00005cd0: 6163 636f 756e 745f 6e61 6d65 2c20 7374  account_name, st
+00005ce0: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
+00005cf0: 7929 3a0a 2020 2020 2020 2020 7365 6c66  y):.        self
+00005d00: 2e5f 7365 7475 7028 7374 6f72 6167 655f  ._setup(storage_
+00005d10: 6163 636f 756e 745f 6e61 6d65 2c20 7374  account_name, st
+00005d20: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
+00005d30: 7929 0a20 2020 2020 2020 2066 696c 655f  y).        file_
+00005d40: 636c 6965 6e74 203d 2061 7761 6974 2073  client = await s
+00005d50: 656c 662e 5f63 7265 6174 655f 6669 6c65  elf._create_file
+00005d60: 2873 746f 7261 6765 5f61 6363 6f75 6e74  (storage_account
+00005d70: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
+00005d80: 6363 6f75 6e74 5f6b 6579 290a 2020 2020  ccount_key).    
+00005d90: 2020 2020 7072 6f70 6572 7469 6573 5f6f      properties_o
+00005da0: 6e5f 6372 6561 7469 6f6e 203d 2061 7761  n_creation = awa
+00005db0: 6974 2066 696c 655f 636c 6965 6e74 2e67  it file_client.g
+00005dc0: 6574 5f66 696c 655f 7072 6f70 6572 7469  et_file_properti
+00005dd0: 6573 2829 0a0a 2020 2020 2020 2020 636f  es()..        co
+00005de0: 6e74 656e 745f 7365 7474 696e 6773 203d  ntent_settings =
+00005df0: 2043 6f6e 7465 6e74 5365 7474 696e 6773   ContentSettings
+00005e00: 280a 2020 2020 2020 2020 2020 2020 636f  (.            co
+00005e10: 6e74 656e 745f 6c61 6e67 7561 6765 3d27  ntent_language='
+00005e20: 7370 616e 6973 6827 2c0a 2020 2020 2020  spanish',.      
+00005e30: 2020 2020 2020 636f 6e74 656e 745f 6469        content_di
+00005e40: 7370 6f73 6974 696f 6e3d 2769 6e6c 696e  sposition='inlin
+00005e50: 6527 290a 0a20 2020 2020 2020 206e 7466  e')..        ntf
+00005e60: 735f 6174 7472 6962 7574 6573 203d 204e  s_attributes = N
+00005e70: 5446 5341 7474 7269 6275 7465 7328 6172  TFSAttributes(ar
+00005e80: 6368 6976 653d 5472 7565 2c20 7465 6d70  chive=True, temp
+00005e90: 6f72 6172 793d 5472 7565 290a 2020 2020  orary=True).    
+00005ea0: 2020 2020 6c61 7374 5f77 7269 7465 5f74      last_write_t
+00005eb0: 696d 6520 3d20 7072 6f70 6572 7469 6573  ime = properties
+00005ec0: 5f6f 6e5f 6372 6561 7469 6f6e 2e6c 6173  _on_creation.las
+00005ed0: 745f 7772 6974 655f 7469 6d65 202b 2074  t_write_time + t
+00005ee0: 696d 6564 656c 7461 2868 6f75 7273 3d33  imedelta(hours=3
+00005ef0: 290a 2020 2020 2020 2020 6372 6561 7469  ).        creati
+00005f00: 6f6e 5f74 696d 6520 3d20 7072 6f70 6572  on_time = proper
+00005f10: 7469 6573 5f6f 6e5f 6372 6561 7469 6f6e  ties_on_creation
+00005f20: 2e63 7265 6174 696f 6e5f 7469 6d65 202b  .creation_time +
+00005f30: 2074 696d 6564 656c 7461 2868 6f75 7273   timedelta(hours
+00005f40: 3d33 290a 2020 2020 2020 2020 6368 616e  =3).        chan
+00005f50: 6765 5f74 696d 6520 3d20 7072 6f70 6572  ge_time = proper
+00005f60: 7469 6573 5f6f 6e5f 6372 6561 7469 6f6e  ties_on_creation
+00005f70: 2e63 6861 6e67 655f 7469 6d65 202b 2074  .change_time + t
+00005f80: 696d 6564 656c 7461 2868 6f75 7273 3d33  imedelta(hours=3
+00005f90: 290a 0a20 2020 2020 2020 2023 2041 6374  )..        # Act
+00005fa0: 0a20 2020 2020 2020 2061 7761 6974 2066  .        await f
+00005fb0: 696c 655f 636c 6965 6e74 2e73 6574 5f68  ile_client.set_h
+00005fc0: 7474 705f 6865 6164 6572 7328 0a20 2020  ttp_headers(.   
+00005fd0: 2020 2020 2020 2020 2063 6f6e 7465 6e74           content
+00005fe0: 5f73 6574 7469 6e67 733d 636f 6e74 656e  _settings=conten
+00005ff0: 745f 7365 7474 696e 6773 2c0a 2020 2020  t_settings,.    
+00006000: 2020 2020 2020 2020 6669 6c65 5f61 7474          file_att
+00006010: 7269 6275 7465 733d 6e74 6673 5f61 7474  ributes=ntfs_att
+00006020: 7269 6275 7465 732c 0a20 2020 2020 2020  ributes,.       
+00006030: 2020 2020 2066 696c 655f 6c61 7374 5f77       file_last_w
+00006040: 7269 7465 5f74 696d 653d 6c61 7374 5f77  rite_time=last_w
+00006050: 7269 7465 5f74 696d 652c 0a20 2020 2020  rite_time,.     
+00006060: 2020 2020 2020 2066 696c 655f 6372 6561         file_crea
+00006070: 7469 6f6e 5f74 696d 653d 6372 6561 7469  tion_time=creati
+00006080: 6f6e 5f74 696d 652c 0a20 2020 2020 2020  on_time,.       
+00006090: 2020 2020 2066 696c 655f 6368 616e 6765       file_change
+000060a0: 5f74 696d 653d 6368 616e 6765 5f74 696d  _time=change_tim
+000060b0: 650a 2020 2020 2020 2020 290a 0a20 2020  e.        )..   
+000060c0: 2020 2020 2023 2041 7373 6572 740a 2020       # Assert.  
+000060d0: 2020 2020 2020 7072 6f70 6572 7469 6573        properties
+000060e0: 203d 2061 7761 6974 2066 696c 655f 636c   = await file_cl
+000060f0: 6965 6e74 2e67 6574 5f66 696c 655f 7072  ient.get_file_pr
+00006100: 6f70 6572 7469 6573 2829 0a20 2020 2020  operties().     
+00006110: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00006120: 7561 6c28 7072 6f70 6572 7469 6573 2e63  ual(properties.c
+00006130: 6f6e 7465 6e74 5f73 6574 7469 6e67 732e  ontent_settings.
+00006140: 636f 6e74 656e 745f 6c61 6e67 7561 6765  content_language
+00006150: 2c20 636f 6e74 656e 745f 7365 7474 696e  , content_settin
+00006160: 6773 2e63 6f6e 7465 6e74 5f6c 616e 6775  gs.content_langu
+00006170: 6167 6529 0a20 2020 2020 2020 2073 656c  age).        sel
+00006180: 662e 6173 7365 7274 4571 7561 6c28 7072  f.assertEqual(pr
+00006190: 6f70 6572 7469 6573 2e63 6f6e 7465 6e74  operties.content
+000061a0: 5f73 6574 7469 6e67 732e 636f 6e74 656e  _settings.conten
+000061b0: 745f 6469 7370 6f73 6974 696f 6e2c 2063  t_disposition, c
+000061c0: 6f6e 7465 6e74 5f73 6574 7469 6e67 732e  ontent_settings.
+000061d0: 636f 6e74 656e 745f 6469 7370 6f73 6974  content_disposit
+000061e0: 696f 6e29 0a20 2020 2020 2020 2073 656c  ion).        sel
+000061f0: 662e 6173 7365 7274 4571 7561 6c28 7072  f.assertEqual(pr
+00006200: 6f70 6572 7469 6573 2e63 7265 6174 696f  operties.creatio
+00006210: 6e5f 7469 6d65 2c20 6372 6561 7469 6f6e  n_time, creation
+00006220: 5f74 696d 6529 0a20 2020 2020 2020 2073  _time).        s
+00006230: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00006240: 7072 6f70 6572 7469 6573 2e6c 6173 745f  properties.last_
+00006250: 7772 6974 655f 7469 6d65 2c20 6c61 7374  write_time, last
+00006260: 5f77 7269 7465 5f74 696d 6529 0a20 2020  _write_time).   
+00006270: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00006280: 4571 7561 6c28 7072 6f70 6572 7469 6573  Equal(properties
+00006290: 2e63 6861 6e67 655f 7469 6d65 2c20 6368  .change_time, ch
+000062a0: 616e 6765 5f74 696d 6529 0a20 2020 2020  ange_time).     
+000062b0: 2020 2073 656c 662e 6173 7365 7274 496e     self.assertIn
+000062c0: 2822 4172 6368 6976 6522 2c20 7072 6f70  ("Archive", prop
+000062d0: 6572 7469 6573 2e66 696c 655f 6174 7472  erties.file_attr
+000062e0: 6962 7574 6573 290a 2020 2020 2020 2020  ibutes).        
+000062f0: 7365 6c66 2e61 7373 6572 7449 6e28 2254  self.assertIn("T
+00006300: 656d 706f 7261 7279 222c 2070 726f 7065  emporary", prope
+00006310: 7274 6965 732e 6669 6c65 5f61 7474 7269  rties.file_attri
+00006320: 6275 7465 7329 0a0a 2020 2020 4046 696c  butes)..    @Fil
+00006330: 6553 6861 7265 5072 6570 6172 6572 2829  eSharePreparer()
+00006340: 0a20 2020 2040 4173 796e 6353 746f 7261  .    @AsyncStora
+00006350: 6765 5465 7374 4361 7365 2e61 7761 6974  geTestCase.await
+00006360: 5f70 7265 7061 7265 645f 7465 7374 0a20  _prepared_test. 
+00006370: 2020 2061 7379 6e63 2064 6566 2074 6573     async def tes
+00006380: 745f 6765 745f 6669 6c65 5f70 726f 7065  t_get_file_prope
+00006390: 7274 6965 735f 6173 796e 6328 7365 6c66  rties_async(self
+000063a0: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
+000063b0: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
+000063c0: 6163 636f 756e 745f 6b65 7929 3a0a 2020  account_key):.  
+000063d0: 2020 2020 2020 7365 6c66 2e5f 7365 7475        self._setu
+000063e0: 7028 7374 6f72 6167 655f 6163 636f 756e  p(storage_accoun
+000063f0: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
+00006400: 6163 636f 756e 745f 6b65 7929 0a20 2020  account_key).   
+00006410: 2020 2020 2066 696c 655f 636c 6965 6e74       file_client
+00006420: 203d 2061 7761 6974 2073 656c 662e 5f63   = await self._c
+00006430: 7265 6174 655f 6669 6c65 2873 746f 7261  reate_file(stora
+00006440: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
+00006450: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
+00006460: 5f6b 6579 290a 0a20 2020 2020 2020 2023  _key)..        #
+00006470: 2041 6374 0a20 2020 2020 2020 2070 726f   Act.        pro
+00006480: 7065 7274 6965 7320 3d20 6177 6169 7420  perties = await 
+00006490: 6669 6c65 5f63 6c69 656e 742e 6765 745f  file_client.get_
+000064a0: 6669 6c65 5f70 726f 7065 7274 6965 7328  file_properties(
+000064b0: 290a 0a20 2020 2020 2020 2023 2041 7373  )..        # Ass
+000064c0: 6572 740a 2020 2020 2020 2020 7365 6c66  ert.        self
+000064d0: 2e61 7373 6572 7449 734e 6f74 4e6f 6e65  .assertIsNotNone
+000064e0: 2870 726f 7065 7274 6965 7329 0a20 2020  (properties).   
+000064f0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00006500: 4571 7561 6c28 7072 6f70 6572 7469 6573  Equal(properties
+00006510: 2e73 697a 652c 206c 656e 2873 656c 662e  .size, len(self.
+00006520: 7368 6f72 745f 6279 7465 5f64 6174 6129  short_byte_data)
+00006530: 290a 0a20 2020 2040 4669 6c65 5368 6172  )..    @FileShar
+00006540: 6550 7265 7061 7265 7228 290a 2020 2020  ePreparer().    
+00006550: 4041 7379 6e63 5374 6f72 6167 6554 6573  @AsyncStorageTes
+00006560: 7443 6173 652e 6177 6169 745f 7072 6570  tCase.await_prep
+00006570: 6172 6564 5f74 6573 740a 2020 2020 6173  ared_test.    as
+00006580: 796e 6320 6465 6620 7465 7374 5f67 6574  ync def test_get
+00006590: 5f66 696c 655f 7072 6f70 6572 7469 6573  _file_properties
+000065a0: 5f77 6974 685f 696e 7661 6c69 645f 6c65  _with_invalid_le
+000065b0: 6173 655f 6661 696c 735f 6173 796e 6328  ase_fails_async(
+000065c0: 7365 6c66 2c20 7374 6f72 6167 655f 6163  self, storage_ac
+000065d0: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
+000065e0: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
+000065f0: 3a0a 2020 2020 2020 2020 7365 6c66 2e5f  :.        self._
+00006600: 7365 7475 7028 7374 6f72 6167 655f 6163  setup(storage_ac
+00006610: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
+00006620: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
+00006630: 0a20 2020 2020 2020 2066 696c 655f 636c  .        file_cl
+00006640: 6965 6e74 203d 2061 7761 6974 2073 656c  ient = await sel
+00006650: 662e 5f63 7265 6174 655f 6669 6c65 2873  f._create_file(s
+00006660: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
+00006670: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
+00006680: 6f75 6e74 5f6b 6579 290a 2020 2020 2020  ount_key).      
+00006690: 2020 6669 6c65 5f63 6c69 656e 742e 6163    file_client.ac
+000066a0: 7175 6972 655f 6c65 6173 6528 290a 0a20  quire_lease().. 
+000066b0: 2020 2020 2020 2023 2041 6374 0a20 2020         # Act.   
+000066c0: 2020 2020 2077 6974 6820 7365 6c66 2e61       with self.a
+000066d0: 7373 6572 7452 6169 7365 7328 4874 7470  ssertRaises(Http
+000066e0: 5265 7370 6f6e 7365 4572 726f 7229 3a0a  ResponseError):.
+000066f0: 2020 2020 2020 2020 2020 2020 6177 6169              awai
+00006700: 7420 6669 6c65 5f63 6c69 656e 742e 6765  t file_client.ge
+00006710: 745f 6669 6c65 5f70 726f 7065 7274 6965  t_file_propertie
+00006720: 7328 6c65 6173 653d 7374 7228 7575 6964  s(lease=str(uuid
+00006730: 2e75 7569 6434 2829 2929 0a0a 2020 2020  .uuid4()))..    
+00006740: 2020 2020 2320 6765 7420 7072 6f70 6572      # get proper
+00006750: 7469 6573 206f 6e20 6120 6c65 6173 6564  ties on a leased
+00006760: 2066 696c 6520 7769 6c6c 2073 7563 6365   file will succe
+00006770: 6564 0a20 2020 2020 2020 2070 726f 7065  ed.        prope
+00006780: 7274 6965 7320 3d20 6177 6169 7420 6669  rties = await fi
+00006790: 6c65 5f63 6c69 656e 742e 6765 745f 6669  le_client.get_fi
+000067a0: 6c65 5f70 726f 7065 7274 6965 7328 290a  le_properties().
+000067b0: 0a20 2020 2020 2020 2023 2041 7373 6572  .        # Asser
+000067c0: 740a 2020 2020 2020 2020 7365 6c66 2e61  t.        self.a
+000067d0: 7373 6572 7449 734e 6f74 4e6f 6e65 2870  ssertIsNotNone(p
+000067e0: 726f 7065 7274 6965 7329 0a20 2020 2020  roperties).     
+000067f0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00006800: 7561 6c28 7072 6f70 6572 7469 6573 2e73  ual(properties.s
+00006810: 697a 652c 206c 656e 2873 656c 662e 7368  ize, len(self.sh
+00006820: 6f72 745f 6279 7465 5f64 6174 6129 290a  ort_byte_data)).
+00006830: 0a20 2020 2040 4669 6c65 5368 6172 6550  .    @FileShareP
+00006840: 7265 7061 7265 7228 290a 2020 2020 4041  reparer().    @A
+00006850: 7379 6e63 5374 6f72 6167 6554 6573 7443  syncStorageTestC
+00006860: 6173 652e 6177 6169 745f 7072 6570 6172  ase.await_prepar
+00006870: 6564 5f74 6573 740a 2020 2020 6173 796e  ed_test.    asyn
+00006880: 6320 6465 6620 7465 7374 5f67 6574 5f66  c def test_get_f
+00006890: 696c 655f 7072 6f70 6572 7469 6573 5f77  ile_properties_w
+000068a0: 6974 685f 736e 6170 7368 6f74 5f61 7379  ith_snapshot_asy
+000068b0: 6e63 2873 656c 662c 2073 746f 7261 6765  nc(self, storage
+000068c0: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
+000068d0: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
+000068e0: 6579 293a 0a20 2020 2020 2020 2073 656c  ey):.        sel
+000068f0: 662e 5f73 6574 7570 2873 746f 7261 6765  f._setup(storage
+00006900: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
+00006910: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
+00006920: 6579 290a 2020 2020 2020 2020 6669 6c65  ey).        file
+00006930: 5f63 6c69 656e 7420 3d20 6177 6169 7420  _client = await 
+00006940: 7365 6c66 2e5f 6372 6561 7465 5f66 696c  self._create_fil
+00006950: 6528 7374 6f72 6167 655f 6163 636f 756e  e(storage_accoun
+00006960: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
+00006970: 6163 636f 756e 745f 6b65 7929 0a20 2020  account_key).   
+00006980: 2020 2020 206d 6574 6164 6174 6120 3d20       metadata = 
+00006990: 7b22 7465 7374 3122 3a20 2266 6f6f 222c  {"test1": "foo",
+000069a0: 2022 7465 7374 3222 3a20 2262 6172 227d   "test2": "bar"}
+000069b0: 0a20 2020 2020 2020 2061 7761 6974 2066  .        await f
+000069c0: 696c 655f 636c 6965 6e74 2e73 6574 5f66  ile_client.set_f
+000069d0: 696c 655f 6d65 7461 6461 7461 286d 6574  ile_metadata(met
+000069e0: 6164 6174 6129 0a0a 2020 2020 2020 2020  adata)..        
+000069f0: 7368 6172 655f 636c 6965 6e74 203d 2073  share_client = s
+00006a00: 656c 662e 6673 632e 6765 745f 7368 6172  elf.fsc.get_shar
+00006a10: 655f 636c 6965 6e74 2873 656c 662e 7368  e_client(self.sh
+00006a20: 6172 655f 6e61 6d65 290a 2020 2020 2020  are_name).      
+00006a30: 2020 736e 6170 7368 6f74 203d 2061 7761    snapshot = awa
+00006a40: 6974 2073 6861 7265 5f63 6c69 656e 742e  it share_client.
+00006a50: 6372 6561 7465 5f73 6e61 7073 686f 7428  create_snapshot(
+00006a60: 290a 0a20 2020 2020 2020 206d 6574 6164  )..        metad
+00006a70: 6174 6132 203d 207b 2274 6573 7431 3030  ata2 = {"test100
+00006a80: 223a 2022 666f 6f31 3030 222c 2022 7465  ": "foo100", "te
+00006a90: 7374 3230 3022 3a20 2262 6172 3230 3022  st200": "bar200"
+00006aa0: 7d0a 2020 2020 2020 2020 6177 6169 7420  }.        await 
+00006ab0: 6669 6c65 5f63 6c69 656e 742e 7365 745f  file_client.set_
+00006ac0: 6669 6c65 5f6d 6574 6164 6174 6128 6d65  file_metadata(me
+00006ad0: 7461 6461 7461 3229 0a0a 2020 2020 2020  tadata2)..      
+00006ae0: 2020 2320 4163 740a 2020 2020 2020 2020    # Act.        
+00006af0: 6669 6c65 5f70 726f 7073 203d 2061 7761  file_props = awa
+00006b00: 6974 2066 696c 655f 636c 6965 6e74 2e67  it file_client.g
+00006b10: 6574 5f66 696c 655f 7072 6f70 6572 7469  et_file_properti
+00006b20: 6573 2829 0a20 2020 2020 2020 2073 6e61  es().        sna
+00006b30: 7073 686f 745f 636c 6965 6e74 203d 2053  pshot_client = S
+00006b40: 6861 7265 4669 6c65 436c 6965 6e74 280a  hareFileClient(.
+00006b50: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00006b60: 2e61 6363 6f75 6e74 5f75 726c 2873 746f  .account_url(sto
+00006b70: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
+00006b80: 652c 2022 6669 6c65 2229 2c0a 2020 2020  e, "file"),.    
+00006b90: 2020 2020 2020 2020 7368 6172 655f 6e61          share_na
+00006ba0: 6d65 3d73 656c 662e 7368 6172 655f 6e61  me=self.share_na
+00006bb0: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
+00006bc0: 6669 6c65 5f70 6174 683d 6669 6c65 5f63  file_path=file_c
+00006bd0: 6c69 656e 742e 6669 6c65 5f6e 616d 652c  lient.file_name,
+00006be0: 0a20 2020 2020 2020 2020 2020 2073 6e61  .            sna
+00006bf0: 7073 686f 743d 736e 6170 7368 6f74 2c0a  pshot=snapshot,.
+00006c00: 2020 2020 2020 2020 2020 2020 6372 6564              cred
+00006c10: 656e 7469 616c 3d73 746f 7261 6765 5f61  ential=storage_a
+00006c20: 6363 6f75 6e74 5f6b 6579 290a 2020 2020  ccount_key).    
+00006c30: 2020 2020 736e 6170 7368 6f74 5f70 726f      snapshot_pro
+00006c40: 7073 203d 2061 7761 6974 2073 6e61 7073  ps = await snaps
+00006c50: 686f 745f 636c 6965 6e74 2e67 6574 5f66  hot_client.get_f
+00006c60: 696c 655f 7072 6f70 6572 7469 6573 2829  ile_properties()
+00006c70: 0a20 2020 2020 2020 2023 2041 7373 6572  .        # Asser
+00006c80: 740a 2020 2020 2020 2020 7365 6c66 2e61  t.        self.a
+00006c90: 7373 6572 7449 734e 6f74 4e6f 6e65 2866  ssertIsNotNone(f
+00006ca0: 696c 655f 7072 6f70 7329 0a20 2020 2020  ile_props).     
+00006cb0: 2020 2073 656c 662e 6173 7365 7274 4973     self.assertIs
+00006cc0: 4e6f 744e 6f6e 6528 736e 6170 7368 6f74  NotNone(snapshot
+00006cd0: 5f70 726f 7073 290a 2020 2020 2020 2020  _props).        
+00006ce0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00006cf0: 2873 6e61 7073 686f 745f 7072 6f70 732e  (snapshot_props.
+00006d00: 736e 6170 7368 6f74 2c20 736e 6170 7368  snapshot, snapsh
+00006d10: 6f74 5f63 6c69 656e 742e 736e 6170 7368  ot_client.snapsh
+00006d20: 6f74 290a 2020 2020 2020 2020 7365 6c66  ot).        self
+00006d30: 2e61 7373 6572 7444 6963 7445 7175 616c  .assertDictEqual
+00006d40: 286d 6574 6164 6174 612c 2073 6e61 7073  (metadata, snaps
+00006d50: 686f 745f 7072 6f70 732e 6d65 7461 6461  hot_props.metada
+00006d60: 7461 290a 0a20 2020 2040 4669 6c65 5368  ta)..    @FileSh
+00006d70: 6172 6550 7265 7061 7265 7228 290a 2020  arePreparer().  
+00006d80: 2020 4041 7379 6e63 5374 6f72 6167 6554    @AsyncStorageT
+00006d90: 6573 7443 6173 652e 6177 6169 745f 7072  estCase.await_pr
+00006da0: 6570 6172 6564 5f74 6573 740a 2020 2020  epared_test.    
+00006db0: 6173 796e 6320 6465 6620 7465 7374 5f67  async def test_g
+00006dc0: 6574 5f66 696c 655f 6d65 7461 6461 7461  et_file_metadata
+00006dd0: 5f77 6974 685f 736e 6170 7368 6f74 5f61  _with_snapshot_a
+00006de0: 7379 6e63 2873 656c 662c 2073 746f 7261  sync(self, stora
+00006df0: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
+00006e00: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
+00006e10: 5f6b 6579 293a 0a20 2020 2020 2020 2073  _key):.        s
+00006e20: 656c 662e 5f73 6574 7570 2873 746f 7261  elf._setup(stora
+00006e30: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
+00006e40: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
+00006e50: 5f6b 6579 290a 2020 2020 2020 2020 6669  _key).        fi
+00006e60: 6c65 5f63 6c69 656e 7420 3d20 6177 6169  le_client = awai
+00006e70: 7420 7365 6c66 2e5f 6372 6561 7465 5f66  t self._create_f
+00006e80: 696c 6528 7374 6f72 6167 655f 6163 636f  ile(storage_acco
+00006e90: 756e 745f 6e61 6d65 2c20 7374 6f72 6167  unt_name, storag
+00006ea0: 655f 6163 636f 756e 745f 6b65 7929 0a20  e_account_key). 
+00006eb0: 2020 2020 2020 206d 6574 6164 6174 6120         metadata 
+00006ec0: 3d20 7b22 7465 7374 3122 3a20 2266 6f6f  = {"test1": "foo
+00006ed0: 222c 2022 7465 7374 3222 3a20 2262 6172  ", "test2": "bar
+00006ee0: 227d 0a20 2020 2020 2020 2061 7761 6974  "}.        await
+00006ef0: 2066 696c 655f 636c 6965 6e74 2e73 6574   file_client.set
+00006f00: 5f66 696c 655f 6d65 7461 6461 7461 286d  _file_metadata(m
+00006f10: 6574 6164 6174 6129 0a0a 2020 2020 2020  etadata)..      
+00006f20: 2020 7368 6172 655f 636c 6965 6e74 203d    share_client =
+00006f30: 2073 656c 662e 6673 632e 6765 745f 7368   self.fsc.get_sh
+00006f40: 6172 655f 636c 6965 6e74 2873 656c 662e  are_client(self.
+00006f50: 7368 6172 655f 6e61 6d65 290a 2020 2020  share_name).    
+00006f60: 2020 2020 736e 6170 7368 6f74 203d 2061      snapshot = a
+00006f70: 7761 6974 2073 6861 7265 5f63 6c69 656e  wait share_clien
+00006f80: 742e 6372 6561 7465 5f73 6e61 7073 686f  t.create_snapsho
+00006f90: 7428 290a 2020 2020 2020 2020 736e 6170  t().        snap
+00006fa0: 7368 6f74 5f63 6c69 656e 7420 3d20 5368  shot_client = Sh
+00006fb0: 6172 6546 696c 6543 6c69 656e 7428 0a20  areFileClient(. 
+00006fc0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00006fd0: 6163 636f 756e 745f 7572 6c28 7374 6f72  account_url(stor
+00006fe0: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
+00006ff0: 2c20 2266 696c 6522 292c 0a20 2020 2020  , "file"),.     
+00007000: 2020 2020 2020 2073 6861 7265 5f6e 616d         share_nam
+00007010: 653d 7365 6c66 2e73 6861 7265 5f6e 616d  e=self.share_nam
+00007020: 652c 0a20 2020 2020 2020 2020 2020 2066  e,.            f
+00007030: 696c 655f 7061 7468 3d66 696c 655f 636c  ile_path=file_cl
+00007040: 6965 6e74 2e66 696c 655f 6e61 6d65 2c0a  ient.file_name,.
+00007050: 2020 2020 2020 2020 2020 2020 736e 6170              snap
+00007060: 7368 6f74 3d73 6e61 7073 686f 742c 0a20  shot=snapshot,. 
+00007070: 2020 2020 2020 2020 2020 2063 7265 6465             crede
+00007080: 6e74 6961 6c3d 7374 6f72 6167 655f 6163  ntial=storage_ac
+00007090: 636f 756e 745f 6b65 7929 0a0a 2020 2020  count_key)..    
+000070a0: 2020 2020 6d65 7461 6461 7461 3220 3d20      metadata2 = 
+000070b0: 7b22 7465 7374 3130 3022 3a20 2266 6f6f  {"test100": "foo
+000070c0: 3130 3022 2c20 2274 6573 7432 3030 223a  100", "test200":
+000070d0: 2022 6261 7232 3030 227d 0a20 2020 2020   "bar200"}.     
+000070e0: 2020 2061 7761 6974 2066 696c 655f 636c     await file_cl
+000070f0: 6965 6e74 2e73 6574 5f66 696c 655f 6d65  ient.set_file_me
+00007100: 7461 6461 7461 286d 6574 6164 6174 6132  tadata(metadata2
+00007110: 290a 0a20 2020 2020 2020 2023 2041 6374  )..        # Act
+00007120: 0a20 2020 2020 2020 2066 696c 655f 6d65  .        file_me
+00007130: 7461 6461 7461 203d 2061 7761 6974 2066  tadata = await f
+00007140: 696c 655f 636c 6965 6e74 2e67 6574 5f66  ile_client.get_f
+00007150: 696c 655f 7072 6f70 6572 7469 6573 2829  ile_properties()
+00007160: 0a20 2020 2020 2020 2066 696c 655f 736e  .        file_sn
+00007170: 6170 7368 6f74 5f6d 6574 6164 6174 6120  apshot_metadata 
+00007180: 3d20 6177 6169 7420 736e 6170 7368 6f74  = await snapshot
+00007190: 5f63 6c69 656e 742e 6765 745f 6669 6c65  _client.get_file
+000071a0: 5f70 726f 7065 7274 6965 7328 290a 0a20  _properties().. 
+000071b0: 2020 2020 2020 2023 2041 7373 6572 740a         # Assert.
+000071c0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+000071d0: 6572 7444 6963 7445 7175 616c 286d 6574  ertDictEqual(met
+000071e0: 6164 6174 6132 2c20 6669 6c65 5f6d 6574  adata2, file_met
+000071f0: 6164 6174 612e 6d65 7461 6461 7461 290a  adata.metadata).
+00007200: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00007210: 6572 7444 6963 7445 7175 616c 286d 6574  ertDictEqual(met
+00007220: 6164 6174 612c 2066 696c 655f 736e 6170  adata, file_snap
+00007230: 7368 6f74 5f6d 6574 6164 6174 612e 6d65  shot_metadata.me
+00007240: 7461 6461 7461 290a 0a20 2020 2040 4669  tadata)..    @Fi
+00007250: 6c65 5368 6172 6550 7265 7061 7265 7228  leSharePreparer(
+00007260: 290a 2020 2020 4041 7379 6e63 5374 6f72  ).    @AsyncStor
+00007270: 6167 6554 6573 7443 6173 652e 6177 6169  ageTestCase.awai
+00007280: 745f 7072 6570 6172 6564 5f74 6573 740a  t_prepared_test.
+00007290: 2020 2020 6173 796e 6320 6465 6620 7465      async def te
+000072a0: 7374 5f67 6574 5f66 696c 655f 7072 6f70  st_get_file_prop
+000072b0: 6572 7469 6573 5f77 6974 685f 6e6f 6e5f  erties_with_non_
+000072c0: 6578 6973 7469 6e67 5f66 696c 655f 6173  existing_file_as
+000072d0: 796e 6328 7365 6c66 2c20 7374 6f72 6167  ync(self, storag
+000072e0: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
+000072f0: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
+00007300: 6b65 7929 3a0a 2020 2020 2020 2020 7365  key):.        se
+00007310: 6c66 2e5f 7365 7475 7028 7374 6f72 6167  lf._setup(storag
+00007320: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
+00007330: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
+00007340: 6b65 7929 0a20 2020 2020 2020 2066 696c  key).        fil
+00007350: 655f 6e61 6d65 203d 2073 656c 662e 5f67  e_name = self._g
+00007360: 6574 5f66 696c 655f 7265 6665 7265 6e63  et_file_referenc
+00007370: 6528 290a 2020 2020 2020 2020 6669 6c65  e().        file
+00007380: 5f63 6c69 656e 7420 3d20 5368 6172 6546  _client = ShareF
+00007390: 696c 6543 6c69 656e 7428 0a20 2020 2020  ileClient(.     
+000073a0: 2020 2020 2020 2073 656c 662e 6163 636f         self.acco
+000073b0: 756e 745f 7572 6c28 7374 6f72 6167 655f  unt_url(storage_
+000073c0: 6163 636f 756e 745f 6e61 6d65 2c20 2266  account_name, "f
+000073d0: 696c 6522 292c 0a20 2020 2020 2020 2020  ile"),.         
+000073e0: 2020 2073 6861 7265 5f6e 616d 653d 7365     share_name=se
+000073f0: 6c66 2e73 6861 7265 5f6e 616d 652c 0a20  lf.share_name,. 
+00007400: 2020 2020 2020 2020 2020 2066 696c 655f             file_
+00007410: 7061 7468 3d66 696c 655f 6e61 6d65 2c0a  path=file_name,.
+00007420: 2020 2020 2020 2020 2020 2020 6372 6564              cred
+00007430: 656e 7469 616c 3d73 746f 7261 6765 5f61  ential=storage_a
+00007440: 6363 6f75 6e74 5f6b 6579 290a 0a20 2020  ccount_key)..   
+00007450: 2020 2020 2023 2041 6374 0a20 2020 2020       # Act.     
+00007460: 2020 2077 6974 6820 7365 6c66 2e61 7373     with self.ass
+00007470: 6572 7452 6169 7365 7328 5265 736f 7572  ertRaises(Resour
+00007480: 6365 4e6f 7446 6f75 6e64 4572 726f 7229  ceNotFoundError)
+00007490: 3a0a 2020 2020 2020 2020 2020 2020 6177  :.            aw
+000074a0: 6169 7420 6669 6c65 5f63 6c69 656e 742e  ait file_client.
+000074b0: 6765 745f 6669 6c65 5f70 726f 7065 7274  get_file_propert
+000074c0: 6965 7328 290a 0a20 2020 2020 2020 2020  ies()..         
+000074d0: 2020 2023 2041 7373 6572 740a 0a20 2020     # Assert..   
+000074e0: 2040 4669 6c65 5368 6172 6550 7265 7061   @FileSharePrepa
+000074f0: 7265 7228 290a 2020 2020 4041 7379 6e63  rer().    @Async
+00007500: 5374 6f72 6167 6554 6573 7443 6173 652e  StorageTestCase.
+00007510: 6177 6169 745f 7072 6570 6172 6564 5f74  await_prepared_t
+00007520: 6573 740a 2020 2020 6173 796e 6320 6465  est.    async de
+00007530: 6620 7465 7374 5f67 6574 5f66 696c 655f  f test_get_file_
+00007540: 6d65 7461 6461 7461 5f61 7379 6e63 2873  metadata_async(s
+00007550: 656c 662c 2073 746f 7261 6765 5f61 6363  elf, storage_acc
+00007560: 6f75 6e74 5f6e 616d 652c 2073 746f 7261  ount_name, stora
+00007570: 6765 5f61 6363 6f75 6e74 5f6b 6579 293a  ge_account_key):
+00007580: 0a20 2020 2020 2020 2073 656c 662e 5f73  .        self._s
+00007590: 6574 7570 2873 746f 7261 6765 5f61 6363  etup(storage_acc
+000075a0: 6f75 6e74 5f6e 616d 652c 2073 746f 7261  ount_name, stora
+000075b0: 6765 5f61 6363 6f75 6e74 5f6b 6579 290a  ge_account_key).
+000075c0: 2020 2020 2020 2020 6669 6c65 5f63 6c69          file_cli
+000075d0: 656e 7420 3d20 6177 6169 7420 7365 6c66  ent = await self
+000075e0: 2e5f 6372 6561 7465 5f66 696c 6528 7374  ._create_file(st
+000075f0: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
+00007600: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
+00007610: 756e 745f 6b65 7929 0a0a 2020 2020 2020  unt_key)..      
+00007620: 2020 2320 4163 740a 2020 2020 2020 2020    # Act.        
+00007630: 6d64 203d 2061 7761 6974 2066 696c 655f  md = await file_
+00007640: 636c 6965 6e74 2e67 6574 5f66 696c 655f  client.get_file_
+00007650: 7072 6f70 6572 7469 6573 2829 0a0a 2020  properties()..  
+00007660: 2020 2020 2020 2320 4173 7365 7274 0a20        # Assert. 
+00007670: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00007680: 7274 4973 4e6f 744e 6f6e 6528 6d64 2e6d  rtIsNotNone(md.m
+00007690: 6574 6164 6174 6129 0a20 2020 2020 2020  etadata).       
+000076a0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+000076b0: 6c28 302c 206c 656e 286d 642e 6d65 7461  l(0, len(md.meta
+000076c0: 6461 7461 2929 0a0a 2020 2020 4070 7974  data))..    @pyt
+000076d0: 6573 742e 6d61 726b 2e6c 6976 655f 7465  est.mark.live_te
+000076e0: 7374 5f6f 6e6c 790a 2020 2020 4046 696c  st_only.    @Fil
+000076f0: 6553 6861 7265 5072 6570 6172 6572 2829  eSharePreparer()
+00007700: 0a20 2020 2040 4173 796e 6353 746f 7261  .    @AsyncStora
+00007710: 6765 5465 7374 4361 7365 2e61 7761 6974  geTestCase.await
+00007720: 5f70 7265 7061 7265 645f 7465 7374 0a20  _prepared_test. 
+00007730: 2020 2061 7379 6e63 2064 6566 2074 6573     async def tes
+00007740: 745f 7365 745f 6669 6c65 5f6d 6574 6164  t_set_file_metad
+00007750: 6174 615f 7769 7468 5f75 7070 6572 5f63  ata_with_upper_c
+00007760: 6173 655f 6173 796e 6328 7365 6c66 2c20  ase_async(self, 
+00007770: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
+00007780: 6e61 6d65 2c20 7374 6f72 6167 655f 6163  name, storage_ac
+00007790: 636f 756e 745f 6b65 7929 3a0a 2020 2020  count_key):.    
+000077a0: 2020 2020 2320 4d61 6b65 2074 6869 7320      # Make this 
+000077b0: 7465 7374 206c 6976 6520 7465 7374 206f  test live test o
+000077c0: 6e6c 792c 2066 6f72 2074 6865 2072 6561  nly, for the rea
+000077d0: 736f 6e20 7468 6174 206d 6574 6164 6174  son that metadat
+000077e0: 6120 6361 6e20 6f6e 6c79 2062 6520 7265  a can only be re
+000077f0: 636f 7264 6564 2069 6e20 6c6f 7765 7220  corded in lower 
+00007800: 6361 7365 2e0a 2020 2020 2020 2020 7365  case..        se
+00007810: 6c66 2e5f 7365 7475 7028 7374 6f72 6167  lf._setup(storag
+00007820: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
+00007830: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
+00007840: 6b65 7929 0a20 2020 2020 2020 206d 6574  key).        met
+00007850: 6164 6174 6120 3d20 7b27 6865 6c6c 6f27  adata = {'hello'
+00007860: 3a20 2777 6f72 6c64 272c 2027 6e75 6d62  : 'world', 'numb
+00007870: 6572 273a 2027 3432 272c 2027 5550 273a  er': '42', 'UP':
+00007880: 2027 5550 7661 6c27 7d0a 2020 2020 2020   'UPval'}.      
+00007890: 2020 6669 6c65 5f63 6c69 656e 7420 3d20    file_client = 
+000078a0: 6177 6169 7420 7365 6c66 2e5f 6372 6561  await self._crea
+000078b0: 7465 5f66 696c 6528 7374 6f72 6167 655f  te_file(storage_
+000078c0: 6163 636f 756e 745f 6e61 6d65 2c20 7374  account_name, st
+000078d0: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
+000078e0: 7929 0a0a 2020 2020 2020 2020 2320 4163  y)..        # Ac
+000078f0: 740a 2020 2020 2020 2020 6177 6169 7420  t.        await 
+00007900: 6669 6c65 5f63 6c69 656e 742e 7365 745f  file_client.set_
+00007910: 6669 6c65 5f6d 6574 6164 6174 6128 6d65  file_metadata(me
+00007920: 7461 6461 7461 290a 0a20 2020 2020 2020  tadata)..       
+00007930: 2023 2041 7373 6572 740a 2020 2020 2020   # Assert.      
+00007940: 2020 7072 6f70 7320 3d20 6177 6169 7420    props = await 
+00007950: 6669 6c65 5f63 6c69 656e 742e 6765 745f  file_client.get_
+00007960: 6669 6c65 5f70 726f 7065 7274 6965 7328  file_properties(
+00007970: 290a 2020 2020 2020 2020 6d64 203d 2070  ).        md = p
+00007980: 726f 7073 2e6d 6574 6164 6174 610a 2020  rops.metadata.  
+00007990: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+000079a0: 7445 7175 616c 2833 2c20 6c65 6e28 6d64  tEqual(3, len(md
+000079b0: 2929 0a20 2020 2020 2020 2073 656c 662e  )).        self.
+000079c0: 6173 7365 7274 4571 7561 6c28 6d64 5b27  assertEqual(md['
+000079d0: 6865 6c6c 6f27 5d2c 2027 776f 726c 6427  hello'], 'world'
+000079e0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+000079f0: 7373 6572 7445 7175 616c 286d 645b 276e  ssertEqual(md['n
+00007a00: 756d 6265 7227 5d2c 2027 3432 2729 0a20  umber'], '42'). 
+00007a10: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00007a20: 7274 4571 7561 6c28 6d64 5b27 5550 275d  rtEqual(md['UP']
+00007a30: 2c20 2755 5076 616c 2729 0a20 2020 2020  , 'UPval').     
+00007a40: 2020 2073 656c 662e 6173 7365 7274 4661     self.assertFa
+00007a50: 6c73 6528 2775 7027 2069 6e20 6d64 290a  lse('up' in md).
+00007a60: 0a20 2020 2040 7079 7465 7374 2e6d 6172  .    @pytest.mar
+00007a70: 6b2e 6c69 7665 5f74 6573 745f 6f6e 6c79  k.live_test_only
+00007a80: 0a20 2020 2040 4669 6c65 5368 6172 6550  .    @FileShareP
+00007a90: 7265 7061 7265 7228 290a 2020 2020 4041  reparer().    @A
+00007aa0: 7379 6e63 5374 6f72 6167 6554 6573 7443  syncStorageTestC
+00007ab0: 6173 652e 6177 6169 745f 7072 6570 6172  ase.await_prepar
+00007ac0: 6564 5f74 6573 740a 2020 2020 6173 796e  ed_test.    asyn
+00007ad0: 6320 6465 6620 7465 7374 5f62 7265 616b  c def test_break
+00007ae0: 5f6c 6561 7365 5f77 6974 685f 6272 6f6b  _lease_with_brok
+00007af0: 656e 5f70 6572 696f 645f 6661 696c 7328  en_period_fails(
+00007b00: 7365 6c66 2c20 7374 6f72 6167 655f 6163  self, storage_ac
+00007b10: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
+00007b20: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
+00007b30: 3a0a 2020 2020 2020 2020 7365 6c66 2e5f  :.        self._
+00007b40: 7365 7475 7028 7374 6f72 6167 655f 6163  setup(storage_ac
+00007b50: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
+00007b60: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
+00007b70: 0a20 2020 2020 2020 2066 696c 655f 636c  .        file_cl
+00007b80: 6965 6e74 203d 2061 7761 6974 2073 656c  ient = await sel
+00007b90: 662e 5f63 7265 6174 655f 6669 6c65 2873  f._create_file(s
+00007ba0: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
+00007bb0: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
+00007bc0: 6f75 6e74 5f6b 6579 290a 2020 2020 2020  ount_key).      
+00007bd0: 2020 6c65 6173 6520 3d20 6177 6169 7420    lease = await 
+00007be0: 6669 6c65 5f63 6c69 656e 742e 6163 7175  file_client.acqu
+00007bf0: 6972 655f 6c65 6173 6528 290a 0a20 2020  ire_lease()..   
+00007c00: 2020 2020 2023 2041 7373 6572 740a 2020       # Assert.  
+00007c10: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00007c20: 7449 734e 6f74 4e6f 6e65 286c 6561 7365  tIsNotNone(lease
+00007c30: 290a 2020 2020 2020 2020 7769 7468 2073  ).        with s
+00007c40: 656c 662e 6173 7365 7274 5261 6973 6573  elf.assertRaises
+00007c50: 2854 7970 6545 7272 6f72 293a 0a20 2020  (TypeError):.   
+00007c60: 2020 2020 2020 2020 2061 7761 6974 206c           await l
+00007c70: 6561 7365 2e62 7265 616b 5f6c 6561 7365  ease.break_lease
+00007c80: 286c 6561 7365 5f62 7265 616b 5f70 6572  (lease_break_per
+00007c90: 696f 643d 3529 0a0a 2020 2020 4070 7974  iod=5)..    @pyt
+00007ca0: 6573 742e 6d61 726b 2e6c 6976 655f 7465  est.mark.live_te
+00007cb0: 7374 5f6f 6e6c 790a 2020 2020 4046 696c  st_only.    @Fil
+00007cc0: 6553 6861 7265 5072 6570 6172 6572 2829  eSharePreparer()
+00007cd0: 0a20 2020 2040 4173 796e 6353 746f 7261  .    @AsyncStora
+00007ce0: 6765 5465 7374 4361 7365 2e61 7761 6974  geTestCase.await
+00007cf0: 5f70 7265 7061 7265 645f 7465 7374 0a20  _prepared_test. 
+00007d00: 2020 2061 7379 6e63 2064 6566 2074 6573     async def tes
+00007d10: 745f 7365 745f 6669 6c65 5f6d 6574 6164  t_set_file_metad
+00007d20: 6174 615f 7769 7468 5f62 726f 6b65 6e5f  ata_with_broken_
+00007d30: 6c65 6173 655f 6173 796e 6328 7365 6c66  lease_async(self
+00007d40: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
+00007d50: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
+00007d60: 6163 636f 756e 745f 6b65 7929 3a0a 2020  account_key):.  
+00007d70: 2020 2020 2020 2320 4d61 6b65 2074 6869        # Make thi
+00007d80: 7320 7465 7374 206c 6976 6520 7465 7374  s test live test
+00007d90: 206f 6e6c 792c 2066 6f72 2074 6865 2072   only, for the r
+00007da0: 6561 736f 6e20 7468 6174 206d 6574 6164  eason that metad
+00007db0: 6174 6120 6361 6e20 6f6e 6c79 2062 6520  ata can only be 
+00007dc0: 7265 636f 7264 6564 2069 6e20 6c6f 7765  recorded in lowe
+00007dd0: 7220 6361 7365 2e0a 2020 2020 2020 2020  r case..        
+00007de0: 7365 6c66 2e5f 7365 7475 7028 7374 6f72  self._setup(stor
+00007df0: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
+00007e00: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
+00007e10: 745f 6b65 7929 0a20 2020 2020 2020 206d  t_key).        m
+00007e20: 6574 6164 6174 6120 3d20 7b27 6865 6c6c  etadata = {'hell
+00007e30: 6f27 3a20 2777 6f72 6c64 272c 2027 6e75  o': 'world', 'nu
+00007e40: 6d62 6572 273a 2027 3432 272c 2027 5550  mber': '42', 'UP
+00007e50: 273a 2027 5550 7661 6c27 7d0a 2020 2020  ': 'UPval'}.    
+00007e60: 2020 2020 6669 6c65 5f63 6c69 656e 7420      file_client 
+00007e70: 3d20 6177 6169 7420 7365 6c66 2e5f 6372  = await self._cr
+00007e80: 6561 7465 5f66 696c 6528 7374 6f72 6167  eate_file(storag
+00007e90: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
+00007ea0: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
+00007eb0: 6b65 7929 0a0a 2020 2020 2020 2020 6c65  key)..        le
+00007ec0: 6173 6520 3d20 6177 6169 7420 6669 6c65  ase = await file
+00007ed0: 5f63 6c69 656e 742e 6163 7175 6972 655f  _client.acquire_
+00007ee0: 6c65 6173 6528 290a 2020 2020 2020 2020  lease().        
+00007ef0: 7769 7468 2073 656c 662e 6173 7365 7274  with self.assert
+00007f00: 5261 6973 6573 2848 7474 7052 6573 706f  Raises(HttpRespo
+00007f10: 6e73 6545 7272 6f72 293a 0a20 2020 2020  nseError):.     
+00007f20: 2020 2020 2020 2061 7761 6974 2066 696c         await fil
+00007f30: 655f 636c 6965 6e74 2e73 6574 5f66 696c  e_client.set_fil
+00007f40: 655f 6d65 7461 6461 7461 286d 6574 6164  e_metadata(metad
+00007f50: 6174 6129 0a0a 2020 2020 2020 2020 6c65  ata)..        le
+00007f60: 6173 655f 6964 5f74 6f5f 6265 5f62 726f  ase_id_to_be_bro
+00007f70: 6b65 6e20 3d20 6c65 6173 652e 6964 0a20  ken = lease.id. 
+00007f80: 2020 2020 2020 2061 7761 6974 206c 6561         await lea
+00007f90: 7365 2e62 7265 616b 5f6c 6561 7365 2829  se.break_lease()
+00007fa0: 0a0a 2020 2020 2020 2020 2320 4163 740a  ..        # Act.
+00007fb0: 2020 2020 2020 2020 2320 6c65 6173 6520          # lease 
+00007fc0: 6973 2062 726f 6b65 6e2c 2073 6574 206d  is broken, set m
+00007fd0: 6574 6164 6174 6120 646f 6573 6e27 7420  etadata doesn't 
+00007fe0: 7265 7175 6972 6520 6120 6c65 6173 650a  require a lease.
+00007ff0: 2020 2020 2020 2020 6177 6169 7420 6669          await fi
+00008000: 6c65 5f63 6c69 656e 742e 7365 745f 6669  le_client.set_fi
+00008010: 6c65 5f6d 6574 6164 6174 6128 7b27 6865  le_metadata({'he
+00008020: 6c6c 6f27 3a20 2777 6f72 6c64 277d 290a  llo': 'world'}).
+00008030: 2020 2020 2020 2020 7072 6f70 7320 3d20          props = 
+00008040: 6177 6169 7420 6669 6c65 5f63 6c69 656e  await file_clien
+00008050: 742e 6765 745f 6669 6c65 5f70 726f 7065  t.get_file_prope
+00008060: 7274 6965 7328 290a 2020 2020 2020 2020  rties().        
+00008070: 2320 4173 7365 7274 0a20 2020 2020 2020  # Assert.       
+00008080: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00008090: 6c28 312c 206c 656e 2870 726f 7073 2e6d  l(1, len(props.m
+000080a0: 6574 6164 6174 6129 290a 2020 2020 2020  etadata)).      
+000080b0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+000080c0: 616c 2870 726f 7073 2e6d 6574 6164 6174  al(props.metadat
+000080d0: 615b 2768 656c 6c6f 275d 2c20 2777 6f72  a['hello'], 'wor
+000080e0: 6c64 2729 0a0a 2020 2020 2020 2020 2320  ld')..        # 
+000080f0: 4163 740a 2020 2020 2020 2020 6177 6169  Act.        awai
+00008100: 7420 6669 6c65 5f63 6c69 656e 742e 6163  t file_client.ac
+00008110: 7175 6972 655f 6c65 6173 6528 6c65 6173  quire_lease(leas
+00008120: 655f 6964 3d6c 6561 7365 5f69 645f 746f  e_id=lease_id_to
+00008130: 5f62 655f 6272 6f6b 656e 290a 2020 2020  _be_broken).    
+00008140: 2020 2020 6177 6169 7420 6669 6c65 5f63      await file_c
+00008150: 6c69 656e 742e 7365 745f 6669 6c65 5f6d  lient.set_file_m
+00008160: 6574 6164 6174 6128 6d65 7461 6461 7461  etadata(metadata
+00008170: 2c20 6c65 6173 653d 6c65 6173 655f 6964  , lease=lease_id
+00008180: 5f74 6f5f 6265 5f62 726f 6b65 6e29 0a20  _to_be_broken). 
+00008190: 2020 2020 2020 2023 2041 7373 6572 740a         # Assert.
+000081a0: 2020 2020 2020 2020 7072 6f70 7320 3d20          props = 
+000081b0: 6177 6169 7420 6669 6c65 5f63 6c69 656e  await file_clien
+000081c0: 742e 6765 745f 6669 6c65 5f70 726f 7065  t.get_file_prope
+000081d0: 7274 6965 7328 290a 2020 2020 2020 2020  rties().        
+000081e0: 6d64 203d 2070 726f 7073 2e6d 6574 6164  md = props.metad
+000081f0: 6174 610a 2020 2020 2020 2020 7365 6c66  ata.        self
+00008200: 2e61 7373 6572 7445 7175 616c 2833 2c20  .assertEqual(3, 
+00008210: 6c65 6e28 6d64 2929 0a20 2020 2020 2020  len(md)).       
+00008220: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00008230: 6c28 6d64 5b27 6865 6c6c 6f27 5d2c 2027  l(md['hello'], '
+00008240: 776f 726c 6427 290a 2020 2020 2020 2020  world').        
+00008250: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00008260: 286d 645b 276e 756d 6265 7227 5d2c 2027  (md['number'], '
+00008270: 3432 2729 0a20 2020 2020 2020 2073 656c  42').        sel
+00008280: 662e 6173 7365 7274 4571 7561 6c28 6d64  f.assertEqual(md
+00008290: 5b27 5550 275d 2c20 2755 5076 616c 2729  ['UP'], 'UPval')
+000082a0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+000082b0: 7365 7274 4661 6c73 6528 2775 7027 2069  sertFalse('up' i
+000082c0: 6e20 6d64 290a 0a20 2020 2040 4669 6c65  n md)..    @File
+000082d0: 5368 6172 6550 7265 7061 7265 7228 290a  SharePreparer().
+000082e0: 2020 2020 4041 7379 6e63 5374 6f72 6167      @AsyncStorag
+000082f0: 6554 6573 7443 6173 652e 6177 6169 745f  eTestCase.await_
+00008300: 7072 6570 6172 6564 5f74 6573 740a 2020  prepared_test.  
+00008310: 2020 6173 796e 6320 6465 6620 7465 7374    async def test
+00008320: 5f64 656c 6574 655f 6669 6c65 5f77 6974  _delete_file_wit
+00008330: 685f 6578 6973 7469 6e67 5f66 696c 655f  h_existing_file_
+00008340: 6173 796e 6328 7365 6c66 2c20 7374 6f72  async(self, stor
+00008350: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
+00008360: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
+00008370: 745f 6b65 7929 3a0a 2020 2020 2020 2020  t_key):.        
+00008380: 7365 6c66 2e5f 7365 7475 7028 7374 6f72  self._setup(stor
+00008390: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
+000083a0: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
+000083b0: 745f 6b65 7929 0a20 2020 2020 2020 2066  t_key).        f
+000083c0: 696c 655f 636c 6965 6e74 203d 2061 7761  ile_client = awa
+000083d0: 6974 2073 656c 662e 5f63 7265 6174 655f  it self._create_
+000083e0: 6669 6c65 2873 746f 7261 6765 5f61 6363  file(storage_acc
+000083f0: 6f75 6e74 5f6e 616d 652c 2073 746f 7261  ount_name, stora
+00008400: 6765 5f61 6363 6f75 6e74 5f6b 6579 290a  ge_account_key).
+00008410: 0a20 2020 2020 2020 2023 2041 6374 0a20  .        # Act. 
+00008420: 2020 2020 2020 2061 7761 6974 2066 696c         await fil
+00008430: 655f 636c 6965 6e74 2e64 656c 6574 655f  e_client.delete_
+00008440: 6669 6c65 2829 0a0a 2020 2020 2020 2020  file()..        
+00008450: 2320 4173 7365 7274 0a20 2020 2020 2020  # Assert.       
+00008460: 2077 6974 6820 7365 6c66 2e61 7373 6572   with self.asser
+00008470: 7452 6169 7365 7328 5265 736f 7572 6365  tRaises(Resource
+00008480: 4e6f 7446 6f75 6e64 4572 726f 7229 3a0a  NotFoundError):.
+00008490: 2020 2020 2020 2020 2020 2020 6177 6169              awai
+000084a0: 7420 6669 6c65 5f63 6c69 656e 742e 6765  t file_client.ge
+000084b0: 745f 6669 6c65 5f70 726f 7065 7274 6965  t_file_propertie
+000084c0: 7328 290a 0a20 2020 2040 4669 6c65 5368  s()..    @FileSh
+000084d0: 6172 6550 7265 7061 7265 7228 290a 2020  arePreparer().  
+000084e0: 2020 4041 7379 6e63 5374 6f72 6167 6554    @AsyncStorageT
+000084f0: 6573 7443 6173 652e 6177 6169 745f 7072  estCase.await_pr
+00008500: 6570 6172 6564 5f74 6573 740a 2020 2020  epared_test.    
+00008510: 6173 796e 6320 6465 6620 7465 7374 5f64  async def test_d
+00008520: 656c 6574 655f 6669 6c65 5f77 6974 685f  elete_file_with_
+00008530: 6e6f 6e5f 6578 6973 7469 6e67 5f66 696c  non_existing_fil
+00008540: 655f 6173 796e 6328 7365 6c66 2c20 7374  e_async(self, st
+00008550: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
+00008560: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
+00008570: 756e 745f 6b65 7929 3a0a 2020 2020 2020  unt_key):.      
+00008580: 2020 7365 6c66 2e5f 7365 7475 7028 7374    self._setup(st
+00008590: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
+000085a0: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
+000085b0: 756e 745f 6b65 7929 0a20 2020 2020 2020  unt_key).       
+000085c0: 2066 696c 655f 6e61 6d65 203d 2073 656c   file_name = sel
+000085d0: 662e 5f67 6574 5f66 696c 655f 7265 6665  f._get_file_refe
+000085e0: 7265 6e63 6528 290a 2020 2020 2020 2020  rence().        
+000085f0: 6669 6c65 5f63 6c69 656e 7420 3d20 5368  file_client = Sh
+00008600: 6172 6546 696c 6543 6c69 656e 7428 0a20  areFileClient(. 
+00008610: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00008620: 6163 636f 756e 745f 7572 6c28 7374 6f72  account_url(stor
+00008630: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
+00008640: 2c20 2266 696c 6522 292c 0a20 2020 2020  , "file"),.     
+00008650: 2020 2020 2020 2073 6861 7265 5f6e 616d         share_nam
+00008660: 653d 7365 6c66 2e73 6861 7265 5f6e 616d  e=self.share_nam
+00008670: 652c 0a20 2020 2020 2020 2020 2020 2066  e,.            f
+00008680: 696c 655f 7061 7468 3d66 696c 655f 6e61  ile_path=file_na
+00008690: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
+000086a0: 6372 6564 656e 7469 616c 3d73 746f 7261  credential=stora
+000086b0: 6765 5f61 6363 6f75 6e74 5f6b 6579 2c0a  ge_account_key,.
+000086c0: 2020 2020 2020 2020 2020 2020 7472 616e              tran
+000086d0: 7370 6f72 743d 4169 6f68 7474 7054 6573  sport=AiohttpTes
+000086e0: 7454 7261 6e73 706f 7274 2829 290a 0a20  tTransport()).. 
+000086f0: 2020 2020 2020 2023 2041 6374 0a20 2020         # Act.   
+00008700: 2020 2020 2077 6974 6820 7365 6c66 2e61       with self.a
+00008710: 7373 6572 7452 6169 7365 7328 5265 736f  ssertRaises(Reso
+00008720: 7572 6365 4e6f 7446 6f75 6e64 4572 726f  urceNotFoundErro
+00008730: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+00008740: 6177 6169 7420 6669 6c65 5f63 6c69 656e  await file_clien
+00008750: 742e 6465 6c65 7465 5f66 696c 6528 290a  t.delete_file().
+00008760: 0a20 2020 2020 2020 2020 2020 2023 2041  .            # A
+00008770: 7373 6572 740a 0a20 2020 2040 4669 6c65  ssert..    @File
+00008780: 5368 6172 6550 7265 7061 7265 7228 290a  SharePreparer().
+00008790: 2020 2020 4041 7379 6e63 5374 6f72 6167      @AsyncStorag
+000087a0: 6554 6573 7443 6173 652e 6177 6169 745f  eTestCase.await_
+000087b0: 7072 6570 6172 6564 5f74 6573 740a 2020  prepared_test.  
+000087c0: 2020 6173 796e 6320 6465 6620 7465 7374    async def test
+000087d0: 5f75 7064 6174 655f 7261 6e67 655f 6173  _update_range_as
+000087e0: 796e 6328 7365 6c66 2c20 7374 6f72 6167  ync(self, storag
+000087f0: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
+00008800: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
+00008810: 6b65 7929 3a0a 2020 2020 2020 2020 7365  key):.        se
+00008820: 6c66 2e5f 7365 7475 7028 7374 6f72 6167  lf._setup(storag
+00008830: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
+00008840: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
+00008850: 6b65 7929 0a20 2020 2020 2020 2066 696c  key).        fil
+00008860: 655f 636c 6965 6e74 203d 2061 7761 6974  e_client = await
+00008870: 2073 656c 662e 5f63 7265 6174 655f 6669   self._create_fi
+00008880: 6c65 2873 746f 7261 6765 5f61 6363 6f75  le(storage_accou
+00008890: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
+000088a0: 5f61 6363 6f75 6e74 5f6b 6579 290a 0a20  _account_key).. 
+000088b0: 2020 2020 2020 2023 2041 6374 0a20 2020         # Act.   
+000088c0: 2020 2020 2064 6174 6120 3d20 6227 6162       data = b'ab
+000088d0: 6364 6566 6768 696a 6b6c 6d6e 6f70 2720  cdefghijklmnop' 
+000088e0: 2a20 3332 0a20 2020 2020 2020 2061 7761  * 32.        awa
+000088f0: 6974 2066 696c 655f 636c 6965 6e74 2e75  it file_client.u
+00008900: 706c 6f61 645f 7261 6e67 6528 6461 7461  pload_range(data
+00008910: 2c20 6f66 6673 6574 3d30 2c20 6c65 6e67  , offset=0, leng
+00008920: 7468 3d35 3132 290a 0a20 2020 2020 2020  th=512)..       
+00008930: 2023 2041 7373 6572 740a 2020 2020 2020   # Assert.      
+00008940: 2020 636f 6e74 656e 7420 3d20 6177 6169    content = awai
+00008950: 7420 6669 6c65 5f63 6c69 656e 742e 646f  t file_client.do
+00008960: 776e 6c6f 6164 5f66 696c 6528 290a 2020  wnload_file().  
+00008970: 2020 2020 2020 636f 6e74 656e 7420 3d20        content = 
+00008980: 6177 6169 7420 636f 6e74 656e 742e 7265  await content.re
+00008990: 6164 616c 6c28 290a 2020 2020 2020 2020  adall().        
+000089a0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+000089b0: 2864 6174 612c 2063 6f6e 7465 6e74 5b3a  (data, content[:
+000089c0: 3531 325d 290a 2020 2020 2020 2020 7365  512]).        se
+000089d0: 6c66 2e61 7373 6572 7445 7175 616c 2873  lf.assertEqual(s
+000089e0: 656c 662e 7368 6f72 745f 6279 7465 5f64  elf.short_byte_d
+000089f0: 6174 615b 3531 323a 5d2c 2063 6f6e 7465  ata[512:], conte
+00008a00: 6e74 5b35 3132 3a5d 290a 0a20 2020 2040  nt[512:])..    @
+00008a10: 4669 6c65 5368 6172 6550 7265 7061 7265  FileSharePrepare
+00008a20: 7228 290a 2020 2020 4041 7379 6e63 5374  r().    @AsyncSt
+00008a30: 6f72 6167 6554 6573 7443 6173 652e 6177  orageTestCase.aw
+00008a40: 6169 745f 7072 6570 6172 6564 5f74 6573  ait_prepared_tes
+00008a50: 740a 2020 2020 6173 796e 6320 6465 6620  t.    async def 
+00008a60: 7465 7374 5f75 7064 6174 655f 7261 6e67  test_update_rang
+00008a70: 655f 7769 7468 5f6c 6561 7365 5f61 7379  e_with_lease_asy
+00008a80: 6e63 2873 656c 662c 2073 746f 7261 6765  nc(self, storage
+00008a90: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
+00008aa0: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
+00008ab0: 6579 293a 0a20 2020 2020 2020 2073 656c  ey):.        sel
+00008ac0: 662e 5f73 6574 7570 2873 746f 7261 6765  f._setup(storage
+00008ad0: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
+00008ae0: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
+00008af0: 6579 290a 2020 2020 2020 2020 6669 6c65  ey).        file
+00008b00: 5f63 6c69 656e 7420 3d20 6177 6169 7420  _client = await 
+00008b10: 7365 6c66 2e5f 6372 6561 7465 5f66 696c  self._create_fil
+00008b20: 6528 7374 6f72 6167 655f 6163 636f 756e  e(storage_accoun
+00008b30: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
+00008b40: 6163 636f 756e 745f 6b65 7929 0a20 2020  account_key).   
+00008b50: 2020 2020 206c 6561 7365 203d 2061 7761       lease = awa
+00008b60: 6974 2066 696c 655f 636c 6965 6e74 2e61  it file_client.a
+00008b70: 6371 7569 7265 5f6c 6561 7365 2829 0a0a  cquire_lease()..
+00008b80: 2020 2020 2020 2020 2320 4163 740a 2020          # Act.  
+00008b90: 2020 2020 2020 6461 7461 203d 2062 2761        data = b'a
+00008ba0: 6263 6465 6667 6869 6a6b 6c6d 6e6f 7027  bcdefghijklmnop'
+00008bb0: 202a 2033 320a 2020 2020 2020 2020 7769   * 32.        wi
+00008bc0: 7468 2073 656c 662e 6173 7365 7274 5261  th self.assertRa
+00008bd0: 6973 6573 2848 7474 7052 6573 706f 6e73  ises(HttpRespons
+00008be0: 6545 7272 6f72 293a 0a20 2020 2020 2020  eError):.       
+00008bf0: 2020 2020 2061 7761 6974 2066 696c 655f       await file_
+00008c00: 636c 6965 6e74 2e75 706c 6f61 645f 7261  client.upload_ra
+00008c10: 6e67 6528 6461 7461 2c20 6f66 6673 6574  nge(data, offset
+00008c20: 3d30 2c20 6c65 6e67 7468 3d35 3132 290a  =0, length=512).
+00008c30: 2020 2020 2020 2020 6177 6169 7420 6669          await fi
+00008c40: 6c65 5f63 6c69 656e 742e 7570 6c6f 6164  le_client.upload
+00008c50: 5f72 616e 6765 2864 6174 612c 206f 6666  _range(data, off
+00008c60: 7365 743d 302c 206c 656e 6774 683d 3531  set=0, length=51
+00008c70: 322c 206c 6561 7365 3d6c 6561 7365 290a  2, lease=lease).
+00008c80: 0a20 2020 2020 2020 2023 2041 7373 6572  .        # Asser
+00008c90: 740a 2020 2020 2020 2020 636f 6e74 656e  t.        conten
+00008ca0: 7420 3d20 6177 6169 7420 6669 6c65 5f63  t = await file_c
+00008cb0: 6c69 656e 742e 646f 776e 6c6f 6164 5f66  lient.download_f
+00008cc0: 696c 6528 290a 2020 2020 2020 2020 636f  ile().        co
+00008cd0: 6e74 656e 7420 3d20 6177 6169 7420 636f  ntent = await co
+00008ce0: 6e74 656e 742e 7265 6164 616c 6c28 290a  ntent.readall().
+00008cf0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00008d00: 6572 7445 7175 616c 2864 6174 612c 2063  ertEqual(data, c
+00008d10: 6f6e 7465 6e74 5b3a 3531 325d 290a 2020  ontent[:512]).  
+00008d20: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00008d30: 7445 7175 616c 2873 656c 662e 7368 6f72  tEqual(self.shor
+00008d40: 745f 6279 7465 5f64 6174 615b 3531 323a  t_byte_data[512:
+00008d50: 5d2c 2063 6f6e 7465 6e74 5b35 3132 3a5d  ], content[512:]
+00008d60: 290a 0a20 2020 2040 4669 6c65 5368 6172  )..    @FileShar
+00008d70: 6550 7265 7061 7265 7228 290a 2020 2020  ePreparer().    
+00008d80: 4041 7379 6e63 5374 6f72 6167 6554 6573  @AsyncStorageTes
+00008d90: 7443 6173 652e 6177 6169 745f 7072 6570  tCase.await_prep
+00008da0: 6172 6564 5f74 6573 740a 2020 2020 6173  ared_test.    as
+00008db0: 796e 6320 6465 6620 7465 7374 5f75 7064  ync def test_upd
+00008dc0: 6174 655f 7261 6e67 655f 7769 7468 5f6d  ate_range_with_m
+00008dd0: 6435 5f61 7379 6e63 2873 656c 662c 2073  d5_async(self, s
+00008de0: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
+00008df0: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
+00008e00: 6f75 6e74 5f6b 6579 293a 0a20 2020 2020  ount_key):.     
+00008e10: 2020 2073 656c 662e 5f73 6574 7570 2873     self._setup(s
+00008e20: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
+00008e30: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
+00008e40: 6f75 6e74 5f6b 6579 290a 2020 2020 2020  ount_key).      
+00008e50: 2020 6669 6c65 5f63 6c69 656e 7420 3d20    file_client = 
+00008e60: 6177 6169 7420 7365 6c66 2e5f 6372 6561  await self._crea
+00008e70: 7465 5f66 696c 6528 7374 6f72 6167 655f  te_file(storage_
+00008e80: 6163 636f 756e 745f 6e61 6d65 2c20 7374  account_name, st
+00008e90: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
+00008ea0: 7929 0a0a 2020 2020 2020 2020 2320 4163  y)..        # Ac
+00008eb0: 740a 2020 2020 2020 2020 6461 7461 203d  t.        data =
+00008ec0: 2062 2761 6263 6465 6667 6869 6a6b 6c6d   b'abcdefghijklm
+00008ed0: 6e6f 7027 202a 2033 320a 2020 2020 2020  nop' * 32.      
+00008ee0: 2020 6177 6169 7420 6669 6c65 5f63 6c69    await file_cli
+00008ef0: 656e 742e 7570 6c6f 6164 5f72 616e 6765  ent.upload_range
+00008f00: 2864 6174 612c 206f 6666 7365 743d 302c  (data, offset=0,
+00008f10: 206c 656e 6774 683d 3531 322c 2076 616c   length=512, val
+00008f20: 6964 6174 655f 636f 6e74 656e 743d 5472  idate_content=Tr
+00008f30: 7565 290a 0a20 2020 2020 2020 2023 2041  ue)..        # A
+00008f40: 7373 6572 740a 0a20 2020 2040 4669 6c65  ssert..    @File
+00008f50: 5368 6172 6550 7265 7061 7265 7228 290a  SharePreparer().
+00008f60: 2020 2020 4041 7379 6e63 5374 6f72 6167      @AsyncStorag
+00008f70: 6554 6573 7443 6173 652e 6177 6169 745f  eTestCase.await_
+00008f80: 7072 6570 6172 6564 5f74 6573 740a 2020  prepared_test.  
+00008f90: 2020 6173 796e 6320 6465 6620 7465 7374    async def test
+00008fa0: 5f75 7064 6174 655f 7261 6e67 655f 6c61  _update_range_la
+00008fb0: 7374 5f77 7269 7474 656e 5f6d 6f64 655f  st_written_mode_
+00008fc0: 6e6f 7728 7365 6c66 2c20 7374 6f72 6167  now(self, storag
+00008fd0: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
+00008fe0: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
+00008ff0: 6b65 7929 3a0a 2020 2020 2020 2020 7365  key):.        se
+00009000: 6c66 2e5f 7365 7475 7028 7374 6f72 6167  lf._setup(storag
+00009010: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
+00009020: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
+00009030: 6b65 7929 0a20 2020 2020 2020 2066 696c  key).        fil
+00009040: 655f 636c 6965 6e74 203d 2061 7761 6974  e_client = await
+00009050: 2073 656c 662e 5f63 7265 6174 655f 6669   self._create_fi
+00009060: 6c65 2873 746f 7261 6765 5f61 6363 6f75  le(storage_accou
+00009070: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
+00009080: 5f61 6363 6f75 6e74 5f6b 6579 290a 2020  _account_key).  
+00009090: 2020 2020 2020 6375 7272 656e 745f 6c61        current_la
+000090a0: 7374 5f77 7269 7465 5f74 696d 6520 3d20  st_write_time = 
+000090b0: 2861 7761 6974 2066 696c 655f 636c 6965  (await file_clie
+000090c0: 6e74 2e67 6574 5f66 696c 655f 7072 6f70  nt.get_file_prop
+000090d0: 6572 7469 6573 2829 292e 6c61 7374 5f77  erties()).last_w
+000090e0: 7269 7465 5f74 696d 650a 0a20 2020 2020  rite_time..     
+000090f0: 2020 2023 2041 6374 0a20 2020 2020 2020     # Act.       
+00009100: 2064 6174 6120 3d20 6227 6162 6364 6566   data = b'abcdef
+00009110: 6768 696a 6b6c 6d6e 6f70 2720 2a20 3332  ghijklmnop' * 32
+00009120: 0a20 2020 2020 2020 2061 7761 6974 2066  .        await f
+00009130: 696c 655f 636c 6965 6e74 2e75 706c 6f61  ile_client.uploa
+00009140: 645f 7261 6e67 6528 6461 7461 2c20 6f66  d_range(data, of
+00009150: 6673 6574 3d30 2c20 6c65 6e67 7468 3d35  fset=0, length=5
+00009160: 3132 2c20 6669 6c65 5f6c 6173 745f 7772  12, file_last_wr
+00009170: 6974 655f 6d6f 6465 3d22 4e6f 7722 290a  ite_mode="Now").
+00009180: 0a20 2020 2020 2020 2023 2041 7373 6572  .        # Asser
+00009190: 740a 2020 2020 2020 2020 6e65 775f 6c61  t.        new_la
+000091a0: 7374 5f77 7269 7465 5f74 696d 6520 3d20  st_write_time = 
+000091b0: 2861 7761 6974 2066 696c 655f 636c 6965  (await file_clie
+000091c0: 6e74 2e67 6574 5f66 696c 655f 7072 6f70  nt.get_file_prop
+000091d0: 6572 7469 6573 2829 292e 6c61 7374 5f77  erties()).last_w
+000091e0: 7269 7465 5f74 696d 650a 2020 2020 2020  rite_time.      
+000091f0: 2020 7365 6c66 2e61 7373 6572 744e 6f74    self.assertNot
+00009200: 4571 7561 6c28 6375 7272 656e 745f 6c61  Equal(current_la
+00009210: 7374 5f77 7269 7465 5f74 696d 652c 206e  st_write_time, n
+00009220: 6577 5f6c 6173 745f 7772 6974 655f 7469  ew_last_write_ti
+00009230: 6d65 290a 0a20 2020 2040 4669 6c65 5368  me)..    @FileSh
+00009240: 6172 6550 7265 7061 7265 7228 290a 2020  arePreparer().  
+00009250: 2020 4041 7379 6e63 5374 6f72 6167 6554    @AsyncStorageT
+00009260: 6573 7443 6173 652e 6177 6169 745f 7072  estCase.await_pr
+00009270: 6570 6172 6564 5f74 6573 740a 2020 2020  epared_test.    
+00009280: 6173 796e 6320 6465 6620 7465 7374 5f75  async def test_u
+00009290: 7064 6174 655f 7261 6e67 655f 6c61 7374  pdate_range_last
+000092a0: 5f77 7269 7474 656e 5f6d 6f64 655f 7072  _written_mode_pr
+000092b0: 6573 6572 7665 2873 656c 662c 2073 746f  eserve(self, sto
+000092c0: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
+000092d0: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
+000092e0: 6e74 5f6b 6579 293a 0a20 2020 2020 2020  nt_key):.       
+000092f0: 2073 656c 662e 5f73 6574 7570 2873 746f   self._setup(sto
+00009300: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
+00009310: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
+00009320: 6e74 5f6b 6579 290a 2020 2020 2020 2020  nt_key).        
+00009330: 6669 6c65 5f63 6c69 656e 7420 3d20 6177  file_client = aw
+00009340: 6169 7420 7365 6c66 2e5f 6372 6561 7465  ait self._create
+00009350: 5f66 696c 6528 7374 6f72 6167 655f 6163  _file(storage_ac
+00009360: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
+00009370: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
+00009380: 0a20 2020 2020 2020 2063 7572 7265 6e74  .        current
+00009390: 5f6c 6173 745f 7772 6974 655f 7469 6d65  _last_write_time
+000093a0: 203d 2028 6177 6169 7420 6669 6c65 5f63   = (await file_c
+000093b0: 6c69 656e 742e 6765 745f 6669 6c65 5f70  lient.get_file_p
+000093c0: 726f 7065 7274 6965 7328 2929 2e6c 6173  roperties()).las
+000093d0: 745f 7772 6974 655f 7469 6d65 0a0a 2020  t_write_time..  
+000093e0: 2020 2020 2020 2320 4163 740a 2020 2020        # Act.    
+000093f0: 2020 2020 6461 7461 203d 2062 2761 6263      data = b'abc
+00009400: 6465 6667 6869 6a6b 6c6d 6e6f 7027 202a  defghijklmnop' *
+00009410: 2033 320a 2020 2020 2020 2020 6177 6169   32.        awai
+00009420: 7420 6669 6c65 5f63 6c69 656e 742e 7570  t file_client.up
+00009430: 6c6f 6164 5f72 616e 6765 2864 6174 612c  load_range(data,
+00009440: 206f 6666 7365 743d 302c 206c 656e 6774   offset=0, lengt
+00009450: 683d 3531 322c 2066 696c 655f 6c61 7374  h=512, file_last
+00009460: 5f77 7269 7465 5f6d 6f64 653d 2250 7265  _write_mode="Pre
+00009470: 7365 7276 6522 290a 0a20 2020 2020 2020  serve")..       
+00009480: 2023 2041 7373 6572 740a 2020 2020 2020   # Assert.      
+00009490: 2020 6e65 775f 6c61 7374 5f77 7269 7465    new_last_write
+000094a0: 5f74 696d 6520 3d20 2861 7761 6974 2066  _time = (await f
+000094b0: 696c 655f 636c 6965 6e74 2e67 6574 5f66  ile_client.get_f
+000094c0: 696c 655f 7072 6f70 6572 7469 6573 2829  ile_properties()
+000094d0: 292e 6c61 7374 5f77 7269 7465 5f74 696d  ).last_write_tim
+000094e0: 650a 2020 2020 2020 2020 7365 6c66 2e61  e.        self.a
+000094f0: 7373 6572 7445 7175 616c 2863 7572 7265  ssertEqual(curre
+00009500: 6e74 5f6c 6173 745f 7772 6974 655f 7469  nt_last_write_ti
+00009510: 6d65 2c20 6e65 775f 6c61 7374 5f77 7269  me, new_last_wri
+00009520: 7465 5f74 696d 6529 0a0a 2020 2020 4046  te_time)..    @F
+00009530: 696c 6553 6861 7265 5072 6570 6172 6572  ileSharePreparer
+00009540: 2829 0a20 2020 2040 4173 796e 6353 746f  ().    @AsyncSto
+00009550: 7261 6765 5465 7374 4361 7365 2e61 7761  rageTestCase.awa
+00009560: 6974 5f70 7265 7061 7265 645f 7465 7374  it_prepared_test
+00009570: 0a20 2020 2061 7379 6e63 2064 6566 2074  .    async def t
+00009580: 6573 745f 7570 6461 7465 5f72 616e 6765  est_update_range
+00009590: 5f66 726f 6d5f 6669 6c65 5f75 726c 5f77  _from_file_url_w
+000095a0: 6865 6e5f 736f 7572 6365 5f66 696c 655f  hen_source_file_
+000095b0: 646f 6573 5f6e 6f74 5f68 6176 655f 656e  does_not_have_en
+000095c0: 6f75 6768 5f62 7974 6573 2873 656c 662c  ough_bytes(self,
+000095d0: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
+000095e0: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
+000095f0: 6363 6f75 6e74 5f6b 6579 293a 0a20 2020  ccount_key):.   
+00009600: 2020 2020 2073 656c 662e 5f73 6574 7570       self._setup
+00009610: 2873 746f 7261 6765 5f61 6363 6f75 6e74  (storage_account
+00009620: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
+00009630: 6363 6f75 6e74 5f6b 6579 290a 2020 2020  ccount_key).    
+00009640: 2020 2020 736f 7572 6365 5f66 696c 655f      source_file_
+00009650: 6e61 6d65 203d 2027 7465 7374 6669 6c65  name = 'testfile
+00009660: 3127 0a20 2020 2020 2020 2073 6f75 7263  1'.        sourc
+00009670: 655f 6669 6c65 5f63 6c69 656e 7420 3d20  e_file_client = 
+00009680: 6177 6169 7420 7365 6c66 2e5f 6372 6561  await self._crea
+00009690: 7465 5f66 696c 6528 7374 6f72 6167 655f  te_file(storage_
+000096a0: 6163 636f 756e 745f 6e61 6d65 2c20 7374  account_name, st
+000096b0: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
+000096c0: 792c 2066 696c 655f 6e61 6d65 3d73 6f75  y, file_name=sou
+000096d0: 7263 655f 6669 6c65 5f6e 616d 6529 0a0a  rce_file_name)..
+000096e0: 2020 2020 2020 2020 6465 7374 696e 6174          destinat
+000096f0: 696f 6e5f 6669 6c65 5f6e 616d 6520 3d20  ion_file_name = 
+00009700: 2766 696c 6574 6f75 7064 6174 6527 0a20  'filetoupdate'. 
+00009710: 2020 2020 2020 2064 6573 7469 6e61 7469         destinati
+00009720: 6f6e 5f66 696c 655f 636c 6965 6e74 203d  on_file_client =
+00009730: 2061 7761 6974 2073 656c 662e 5f63 7265   await self._cre
+00009740: 6174 655f 6669 6c65 2873 746f 7261 6765  ate_file(storage
+00009750: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
+00009760: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
+00009770: 6579 2c20 6669 6c65 5f6e 616d 653d 6465  ey, file_name=de
+00009780: 7374 696e 6174 696f 6e5f 6669 6c65 5f6e  stination_file_n
+00009790: 616d 6529 0a0a 2020 2020 2020 2020 2320  ame)..        # 
+000097a0: 6765 6e65 7261 7465 2053 4153 2066 6f72  generate SAS for
+000097b0: 2074 6865 2073 6f75 7263 6520 6669 6c65   the source file
+000097c0: 0a20 2020 2020 2020 2073 6173 5f74 6f6b  .        sas_tok
+000097d0: 656e 5f66 6f72 5f73 6f75 7263 655f 6669  en_for_source_fi
+000097e0: 6c65 203d 2067 656e 6572 6174 655f 6669  le = generate_fi
+000097f0: 6c65 5f73 6173 280a 2020 2020 2020 2020  le_sas(.        
+00009800: 2020 2020 736f 7572 6365 5f66 696c 655f      source_file_
+00009810: 636c 6965 6e74 2e61 6363 6f75 6e74 5f6e  client.account_n
+00009820: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
+00009830: 2073 6f75 7263 655f 6669 6c65 5f63 6c69   source_file_cli
+00009840: 656e 742e 7368 6172 655f 6e61 6d65 2c0a  ent.share_name,.
+00009850: 2020 2020 2020 2020 2020 2020 736f 7572              sour
+00009860: 6365 5f66 696c 655f 636c 6965 6e74 2e66  ce_file_client.f
+00009870: 696c 655f 7061 7468 2c0a 2020 2020 2020  ile_path,.      
+00009880: 2020 2020 2020 736f 7572 6365 5f66 696c        source_fil
+00009890: 655f 636c 6965 6e74 2e63 7265 6465 6e74  e_client.credent
+000098a0: 6961 6c2e 6163 636f 756e 745f 6b65 7929  ial.account_key)
+000098b0: 0a0a 2020 2020 2020 2020 736f 7572 6365  ..        source
+000098c0: 5f66 696c 655f 7572 6c20 3d20 736f 7572  _file_url = sour
+000098d0: 6365 5f66 696c 655f 636c 6965 6e74 2e75  ce_file_client.u
+000098e0: 726c 202b 2027 3f27 202b 2073 6173 5f74  rl + '?' + sas_t
+000098f0: 6f6b 656e 5f66 6f72 5f73 6f75 7263 655f  oken_for_source_
+00009900: 6669 6c65 0a0a 2020 2020 2020 2020 2320  file..        # 
+00009910: 4163 740a 2020 2020 2020 2020 7769 7468  Act.        with
+00009920: 2073 656c 662e 6173 7365 7274 5261 6973   self.assertRais
+00009930: 6573 2848 7474 7052 6573 706f 6e73 6545  es(HttpResponseE
+00009940: 7272 6f72 293a 0a20 2020 2020 2020 2020  rror):.         
+00009950: 2020 2023 2077 6865 6e20 7468 6520 736f     # when the so
+00009960: 7572 6365 2066 696c 6520 6861 7320 6c65  urce file has le
+00009970: 7373 2062 7974 6573 2074 6861 6e20 3230  ss bytes than 20
+00009980: 3530 2c20 7468 726f 7720 6578 6365 7074  50, throw except
+00009990: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
+000099a0: 6177 6169 7420 6465 7374 696e 6174 696f  await destinatio
+000099b0: 6e5f 6669 6c65 5f63 6c69 656e 742e 7570  n_file_client.up
+000099c0: 6c6f 6164 5f72 616e 6765 5f66 726f 6d5f  load_range_from_
+000099d0: 7572 6c28 736f 7572 6365 5f66 696c 655f  url(source_file_
+000099e0: 7572 6c2c 206f 6666 7365 743d 302c 206c  url, offset=0, l
+000099f0: 656e 6774 683d 3230 3530 2c20 736f 7572  ength=2050, sour
+00009a00: 6365 5f6f 6666 7365 743d 3029 0a0a 2020  ce_offset=0)..  
+00009a10: 2020 4046 696c 6553 6861 7265 5072 6570    @FileSharePrep
+00009a20: 6172 6572 2829 0a20 2020 2040 4173 796e  arer().    @Asyn
+00009a30: 6353 746f 7261 6765 5465 7374 4361 7365  cStorageTestCase
+00009a40: 2e61 7761 6974 5f70 7265 7061 7265 645f  .await_prepared_
+00009a50: 7465 7374 0a20 2020 2061 7379 6e63 2064  test.    async d
+00009a60: 6566 2074 6573 745f 7570 6461 7465 5f72  ef test_update_r
+00009a70: 616e 6765 5f66 726f 6d5f 6669 6c65 5f75  ange_from_file_u
+00009a80: 726c 2873 656c 662c 2073 746f 7261 6765  rl(self, storage
+00009a90: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
+00009aa0: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
+00009ab0: 6579 293a 0a20 2020 2020 2020 2073 656c  ey):.        sel
+00009ac0: 662e 5f73 6574 7570 2873 746f 7261 6765  f._setup(storage
+00009ad0: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
+00009ae0: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
+00009af0: 6579 290a 2020 2020 2020 2020 736f 7572  ey).        sour
+00009b00: 6365 5f66 696c 655f 6e61 6d65 203d 2027  ce_file_name = '
+00009b10: 7465 7374 6669 6c65 270a 2020 2020 2020  testfile'.      
+00009b20: 2020 736f 7572 6365 5f66 696c 655f 636c    source_file_cl
+00009b30: 6965 6e74 203d 2061 7761 6974 2073 656c  ient = await sel
+00009b40: 662e 5f63 7265 6174 655f 6669 6c65 2873  f._create_file(s
+00009b50: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
+00009b60: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
+00009b70: 6f75 6e74 5f6b 6579 2c20 6669 6c65 5f6e  ount_key, file_n
+00009b80: 616d 653d 736f 7572 6365 5f66 696c 655f  ame=source_file_
+00009b90: 6e61 6d65 290a 2020 2020 2020 2020 6461  name).        da
+00009ba0: 7461 203d 2062 2761 6263 6465 6667 6869  ta = b'abcdefghi
+00009bb0: 6a6b 6c6d 6e6f 7027 202a 2033 320a 2020  jklmnop' * 32.  
+00009bc0: 2020 2020 2020 6177 6169 7420 736f 7572        await sour
+00009bd0: 6365 5f66 696c 655f 636c 6965 6e74 2e75  ce_file_client.u
+00009be0: 706c 6f61 645f 7261 6e67 6528 6461 7461  pload_range(data
+00009bf0: 2c20 6f66 6673 6574 3d30 2c20 6c65 6e67  , offset=0, leng
+00009c00: 7468 3d35 3132 290a 0a20 2020 2020 2020  th=512)..       
+00009c10: 2064 6573 7469 6e61 7469 6f6e 5f66 696c   destination_fil
+00009c20: 655f 6e61 6d65 203d 2027 6669 6c65 746f  e_name = 'fileto
+00009c30: 7570 6461 7465 270a 2020 2020 2020 2020  update'.        
+00009c40: 6465 7374 696e 6174 696f 6e5f 6669 6c65  destination_file
+00009c50: 5f63 6c69 656e 7420 3d20 6177 6169 7420  _client = await 
+00009c60: 7365 6c66 2e5f 6372 6561 7465 5f65 6d70  self._create_emp
+00009c70: 7479 5f66 696c 6528 7374 6f72 6167 655f  ty_file(storage_
+00009c80: 6163 636f 756e 745f 6e61 6d65 2c20 7374  account_name, st
+00009c90: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
+00009ca0: 792c 2066 696c 655f 6e61 6d65 3d64 6573  y, file_name=des
+00009cb0: 7469 6e61 7469 6f6e 5f66 696c 655f 6e61  tination_file_na
+00009cc0: 6d65 290a 0a20 2020 2020 2020 2023 2067  me)..        # g
+00009cd0: 656e 6572 6174 6520 5341 5320 666f 7220  enerate SAS for 
+00009ce0: 7468 6520 736f 7572 6365 2066 696c 650a  the source file.
+00009cf0: 2020 2020 2020 2020 7361 735f 746f 6b65          sas_toke
+00009d00: 6e5f 666f 725f 736f 7572 6365 5f66 696c  n_for_source_fil
+00009d10: 6520 3d20 6765 6e65 7261 7465 5f66 696c  e = generate_fil
+00009d20: 655f 7361 7328 0a20 2020 2020 2020 2020  e_sas(.         
+00009d30: 2020 2073 6f75 7263 655f 6669 6c65 5f63     source_file_c
+00009d40: 6c69 656e 742e 6163 636f 756e 745f 6e61  lient.account_na
+00009d50: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
+00009d60: 736f 7572 6365 5f66 696c 655f 636c 6965  source_file_clie
+00009d70: 6e74 2e73 6861 7265 5f6e 616d 652c 0a20  nt.share_name,. 
+00009d80: 2020 2020 2020 2020 2020 2073 6f75 7263             sourc
+00009d90: 655f 6669 6c65 5f63 6c69 656e 742e 6669  e_file_client.fi
+00009da0: 6c65 5f70 6174 682c 0a20 2020 2020 2020  le_path,.       
+00009db0: 2020 2020 2073 6f75 7263 655f 6669 6c65       source_file
+00009dc0: 5f63 6c69 656e 742e 6372 6564 656e 7469  _client.credenti
+00009dd0: 616c 2e61 6363 6f75 6e74 5f6b 6579 2c0a  al.account_key,.
+00009de0: 2020 2020 2020 2020 2020 2020 4669 6c65              File
+00009df0: 5361 7350 6572 6d69 7373 696f 6e73 2872  SasPermissions(r
+00009e00: 6561 643d 5472 7565 292c 0a20 2020 2020  ead=True),.     
+00009e10: 2020 2020 2020 2065 7870 6972 793d 6461         expiry=da
+00009e20: 7465 7469 6d65 2e75 7463 6e6f 7728 2920  tetime.utcnow() 
+00009e30: 2b20 7469 6d65 6465 6c74 6128 686f 7572  + timedelta(hour
+00009e40: 733d 3129 290a 0a20 2020 2020 2020 2073  s=1))..        s
+00009e50: 6f75 7263 655f 6669 6c65 5f75 726c 203d  ource_file_url =
+00009e60: 2073 6f75 7263 655f 6669 6c65 5f63 6c69   source_file_cli
+00009e70: 656e 742e 7572 6c20 2b20 273f 2720 2b20  ent.url + '?' + 
+00009e80: 7361 735f 746f 6b65 6e5f 666f 725f 736f  sas_token_for_so
+00009e90: 7572 6365 5f66 696c 650a 2020 2020 2020  urce_file.      
+00009ea0: 2020 2320 4163 740a 2020 2020 2020 2020    # Act.        
+00009eb0: 6177 6169 7420 6465 7374 696e 6174 696f  await destinatio
+00009ec0: 6e5f 6669 6c65 5f63 6c69 656e 742e 7570  n_file_client.up
+00009ed0: 6c6f 6164 5f72 616e 6765 5f66 726f 6d5f  load_range_from_
+00009ee0: 7572 6c28 736f 7572 6365 5f66 696c 655f  url(source_file_
+00009ef0: 7572 6c2c 206f 6666 7365 743d 302c 206c  url, offset=0, l
+00009f00: 656e 6774 683d 3531 322c 2073 6f75 7263  ength=512, sourc
+00009f10: 655f 6f66 6673 6574 3d30 290a 0a20 2020  e_offset=0)..   
+00009f20: 2020 2020 2023 2041 7373 6572 740a 2020       # Assert.  
+00009f30: 2020 2020 2020 2320 546f 206d 616b 6520        # To make 
+00009f40: 7375 7265 2074 6865 2072 616e 6765 206f  sure the range o
+00009f50: 6620 7468 6520 6669 6c65 2069 7320 6163  f the file is ac
+00009f60: 7475 616c 6c79 2075 7064 6174 6564 0a20  tually updated. 
+00009f70: 2020 2020 2020 2066 696c 655f 7261 6e67         file_rang
+00009f80: 6573 203d 2061 7761 6974 2064 6573 7469  es = await desti
+00009f90: 6e61 7469 6f6e 5f66 696c 655f 636c 6965  nation_file_clie
+00009fa0: 6e74 2e67 6574 5f72 616e 6765 7328 290a  nt.get_ranges().
+00009fb0: 2020 2020 2020 2020 6669 6c65 5f63 6f6e          file_con
+00009fc0: 7465 6e74 203d 2061 7761 6974 2064 6573  tent = await des
+00009fd0: 7469 6e61 7469 6f6e 5f66 696c 655f 636c  tination_file_cl
+00009fe0: 6965 6e74 2e64 6f77 6e6c 6f61 645f 6669  ient.download_fi
+00009ff0: 6c65 286f 6666 7365 743d 302c 206c 656e  le(offset=0, len
+0000a000: 6774 683d 3531 3229 0a20 2020 2020 2020  gth=512).       
+0000a010: 2066 696c 655f 636f 6e74 656e 7420 3d20   file_content = 
+0000a020: 6177 6169 7420 6669 6c65 5f63 6f6e 7465  await file_conte
+0000a030: 6e74 2e72 6561 6461 6c6c 2829 0a20 2020  nt.readall().   
+0000a040: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0000a050: 4571 7561 6c28 312c 206c 656e 2866 696c  Equal(1, len(fil
+0000a060: 655f 7261 6e67 6573 2929 0a20 2020 2020  e_ranges)).     
+0000a070: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+0000a080: 7561 6c28 302c 2066 696c 655f 7261 6e67  ual(0, file_rang
+0000a090: 6573 5b30 5d2e 6765 7428 2773 7461 7274  es[0].get('start
+0000a0a0: 2729 290a 2020 2020 2020 2020 7365 6c66  ')).        self
+0000a0b0: 2e61 7373 6572 7445 7175 616c 2835 3131  .assertEqual(511
+0000a0c0: 2c20 6669 6c65 5f72 616e 6765 735b 305d  , file_ranges[0]
+0000a0d0: 2e67 6574 2827 656e 6427 2929 0a20 2020  .get('end')).   
+0000a0e0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0000a0f0: 4571 7561 6c28 6461 7461 2c20 6669 6c65  Equal(data, file
+0000a100: 5f63 6f6e 7465 6e74 290a 0a20 2020 2040  _content)..    @
+0000a110: 4669 6c65 5368 6172 6550 7265 7061 7265  FileSharePrepare
+0000a120: 7228 290a 2020 2020 4041 7379 6e63 5374  r().    @AsyncSt
+0000a130: 6f72 6167 6554 6573 7443 6173 652e 6177  orageTestCase.aw
+0000a140: 6169 745f 7072 6570 6172 6564 5f74 6573  ait_prepared_tes
+0000a150: 740a 2020 2020 6173 796e 6320 6465 6620  t.    async def 
+0000a160: 7465 7374 5f75 7064 6174 655f 7261 6e67  test_update_rang
+0000a170: 655f 6672 6f6d 5f66 696c 655f 7572 6c5f  e_from_file_url_
+0000a180: 7769 7468 5f6f 6175 7468 280a 2020 2020  with_oauth(.    
+0000a190: 2020 2020 2020 2020 7365 6c66 2c20 7374          self, st
+0000a1a0: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
+0000a1b0: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
+0000a1c0: 756e 745f 6b65 7929 3a0a 2020 2020 2020  unt_key):.      
+0000a1d0: 2020 7365 6c66 2e5f 7365 7475 7028 7374    self._setup(st
+0000a1e0: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
+0000a1f0: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
+0000a200: 756e 745f 6b65 7929 0a20 2020 2020 2020  unt_key).       
+0000a210: 2073 6f75 7263 655f 626c 6f62 5f63 6c69   source_blob_cli
+0000a220: 656e 7420 3d20 6177 6169 7420 7365 6c66  ent = await self
+0000a230: 2e5f 6372 6561 7465 5f73 6f75 7263 655f  ._create_source_
+0000a240: 626c 6f62 2829 0a20 2020 2020 2020 2061  blob().        a
+0000a250: 6363 6573 735f 746f 6b65 6e20 3d20 6177  ccess_token = aw
+0000a260: 6169 7420 7365 6c66 2e67 656e 6572 6174  ait self.generat
+0000a270: 655f 6f61 7574 685f 746f 6b65 6e28 292e  e_oauth_token().
+0000a280: 6765 745f 746f 6b65 6e28 2268 7474 7073  get_token("https
+0000a290: 3a2f 2f73 746f 7261 6765 2e61 7a75 7265  ://storage.azure
+0000a2a0: 2e63 6f6d 2f2e 6465 6661 756c 7422 290a  .com/.default").
+0000a2b0: 2020 2020 2020 2020 746f 6b65 6e20 3d20          token = 
+0000a2c0: 2242 6561 7265 7220 7b7d 222e 666f 726d  "Bearer {}".form
+0000a2d0: 6174 2861 6363 6573 735f 746f 6b65 6e2e  at(access_token.
+0000a2e0: 746f 6b65 6e29 0a0a 2020 2020 2020 2020  token)..        
+0000a2f0: 6465 7374 696e 6174 696f 6e5f 6669 6c65  destination_file
+0000a300: 5f6e 616d 6520 3d20 2766 696c 6574 6f75  _name = 'filetou
+0000a310: 7064 6174 6527 0a20 2020 2020 2020 2064  pdate'.        d
+0000a320: 6573 7469 6e61 7469 6f6e 5f66 696c 655f  estination_file_
+0000a330: 636c 6965 6e74 203d 2061 7761 6974 2073  client = await s
+0000a340: 656c 662e 5f63 7265 6174 655f 656d 7074  elf._create_empt
+0000a350: 795f 6669 6c65 280a 2020 2020 2020 2020  y_file(.        
+0000a360: 2020 2020 7374 6f72 6167 655f 6163 636f      storage_acco
+0000a370: 756e 745f 6e61 6d65 2c20 7374 6f72 6167  unt_name, storag
+0000a380: 655f 6163 636f 756e 745f 6b65 792c 2066  e_account_key, f
+0000a390: 696c 655f 6e61 6d65 3d64 6573 7469 6e61  ile_name=destina
+0000a3a0: 7469 6f6e 5f66 696c 655f 6e61 6d65 290a  tion_file_name).
+0000a3b0: 2020 2020 2020 2020 7769 7468 2073 656c          with sel
+0000a3c0: 662e 6173 7365 7274 5261 6973 6573 2848  f.assertRaises(H
+0000a3d0: 7474 7052 6573 706f 6e73 6545 7272 6f72  ttpResponseError
+0000a3e0: 293a 0a20 2020 2020 2020 2020 2020 2061  ):.            a
+0000a3f0: 7761 6974 2064 6573 7469 6e61 7469 6f6e  wait destination
+0000a400: 5f66 696c 655f 636c 6965 6e74 2e75 706c  _file_client.upl
+0000a410: 6f61 645f 7261 6e67 655f 6672 6f6d 5f75  oad_range_from_u
+0000a420: 726c 280a 2020 2020 2020 2020 2020 2020  rl(.            
+0000a430: 2020 2020 736f 7572 6365 5f62 6c6f 625f      source_blob_
+0000a440: 636c 6965 6e74 2e75 726c 2c20 6f66 6673  client.url, offs
+0000a450: 6574 3d30 2c20 6c65 6e67 7468 3d35 3132  et=0, length=512
+0000a460: 2c20 736f 7572 6365 5f6f 6666 7365 743d  , source_offset=
+0000a470: 3029 0a0a 2020 2020 2020 2020 6177 6169  0)..        awai
+0000a480: 7420 6465 7374 696e 6174 696f 6e5f 6669  t destination_fi
+0000a490: 6c65 5f63 6c69 656e 742e 7570 6c6f 6164  le_client.upload
+0000a4a0: 5f72 616e 6765 5f66 726f 6d5f 7572 6c28  _range_from_url(
+0000a4b0: 0a20 2020 2020 2020 2020 2020 2073 6f75  .            sou
+0000a4c0: 7263 655f 626c 6f62 5f63 6c69 656e 742e  rce_blob_client.
+0000a4d0: 7572 6c2c 206f 6666 7365 743d 302c 206c  url, offset=0, l
+0000a4e0: 656e 6774 683d 3531 322c 2073 6f75 7263  ength=512, sourc
+0000a4f0: 655f 6f66 6673 6574 3d30 2c20 736f 7572  e_offset=0, sour
+0000a500: 6365 5f61 7574 686f 7269 7a61 7469 6f6e  ce_authorization
+0000a510: 3d74 6f6b 656e 290a 0a20 2020 2040 4669  =token)..    @Fi
+0000a520: 6c65 5368 6172 6550 7265 7061 7265 7228  leSharePreparer(
+0000a530: 290a 2020 2020 4041 7379 6e63 5374 6f72  ).    @AsyncStor
+0000a540: 6167 6554 6573 7443 6173 652e 6177 6169  ageTestCase.awai
+0000a550: 745f 7072 6570 6172 6564 5f74 6573 740a  t_prepared_test.
+0000a560: 2020 2020 6173 796e 6320 6465 6620 7465      async def te
+0000a570: 7374 5f75 7064 6174 655f 7261 6e67 655f  st_update_range_
+0000a580: 6672 6f6d 5f66 696c 655f 7572 6c5f 7769  from_file_url_wi
+0000a590: 7468 5f6c 6561 7365 5f61 7379 6e63 2873  th_lease_async(s
+0000a5a0: 656c 662c 2073 746f 7261 6765 5f61 6363  elf, storage_acc
+0000a5b0: 6f75 6e74 5f6e 616d 652c 2073 746f 7261  ount_name, stora
+0000a5c0: 6765 5f61 6363 6f75 6e74 5f6b 6579 293a  ge_account_key):
+0000a5d0: 0a20 2020 2020 2020 2073 656c 662e 5f73  .        self._s
+0000a5e0: 6574 7570 2873 746f 7261 6765 5f61 6363  etup(storage_acc
+0000a5f0: 6f75 6e74 5f6e 616d 652c 2073 746f 7261  ount_name, stora
+0000a600: 6765 5f61 6363 6f75 6e74 5f6b 6579 290a  ge_account_key).
+0000a610: 2020 2020 2020 2020 736f 7572 6365 5f66          source_f
+0000a620: 696c 655f 6e61 6d65 203d 2027 7465 7374  ile_name = 'test
+0000a630: 6669 6c65 270a 2020 2020 2020 2020 736f  file'.        so
+0000a640: 7572 6365 5f66 696c 655f 636c 6965 6e74  urce_file_client
+0000a650: 203d 2061 7761 6974 2073 656c 662e 5f63   = await self._c
+0000a660: 7265 6174 655f 6669 6c65 2873 746f 7261  reate_file(stora
+0000a670: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
+0000a680: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
+0000a690: 5f6b 6579 2c20 6669 6c65 5f6e 616d 653d  _key, file_name=
+0000a6a0: 736f 7572 6365 5f66 696c 655f 6e61 6d65  source_file_name
+0000a6b0: 290a 2020 2020 2020 2020 6461 7461 203d  ).        data =
+0000a6c0: 2062 2761 6263 6465 6667 6869 6a6b 6c6d   b'abcdefghijklm
+0000a6d0: 6e6f 7027 202a 2033 320a 2020 2020 2020  nop' * 32.      
+0000a6e0: 2020 6177 6169 7420 736f 7572 6365 5f66    await source_f
+0000a6f0: 696c 655f 636c 6965 6e74 2e75 706c 6f61  ile_client.uploa
+0000a700: 645f 7261 6e67 6528 6461 7461 2c20 6f66  d_range(data, of
+0000a710: 6673 6574 3d30 2c20 6c65 6e67 7468 3d35  fset=0, length=5
+0000a720: 3132 290a 0a20 2020 2020 2020 2064 6573  12)..        des
+0000a730: 7469 6e61 7469 6f6e 5f66 696c 655f 6e61  tination_file_na
+0000a740: 6d65 203d 2027 6669 6c65 746f 7570 6461  me = 'filetoupda
+0000a750: 7465 270a 2020 2020 2020 2020 6465 7374  te'.        dest
+0000a760: 696e 6174 696f 6e5f 6669 6c65 5f63 6c69  ination_file_cli
+0000a770: 656e 7420 3d20 6177 6169 7420 7365 6c66  ent = await self
+0000a780: 2e5f 6372 6561 7465 5f65 6d70 7479 5f66  ._create_empty_f
+0000a790: 696c 6528 7374 6f72 6167 655f 6163 636f  ile(storage_acco
+0000a7a0: 756e 745f 6e61 6d65 2c20 7374 6f72 6167  unt_name, storag
+0000a7b0: 655f 6163 636f 756e 745f 6b65 792c 2066  e_account_key, f
+0000a7c0: 696c 655f 6e61 6d65 3d64 6573 7469 6e61  ile_name=destina
+0000a7d0: 7469 6f6e 5f66 696c 655f 6e61 6d65 290a  tion_file_name).
+0000a7e0: 2020 2020 2020 2020 6c65 6173 6520 3d20          lease = 
+0000a7f0: 6177 6169 7420 6465 7374 696e 6174 696f  await destinatio
+0000a800: 6e5f 6669 6c65 5f63 6c69 656e 742e 6163  n_file_client.ac
+0000a810: 7175 6972 655f 6c65 6173 6528 290a 0a20  quire_lease().. 
+0000a820: 2020 2020 2020 2023 2067 656e 6572 6174         # generat
+0000a830: 6520 5341 5320 666f 7220 7468 6520 736f  e SAS for the so
+0000a840: 7572 6365 2066 696c 650a 2020 2020 2020  urce file.      
+0000a850: 2020 7361 735f 746f 6b65 6e5f 666f 725f    sas_token_for_
+0000a860: 736f 7572 6365 5f66 696c 6520 3d20 6765  source_file = ge
+0000a870: 6e65 7261 7465 5f66 696c 655f 7361 7328  nerate_file_sas(
+0000a880: 0a20 2020 2020 2020 2020 2020 2073 6f75  .            sou
+0000a890: 7263 655f 6669 6c65 5f63 6c69 656e 742e  rce_file_client.
+0000a8a0: 6163 636f 756e 745f 6e61 6d65 2c0a 2020  account_name,.  
+0000a8b0: 2020 2020 2020 2020 2020 736f 7572 6365            source
+0000a8c0: 5f66 696c 655f 636c 6965 6e74 2e73 6861  _file_client.sha
+0000a8d0: 7265 5f6e 616d 652c 0a20 2020 2020 2020  re_name,.       
+0000a8e0: 2020 2020 2073 6f75 7263 655f 6669 6c65       source_file
+0000a8f0: 5f63 6c69 656e 742e 6669 6c65 5f70 6174  _client.file_pat
+0000a900: 682c 0a20 2020 2020 2020 2020 2020 2073  h,.            s
+0000a910: 6f75 7263 655f 6669 6c65 5f63 6c69 656e  ource_file_clien
+0000a920: 742e 6372 6564 656e 7469 616c 2e61 6363  t.credential.acc
+0000a930: 6f75 6e74 5f6b 6579 2c0a 2020 2020 2020  ount_key,.      
+0000a940: 2020 2020 2020 4669 6c65 5361 7350 6572        FileSasPer
+0000a950: 6d69 7373 696f 6e73 2872 6561 643d 5472  missions(read=Tr
+0000a960: 7565 292c 0a20 2020 2020 2020 2020 2020  ue),.           
+0000a970: 2065 7870 6972 793d 6461 7465 7469 6d65   expiry=datetime
+0000a980: 2e75 7463 6e6f 7728 2920 2b20 7469 6d65  .utcnow() + time
+0000a990: 6465 6c74 6128 686f 7572 733d 3129 290a  delta(hours=1)).
+0000a9a0: 0a20 2020 2020 2020 2073 6f75 7263 655f  .        source_
+0000a9b0: 6669 6c65 5f75 726c 203d 2073 6f75 7263  file_url = sourc
+0000a9c0: 655f 6669 6c65 5f63 6c69 656e 742e 7572  e_file_client.ur
+0000a9d0: 6c20 2b20 273f 2720 2b20 7361 735f 746f  l + '?' + sas_to
+0000a9e0: 6b65 6e5f 666f 725f 736f 7572 6365 5f66  ken_for_source_f
+0000a9f0: 696c 650a 2020 2020 2020 2020 2320 4163  ile.        # Ac
+0000aa00: 740a 2020 2020 2020 2020 7769 7468 2073  t.        with s
+0000aa10: 656c 662e 6173 7365 7274 5261 6973 6573  elf.assertRaises
+0000aa20: 2848 7474 7052 6573 706f 6e73 6545 7272  (HttpResponseErr
+0000aa30: 6f72 293a 0a20 2020 2020 2020 2020 2020  or):.           
+0000aa40: 2061 7761 6974 2064 6573 7469 6e61 7469   await destinati
+0000aa50: 6f6e 5f66 696c 655f 636c 6965 6e74 2e75  on_file_client.u
+0000aa60: 706c 6f61 645f 7261 6e67 655f 6672 6f6d  pload_range_from
+0000aa70: 5f75 726c 2873 6f75 7263 655f 6669 6c65  _url(source_file
+0000aa80: 5f75 726c 2c20 6f66 6673 6574 3d30 2c20  _url, offset=0, 
+0000aa90: 6c65 6e67 7468 3d35 3132 2c20 736f 7572  length=512, sour
+0000aaa0: 6365 5f6f 6666 7365 743d 3029 0a20 2020  ce_offset=0).   
+0000aab0: 2020 2020 2061 7761 6974 2064 6573 7469       await desti
+0000aac0: 6e61 7469 6f6e 5f66 696c 655f 636c 6965  nation_file_clie
+0000aad0: 6e74 2e75 706c 6f61 645f 7261 6e67 655f  nt.upload_range_
+0000aae0: 6672 6f6d 5f75 726c 2873 6f75 7263 655f  from_url(source_
+0000aaf0: 6669 6c65 5f75 726c 2c20 6f66 6673 6574  file_url, offset
+0000ab00: 3d30 2c20 6c65 6e67 7468 3d35 3132 2c20  =0, length=512, 
+0000ab10: 736f 7572 6365 5f6f 6666 7365 743d 302c  source_offset=0,
+0000ab20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ab30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ab40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ab50: 2020 2020 2020 2020 2020 2020 206c 6561               lea
+0000ab60: 7365 3d6c 6561 7365 290a 0a20 2020 2020  se=lease)..     
+0000ab70: 2020 2023 2041 7373 6572 740a 2020 2020     # Assert.    
+0000ab80: 2020 2020 2320 546f 206d 616b 6520 7375      # To make su
+0000ab90: 7265 2074 6865 2072 616e 6765 206f 6620  re the range of 
+0000aba0: 7468 6520 6669 6c65 2069 7320 6163 7475  the file is actu
+0000abb0: 616c 6c79 2075 7064 6174 6564 0a20 2020  ally updated.   
+0000abc0: 2020 2020 2066 696c 655f 7261 6e67 6573       file_ranges
+0000abd0: 203d 2061 7761 6974 2064 6573 7469 6e61   = await destina
+0000abe0: 7469 6f6e 5f66 696c 655f 636c 6965 6e74  tion_file_client
+0000abf0: 2e67 6574 5f72 616e 6765 7328 290a 2020  .get_ranges().  
+0000ac00: 2020 2020 2020 6669 6c65 5f63 6f6e 7465        file_conte
+0000ac10: 6e74 203d 2061 7761 6974 2064 6573 7469  nt = await desti
+0000ac20: 6e61 7469 6f6e 5f66 696c 655f 636c 6965  nation_file_clie
+0000ac30: 6e74 2e64 6f77 6e6c 6f61 645f 6669 6c65  nt.download_file
+0000ac40: 286f 6666 7365 743d 302c 206c 656e 6774  (offset=0, lengt
+0000ac50: 683d 3531 3229 0a20 2020 2020 2020 2066  h=512).        f
+0000ac60: 696c 655f 636f 6e74 656e 7420 3d20 6177  ile_content = aw
+0000ac70: 6169 7420 6669 6c65 5f63 6f6e 7465 6e74  ait file_content
+0000ac80: 2e72 6561 6461 6c6c 2829 0a20 2020 2020  .readall().     
+0000ac90: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+0000aca0: 7561 6c28 312c 206c 656e 2866 696c 655f  ual(1, len(file_
+0000acb0: 7261 6e67 6573 2929 0a20 2020 2020 2020  ranges)).       
+0000acc0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+0000acd0: 6c28 302c 2066 696c 655f 7261 6e67 6573  l(0, file_ranges
+0000ace0: 5b30 5d2e 6765 7428 2773 7461 7274 2729  [0].get('start')
+0000acf0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0000ad00: 7373 6572 7445 7175 616c 2835 3131 2c20  ssertEqual(511, 
+0000ad10: 6669 6c65 5f72 616e 6765 735b 305d 2e67  file_ranges[0].g
+0000ad20: 6574 2827 656e 6427 2929 0a20 2020 2020  et('end')).     
+0000ad30: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+0000ad40: 7561 6c28 6461 7461 2c20 6669 6c65 5f63  ual(data, file_c
+0000ad50: 6f6e 7465 6e74 290a 0a20 2020 2040 4669  ontent)..    @Fi
+0000ad60: 6c65 5368 6172 6550 7265 7061 7265 7228  leSharePreparer(
+0000ad70: 290a 2020 2020 4041 7379 6e63 5374 6f72  ).    @AsyncStor
+0000ad80: 6167 6554 6573 7443 6173 652e 6177 6169  ageTestCase.awai
+0000ad90: 745f 7072 6570 6172 6564 5f74 6573 740a  t_prepared_test.
+0000ada0: 2020 2020 6173 796e 6320 6465 6620 7465      async def te
+0000adb0: 7374 5f75 7064 6174 655f 6269 675f 7261  st_update_big_ra
+0000adc0: 6e67 655f 6672 6f6d 5f66 696c 655f 7572  nge_from_file_ur
+0000add0: 6c28 7365 6c66 2c20 7374 6f72 6167 655f  l(self, storage_
+0000ade0: 6163 636f 756e 745f 6e61 6d65 2c20 7374  account_name, st
+0000adf0: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
+0000ae00: 7929 3a0a 2020 2020 2020 2020 7365 6c66  y):.        self
+0000ae10: 2e5f 7365 7475 7028 7374 6f72 6167 655f  ._setup(storage_
+0000ae20: 6163 636f 756e 745f 6e61 6d65 2c20 7374  account_name, st
+0000ae30: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
+0000ae40: 7929 0a20 2020 2020 2020 2073 6f75 7263  y).        sourc
+0000ae50: 655f 6669 6c65 5f6e 616d 6520 3d20 2774  e_file_name = 't
+0000ae60: 6573 7466 696c 6531 270a 2020 2020 2020  estfile1'.      
+0000ae70: 2020 656e 6420 3d20 3130 3438 3537 350a    end = 1048575.
+0000ae80: 0a20 2020 2020 2020 2073 6f75 7263 655f  .        source_
+0000ae90: 6669 6c65 5f63 6c69 656e 7420 3d20 6177  file_client = aw
+0000aea0: 6169 7420 7365 6c66 2e5f 6372 6561 7465  ait self._create
+0000aeb0: 5f65 6d70 7479 5f66 696c 6528 7374 6f72  _empty_file(stor
+0000aec0: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
+0000aed0: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
+0000aee0: 745f 6b65 792c 2066 696c 655f 6e61 6d65  t_key, file_name
+0000aef0: 3d73 6f75 7263 655f 6669 6c65 5f6e 616d  =source_file_nam
+0000af00: 652c 2066 696c 655f 7369 7a65 3d31 3032  e, file_size=102
+0000af10: 3420 2a20 3130 3234 290a 2020 2020 2020  4 * 1024).      
+0000af20: 2020 6461 7461 203d 2062 2761 6263 6465    data = b'abcde
+0000af30: 6667 6869 6a6b 6c6d 6e6f 7027 202a 2036  fghijklmnop' * 6
+0000af40: 3535 3336 0a20 2020 2020 2020 2061 7761  5536.        awa
+0000af50: 6974 2073 6f75 7263 655f 6669 6c65 5f63  it source_file_c
+0000af60: 6c69 656e 742e 7570 6c6f 6164 5f72 616e  lient.upload_ran
+0000af70: 6765 2864 6174 612c 206f 6666 7365 743d  ge(data, offset=
+0000af80: 302c 206c 656e 6774 683d 656e 642b 3129  0, length=end+1)
+0000af90: 0a0a 2020 2020 2020 2020 6465 7374 696e  ..        destin
+0000afa0: 6174 696f 6e5f 6669 6c65 5f6e 616d 6520  ation_file_name 
+0000afb0: 3d20 2766 696c 6574 6f75 7064 6174 6531  = 'filetoupdate1
+0000afc0: 270a 2020 2020 2020 2020 6465 7374 696e  '.        destin
+0000afd0: 6174 696f 6e5f 6669 6c65 5f63 6c69 656e  ation_file_clien
+0000afe0: 7420 3d20 6177 6169 7420 7365 6c66 2e5f  t = await self._
+0000aff0: 6372 6561 7465 5f65 6d70 7479 5f66 696c  create_empty_fil
+0000b000: 6528 7374 6f72 6167 655f 6163 636f 756e  e(storage_accoun
+0000b010: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
+0000b020: 6163 636f 756e 745f 6b65 792c 2066 696c  account_key, fil
+0000b030: 655f 6e61 6d65 3d64 6573 7469 6e61 7469  e_name=destinati
+0000b040: 6f6e 5f66 696c 655f 6e61 6d65 2c20 6669  on_file_name, fi
+0000b050: 6c65 5f73 697a 653d 3130 3234 202a 2031  le_size=1024 * 1
+0000b060: 3032 3429 0a0a 2020 2020 2020 2020 2320  024)..        # 
+0000b070: 6765 6e65 7261 7465 2053 4153 2066 6f72  generate SAS for
+0000b080: 2074 6865 2073 6f75 7263 6520 6669 6c65   the source file
+0000b090: 0a20 2020 2020 2020 2073 6173 5f74 6f6b  .        sas_tok
+0000b0a0: 656e 5f66 6f72 5f73 6f75 7263 655f 6669  en_for_source_fi
+0000b0b0: 6c65 203d 2067 656e 6572 6174 655f 6669  le = generate_fi
+0000b0c0: 6c65 5f73 6173 280a 2020 2020 2020 2020  le_sas(.        
+0000b0d0: 2020 2020 736f 7572 6365 5f66 696c 655f      source_file_
+0000b0e0: 636c 6965 6e74 2e61 6363 6f75 6e74 5f6e  client.account_n
+0000b0f0: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
+0000b100: 2073 6f75 7263 655f 6669 6c65 5f63 6c69   source_file_cli
+0000b110: 656e 742e 7368 6172 655f 6e61 6d65 2c0a  ent.share_name,.
+0000b120: 2020 2020 2020 2020 2020 2020 736f 7572              sour
+0000b130: 6365 5f66 696c 655f 636c 6965 6e74 2e66  ce_file_client.f
+0000b140: 696c 655f 7061 7468 2c0a 2020 2020 2020  ile_path,.      
+0000b150: 2020 2020 2020 736f 7572 6365 5f66 696c        source_fil
+0000b160: 655f 636c 6965 6e74 2e63 7265 6465 6e74  e_client.credent
+0000b170: 6961 6c2e 6163 636f 756e 745f 6b65 792c  ial.account_key,
+0000b180: 0a20 2020 2020 2020 2020 2020 2046 696c  .            Fil
+0000b190: 6553 6173 5065 726d 6973 7369 6f6e 7328  eSasPermissions(
+0000b1a0: 7265 6164 3d54 7275 6529 2c0a 2020 2020  read=True),.    
+0000b1b0: 2020 2020 2020 2020 6578 7069 7279 3d64          expiry=d
+0000b1c0: 6174 6574 696d 652e 7574 636e 6f77 2829  atetime.utcnow()
+0000b1d0: 202b 2074 696d 6564 656c 7461 2868 6f75   + timedelta(hou
+0000b1e0: 7273 3d31 2929 0a0a 2020 2020 2020 2020  rs=1))..        
+0000b1f0: 736f 7572 6365 5f66 696c 655f 7572 6c20  source_file_url 
+0000b200: 3d20 736f 7572 6365 5f66 696c 655f 636c  = source_file_cl
+0000b210: 6965 6e74 2e75 726c 202b 2027 3f27 202b  ient.url + '?' +
+0000b220: 2073 6173 5f74 6f6b 656e 5f66 6f72 5f73   sas_token_for_s
+0000b230: 6f75 7263 655f 6669 6c65 0a0a 2020 2020  ource_file..    
+0000b240: 2020 2020 2320 4163 740a 2020 2020 2020      # Act.      
+0000b250: 2020 6177 6169 7420 6465 7374 696e 6174    await destinat
+0000b260: 696f 6e5f 6669 6c65 5f63 6c69 656e 742e  ion_file_client.
+0000b270: 7570 6c6f 6164 5f72 616e 6765 5f66 726f  upload_range_fro
+0000b280: 6d5f 7572 6c28 736f 7572 6365 5f66 696c  m_url(source_fil
+0000b290: 655f 7572 6c2c 206f 6666 7365 743d 302c  e_url, offset=0,
+0000b2a0: 206c 656e 6774 683d 656e 642b 312c 2073   length=end+1, s
+0000b2b0: 6f75 7263 655f 6f66 6673 6574 3d30 290a  ource_offset=0).
+0000b2c0: 0a20 2020 2020 2020 2023 2041 7373 6572  .        # Asser
+0000b2d0: 740a 2020 2020 2020 2020 2320 546f 206d  t.        # To m
+0000b2e0: 616b 6520 7375 7265 2074 6865 2072 616e  ake sure the ran
+0000b2f0: 6765 206f 6620 7468 6520 6669 6c65 2069  ge of the file i
+0000b300: 7320 6163 7475 616c 6c79 2075 7064 6174  s actually updat
+0000b310: 6564 0a20 2020 2020 2020 2066 696c 655f  ed.        file_
+0000b320: 7261 6e67 6573 203d 2061 7761 6974 2064  ranges = await d
+0000b330: 6573 7469 6e61 7469 6f6e 5f66 696c 655f  estination_file_
+0000b340: 636c 6965 6e74 2e67 6574 5f72 616e 6765  client.get_range
+0000b350: 7328 290a 2020 2020 2020 2020 6669 6c65  s().        file
+0000b360: 5f63 6f6e 7465 6e74 203d 2061 7761 6974  _content = await
+0000b370: 2064 6573 7469 6e61 7469 6f6e 5f66 696c   destination_fil
+0000b380: 655f 636c 6965 6e74 2e64 6f77 6e6c 6f61  e_client.downloa
+0000b390: 645f 6669 6c65 286f 6666 7365 743d 302c  d_file(offset=0,
+0000b3a0: 206c 656e 6774 683d 656e 6420 2b20 3129   length=end + 1)
+0000b3b0: 0a20 2020 2020 2020 2066 696c 655f 636f  .        file_co
+0000b3c0: 6e74 656e 7420 3d20 6177 6169 7420 6669  ntent = await fi
+0000b3d0: 6c65 5f63 6f6e 7465 6e74 2e72 6561 6461  le_content.reada
+0000b3e0: 6c6c 2829 0a20 2020 2020 2020 2073 656c  ll().        sel
+0000b3f0: 662e 6173 7365 7274 4571 7561 6c28 312c  f.assertEqual(1,
+0000b400: 206c 656e 2866 696c 655f 7261 6e67 6573   len(file_ranges
+0000b410: 2929 0a20 2020 2020 2020 2073 656c 662e  )).        self.
+0000b420: 6173 7365 7274 4571 7561 6c28 302c 2066  assertEqual(0, f
+0000b430: 696c 655f 7261 6e67 6573 5b30 5d2e 6765  ile_ranges[0].ge
+0000b440: 7428 2773 7461 7274 2729 290a 2020 2020  t('start')).    
+0000b450: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0000b460: 7175 616c 2865 6e64 2c20 6669 6c65 5f72  qual(end, file_r
+0000b470: 616e 6765 735b 305d 2e67 6574 2827 656e  anges[0].get('en
+0000b480: 6427 2929 0a20 2020 2020 2020 2073 656c  d')).        sel
+0000b490: 662e 6173 7365 7274 4571 7561 6c28 6461  f.assertEqual(da
+0000b4a0: 7461 2c20 6669 6c65 5f63 6f6e 7465 6e74  ta, file_content
+0000b4b0: 290a 0a20 2020 2040 4669 6c65 5368 6172  )..    @FileShar
+0000b4c0: 6550 7265 7061 7265 7228 290a 2020 2020  ePreparer().    
+0000b4d0: 4041 7379 6e63 5374 6f72 6167 6554 6573  @AsyncStorageTes
+0000b4e0: 7443 6173 652e 6177 6169 745f 7072 6570  tCase.await_prep
+0000b4f0: 6172 6564 5f74 6573 740a 2020 2020 6173  ared_test.    as
+0000b500: 796e 6320 6465 6620 7465 7374 5f75 7064  ync def test_upd
+0000b510: 6174 655f 7261 6e67 655f 6672 6f6d 5f66  ate_range_from_f
+0000b520: 696c 655f 7572 6c5f 6c61 7374 5f77 7269  ile_url_last_wri
+0000b530: 7474 656e 5f6d 6f64 655f 6e6f 7728 7365  tten_mode_now(se
+0000b540: 6c66 2c20 7374 6f72 6167 655f 6163 636f  lf, storage_acco
+0000b550: 756e 745f 6e61 6d65 2c20 7374 6f72 6167  unt_name, storag
+0000b560: 655f 6163 636f 756e 745f 6b65 7929 3a0a  e_account_key):.
+0000b570: 2020 2020 2020 2020 7365 6c66 2e5f 7365          self._se
+0000b580: 7475 7028 7374 6f72 6167 655f 6163 636f  tup(storage_acco
+0000b590: 756e 745f 6e61 6d65 2c20 7374 6f72 6167  unt_name, storag
+0000b5a0: 655f 6163 636f 756e 745f 6b65 7929 0a20  e_account_key). 
+0000b5b0: 2020 2020 2020 2073 6f75 7263 655f 6669         source_fi
+0000b5c0: 6c65 5f63 6c69 656e 7420 3d20 6177 6169  le_client = awai
+0000b5d0: 7420 7365 6c66 2e5f 6372 6561 7465 5f66  t self._create_f
+0000b5e0: 696c 6528 7374 6f72 6167 655f 6163 636f  ile(storage_acco
+0000b5f0: 756e 745f 6e61 6d65 2c20 7374 6f72 6167  unt_name, storag
+0000b600: 655f 6163 636f 756e 745f 6b65 792c 2066  e_account_key, f
+0000b610: 696c 655f 6e61 6d65 3d27 7465 7374 6669  ile_name='testfi
+0000b620: 6c65 2729 0a20 2020 2020 2020 2064 6174  le').        dat
+0000b630: 6120 3d20 6227 6162 6364 6566 6768 696a  a = b'abcdefghij
+0000b640: 6b6c 6d6e 6f70 2720 2a20 3332 0a20 2020  klmnop' * 32.   
+0000b650: 2020 2020 2061 7761 6974 2073 6f75 7263       await sourc
+0000b660: 655f 6669 6c65 5f63 6c69 656e 742e 7570  e_file_client.up
+0000b670: 6c6f 6164 5f72 616e 6765 2864 6174 612c  load_range(data,
+0000b680: 206f 6666 7365 743d 302c 206c 656e 6774   offset=0, lengt
+0000b690: 683d 3531 3229 0a0a 2020 2020 2020 2020  h=512)..        
+0000b6a0: 6465 7374 696e 6174 696f 6e5f 6669 6c65  destination_file
+0000b6b0: 5f63 6c69 656e 7420 3d20 6177 6169 7420  _client = await 
+0000b6c0: 7365 6c66 2e5f 6372 6561 7465 5f65 6d70  self._create_emp
+0000b6d0: 7479 5f66 696c 6528 0a20 2020 2020 2020  ty_file(.       
+0000b6e0: 2020 2020 2073 746f 7261 6765 5f61 6363       storage_acc
+0000b6f0: 6f75 6e74 5f6e 616d 652c 0a20 2020 2020  ount_name,.     
+0000b700: 2020 2020 2020 2073 746f 7261 6765 5f61         storage_a
+0000b710: 6363 6f75 6e74 5f6b 6579 2c0a 2020 2020  ccount_key,.    
+0000b720: 2020 2020 2020 2020 6669 6c65 5f6e 616d          file_nam
+0000b730: 653d 2766 696c 6574 6f75 7064 6174 6527  e='filetoupdate'
+0000b740: 290a 2020 2020 2020 2020 6375 7272 656e  ).        curren
+0000b750: 745f 6c61 7374 5f77 7269 7465 5f74 696d  t_last_write_tim
+0000b760: 6520 3d20 2861 7761 6974 2064 6573 7469  e = (await desti
+0000b770: 6e61 7469 6f6e 5f66 696c 655f 636c 6965  nation_file_clie
+0000b780: 6e74 2e67 6574 5f66 696c 655f 7072 6f70  nt.get_file_prop
+0000b790: 6572 7469 6573 2829 292e 6c61 7374 5f77  erties()).last_w
+0000b7a0: 7269 7465 5f74 696d 650a 0a20 2020 2020  rite_time..     
+0000b7b0: 2020 2023 2067 656e 6572 6174 6520 5341     # generate SA
+0000b7c0: 5320 666f 7220 7468 6520 736f 7572 6365  S for the source
+0000b7d0: 2066 696c 650a 2020 2020 2020 2020 7361   file.        sa
+0000b7e0: 735f 746f 6b65 6e5f 666f 725f 736f 7572  s_token_for_sour
+0000b7f0: 6365 5f66 696c 6520 3d20 6765 6e65 7261  ce_file = genera
+0000b800: 7465 5f66 696c 655f 7361 7328 0a20 2020  te_file_sas(.   
+0000b810: 2020 2020 2020 2020 2073 6f75 7263 655f           source_
+0000b820: 6669 6c65 5f63 6c69 656e 742e 6163 636f  file_client.acco
+0000b830: 756e 745f 6e61 6d65 2c0a 2020 2020 2020  unt_name,.      
+0000b840: 2020 2020 2020 736f 7572 6365 5f66 696c        source_fil
+0000b850: 655f 636c 6965 6e74 2e73 6861 7265 5f6e  e_client.share_n
+0000b860: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
+0000b870: 2073 6f75 7263 655f 6669 6c65 5f63 6c69   source_file_cli
+0000b880: 656e 742e 6669 6c65 5f70 6174 682c 0a20  ent.file_path,. 
+0000b890: 2020 2020 2020 2020 2020 2073 6f75 7263             sourc
+0000b8a0: 655f 6669 6c65 5f63 6c69 656e 742e 6372  e_file_client.cr
+0000b8b0: 6564 656e 7469 616c 2e61 6363 6f75 6e74  edential.account
+0000b8c0: 5f6b 6579 2c0a 2020 2020 2020 2020 2020  _key,.          
+0000b8d0: 2020 4669 6c65 5361 7350 6572 6d69 7373    FileSasPermiss
+0000b8e0: 696f 6e73 2872 6561 643d 5472 7565 292c  ions(read=True),
+0000b8f0: 0a20 2020 2020 2020 2020 2020 2065 7870  .            exp
+0000b900: 6972 793d 6461 7465 7469 6d65 2e75 7463  iry=datetime.utc
+0000b910: 6e6f 7728 2920 2b20 7469 6d65 6465 6c74  now() + timedelt
+0000b920: 6128 686f 7572 733d 3129 290a 0a20 2020  a(hours=1))..   
+0000b930: 2020 2020 2073 6f75 7263 655f 6669 6c65       source_file
+0000b940: 5f75 726c 203d 2073 6f75 7263 655f 6669  _url = source_fi
+0000b950: 6c65 5f63 6c69 656e 742e 7572 6c20 2b20  le_client.url + 
+0000b960: 273f 2720 2b20 7361 735f 746f 6b65 6e5f  '?' + sas_token_
+0000b970: 666f 725f 736f 7572 6365 5f66 696c 650a  for_source_file.
+0000b980: 0a20 2020 2020 2020 2023 2041 6374 0a20  .        # Act. 
+0000b990: 2020 2020 2020 2061 7761 6974 2064 6573         await des
+0000b9a0: 7469 6e61 7469 6f6e 5f66 696c 655f 636c  tination_file_cl
+0000b9b0: 6965 6e74 2e75 706c 6f61 645f 7261 6e67  ient.upload_rang
+0000b9c0: 655f 6672 6f6d 5f75 726c 2873 6f75 7263  e_from_url(sourc
+0000b9d0: 655f 6669 6c65 5f75 726c 2c20 6f66 6673  e_file_url, offs
+0000b9e0: 6574 3d30 2c20 6c65 6e67 7468 3d35 3132  et=0, length=512
+0000b9f0: 2c20 736f 7572 6365 5f6f 6666 7365 743d  , source_offset=
+0000ba00: 302c 0a20 2020 2020 2020 2020 2020 2020  0,.             
+0000ba10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ba20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ba30: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000ba40: 696c 655f 6c61 7374 5f77 7269 7465 5f6d  ile_last_write_m
+0000ba50: 6f64 653d 224e 6f77 2229 0a0a 2020 2020  ode="Now")..    
+0000ba60: 2020 2020 2320 4173 7365 7274 0a20 2020      # Assert.   
+0000ba70: 2020 2020 206e 6577 5f6c 6173 745f 7772       new_last_wr
+0000ba80: 6974 655f 7469 6d65 203d 2028 6177 6169  ite_time = (awai
+0000ba90: 7420 6465 7374 696e 6174 696f 6e5f 6669  t destination_fi
+0000baa0: 6c65 5f63 6c69 656e 742e 6765 745f 6669  le_client.get_fi
+0000bab0: 6c65 5f70 726f 7065 7274 6965 7328 2929  le_properties())
+0000bac0: 2e6c 6173 745f 7772 6974 655f 7469 6d65  .last_write_time
+0000bad0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+0000bae0: 7365 7274 4e6f 7445 7175 616c 2863 7572  sertNotEqual(cur
+0000baf0: 7265 6e74 5f6c 6173 745f 7772 6974 655f  rent_last_write_
+0000bb00: 7469 6d65 2c20 6e65 775f 6c61 7374 5f77  time, new_last_w
+0000bb10: 7269 7465 5f74 696d 6529 0a0a 2020 2020  rite_time)..    
+0000bb20: 4046 696c 6553 6861 7265 5072 6570 6172  @FileSharePrepar
+0000bb30: 6572 2829 0a20 2020 2040 4173 796e 6353  er().    @AsyncS
+0000bb40: 746f 7261 6765 5465 7374 4361 7365 2e61  torageTestCase.a
+0000bb50: 7761 6974 5f70 7265 7061 7265 645f 7465  wait_prepared_te
+0000bb60: 7374 0a20 2020 2061 7379 6e63 2064 6566  st.    async def
+0000bb70: 2074 6573 745f 7570 6461 7465 5f72 616e   test_update_ran
+0000bb80: 6765 5f66 726f 6d5f 6669 6c65 5f75 726c  ge_from_file_url
+0000bb90: 5f6c 6173 745f 7772 6974 7465 6e5f 6d6f  _last_written_mo
+0000bba0: 6465 5f70 7265 7365 7276 6528 7365 6c66  de_preserve(self
+0000bbb0: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
+0000bbc0: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
+0000bbd0: 6163 636f 756e 745f 6b65 7929 3a0a 2020  account_key):.  
+0000bbe0: 2020 2020 2020 7365 6c66 2e5f 7365 7475        self._setu
+0000bbf0: 7028 7374 6f72 6167 655f 6163 636f 756e  p(storage_accoun
+0000bc00: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
+0000bc10: 6163 636f 756e 745f 6b65 7929 0a20 2020  account_key).   
+0000bc20: 2020 2020 2073 6f75 7263 655f 6669 6c65       source_file
+0000bc30: 5f63 6c69 656e 7420 3d20 6177 6169 7420  _client = await 
+0000bc40: 7365 6c66 2e5f 6372 6561 7465 5f66 696c  self._create_fil
+0000bc50: 6528 7374 6f72 6167 655f 6163 636f 756e  e(storage_accoun
+0000bc60: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
+0000bc70: 6163 636f 756e 745f 6b65 792c 2066 696c  account_key, fil
+0000bc80: 655f 6e61 6d65 3d27 7465 7374 6669 6c65  e_name='testfile
+0000bc90: 2729 0a20 2020 2020 2020 2064 6174 6120  ').        data 
+0000bca0: 3d20 6227 6162 6364 6566 6768 696a 6b6c  = b'abcdefghijkl
+0000bcb0: 6d6e 6f70 2720 2a20 3332 0a20 2020 2020  mnop' * 32.     
+0000bcc0: 2020 2061 7761 6974 2073 6f75 7263 655f     await source_
+0000bcd0: 6669 6c65 5f63 6c69 656e 742e 7570 6c6f  file_client.uplo
+0000bce0: 6164 5f72 616e 6765 2864 6174 612c 206f  ad_range(data, o
+0000bcf0: 6666 7365 743d 302c 206c 656e 6774 683d  ffset=0, length=
+0000bd00: 3531 3229 0a0a 2020 2020 2020 2020 6465  512)..        de
+0000bd10: 7374 696e 6174 696f 6e5f 6669 6c65 5f63  stination_file_c
+0000bd20: 6c69 656e 7420 3d20 6177 6169 7420 7365  lient = await se
+0000bd30: 6c66 2e5f 6372 6561 7465 5f65 6d70 7479  lf._create_empty
+0000bd40: 5f66 696c 6528 0a20 2020 2020 2020 2020  _file(.         
+0000bd50: 2020 2073 746f 7261 6765 5f61 6363 6f75     storage_accou
+0000bd60: 6e74 5f6e 616d 652c 0a20 2020 2020 2020  nt_name,.       
+0000bd70: 2020 2020 2073 746f 7261 6765 5f61 6363       storage_acc
+0000bd80: 6f75 6e74 5f6b 6579 2c0a 2020 2020 2020  ount_key,.      
+0000bd90: 2020 2020 2020 6669 6c65 5f6e 616d 653d        file_name=
+0000bda0: 2766 696c 6574 6f75 7064 6174 6527 290a  'filetoupdate').
+0000bdb0: 2020 2020 2020 2020 6375 7272 656e 745f          current_
+0000bdc0: 6c61 7374 5f77 7269 7465 5f74 696d 6520  last_write_time 
+0000bdd0: 3d20 2861 7761 6974 2064 6573 7469 6e61  = (await destina
+0000bde0: 7469 6f6e 5f66 696c 655f 636c 6965 6e74  tion_file_client
+0000bdf0: 2e67 6574 5f66 696c 655f 7072 6f70 6572  .get_file_proper
+0000be00: 7469 6573 2829 292e 6c61 7374 5f77 7269  ties()).last_wri
+0000be10: 7465 5f74 696d 650a 0a20 2020 2020 2020  te_time..       
+0000be20: 2023 2067 656e 6572 6174 6520 5341 5320   # generate SAS 
+0000be30: 666f 7220 7468 6520 736f 7572 6365 2066  for the source f
+0000be40: 696c 650a 2020 2020 2020 2020 7361 735f  ile.        sas_
+0000be50: 746f 6b65 6e5f 666f 725f 736f 7572 6365  token_for_source
+0000be60: 5f66 696c 6520 3d20 6765 6e65 7261 7465  _file = generate
+0000be70: 5f66 696c 655f 7361 7328 0a20 2020 2020  _file_sas(.     
+0000be80: 2020 2020 2020 2073 6f75 7263 655f 6669         source_fi
+0000be90: 6c65 5f63 6c69 656e 742e 6163 636f 756e  le_client.accoun
+0000bea0: 745f 6e61 6d65 2c0a 2020 2020 2020 2020  t_name,.        
+0000beb0: 2020 2020 736f 7572 6365 5f66 696c 655f      source_file_
+0000bec0: 636c 6965 6e74 2e73 6861 7265 5f6e 616d  client.share_nam
+0000bed0: 652c 0a20 2020 2020 2020 2020 2020 2073  e,.            s
+0000bee0: 6f75 7263 655f 6669 6c65 5f63 6c69 656e  ource_file_clien
+0000bef0: 742e 6669 6c65 5f70 6174 682c 0a20 2020  t.file_path,.   
+0000bf00: 2020 2020 2020 2020 2073 6f75 7263 655f           source_
+0000bf10: 6669 6c65 5f63 6c69 656e 742e 6372 6564  file_client.cred
+0000bf20: 656e 7469 616c 2e61 6363 6f75 6e74 5f6b  ential.account_k
+0000bf30: 6579 2c0a 2020 2020 2020 2020 2020 2020  ey,.            
+0000bf40: 4669 6c65 5361 7350 6572 6d69 7373 696f  FileSasPermissio
+0000bf50: 6e73 2872 6561 643d 5472 7565 292c 0a20  ns(read=True),. 
+0000bf60: 2020 2020 2020 2020 2020 2065 7870 6972             expir
+0000bf70: 793d 6461 7465 7469 6d65 2e75 7463 6e6f  y=datetime.utcno
+0000bf80: 7728 2920 2b20 7469 6d65 6465 6c74 6128  w() + timedelta(
+0000bf90: 686f 7572 733d 3129 290a 0a20 2020 2020  hours=1))..     
+0000bfa0: 2020 2073 6f75 7263 655f 6669 6c65 5f75     source_file_u
+0000bfb0: 726c 203d 2073 6f75 7263 655f 6669 6c65  rl = source_file
+0000bfc0: 5f63 6c69 656e 742e 7572 6c20 2b20 273f  _client.url + '?
+0000bfd0: 2720 2b20 7361 735f 746f 6b65 6e5f 666f  ' + sas_token_fo
+0000bfe0: 725f 736f 7572 6365 5f66 696c 650a 0a20  r_source_file.. 
+0000bff0: 2020 2020 2020 2023 2041 6374 0a20 2020         # Act.   
+0000c000: 2020 2020 2061 7761 6974 2064 6573 7469       await desti
+0000c010: 6e61 7469 6f6e 5f66 696c 655f 636c 6965  nation_file_clie
+0000c020: 6e74 2e75 706c 6f61 645f 7261 6e67 655f  nt.upload_range_
+0000c030: 6672 6f6d 5f75 726c 2873 6f75 7263 655f  from_url(source_
+0000c040: 6669 6c65 5f75 726c 2c20 6f66 6673 6574  file_url, offset
+0000c050: 3d30 2c20 6c65 6e67 7468 3d35 3132 2c20  =0, length=512, 
+0000c060: 736f 7572 6365 5f6f 6666 7365 743d 302c  source_offset=0,
+0000c070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c0a0: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+0000c0b0: 655f 6c61 7374 5f77 7269 7465 5f6d 6f64  e_last_write_mod
+0000c0c0: 653d 2250 7265 7365 7276 6522 290a 0a20  e="Preserve").. 
+0000c0d0: 2020 2020 2020 2023 2041 7373 6572 740a         # Assert.
+0000c0e0: 2020 2020 2020 2020 6e65 775f 6c61 7374          new_last
+0000c0f0: 5f77 7269 7465 5f74 696d 6520 3d20 2861  _write_time = (a
+0000c100: 7761 6974 2064 6573 7469 6e61 7469 6f6e  wait destination
+0000c110: 5f66 696c 655f 636c 6965 6e74 2e67 6574  _file_client.get
+0000c120: 5f66 696c 655f 7072 6f70 6572 7469 6573  _file_properties
+0000c130: 2829 292e 6c61 7374 5f77 7269 7465 5f74  ()).last_write_t
+0000c140: 696d 650a 2020 2020 2020 2020 7365 6c66  ime.        self
+0000c150: 2e61 7373 6572 7445 7175 616c 2863 7572  .assertEqual(cur
+0000c160: 7265 6e74 5f6c 6173 745f 7772 6974 655f  rent_last_write_
+0000c170: 7469 6d65 2c20 6e65 775f 6c61 7374 5f77  time, new_last_w
+0000c180: 7269 7465 5f74 696d 6529 0a0a 2020 2020  rite_time)..    
+0000c190: 4046 696c 6553 6861 7265 5072 6570 6172  @FileSharePrepar
+0000c1a0: 6572 2829 0a20 2020 2040 4173 796e 6353  er().    @AsyncS
+0000c1b0: 746f 7261 6765 5465 7374 4361 7365 2e61  torageTestCase.a
+0000c1c0: 7761 6974 5f70 7265 7061 7265 645f 7465  wait_prepared_te
+0000c1d0: 7374 0a20 2020 2061 7379 6e63 2064 6566  st.    async def
+0000c1e0: 2074 6573 745f 636c 6561 725f 7261 6e67   test_clear_rang
+0000c1f0: 655f 6173 796e 6328 7365 6c66 2c20 7374  e_async(self, st
+0000c200: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
+0000c210: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
+0000c220: 756e 745f 6b65 7929 3a0a 2020 2020 2020  unt_key):.      
+0000c230: 2020 7365 6c66 2e5f 7365 7475 7028 7374    self._setup(st
+0000c240: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
+0000c250: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
+0000c260: 756e 745f 6b65 7929 0a20 2020 2020 2020  unt_key).       
+0000c270: 2066 696c 655f 636c 6965 6e74 203d 2061   file_client = a
+0000c280: 7761 6974 2073 656c 662e 5f63 7265 6174  wait self._creat
+0000c290: 655f 6669 6c65 2873 746f 7261 6765 5f61  e_file(storage_a
+0000c2a0: 6363 6f75 6e74 5f6e 616d 652c 2073 746f  ccount_name, sto
+0000c2b0: 7261 6765 5f61 6363 6f75 6e74 5f6b 6579  rage_account_key
+0000c2c0: 290a 0a20 2020 2020 2020 2023 2041 6374  )..        # Act
+0000c2d0: 0a20 2020 2020 2020 2072 6573 7020 3d20  .        resp = 
+0000c2e0: 6177 6169 7420 6669 6c65 5f63 6c69 656e  await file_clien
+0000c2f0: 742e 636c 6561 725f 7261 6e67 6528 6f66  t.clear_range(of
+0000c300: 6673 6574 3d30 2c20 6c65 6e67 7468 3d35  fset=0, length=5
+0000c310: 3132 290a 0a20 2020 2020 2020 2023 2041  12)..        # A
+0000c320: 7373 6572 740a 2020 2020 2020 2020 636f  ssert.        co
+0000c330: 6e74 656e 7420 3d20 6177 6169 7420 6669  ntent = await fi
+0000c340: 6c65 5f63 6c69 656e 742e 646f 776e 6c6f  le_client.downlo
+0000c350: 6164 5f66 696c 6528 290a 2020 2020 2020  ad_file().      
+0000c360: 2020 636f 6e74 656e 7420 3d20 6177 6169    content = awai
+0000c370: 7420 636f 6e74 656e 742e 7265 6164 616c  t content.readal
+0000c380: 6c28 290a 2020 2020 2020 2020 7365 6c66  l().        self
+0000c390: 2e61 7373 6572 7445 7175 616c 2862 275c  .assertEqual(b'\
+0000c3a0: 7830 3027 202a 2035 3132 2c20 636f 6e74  x00' * 512, cont
+0000c3b0: 656e 745b 3a35 3132 5d29 0a20 2020 2020  ent[:512]).     
+0000c3c0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+0000c3d0: 7561 6c28 7365 6c66 2e73 686f 7274 5f62  ual(self.short_b
+0000c3e0: 7974 655f 6461 7461 5b35 3132 3a5d 2c20  yte_data[512:], 
+0000c3f0: 636f 6e74 656e 745b 3531 323a 5d29 0a0a  content[512:])..
+0000c400: 2020 2020 4046 696c 6553 6861 7265 5072      @FileSharePr
+0000c410: 6570 6172 6572 2829 0a20 2020 2040 4173  eparer().    @As
+0000c420: 796e 6353 746f 7261 6765 5465 7374 4361  yncStorageTestCa
+0000c430: 7365 2e61 7761 6974 5f70 7265 7061 7265  se.await_prepare
+0000c440: 645f 7465 7374 0a20 2020 2061 7379 6e63  d_test.    async
+0000c450: 2064 6566 2074 6573 745f 7570 6461 7465   def test_update
+0000c460: 5f66 696c 655f 756e 6963 6f64 655f 6173  _file_unicode_as
+0000c470: 796e 6328 7365 6c66 2c20 7374 6f72 6167  ync(self, storag
+0000c480: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
+0000c490: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
+0000c4a0: 6b65 7929 3a0a 2020 2020 2020 2020 7365  key):.        se
+0000c4b0: 6c66 2e5f 7365 7475 7028 7374 6f72 6167  lf._setup(storag
+0000c4c0: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
+0000c4d0: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
+0000c4e0: 6b65 7929 0a20 2020 2020 2020 2066 696c  key).        fil
+0000c4f0: 655f 636c 6965 6e74 203d 2061 7761 6974  e_client = await
+0000c500: 2073 656c 662e 5f63 7265 6174 655f 6669   self._create_fi
+0000c510: 6c65 2873 746f 7261 6765 5f61 6363 6f75  le(storage_accou
+0000c520: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
+0000c530: 5f61 6363 6f75 6e74 5f6b 6579 290a 0a20  _account_key).. 
+0000c540: 2020 2020 2020 2023 2041 6374 0a20 2020         # Act.   
+0000c550: 2020 2020 2064 6174 6120 3d20 7527 6162       data = u'ab
+0000c560: 6364 6566 6768 696a 6b6c 6d6e 6f70 2720  cdefghijklmnop' 
+0000c570: 2a20 3332 0a20 2020 2020 2020 2061 7761  * 32.        awa
+0000c580: 6974 2066 696c 655f 636c 6965 6e74 2e75  it file_client.u
+0000c590: 706c 6f61 645f 7261 6e67 6528 6461 7461  pload_range(data
+0000c5a0: 2c20 6f66 6673 6574 3d30 2c20 6c65 6e67  , offset=0, leng
+0000c5b0: 7468 3d35 3132 290a 0a20 2020 2020 2020  th=512)..       
+0000c5c0: 2065 6e63 6f64 6564 203d 2064 6174 612e   encoded = data.
+0000c5d0: 656e 636f 6465 2827 7574 662d 3827 290a  encode('utf-8').
+0000c5e0: 0a20 2020 2020 2020 2023 2041 7373 6572  .        # Asser
+0000c5f0: 740a 2020 2020 2020 2020 636f 6e74 656e  t.        conten
+0000c600: 7420 3d20 6177 6169 7420 6669 6c65 5f63  t = await file_c
+0000c610: 6c69 656e 742e 646f 776e 6c6f 6164 5f66  lient.download_f
+0000c620: 696c 6528 290a 2020 2020 2020 2020 636f  ile().        co
+0000c630: 6e74 656e 7420 3d20 6177 6169 7420 636f  ntent = await co
+0000c640: 6e74 656e 742e 7265 6164 616c 6c28 290a  ntent.readall().
+0000c650: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000c660: 6572 7445 7175 616c 2865 6e63 6f64 6564  ertEqual(encoded
+0000c670: 2c20 636f 6e74 656e 745b 3a35 3132 5d29  , content[:512])
+0000c680: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+0000c690: 7365 7274 4571 7561 6c28 7365 6c66 2e73  sertEqual(self.s
+0000c6a0: 686f 7274 5f62 7974 655f 6461 7461 5b35  hort_byte_data[5
+0000c6b0: 3132 3a5d 2c20 636f 6e74 656e 745b 3531  12:], content[51
+0000c6c0: 323a 5d29 0a0a 2020 2020 2020 2020 2320  2:])..        # 
+0000c6d0: 4173 7365 7274 0a0a 2020 2020 4046 696c  Assert..    @Fil
+0000c6e0: 6553 6861 7265 5072 6570 6172 6572 2829  eSharePreparer()
+0000c6f0: 0a20 2020 2040 4173 796e 6353 746f 7261  .    @AsyncStora
+0000c700: 6765 5465 7374 4361 7365 2e61 7761 6974  geTestCase.await
+0000c710: 5f70 7265 7061 7265 645f 7465 7374 0a20  _prepared_test. 
+0000c720: 2020 2061 7379 6e63 2064 6566 2074 6573     async def tes
+0000c730: 745f 6c69 7374 5f72 616e 6765 735f 6e6f  t_list_ranges_no
+0000c740: 6e65 5f61 7379 6e63 2873 656c 662c 2073  ne_async(self, s
+0000c750: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
+0000c760: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
+0000c770: 6f75 6e74 5f6b 6579 293a 0a20 2020 2020  ount_key):.     
+0000c780: 2020 2073 656c 662e 5f73 6574 7570 2873     self._setup(s
+0000c790: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
+0000c7a0: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
+0000c7b0: 6f75 6e74 5f6b 6579 290a 2020 2020 2020  ount_key).      
+0000c7c0: 2020 6669 6c65 5f6e 616d 6520 3d20 7365    file_name = se
+0000c7d0: 6c66 2e5f 6765 745f 6669 6c65 5f72 6566  lf._get_file_ref
+0000c7e0: 6572 656e 6365 2829 0a20 2020 2020 2020  erence().       
+0000c7f0: 2061 7761 6974 2073 656c 662e 5f73 6574   await self._set
+0000c800: 7570 5f73 6861 7265 2873 746f 7261 6765  up_share(storage
+0000c810: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
+0000c820: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
+0000c830: 6579 290a 2020 2020 2020 2020 6669 6c65  ey).        file
+0000c840: 5f63 6c69 656e 7420 3d20 5368 6172 6546  _client = ShareF
+0000c850: 696c 6543 6c69 656e 7428 0a20 2020 2020  ileClient(.     
+0000c860: 2020 2020 2020 2073 656c 662e 6163 636f         self.acco
+0000c870: 756e 745f 7572 6c28 7374 6f72 6167 655f  unt_url(storage_
+0000c880: 6163 636f 756e 745f 6e61 6d65 2c20 2266  account_name, "f
+0000c890: 696c 6522 292c 0a20 2020 2020 2020 2020  ile"),.         
+0000c8a0: 2020 2073 6861 7265 5f6e 616d 653d 7365     share_name=se
+0000c8b0: 6c66 2e73 6861 7265 5f6e 616d 652c 0a20  lf.share_name,. 
+0000c8c0: 2020 2020 2020 2020 2020 2066 696c 655f             file_
+0000c8d0: 7061 7468 3d66 696c 655f 6e61 6d65 2c0a  path=file_name,.
+0000c8e0: 2020 2020 2020 2020 2020 2020 6372 6564              cred
+0000c8f0: 656e 7469 616c 3d73 746f 7261 6765 5f61  ential=storage_a
+0000c900: 6363 6f75 6e74 5f6b 6579 2c0a 2020 2020  ccount_key,.    
+0000c910: 2020 2020 2020 2020 7472 616e 7370 6f72          transpor
+0000c920: 743d 4169 6f68 7474 7054 6573 7454 7261  t=AiohttpTestTra
+0000c930: 6e73 706f 7274 2829 290a 2020 2020 2020  nsport()).      
+0000c940: 2020 6177 6169 7420 6669 6c65 5f63 6c69    await file_cli
+0000c950: 656e 742e 6372 6561 7465 5f66 696c 6528  ent.create_file(
+0000c960: 3130 3234 290a 0a20 2020 2020 2020 2023  1024)..        #
+0000c970: 2041 6374 0a20 2020 2020 2020 2072 616e   Act.        ran
+0000c980: 6765 7320 3d20 6177 6169 7420 6669 6c65  ges = await file
+0000c990: 5f63 6c69 656e 742e 6765 745f 7261 6e67  _client.get_rang
+0000c9a0: 6573 2829 0a0a 2020 2020 2020 2020 2320  es()..        # 
+0000c9b0: 4173 7365 7274 0a20 2020 2020 2020 2073  Assert.        s
+0000c9c0: 656c 662e 6173 7365 7274 4973 4e6f 744e  elf.assertIsNotN
+0000c9d0: 6f6e 6528 7261 6e67 6573 290a 2020 2020  one(ranges).    
+0000c9e0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0000c9f0: 7175 616c 286c 656e 2872 616e 6765 7329  qual(len(ranges)
+0000ca00: 2c20 3029 0a0a 2020 2020 4046 696c 6553  , 0)..    @FileS
+0000ca10: 6861 7265 5072 6570 6172 6572 2829 0a20  harePreparer(). 
+0000ca20: 2020 2040 4173 796e 6353 746f 7261 6765     @AsyncStorage
+0000ca30: 5465 7374 4361 7365 2e61 7761 6974 5f70  TestCase.await_p
+0000ca40: 7265 7061 7265 645f 7465 7374 0a20 2020  repared_test.   
+0000ca50: 2061 7379 6e63 2064 6566 2074 6573 745f   async def test_
+0000ca60: 6c69 7374 5f72 616e 6765 735f 6e6f 6e65  list_ranges_none
+0000ca70: 5f77 6974 685f 696e 7661 6c69 645f 6c65  _with_invalid_le
+0000ca80: 6173 655f 6661 696c 735f 6173 796e 6328  ase_fails_async(
+0000ca90: 7365 6c66 2c20 7374 6f72 6167 655f 6163  self, storage_ac
+0000caa0: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
+0000cab0: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
+0000cac0: 3a0a 2020 2020 2020 2020 7365 6c66 2e5f  :.        self._
+0000cad0: 7365 7475 7028 7374 6f72 6167 655f 6163  setup(storage_ac
+0000cae0: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
+0000caf0: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
+0000cb00: 0a20 2020 2020 2020 2066 696c 655f 6e61  .        file_na
+0000cb10: 6d65 203d 2073 656c 662e 5f67 6574 5f66  me = self._get_f
+0000cb20: 696c 655f 7265 6665 7265 6e63 6528 290a  ile_reference().
+0000cb30: 2020 2020 2020 2020 6177 6169 7420 7365          await se
+0000cb40: 6c66 2e5f 7365 7475 705f 7368 6172 6528  lf._setup_share(
+0000cb50: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
+0000cb60: 6e61 6d65 2c20 7374 6f72 6167 655f 6163  name, storage_ac
+0000cb70: 636f 756e 745f 6b65 7929 0a20 2020 2020  count_key).     
+0000cb80: 2020 2066 696c 655f 636c 6965 6e74 203d     file_client =
+0000cb90: 2053 6861 7265 4669 6c65 436c 6965 6e74   ShareFileClient
+0000cba0: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
+0000cbb0: 6c66 2e61 6363 6f75 6e74 5f75 726c 2873  lf.account_url(s
+0000cbc0: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
+0000cbd0: 616d 652c 2022 6669 6c65 2229 2c0a 2020  ame, "file"),.  
+0000cbe0: 2020 2020 2020 2020 2020 7368 6172 655f            share_
+0000cbf0: 6e61 6d65 3d73 656c 662e 7368 6172 655f  name=self.share_
+0000cc00: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
+0000cc10: 2020 6669 6c65 5f70 6174 683d 6669 6c65    file_path=file
+0000cc20: 5f6e 616d 652c 0a20 2020 2020 2020 2020  _name,.         
+0000cc30: 2020 2063 7265 6465 6e74 6961 6c3d 7374     credential=st
+0000cc40: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
+0000cc50: 792c 0a20 2020 2020 2020 2020 2020 2074  y,.            t
+0000cc60: 7261 6e73 706f 7274 3d41 696f 6874 7470  ransport=Aiohttp
+0000cc70: 5465 7374 5472 616e 7370 6f72 7428 2929  TestTransport())
+0000cc80: 0a20 2020 2020 2020 2061 7761 6974 2066  .        await f
+0000cc90: 696c 655f 636c 6965 6e74 2e63 7265 6174  ile_client.creat
+0000cca0: 655f 6669 6c65 2831 3032 3429 0a20 2020  e_file(1024).   
+0000ccb0: 2020 2020 2061 7761 6974 2066 696c 655f       await file_
+0000ccc0: 636c 6965 6e74 2e61 6371 7569 7265 5f6c  client.acquire_l
+0000ccd0: 6561 7365 2829 0a0a 2020 2020 2020 2020  ease()..        
+0000cce0: 2320 4163 740a 2020 2020 2020 2020 7769  # Act.        wi
+0000ccf0: 7468 2073 656c 662e 6173 7365 7274 5261  th self.assertRa
+0000cd00: 6973 6573 2848 7474 7052 6573 706f 6e73  ises(HttpRespons
+0000cd10: 6545 7272 6f72 293a 0a20 2020 2020 2020  eError):.       
+0000cd20: 2020 2020 2061 7761 6974 2066 696c 655f       await file_
+0000cd30: 636c 6965 6e74 2e67 6574 5f72 616e 6765  client.get_range
+0000cd40: 7328 6c65 6173 653d 7374 7228 7575 6964  s(lease=str(uuid
+0000cd50: 2e75 7569 6434 2829 2929 0a0a 2020 2020  .uuid4()))..    
+0000cd60: 2020 2020 2320 4765 7420 7261 6e67 6573      # Get ranges
+0000cd70: 206f 6e20 6120 6c65 6173 6564 2066 696c   on a leased fil
+0000cd80: 6520 7769 6c6c 2073 7563 6365 6564 2077  e will succeed w
+0000cd90: 6974 686f 7574 2070 726f 7669 6465 2074  ithout provide t
+0000cda0: 6865 206c 6561 7365 0a20 2020 2020 2020  he lease.       
+0000cdb0: 2072 616e 6765 7320 3d20 6177 6169 7420   ranges = await 
+0000cdc0: 6669 6c65 5f63 6c69 656e 742e 6765 745f  file_client.get_
+0000cdd0: 7261 6e67 6573 2829 0a0a 2020 2020 2020  ranges()..      
+0000cde0: 2020 2320 4173 7365 7274 0a20 2020 2020    # Assert.     
+0000cdf0: 2020 2073 656c 662e 6173 7365 7274 4973     self.assertIs
+0000ce00: 4e6f 744e 6f6e 6528 7261 6e67 6573 290a  NotNone(ranges).
+0000ce10: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000ce20: 6572 7445 7175 616c 286c 656e 2872 616e  ertEqual(len(ran
+0000ce30: 6765 7329 2c20 3029 0a0a 2020 2020 4070  ges), 0)..    @p
+0000ce40: 7974 6573 742e 6d61 726b 2e70 6c61 7962  ytest.mark.playb
+0000ce50: 6163 6b5f 7465 7374 5f6f 6e6c 790a 2020  ack_test_only.  
+0000ce60: 2020 4046 696c 6553 6861 7265 5072 6570    @FileSharePrep
+0000ce70: 6172 6572 2829 0a20 2020 2040 4173 796e  arer().    @Asyn
+0000ce80: 6353 746f 7261 6765 5465 7374 4361 7365  cStorageTestCase
+0000ce90: 2e61 7761 6974 5f70 7265 7061 7265 645f  .await_prepared_
+0000cea0: 7465 7374 0a20 2020 2061 7379 6e63 2064  test.    async d
+0000ceb0: 6566 2074 6573 745f 6c69 7374 5f72 616e  ef test_list_ran
+0000cec0: 6765 735f 6469 6666 2873 656c 662c 2073  ges_diff(self, s
+0000ced0: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
+0000cee0: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
+0000cef0: 6f75 6e74 5f6b 6579 293a 0a20 2020 2020  ount_key):.     
+0000cf00: 2020 2073 656c 662e 5f73 6574 7570 2873     self._setup(s
+0000cf10: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
+0000cf20: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
+0000cf30: 6f75 6e74 5f6b 6579 290a 2020 2020 2020  ount_key).      
+0000cf40: 2020 6669 6c65 5f6e 616d 6520 3d20 7365    file_name = se
+0000cf50: 6c66 2e5f 6765 745f 6669 6c65 5f72 6566  lf._get_file_ref
+0000cf60: 6572 656e 6365 2829 0a20 2020 2020 2020  erence().       
+0000cf70: 2061 7761 6974 2073 656c 662e 5f73 6574   await self._set
+0000cf80: 7570 5f73 6861 7265 2873 746f 7261 6765  up_share(storage
+0000cf90: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
+0000cfa0: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
+0000cfb0: 6579 290a 2020 2020 2020 2020 6669 6c65  ey).        file
+0000cfc0: 5f63 6c69 656e 7420 3d20 5368 6172 6546  _client = ShareF
+0000cfd0: 696c 6543 6c69 656e 7428 0a20 2020 2020  ileClient(.     
+0000cfe0: 2020 2020 2020 2073 656c 662e 6163 636f         self.acco
+0000cff0: 756e 745f 7572 6c28 7374 6f72 6167 655f  unt_url(storage_
+0000d000: 6163 636f 756e 745f 6e61 6d65 2c20 2266  account_name, "f
+0000d010: 696c 6522 292c 0a20 2020 2020 2020 2020  ile"),.         
+0000d020: 2020 2073 6861 7265 5f6e 616d 653d 7365     share_name=se
+0000d030: 6c66 2e73 6861 7265 5f6e 616d 652c 0a20  lf.share_name,. 
+0000d040: 2020 2020 2020 2020 2020 2066 696c 655f             file_
+0000d050: 7061 7468 3d66 696c 655f 6e61 6d65 2c0a  path=file_name,.
+0000d060: 2020 2020 2020 2020 2020 2020 6372 6564              cred
+0000d070: 656e 7469 616c 3d73 746f 7261 6765 5f61  ential=storage_a
+0000d080: 6363 6f75 6e74 5f6b 6579 290a 0a20 2020  ccount_key)..   
+0000d090: 2020 2020 2061 7761 6974 2066 696c 655f       await file_
+0000d0a0: 636c 6965 6e74 2e63 7265 6174 655f 6669  client.create_fi
+0000d0b0: 6c65 2832 3034 3829 0a20 2020 2020 2020  le(2048).       
+0000d0c0: 2073 6861 7265 5f63 6c69 656e 7420 3d20   share_client = 
+0000d0d0: 7365 6c66 2e66 7363 2e67 6574 5f73 6861  self.fsc.get_sha
+0000d0e0: 7265 5f63 6c69 656e 7428 7365 6c66 2e73  re_client(self.s
+0000d0f0: 6861 7265 5f6e 616d 6529 0a20 2020 2020  hare_name).     
+0000d100: 2020 2073 6e61 7073 686f 7431 203d 2061     snapshot1 = a
+0000d110: 7761 6974 2073 6861 7265 5f63 6c69 656e  wait share_clien
+0000d120: 742e 6372 6561 7465 5f73 6e61 7073 686f  t.create_snapsho
+0000d130: 7428 290a 0a20 2020 2020 2020 2064 6174  t()..        dat
+0000d140: 6120 3d20 7365 6c66 2e67 6574 5f72 616e  a = self.get_ran
+0000d150: 646f 6d5f 6279 7465 7328 3135 3336 290a  dom_bytes(1536).
+0000d160: 2020 2020 2020 2020 6177 6169 7420 6669          await fi
+0000d170: 6c65 5f63 6c69 656e 742e 7570 6c6f 6164  le_client.upload
+0000d180: 5f72 616e 6765 2864 6174 612c 206f 6666  _range(data, off
+0000d190: 7365 743d 302c 206c 656e 6774 683d 3135  set=0, length=15
+0000d1a0: 3336 290a 2020 2020 2020 2020 736e 6170  36).        snap
+0000d1b0: 7368 6f74 3220 3d20 6177 6169 7420 7368  shot2 = await sh
+0000d1c0: 6172 655f 636c 6965 6e74 2e63 7265 6174  are_client.creat
+0000d1d0: 655f 736e 6170 7368 6f74 2829 0a20 2020  e_snapshot().   
+0000d1e0: 2020 2020 2061 7761 6974 2066 696c 655f       await file_
+0000d1f0: 636c 6965 6e74 2e63 6c65 6172 5f72 616e  client.clear_ran
+0000d200: 6765 286f 6666 7365 743d 3531 322c 206c  ge(offset=512, l
+0000d210: 656e 6774 683d 3531 3229 0a0a 2020 2020  ength=512)..    
+0000d220: 2020 2020 7261 6e67 6573 312c 2063 6c65      ranges1, cle
+0000d230: 6172 6564 3120 3d20 6177 6169 7420 6669  ared1 = await fi
+0000d240: 6c65 5f63 6c69 656e 742e 6765 745f 7261  le_client.get_ra
+0000d250: 6e67 6573 5f64 6966 6628 7072 6576 696f  nges_diff(previo
+0000d260: 7573 5f73 6861 7265 736e 6170 7368 6f74  us_sharesnapshot
+0000d270: 3d73 6e61 7073 686f 7431 290a 2020 2020  =snapshot1).    
+0000d280: 2020 2020 7261 6e67 6573 322c 2063 6c65      ranges2, cle
+0000d290: 6172 6564 3220 3d20 6177 6169 7420 6669  ared2 = await fi
+0000d2a0: 6c65 5f63 6c69 656e 742e 6765 745f 7261  le_client.get_ra
+0000d2b0: 6e67 6573 5f64 6966 6628 7072 6576 696f  nges_diff(previo
+0000d2c0: 7573 5f73 6861 7265 736e 6170 7368 6f74  us_sharesnapshot
+0000d2d0: 3d73 6e61 7073 686f 7432 5b27 736e 6170  =snapshot2['snap
+0000d2e0: 7368 6f74 275d 290a 0a20 2020 2020 2020  shot'])..       
+0000d2f0: 2023 2041 7373 6572 740a 2020 2020 2020   # Assert.      
+0000d300: 2020 7365 6c66 2e61 7373 6572 7449 734e    self.assertIsN
+0000d310: 6f74 4e6f 6e65 2872 616e 6765 7331 290a  otNone(ranges1).
+0000d320: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000d330: 6572 7449 7349 6e73 7461 6e63 6528 7261  ertIsInstance(ra
+0000d340: 6e67 6573 312c 206c 6973 7429 0a20 2020  nges1, list).   
+0000d350: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0000d360: 4571 7561 6c28 6c65 6e28 7261 6e67 6573  Equal(len(ranges
+0000d370: 3129 2c20 3229 0a20 2020 2020 2020 2073  1), 2).        s
+0000d380: 656c 662e 6173 7365 7274 4973 496e 7374  elf.assertIsInst
+0000d390: 616e 6365 2863 6c65 6172 6564 312c 206c  ance(cleared1, l
+0000d3a0: 6973 7429 0a20 2020 2020 2020 2073 656c  ist).        sel
+0000d3b0: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
+0000d3c0: 6e28 636c 6561 7265 6431 292c 2031 290a  n(cleared1), 1).
+0000d3d0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000d3e0: 6572 7445 7175 616c 2872 616e 6765 7331  ertEqual(ranges1
+0000d3f0: 5b30 5d5b 2773 7461 7274 275d 2c20 3029  [0]['start'], 0)
+0000d400: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+0000d410: 7365 7274 4571 7561 6c28 7261 6e67 6573  sertEqual(ranges
+0000d420: 315b 305d 5b27 656e 6427 5d2c 2035 3131  1[0]['end'], 511
+0000d430: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0000d440: 7373 6572 7445 7175 616c 2863 6c65 6172  ssertEqual(clear
+0000d450: 6564 315b 305d 5b27 7374 6172 7427 5d2c  ed1[0]['start'],
+0000d460: 2035 3132 290a 2020 2020 2020 2020 7365   512).        se
+0000d470: 6c66 2e61 7373 6572 7445 7175 616c 2863  lf.assertEqual(c
+0000d480: 6c65 6172 6564 315b 305d 5b27 656e 6427  leared1[0]['end'
+0000d490: 5d2c 2031 3032 3329 0a20 2020 2020 2020  ], 1023).       
+0000d4a0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+0000d4b0: 6c28 7261 6e67 6573 315b 315d 5b27 7374  l(ranges1[1]['st
+0000d4c0: 6172 7427 5d2c 2031 3032 3429 0a20 2020  art'], 1024).   
+0000d4d0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0000d4e0: 4571 7561 6c28 7261 6e67 6573 315b 315d  Equal(ranges1[1]
+0000d4f0: 5b27 656e 6427 5d2c 2031 3533 3529 0a0a  ['end'], 1535)..
+0000d500: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000d510: 6572 7449 734e 6f74 4e6f 6e65 2872 616e  ertIsNotNone(ran
+0000d520: 6765 7332 290a 2020 2020 2020 2020 7365  ges2).        se
+0000d530: 6c66 2e61 7373 6572 7449 7349 6e73 7461  lf.assertIsInsta
+0000d540: 6e63 6528 7261 6e67 6573 322c 206c 6973  nce(ranges2, lis
+0000d550: 7429 0a20 2020 2020 2020 2073 656c 662e  t).        self.
+0000d560: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
+0000d570: 7261 6e67 6573 3229 2c20 3029 0a20 2020  ranges2), 0).   
+0000d580: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0000d590: 4973 496e 7374 616e 6365 2863 6c65 6172  IsInstance(clear
+0000d5a0: 6564 322c 206c 6973 7429 0a20 2020 2020  ed2, list).     
+0000d5b0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+0000d5c0: 7561 6c28 6c65 6e28 636c 6561 7265 6432  ual(len(cleared2
+0000d5d0: 292c 2031 290a 2020 2020 2020 2020 7365  ), 1).        se
+0000d5e0: 6c66 2e61 7373 6572 7445 7175 616c 2863  lf.assertEqual(c
+0000d5f0: 6c65 6172 6564 325b 305d 5b27 7374 6172  leared2[0]['star
+0000d600: 7427 5d2c 2035 3132 290a 2020 2020 2020  t'], 512).      
+0000d610: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0000d620: 616c 2863 6c65 6172 6564 325b 305d 5b27  al(cleared2[0]['
+0000d630: 656e 6427 5d2c 2031 3032 3329 0a0a 2020  end'], 1023)..  
+0000d640: 2020 4046 696c 6553 6861 7265 5072 6570    @FileSharePrep
+0000d650: 6172 6572 2829 0a20 2020 2040 4173 796e  arer().    @Asyn
+0000d660: 6353 746f 7261 6765 5465 7374 4361 7365  cStorageTestCase
+0000d670: 2e61 7761 6974 5f70 7265 7061 7265 645f  .await_prepared_
+0000d680: 7465 7374 0a20 2020 2061 7379 6e63 2064  test.    async d
+0000d690: 6566 2074 6573 745f 6c69 7374 5f72 616e  ef test_list_ran
+0000d6a0: 6765 735f 325f 6173 796e 6328 7365 6c66  ges_2_async(self
+0000d6b0: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
+0000d6c0: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
+0000d6d0: 6163 636f 756e 745f 6b65 7929 3a0a 2020  account_key):.  
+0000d6e0: 2020 2020 2020 7365 6c66 2e5f 7365 7475        self._setu
+0000d6f0: 7028 7374 6f72 6167 655f 6163 636f 756e  p(storage_accoun
+0000d700: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
+0000d710: 6163 636f 756e 745f 6b65 7929 0a20 2020  account_key).   
+0000d720: 2020 2020 2066 696c 655f 6e61 6d65 203d       file_name =
+0000d730: 2073 656c 662e 5f67 6574 5f66 696c 655f   self._get_file_
+0000d740: 7265 6665 7265 6e63 6528 290a 2020 2020  reference().    
+0000d750: 2020 2020 6177 6169 7420 7365 6c66 2e5f      await self._
+0000d760: 7365 7475 705f 7368 6172 6528 7374 6f72  setup_share(stor
+0000d770: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
+0000d780: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
+0000d790: 745f 6b65 7929 0a20 2020 2020 2020 2066  t_key).        f
+0000d7a0: 696c 655f 636c 6965 6e74 203d 2053 6861  ile_client = Sha
+0000d7b0: 7265 4669 6c65 436c 6965 6e74 280a 2020  reFileClient(.  
+0000d7c0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+0000d7d0: 6363 6f75 6e74 5f75 726c 2873 746f 7261  ccount_url(stora
+0000d7e0: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
+0000d7f0: 2022 6669 6c65 2229 2c0a 2020 2020 2020   "file"),.      
+0000d800: 2020 2020 2020 7368 6172 655f 6e61 6d65        share_name
+0000d810: 3d73 656c 662e 7368 6172 655f 6e61 6d65  =self.share_name
+0000d820: 2c0a 2020 2020 2020 2020 2020 2020 6669  ,.            fi
+0000d830: 6c65 5f70 6174 683d 6669 6c65 5f6e 616d  le_path=file_nam
+0000d840: 652c 0a20 2020 2020 2020 2020 2020 2063  e,.            c
+0000d850: 7265 6465 6e74 6961 6c3d 7374 6f72 6167  redential=storag
+0000d860: 655f 6163 636f 756e 745f 6b65 792c 0a20  e_account_key,. 
+0000d870: 2020 2020 2020 2020 2020 2074 7261 6e73             trans
+0000d880: 706f 7274 3d41 696f 6874 7470 5465 7374  port=AiohttpTest
+0000d890: 5472 616e 7370 6f72 7428 2929 0a20 2020  Transport()).   
+0000d8a0: 2020 2020 2061 7761 6974 2066 696c 655f       await file_
+0000d8b0: 636c 6965 6e74 2e63 7265 6174 655f 6669  client.create_fi
+0000d8c0: 6c65 2832 3034 3829 0a0a 2020 2020 2020  le(2048)..      
+0000d8d0: 2020 6461 7461 203d 2062 2761 6263 6465    data = b'abcde
+0000d8e0: 6667 6869 6a6b 6c6d 6e6f 7027 202a 2033  fghijklmnop' * 3
+0000d8f0: 320a 2020 2020 2020 2020 7265 7370 3120  2.        resp1 
+0000d900: 3d20 6177 6169 7420 6669 6c65 5f63 6c69  = await file_cli
+0000d910: 656e 742e 7570 6c6f 6164 5f72 616e 6765  ent.upload_range
+0000d920: 2864 6174 612c 206f 6666 7365 743d 302c  (data, offset=0,
+0000d930: 206c 656e 6774 683d 3531 3229 0a20 2020   length=512).   
+0000d940: 2020 2020 2072 6573 7032 203d 2061 7761       resp2 = awa
+0000d950: 6974 2066 696c 655f 636c 6965 6e74 2e75  it file_client.u
+0000d960: 706c 6f61 645f 7261 6e67 6528 6461 7461  pload_range(data
+0000d970: 2c20 6f66 6673 6574 3d31 3032 342c 206c  , offset=1024, l
+0000d980: 656e 6774 683d 3531 3229 0a0a 2020 2020  ength=512)..    
+0000d990: 2020 2020 2320 4163 740a 2020 2020 2020      # Act.      
+0000d9a0: 2020 7261 6e67 6573 203d 2061 7761 6974    ranges = await
+0000d9b0: 2066 696c 655f 636c 6965 6e74 2e67 6574   file_client.get
+0000d9c0: 5f72 616e 6765 7328 290a 0a20 2020 2020  _ranges()..     
+0000d9d0: 2020 2023 2041 7373 6572 740a 2020 2020     # Assert.    
+0000d9e0: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
+0000d9f0: 734e 6f74 4e6f 6e65 2872 616e 6765 7329  sNotNone(ranges)
+0000da00: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+0000da10: 7365 7274 4571 7561 6c28 6c65 6e28 7261  sertEqual(len(ra
+0000da20: 6e67 6573 292c 2032 290a 2020 2020 2020  nges), 2).      
+0000da30: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0000da40: 616c 2872 616e 6765 735b 305d 5b27 7374  al(ranges[0]['st
+0000da50: 6172 7427 5d2c 2030 290a 2020 2020 2020  art'], 0).      
+0000da60: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0000da70: 616c 2872 616e 6765 735b 305d 5b27 656e  al(ranges[0]['en
+0000da80: 6427 5d2c 2035 3131 290a 2020 2020 2020  d'], 511).      
+0000da90: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0000daa0: 616c 2872 616e 6765 735b 315d 5b27 7374  al(ranges[1]['st
+0000dab0: 6172 7427 5d2c 2031 3032 3429 0a20 2020  art'], 1024).   
+0000dac0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0000dad0: 4571 7561 6c28 7261 6e67 6573 5b31 5d5b  Equal(ranges[1][
+0000dae0: 2765 6e64 275d 2c20 3135 3335 290a 0a20  'end'], 1535).. 
+0000daf0: 2020 2040 4669 6c65 5368 6172 6550 7265     @FileSharePre
+0000db00: 7061 7265 7228 290a 2020 2020 4041 7379  parer().    @Asy
+0000db10: 6e63 5374 6f72 6167 6554 6573 7443 6173  ncStorageTestCas
+0000db20: 652e 6177 6169 745f 7072 6570 6172 6564  e.await_prepared
+0000db30: 5f74 6573 740a 2020 2020 6173 796e 6320  _test.    async 
+0000db40: 6465 6620 7465 7374 5f6c 6973 745f 7261  def test_list_ra
+0000db50: 6e67 6573 5f6e 6f6e 655f 6672 6f6d 5f73  nges_none_from_s
+0000db60: 6e61 7073 686f 745f 6173 796e 6328 7365  napshot_async(se
+0000db70: 6c66 2c20 7374 6f72 6167 655f 6163 636f  lf, storage_acco
+0000db80: 756e 745f 6e61 6d65 2c20 7374 6f72 6167  unt_name, storag
+0000db90: 655f 6163 636f 756e 745f 6b65 7929 3a0a  e_account_key):.
+0000dba0: 2020 2020 2020 2020 7365 6c66 2e5f 7365          self._se
+0000dbb0: 7475 7028 7374 6f72 6167 655f 6163 636f  tup(storage_acco
+0000dbc0: 756e 745f 6e61 6d65 2c20 7374 6f72 6167  unt_name, storag
+0000dbd0: 655f 6163 636f 756e 745f 6b65 7929 0a20  e_account_key). 
+0000dbe0: 2020 2020 2020 2066 696c 655f 6e61 6d65         file_name
+0000dbf0: 203d 2073 656c 662e 5f67 6574 5f66 696c   = self._get_fil
+0000dc00: 655f 7265 6665 7265 6e63 6528 290a 2020  e_reference().  
+0000dc10: 2020 2020 2020 6177 6169 7420 7365 6c66        await self
+0000dc20: 2e5f 7365 7475 705f 7368 6172 6528 7374  ._setup_share(st
+0000dc30: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
+0000dc40: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
+0000dc50: 756e 745f 6b65 7929 0a20 2020 2020 2020  unt_key).       
+0000dc60: 2066 696c 655f 636c 6965 6e74 203d 2053   file_client = S
+0000dc70: 6861 7265 4669 6c65 436c 6965 6e74 280a  hareFileClient(.
+0000dc80: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000dc90: 2e61 6363 6f75 6e74 5f75 726c 2873 746f  .account_url(sto
+0000dca0: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
+0000dcb0: 652c 2022 6669 6c65 2229 2c0a 2020 2020  e, "file"),.    
+0000dcc0: 2020 2020 2020 2020 7368 6172 655f 6e61          share_na
+0000dcd0: 6d65 3d73 656c 662e 7368 6172 655f 6e61  me=self.share_na
+0000dce0: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
+0000dcf0: 6669 6c65 5f70 6174 683d 6669 6c65 5f6e  file_path=file_n
+0000dd00: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
+0000dd10: 2063 7265 6465 6e74 6961 6c3d 7374 6f72   credential=stor
+0000dd20: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
+0000dd30: 0a20 2020 2020 2020 2061 7761 6974 2066  .        await f
+0000dd40: 696c 655f 636c 6965 6e74 2e63 7265 6174  ile_client.creat
+0000dd50: 655f 6669 6c65 2831 3032 3429 0a20 2020  e_file(1024).   
+0000dd60: 2020 2020 200a 2020 2020 2020 2020 7368       .        sh
+0000dd70: 6172 655f 636c 6965 6e74 203d 2073 656c  are_client = sel
+0000dd80: 662e 6673 632e 6765 745f 7368 6172 655f  f.fsc.get_share_
+0000dd90: 636c 6965 6e74 2873 656c 662e 7368 6172  client(self.shar
+0000dda0: 655f 6e61 6d65 290a 2020 2020 2020 2020  e_name).        
+0000ddb0: 736e 6170 7368 6f74 203d 2061 7761 6974  snapshot = await
+0000ddc0: 2073 6861 7265 5f63 6c69 656e 742e 6372   share_client.cr
+0000ddd0: 6561 7465 5f73 6e61 7073 686f 7428 290a  eate_snapshot().
+0000dde0: 2020 2020 2020 2020 736e 6170 7368 6f74          snapshot
+0000ddf0: 5f63 6c69 656e 7420 3d20 5368 6172 6546  _client = ShareF
+0000de00: 696c 6543 6c69 656e 7428 0a20 2020 2020  ileClient(.     
+0000de10: 2020 2020 2020 2073 656c 662e 6163 636f         self.acco
+0000de20: 756e 745f 7572 6c28 7374 6f72 6167 655f  unt_url(storage_
+0000de30: 6163 636f 756e 745f 6e61 6d65 2c20 2266  account_name, "f
+0000de40: 696c 6522 292c 0a20 2020 2020 2020 2020  ile"),.         
+0000de50: 2020 2073 6861 7265 5f6e 616d 653d 7365     share_name=se
+0000de60: 6c66 2e73 6861 7265 5f6e 616d 652c 0a20  lf.share_name,. 
+0000de70: 2020 2020 2020 2020 2020 2066 696c 655f             file_
+0000de80: 7061 7468 3d66 696c 655f 636c 6965 6e74  path=file_client
+0000de90: 2e66 696c 655f 6e61 6d65 2c0a 2020 2020  .file_name,.    
+0000dea0: 2020 2020 2020 2020 736e 6170 7368 6f74          snapshot
+0000deb0: 3d73 6e61 7073 686f 742c 0a20 2020 2020  =snapshot,.     
+0000dec0: 2020 2020 2020 2063 7265 6465 6e74 6961         credentia
+0000ded0: 6c3d 7374 6f72 6167 655f 6163 636f 756e  l=storage_accoun
+0000dee0: 745f 6b65 792c 0a20 2020 2020 2020 2020  t_key,.         
+0000def0: 2020 2074 7261 6e73 706f 7274 3d41 696f     transport=Aio
+0000df00: 6874 7470 5465 7374 5472 616e 7370 6f72  httpTestTranspor
+0000df10: 7428 2929 0a0a 2020 2020 2020 2020 6177  t())..        aw
+0000df20: 6169 7420 6669 6c65 5f63 6c69 656e 742e  ait file_client.
+0000df30: 6465 6c65 7465 5f66 696c 6528 290a 0a20  delete_file().. 
+0000df40: 2020 2020 2020 2023 2041 6374 0a20 2020         # Act.   
+0000df50: 2020 2020 2072 616e 6765 7320 3d20 6177       ranges = aw
+0000df60: 6169 7420 736e 6170 7368 6f74 5f63 6c69  ait snapshot_cli
+0000df70: 656e 742e 6765 745f 7261 6e67 6573 2829  ent.get_ranges()
+0000df80: 0a0a 2020 2020 2020 2020 2320 4173 7365  ..        # Asse
+0000df90: 7274 0a20 2020 2020 2020 2073 656c 662e  rt.        self.
+0000dfa0: 6173 7365 7274 4973 4e6f 744e 6f6e 6528  assertIsNotNone(
+0000dfb0: 7261 6e67 6573 290a 2020 2020 2020 2020  ranges).        
+0000dfc0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+0000dfd0: 286c 656e 2872 616e 6765 7329 2c20 3029  (len(ranges), 0)
+0000dfe0: 0a0a 2020 2020 4046 696c 6553 6861 7265  ..    @FileShare
+0000dff0: 5072 6570 6172 6572 2829 0a20 2020 2040  Preparer().    @
+0000e000: 4173 796e 6353 746f 7261 6765 5465 7374  AsyncStorageTest
+0000e010: 4361 7365 2e61 7761 6974 5f70 7265 7061  Case.await_prepa
+0000e020: 7265 645f 7465 7374 0a20 2020 2061 7379  red_test.    asy
+0000e030: 6e63 2064 6566 2074 6573 745f 6c69 7374  nc def test_list
+0000e040: 5f72 616e 6765 735f 325f 6672 6f6d 5f73  _ranges_2_from_s
+0000e050: 6e61 7073 686f 745f 6173 796e 6328 7365  napshot_async(se
+0000e060: 6c66 2c20 7374 6f72 6167 655f 6163 636f  lf, storage_acco
+0000e070: 756e 745f 6e61 6d65 2c20 7374 6f72 6167  unt_name, storag
+0000e080: 655f 6163 636f 756e 745f 6b65 7929 3a0a  e_account_key):.
+0000e090: 2020 2020 2020 2020 7365 6c66 2e5f 7365          self._se
+0000e0a0: 7475 7028 7374 6f72 6167 655f 6163 636f  tup(storage_acco
+0000e0b0: 756e 745f 6e61 6d65 2c20 7374 6f72 6167  unt_name, storag
+0000e0c0: 655f 6163 636f 756e 745f 6b65 7929 0a20  e_account_key). 
+0000e0d0: 2020 2020 2020 2066 696c 655f 6e61 6d65         file_name
+0000e0e0: 203d 2073 656c 662e 5f67 6574 5f66 696c   = self._get_fil
+0000e0f0: 655f 7265 6665 7265 6e63 6528 290a 2020  e_reference().  
+0000e100: 2020 2020 2020 6177 6169 7420 7365 6c66        await self
+0000e110: 2e5f 7365 7475 705f 7368 6172 6528 7374  ._setup_share(st
+0000e120: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
+0000e130: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
+0000e140: 756e 745f 6b65 7929 0a20 2020 2020 2020  unt_key).       
+0000e150: 2066 696c 655f 636c 6965 6e74 203d 2053   file_client = S
+0000e160: 6861 7265 4669 6c65 436c 6965 6e74 280a  hareFileClient(.
+0000e170: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000e180: 2e61 6363 6f75 6e74 5f75 726c 2873 746f  .account_url(sto
+0000e190: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
+0000e1a0: 652c 2022 6669 6c65 2229 2c0a 2020 2020  e, "file"),.    
+0000e1b0: 2020 2020 2020 2020 7368 6172 655f 6e61          share_na
+0000e1c0: 6d65 3d73 656c 662e 7368 6172 655f 6e61  me=self.share_na
+0000e1d0: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
+0000e1e0: 6669 6c65 5f70 6174 683d 6669 6c65 5f6e  file_path=file_n
+0000e1f0: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
+0000e200: 2063 7265 6465 6e74 6961 6c3d 7374 6f72   credential=stor
+0000e210: 6167 655f 6163 636f 756e 745f 6b65 792c  age_account_key,
+0000e220: 0a20 2020 2020 2020 2020 2020 2074 7261  .            tra
+0000e230: 6e73 706f 7274 3d41 696f 6874 7470 5465  nsport=AiohttpTe
+0000e240: 7374 5472 616e 7370 6f72 7428 2929 0a20  stTransport()). 
+0000e250: 2020 2020 2020 2061 7761 6974 2066 696c         await fil
+0000e260: 655f 636c 6965 6e74 2e63 7265 6174 655f  e_client.create_
+0000e270: 6669 6c65 2832 3034 3829 0a20 2020 2020  file(2048).     
+0000e280: 2020 2064 6174 6120 3d20 6227 6162 6364     data = b'abcd
+0000e290: 6566 6768 696a 6b6c 6d6e 6f70 2720 2a20  efghijklmnop' * 
+0000e2a0: 3332 0a20 2020 2020 2020 2072 6573 7031  32.        resp1
+0000e2b0: 203d 2061 7761 6974 2066 696c 655f 636c   = await file_cl
+0000e2c0: 6965 6e74 2e75 706c 6f61 645f 7261 6e67  ient.upload_rang
+0000e2d0: 6528 6461 7461 2c20 6f66 6673 6574 3d30  e(data, offset=0
+0000e2e0: 2c20 6c65 6e67 7468 3d35 3132 290a 2020  , length=512).  
+0000e2f0: 2020 2020 2020 7265 7370 3220 3d20 6177        resp2 = aw
+0000e300: 6169 7420 6669 6c65 5f63 6c69 656e 742e  ait file_client.
+0000e310: 7570 6c6f 6164 5f72 616e 6765 2864 6174  upload_range(dat
+0000e320: 612c 206f 6666 7365 743d 3130 3234 2c20  a, offset=1024, 
+0000e330: 6c65 6e67 7468 3d35 3132 290a 2020 2020  length=512).    
+0000e340: 2020 2020 0a20 2020 2020 2020 2073 6861      .        sha
+0000e350: 7265 5f63 6c69 656e 7420 3d20 7365 6c66  re_client = self
+0000e360: 2e66 7363 2e67 6574 5f73 6861 7265 5f63  .fsc.get_share_c
+0000e370: 6c69 656e 7428 7365 6c66 2e73 6861 7265  lient(self.share
+0000e380: 5f6e 616d 6529 0a20 2020 2020 2020 2073  _name).        s
+0000e390: 6e61 7073 686f 7420 3d20 6177 6169 7420  napshot = await 
+0000e3a0: 7368 6172 655f 636c 6965 6e74 2e63 7265  share_client.cre
+0000e3b0: 6174 655f 736e 6170 7368 6f74 2829 0a20  ate_snapshot(). 
+0000e3c0: 2020 2020 2020 2073 6e61 7073 686f 745f         snapshot_
+0000e3d0: 636c 6965 6e74 203d 2053 6861 7265 4669  client = ShareFi
+0000e3e0: 6c65 436c 6965 6e74 280a 2020 2020 2020  leClient(.      
+0000e3f0: 2020 2020 2020 7365 6c66 2e61 6363 6f75        self.accou
+0000e400: 6e74 5f75 726c 2873 746f 7261 6765 5f61  nt_url(storage_a
+0000e410: 6363 6f75 6e74 5f6e 616d 652c 2022 6669  ccount_name, "fi
+0000e420: 6c65 2229 2c0a 2020 2020 2020 2020 2020  le"),.          
+0000e430: 2020 7368 6172 655f 6e61 6d65 3d73 656c    share_name=sel
+0000e440: 662e 7368 6172 655f 6e61 6d65 2c0a 2020  f.share_name,.  
+0000e450: 2020 2020 2020 2020 2020 6669 6c65 5f70            file_p
+0000e460: 6174 683d 6669 6c65 5f63 6c69 656e 742e  ath=file_client.
+0000e470: 6669 6c65 5f6e 616d 652c 0a20 2020 2020  file_name,.     
+0000e480: 2020 2020 2020 2073 6e61 7073 686f 743d         snapshot=
+0000e490: 736e 6170 7368 6f74 2c0a 2020 2020 2020  snapshot,.      
+0000e4a0: 2020 2020 2020 6372 6564 656e 7469 616c        credential
+0000e4b0: 3d73 746f 7261 6765 5f61 6363 6f75 6e74  =storage_account
+0000e4c0: 5f6b 6579 2c0a 2020 2020 2020 2020 2020  _key,.          
+0000e4d0: 2020 7472 616e 7370 6f72 743d 4169 6f68    transport=Aioh
+0000e4e0: 7474 7054 6573 7454 7261 6e73 706f 7274  ttpTestTransport
+0000e4f0: 2829 290a 0a20 2020 2020 2020 2061 7761  ())..        awa
+0000e500: 6974 2066 696c 655f 636c 6965 6e74 2e64  it file_client.d
+0000e510: 656c 6574 655f 6669 6c65 2829 0a0a 2020  elete_file()..  
+0000e520: 2020 2020 2020 2320 4163 740a 2020 2020        # Act.    
+0000e530: 2020 2020 7261 6e67 6573 203d 2061 7761      ranges = awa
+0000e540: 6974 2073 6e61 7073 686f 745f 636c 6965  it snapshot_clie
+0000e550: 6e74 2e67 6574 5f72 616e 6765 7328 290a  nt.get_ranges().
+0000e560: 0a20 2020 2020 2020 2023 2041 7373 6572  .        # Asser
+0000e570: 740a 2020 2020 2020 2020 7365 6c66 2e61  t.        self.a
+0000e580: 7373 6572 7449 734e 6f74 4e6f 6e65 2872  ssertIsNotNone(r
+0000e590: 616e 6765 7329 0a20 2020 2020 2020 2073  anges).        s
+0000e5a0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0000e5b0: 6c65 6e28 7261 6e67 6573 292c 2032 290a  len(ranges), 2).
+0000e5c0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000e5d0: 6572 7445 7175 616c 2872 616e 6765 735b  ertEqual(ranges[
+0000e5e0: 305d 5b27 7374 6172 7427 5d2c 2030 290a  0]['start'], 0).
+0000e5f0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000e600: 6572 7445 7175 616c 2872 616e 6765 735b  ertEqual(ranges[
+0000e610: 305d 5b27 656e 6427 5d2c 2035 3131 290a  0]['end'], 511).
+0000e620: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000e630: 6572 7445 7175 616c 2872 616e 6765 735b  ertEqual(ranges[
+0000e640: 315d 5b27 7374 6172 7427 5d2c 2031 3032  1]['start'], 102
+0000e650: 3429 0a20 2020 2020 2020 2073 656c 662e  4).        self.
+0000e660: 6173 7365 7274 4571 7561 6c28 7261 6e67  assertEqual(rang
+0000e670: 6573 5b31 5d5b 2765 6e64 275d 2c20 3135  es[1]['end'], 15
+0000e680: 3335 290a 0a20 2020 2040 4669 6c65 5368  35)..    @FileSh
+0000e690: 6172 6550 7265 7061 7265 7228 290a 2020  arePreparer().  
+0000e6a0: 2020 4041 7379 6e63 5374 6f72 6167 6554    @AsyncStorageT
+0000e6b0: 6573 7443 6173 652e 6177 6169 745f 7072  estCase.await_pr
+0000e6c0: 6570 6172 6564 5f74 6573 740a 2020 2020  epared_test.    
+0000e6d0: 6173 796e 6320 6465 6620 7465 7374 5f63  async def test_c
+0000e6e0: 6f70 795f 6669 6c65 5f77 6974 685f 6578  opy_file_with_ex
+0000e6f0: 6973 7469 6e67 5f66 696c 655f 6173 796e  isting_file_asyn
+0000e700: 6328 7365 6c66 2c20 7374 6f72 6167 655f  c(self, storage_
+0000e710: 6163 636f 756e 745f 6e61 6d65 2c20 7374  account_name, st
+0000e720: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
+0000e730: 7929 3a0a 2020 2020 2020 2020 7365 6c66  y):.        self
+0000e740: 2e5f 7365 7475 7028 7374 6f72 6167 655f  ._setup(storage_
+0000e750: 6163 636f 756e 745f 6e61 6d65 2c20 7374  account_name, st
+0000e760: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
+0000e770: 7929 0a20 2020 2020 2020 2073 6f75 7263  y).        sourc
+0000e780: 655f 636c 6965 6e74 203d 2061 7761 6974  e_client = await
+0000e790: 2073 656c 662e 5f63 7265 6174 655f 6669   self._create_fi
+0000e7a0: 6c65 2873 746f 7261 6765 5f61 6363 6f75  le(storage_accou
+0000e7b0: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
+0000e7c0: 5f61 6363 6f75 6e74 5f6b 6579 290a 2020  _account_key).  
+0000e7d0: 2020 2020 2020 6669 6c65 5f63 6c69 656e        file_clien
+0000e7e0: 7420 3d20 5368 6172 6546 696c 6543 6c69  t = ShareFileCli
+0000e7f0: 656e 7428 0a20 2020 2020 2020 2020 2020  ent(.           
+0000e800: 2073 656c 662e 6163 636f 756e 745f 7572   self.account_ur
+0000e810: 6c28 7374 6f72 6167 655f 6163 636f 756e  l(storage_accoun
+0000e820: 745f 6e61 6d65 2c20 2266 696c 6522 292c  t_name, "file"),
+0000e830: 0a20 2020 2020 2020 2020 2020 2073 6861  .            sha
+0000e840: 7265 5f6e 616d 653d 7365 6c66 2e73 6861  re_name=self.sha
+0000e850: 7265 5f6e 616d 652c 0a20 2020 2020 2020  re_name,.       
+0000e860: 2020 2020 2066 696c 655f 7061 7468 3d27       file_path='
+0000e870: 6669 6c65 3163 6f70 7927 2c0a 2020 2020  file1copy',.    
+0000e880: 2020 2020 2020 2020 6372 6564 656e 7469          credenti
+0000e890: 616c 3d73 746f 7261 6765 5f61 6363 6f75  al=storage_accou
+0000e8a0: 6e74 5f6b 6579 2c0a 2020 2020 2020 2020  nt_key,.        
+0000e8b0: 2020 2020 7472 616e 7370 6f72 743d 4169      transport=Ai
+0000e8c0: 6f68 7474 7054 6573 7454 7261 6e73 706f  ohttpTestTranspo
+0000e8d0: 7274 2829 290a 0a20 2020 2020 2020 2023  rt())..        #
+0000e8e0: 2041 6374 0a20 2020 2020 2020 2063 6f70   Act.        cop
+0000e8f0: 7920 3d20 6177 6169 7420 6669 6c65 5f63  y = await file_c
+0000e900: 6c69 656e 742e 7374 6172 745f 636f 7079  lient.start_copy
+0000e910: 5f66 726f 6d5f 7572 6c28 736f 7572 6365  _from_url(source
+0000e920: 5f63 6c69 656e 742e 7572 6c29 0a0a 2020  _client.url)..  
+0000e930: 2020 2020 2020 2320 4173 7365 7274 0a20        # Assert. 
+0000e940: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+0000e950: 7274 4973 4e6f 744e 6f6e 6528 636f 7079  rtIsNotNone(copy
+0000e960: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0000e970: 7373 6572 7445 7175 616c 2863 6f70 795b  ssertEqual(copy[
+0000e980: 2763 6f70 795f 7374 6174 7573 275d 2c20  'copy_status'], 
+0000e990: 2773 7563 6365 7373 2729 0a20 2020 2020  'success').     
+0000e9a0: 2020 2073 656c 662e 6173 7365 7274 4973     self.assertIs
+0000e9b0: 4e6f 744e 6f6e 6528 636f 7079 5b27 636f  NotNone(copy['co
+0000e9c0: 7079 5f69 6427 5d29 0a0a 2020 2020 2020  py_id'])..      
+0000e9d0: 2020 636f 7079 5f66 696c 6520 3d20 6177    copy_file = aw
+0000e9e0: 6169 7420 6669 6c65 5f63 6c69 656e 742e  ait file_client.
+0000e9f0: 646f 776e 6c6f 6164 5f66 696c 6528 290a  download_file().
+0000ea00: 2020 2020 2020 2020 636f 6e74 656e 7420          content 
+0000ea10: 3d20 6177 6169 7420 636f 7079 5f66 696c  = await copy_fil
+0000ea20: 652e 7265 6164 616c 6c28 290a 2020 2020  e.readall().    
+0000ea30: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0000ea40: 7175 616c 2863 6f6e 7465 6e74 2c20 7365  qual(content, se
+0000ea50: 6c66 2e73 686f 7274 5f62 7974 655f 6461  lf.short_byte_da
+0000ea60: 7461 290a 0a20 2020 2040 4669 6c65 5368  ta)..    @FileSh
+0000ea70: 6172 6550 7265 7061 7265 7228 290a 2020  arePreparer().  
+0000ea80: 2020 4041 7379 6e63 5374 6f72 6167 6554    @AsyncStorageT
+0000ea90: 6573 7443 6173 652e 6177 6169 745f 7072  estCase.await_pr
+0000eaa0: 6570 6172 6564 5f74 6573 740a 2020 2020  epared_test.    
+0000eab0: 6173 796e 6320 6465 6620 7465 7374 5f63  async def test_c
+0000eac0: 6f70 795f 6578 6973 7469 6e67 5f66 696c  opy_existing_fil
+0000ead0: 655f 7769 7468 5f6c 6561 7365 5f61 7379  e_with_lease_asy
+0000eae0: 6e63 2873 656c 662c 2073 746f 7261 6765  nc(self, storage
+0000eaf0: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
+0000eb00: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
+0000eb10: 6579 293a 0a20 2020 2020 2020 2073 656c  ey):.        sel
+0000eb20: 662e 5f73 6574 7570 2873 746f 7261 6765  f._setup(storage
+0000eb30: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
+0000eb40: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
+0000eb50: 6579 290a 2020 2020 2020 2020 736f 7572  ey).        sour
+0000eb60: 6365 5f63 6c69 656e 7420 3d20 6177 6169  ce_client = awai
+0000eb70: 7420 7365 6c66 2e5f 6372 6561 7465 5f66  t self._create_f
+0000eb80: 696c 6528 7374 6f72 6167 655f 6163 636f  ile(storage_acco
+0000eb90: 756e 745f 6e61 6d65 2c20 7374 6f72 6167  unt_name, storag
+0000eba0: 655f 6163 636f 756e 745f 6b65 7929 0a20  e_account_key). 
+0000ebb0: 2020 2020 2020 2066 696c 655f 636c 6965         file_clie
+0000ebc0: 6e74 203d 2053 6861 7265 4669 6c65 436c  nt = ShareFileCl
+0000ebd0: 6965 6e74 280a 2020 2020 2020 2020 2020  ient(.          
+0000ebe0: 2020 7365 6c66 2e61 6363 6f75 6e74 5f75    self.account_u
+0000ebf0: 726c 2873 746f 7261 6765 5f61 6363 6f75  rl(storage_accou
+0000ec00: 6e74 5f6e 616d 652c 2022 6669 6c65 2229  nt_name, "file")
+0000ec10: 2c0a 2020 2020 2020 2020 2020 2020 7368  ,.            sh
+0000ec20: 6172 655f 6e61 6d65 3d73 656c 662e 7368  are_name=self.sh
+0000ec30: 6172 655f 6e61 6d65 2c0a 2020 2020 2020  are_name,.      
+0000ec40: 2020 2020 2020 6669 6c65 5f70 6174 683d        file_path=
+0000ec50: 2766 696c 6531 636f 7079 272c 0a20 2020  'file1copy',.   
+0000ec60: 2020 2020 2020 2020 2063 7265 6465 6e74           credent
+0000ec70: 6961 6c3d 7374 6f72 6167 655f 6163 636f  ial=storage_acco
+0000ec80: 756e 745f 6b65 7929 0a20 2020 2020 2020  unt_key).       
+0000ec90: 2061 7761 6974 2066 696c 655f 636c 6965   await file_clie
+0000eca0: 6e74 2e63 7265 6174 655f 6669 6c65 2831  nt.create_file(1
+0000ecb0: 3032 3429 0a20 2020 2020 2020 206c 6561  024).        lea
+0000ecc0: 7365 203d 2061 7761 6974 2066 696c 655f  se = await file_
+0000ecd0: 636c 6965 6e74 2e61 6371 7569 7265 5f6c  client.acquire_l
+0000ece0: 6561 7365 2829 0a0a 2020 2020 2020 2020  ease()..        
+0000ecf0: 2320 4163 740a 2020 2020 2020 2020 7769  # Act.        wi
+0000ed00: 7468 2073 656c 662e 6173 7365 7274 5261  th self.assertRa
+0000ed10: 6973 6573 2848 7474 7052 6573 706f 6e73  ises(HttpRespons
+0000ed20: 6545 7272 6f72 293a 0a20 2020 2020 2020  eError):.       
+0000ed30: 2020 2020 2061 7761 6974 2066 696c 655f       await file_
+0000ed40: 636c 6965 6e74 2e73 7461 7274 5f63 6f70  client.start_cop
+0000ed50: 795f 6672 6f6d 5f75 726c 2873 6f75 7263  y_from_url(sourc
+0000ed60: 655f 636c 6965 6e74 2e75 726c 290a 0a20  e_client.url).. 
+0000ed70: 2020 2020 2020 2063 6f70 7920 3d20 6177         copy = aw
+0000ed80: 6169 7420 6669 6c65 5f63 6c69 656e 742e  ait file_client.
+0000ed90: 7374 6172 745f 636f 7079 5f66 726f 6d5f  start_copy_from_
+0000eda0: 7572 6c28 736f 7572 6365 5f63 6c69 656e  url(source_clien
+0000edb0: 742e 7572 6c2c 206c 6561 7365 3d6c 6561  t.url, lease=lea
+0000edc0: 7365 290a 0a20 2020 2020 2020 2023 2041  se)..        # A
+0000edd0: 7373 6572 740a 2020 2020 2020 2020 7365  ssert.        se
+0000ede0: 6c66 2e61 7373 6572 7449 734e 6f74 4e6f  lf.assertIsNotNo
+0000edf0: 6e65 2863 6f70 7929 0a20 2020 2020 2020  ne(copy).       
+0000ee00: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+0000ee10: 6c28 636f 7079 5b27 636f 7079 5f73 7461  l(copy['copy_sta
+0000ee20: 7475 7327 5d2c 2027 7375 6363 6573 7327  tus'], 'success'
+0000ee30: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0000ee40: 7373 6572 7449 734e 6f74 4e6f 6e65 2863  ssertIsNotNone(c
+0000ee50: 6f70 795b 2763 6f70 795f 6964 275d 290a  opy['copy_id']).
+0000ee60: 0a20 2020 2020 2020 2063 6f70 795f 6669  .        copy_fi
+0000ee70: 6c65 203d 2061 7761 6974 2066 696c 655f  le = await file_
+0000ee80: 636c 6965 6e74 2e64 6f77 6e6c 6f61 645f  client.download_
+0000ee90: 6669 6c65 2829 0a20 2020 2020 2020 2063  file().        c
+0000eea0: 6f6e 7465 6e74 203d 2061 7761 6974 2063  ontent = await c
+0000eeb0: 6f70 795f 6669 6c65 2e72 6561 6461 6c6c  opy_file.readall
+0000eec0: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
+0000eed0: 6173 7365 7274 4571 7561 6c28 636f 6e74  assertEqual(cont
+0000eee0: 656e 742c 2073 656c 662e 7368 6f72 745f  ent, self.short_
+0000eef0: 6279 7465 5f64 6174 6129 0a0a 2020 2020  byte_data)..    
+0000ef00: 4046 696c 6553 6861 7265 5072 6570 6172  @FileSharePrepar
+0000ef10: 6572 2829 0a20 2020 2040 4173 796e 6353  er().    @AsyncS
+0000ef20: 746f 7261 6765 5465 7374 4361 7365 2e61  torageTestCase.a
+0000ef30: 7761 6974 5f70 7265 7061 7265 645f 7465  wait_prepared_te
+0000ef40: 7374 0a20 2020 2061 7379 6e63 2064 6566  st.    async def
+0000ef50: 2074 6573 745f 636f 7079 5f66 696c 655f   test_copy_file_
+0000ef60: 6967 6e6f 7265 5f72 6561 646f 6e6c 7928  ignore_readonly(
+0000ef70: 7365 6c66 2c20 7374 6f72 6167 655f 6163  self, storage_ac
+0000ef80: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
+0000ef90: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
+0000efa0: 3a0a 2020 2020 2020 2020 7365 6c66 2e5f  :.        self._
+0000efb0: 7365 7475 7028 7374 6f72 6167 655f 6163  setup(storage_ac
+0000efc0: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
+0000efd0: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
+0000efe0: 0a20 2020 2020 2020 2073 6f75 7263 655f  .        source_
+0000eff0: 6669 6c65 203d 2061 7761 6974 2073 656c  file = await sel
+0000f000: 662e 5f63 7265 6174 655f 6669 6c65 2873  f._create_file(s
+0000f010: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
+0000f020: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
+0000f030: 6f75 6e74 5f6b 6579 290a 2020 2020 2020  ount_key).      
+0000f040: 2020 6465 7374 5f66 696c 6520 3d20 5368    dest_file = Sh
+0000f050: 6172 6546 696c 6543 6c69 656e 7428 0a20  areFileClient(. 
+0000f060: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000f070: 6163 636f 756e 745f 7572 6c28 7374 6f72  account_url(stor
+0000f080: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
+0000f090: 2c20 2266 696c 6522 292c 0a20 2020 2020  , "file"),.     
+0000f0a0: 2020 2020 2020 2073 6861 7265 5f6e 616d         share_nam
+0000f0b0: 653d 7365 6c66 2e73 6861 7265 5f6e 616d  e=self.share_nam
+0000f0c0: 652c 0a20 2020 2020 2020 2020 2020 2066  e,.            f
+0000f0d0: 696c 655f 7061 7468 3d27 6669 6c65 3163  ile_path='file1c
+0000f0e0: 6f70 7927 2c0a 2020 2020 2020 2020 2020  opy',.          
+0000f0f0: 2020 6372 6564 656e 7469 616c 3d73 746f    credential=sto
+0000f100: 7261 6765 5f61 6363 6f75 6e74 5f6b 6579  rage_account_key
+0000f110: 290a 0a20 2020 2020 2020 2066 696c 655f  )..        file_
+0000f120: 6174 7472 6962 7574 6573 203d 204e 5446  attributes = NTF
+0000f130: 5341 7474 7269 6275 7465 7328 7265 6164  SAttributes(read
+0000f140: 5f6f 6e6c 793d 5472 7565 290a 2020 2020  _only=True).    
+0000f150: 2020 2020 6177 6169 7420 6465 7374 5f66      await dest_f
+0000f160: 696c 652e 6372 6561 7465 5f66 696c 6528  ile.create_file(
+0000f170: 3130 3234 2c20 6669 6c65 5f61 7474 7269  1024, file_attri
+0000f180: 6275 7465 733d 6669 6c65 5f61 7474 7269  butes=file_attri
+0000f190: 6275 7465 7329 0a0a 2020 2020 2020 2020  butes)..        
+0000f1a0: 2320 4163 740a 2020 2020 2020 2020 7769  # Act.        wi
+0000f1b0: 7468 2073 656c 662e 6173 7365 7274 5261  th self.assertRa
+0000f1c0: 6973 6573 2848 7474 7052 6573 706f 6e73  ises(HttpRespons
+0000f1d0: 6545 7272 6f72 293a 0a20 2020 2020 2020  eError):.       
+0000f1e0: 2020 2020 2061 7761 6974 2064 6573 745f       await dest_
+0000f1f0: 6669 6c65 2e73 7461 7274 5f63 6f70 795f  file.start_copy_
+0000f200: 6672 6f6d 5f75 726c 2873 6f75 7263 655f  from_url(source_
+0000f210: 6669 6c65 2e75 726c 290a 0a20 2020 2020  file.url)..     
+0000f220: 2020 2063 6f70 7920 3d20 6177 6169 7420     copy = await 
+0000f230: 6465 7374 5f66 696c 652e 7374 6172 745f  dest_file.start_
+0000f240: 636f 7079 5f66 726f 6d5f 7572 6c28 736f  copy_from_url(so
+0000f250: 7572 6365 5f66 696c 652e 7572 6c2c 2069  urce_file.url, i
+0000f260: 676e 6f72 655f 7265 6164 5f6f 6e6c 793d  gnore_read_only=
+0000f270: 5472 7565 290a 0a20 2020 2020 2020 2023  True)..        #
+0000f280: 2041 7373 6572 740a 2020 2020 2020 2020   Assert.        
+0000f290: 7365 6c66 2e61 7373 6572 7449 734e 6f74  self.assertIsNot
+0000f2a0: 4e6f 6e65 2863 6f70 7929 0a20 2020 2020  None(copy).     
+0000f2b0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+0000f2c0: 7561 6c28 636f 7079 5b27 636f 7079 5f73  ual(copy['copy_s
+0000f2d0: 7461 7475 7327 5d2c 2027 7375 6363 6573  tatus'], 'succes
+0000f2e0: 7327 290a 2020 2020 2020 2020 7365 6c66  s').        self
+0000f2f0: 2e61 7373 6572 7449 734e 6f74 4e6f 6e65  .assertIsNotNone
+0000f300: 2863 6f70 795b 2763 6f70 795f 6964 275d  (copy['copy_id']
+0000f310: 290a 0a20 2020 2020 2020 2063 6f70 795f  )..        copy_
+0000f320: 6669 6c65 203d 2061 7761 6974 2064 6573  file = await des
+0000f330: 745f 6669 6c65 2e64 6f77 6e6c 6f61 645f  t_file.download_
+0000f340: 6669 6c65 2829 0a20 2020 2020 2020 2063  file().        c
+0000f350: 6f6e 7465 6e74 203d 2061 7761 6974 2063  ontent = await c
+0000f360: 6f70 795f 6669 6c65 2e72 6561 6461 6c6c  opy_file.readall
+0000f370: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
+0000f380: 6173 7365 7274 4571 7561 6c28 636f 6e74  assertEqual(cont
+0000f390: 656e 742c 2073 656c 662e 7368 6f72 745f  ent, self.short_
+0000f3a0: 6279 7465 5f64 6174 6129 0a0a 2020 2020  byte_data)..    
+0000f3b0: 4046 696c 6553 6861 7265 5072 6570 6172  @FileSharePrepar
+0000f3c0: 6572 2829 0a20 2020 2040 4173 796e 6353  er().    @AsyncS
+0000f3d0: 746f 7261 6765 5465 7374 4361 7365 2e61  torageTestCase.a
+0000f3e0: 7761 6974 5f70 7265 7061 7265 645f 7465  wait_prepared_te
+0000f3f0: 7374 0a20 2020 2061 7379 6e63 2064 6566  st.    async def
+0000f400: 2074 6573 745f 636f 7079 5f66 696c 655f   test_copy_file_
+0000f410: 7769 7468 5f73 7065 6369 6679 696e 675f  with_specifying_
+0000f420: 6163 6c5f 636f 7079 5f62 6568 6176 696f  acl_copy_behavio
+0000f430: 725f 6174 7472 6962 7574 6573 5f61 7379  r_attributes_asy
+0000f440: 6e63 2873 656c 662c 2073 746f 7261 6765  nc(self, storage
+0000f450: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
+0000f460: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
+0000f470: 6579 293a 0a20 2020 2020 2020 2073 656c  ey):.        sel
+0000f480: 662e 5f73 6574 7570 2873 746f 7261 6765  f._setup(storage
+0000f490: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
+0000f4a0: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
+0000f4b0: 6579 290a 2020 2020 2020 2020 736f 7572  ey).        sour
+0000f4c0: 6365 5f63 6c69 656e 7420 3d20 6177 6169  ce_client = awai
+0000f4d0: 7420 7365 6c66 2e5f 6372 6561 7465 5f66  t self._create_f
+0000f4e0: 696c 6528 7374 6f72 6167 655f 6163 636f  ile(storage_acco
+0000f4f0: 756e 745f 6e61 6d65 2c20 7374 6f72 6167  unt_name, storag
+0000f500: 655f 6163 636f 756e 745f 6b65 7929 0a20  e_account_key). 
+0000f510: 2020 2020 2020 2066 696c 655f 636c 6965         file_clie
+0000f520: 6e74 203d 2053 6861 7265 4669 6c65 436c  nt = ShareFileCl
+0000f530: 6965 6e74 280a 2020 2020 2020 2020 2020  ient(.          
+0000f540: 2020 7365 6c66 2e61 6363 6f75 6e74 5f75    self.account_u
+0000f550: 726c 2873 746f 7261 6765 5f61 6363 6f75  rl(storage_accou
+0000f560: 6e74 5f6e 616d 652c 2022 6669 6c65 2229  nt_name, "file")
+0000f570: 2c0a 2020 2020 2020 2020 2020 2020 7368  ,.            sh
+0000f580: 6172 655f 6e61 6d65 3d73 656c 662e 7368  are_name=self.sh
+0000f590: 6172 655f 6e61 6d65 2c0a 2020 2020 2020  are_name,.      
+0000f5a0: 2020 2020 2020 6669 6c65 5f70 6174 683d        file_path=
+0000f5b0: 2766 696c 6531 636f 7079 272c 0a20 2020  'file1copy',.   
+0000f5c0: 2020 2020 2020 2020 2063 7265 6465 6e74           credent
+0000f5d0: 6961 6c3d 7374 6f72 6167 655f 6163 636f  ial=storage_acco
+0000f5e0: 756e 745f 6b65 792c 0a20 2020 2020 2020  unt_key,.       
+0000f5f0: 2020 2020 2074 7261 6e73 706f 7274 3d41       transport=A
+0000f600: 696f 6874 7470 5465 7374 5472 616e 7370  iohttpTestTransp
+0000f610: 6f72 7428 2929 0a20 2020 2020 2020 2073  ort()).        s
+0000f620: 6f75 7263 655f 7072 6f70 7320 3d20 6177  ource_props = aw
+0000f630: 6169 7420 736f 7572 6365 5f63 6c69 656e  ait source_clien
+0000f640: 742e 6765 745f 6669 6c65 5f70 726f 7065  t.get_file_prope
+0000f650: 7274 6965 7328 290a 0a20 2020 2020 2020  rties()..       
+0000f660: 2066 696c 655f 6372 6561 7469 6f6e 5f74   file_creation_t
+0000f670: 696d 6520 3d20 736f 7572 6365 5f70 726f  ime = source_pro
+0000f680: 7073 2e63 7265 6174 696f 6e5f 7469 6d65  ps.creation_time
+0000f690: 202d 2074 696d 6564 656c 7461 2868 6f75   - timedelta(hou
+0000f6a0: 7273 3d31 290a 2020 2020 2020 2020 6669  rs=1).        fi
+0000f6b0: 6c65 5f6c 6173 745f 7772 6974 655f 7469  le_last_write_ti
+0000f6c0: 6d65 203d 2073 6f75 7263 655f 7072 6f70  me = source_prop
+0000f6d0: 732e 6c61 7374 5f77 7269 7465 5f74 696d  s.last_write_tim
+0000f6e0: 6520 2d20 7469 6d65 6465 6c74 6128 686f  e - timedelta(ho
+0000f6f0: 7572 733d 3129 0a20 2020 2020 2020 2066  urs=1).        f
+0000f700: 696c 655f 6368 616e 6765 5f74 696d 6520  ile_change_time 
+0000f710: 3d20 736f 7572 6365 5f70 726f 7073 2e63  = source_props.c
+0000f720: 6861 6e67 655f 7469 6d65 202d 2074 696d  hange_time - tim
+0000f730: 6564 656c 7461 2868 6f75 7273 3d31 290a  edelta(hours=1).
+0000f740: 2020 2020 2020 2020 6669 6c65 5f61 7474          file_att
+0000f750: 7269 6275 7465 7320 3d20 2254 656d 706f  ributes = "Tempo
+0000f760: 7261 7279 7c4e 6f53 6372 7562 4461 7461  rary|NoScrubData
+0000f770: 220a 0a20 2020 2020 2020 2023 2041 6374  "..        # Act
+0000f780: 0a20 2020 2020 2020 2063 6f70 7920 3d20  .        copy = 
+0000f790: 6177 6169 7420 6669 6c65 5f63 6c69 656e  await file_clien
+0000f7a0: 742e 7374 6172 745f 636f 7079 5f66 726f  t.start_copy_fro
+0000f7b0: 6d5f 7572 6c28 0a20 2020 2020 2020 2020  m_url(.         
+0000f7c0: 2020 2073 6f75 7263 655f 636c 6965 6e74     source_client
+0000f7d0: 2e75 726c 2c0a 2020 2020 2020 2020 2020  .url,.          
+0000f7e0: 2020 6967 6e6f 7265 5f72 6561 645f 6f6e    ignore_read_on
+0000f7f0: 6c79 3d54 7275 652c 0a20 2020 2020 2020  ly=True,.       
+0000f800: 2020 2020 2066 696c 655f 7065 726d 6973       file_permis
+0000f810: 7369 6f6e 3d54 4553 545f 4649 4c45 5f50  sion=TEST_FILE_P
+0000f820: 4552 4d49 5353 494f 4e53 2c0a 2020 2020  ERMISSIONS,.    
+0000f830: 2020 2020 2020 2020 6669 6c65 5f61 7474          file_att
+0000f840: 7269 6275 7465 733d 6669 6c65 5f61 7474  ributes=file_att
+0000f850: 7269 6275 7465 732c 0a20 2020 2020 2020  ributes,.       
+0000f860: 2020 2020 2066 696c 655f 6372 6561 7469       file_creati
+0000f870: 6f6e 5f74 696d 653d 6669 6c65 5f63 7265  on_time=file_cre
+0000f880: 6174 696f 6e5f 7469 6d65 2c0a 2020 2020  ation_time,.    
+0000f890: 2020 2020 2020 2020 6669 6c65 5f6c 6173          file_las
+0000f8a0: 745f 7772 6974 655f 7469 6d65 3d66 696c  t_write_time=fil
+0000f8b0: 655f 6c61 7374 5f77 7269 7465 5f74 696d  e_last_write_tim
+0000f8c0: 652c 0a20 2020 2020 2020 2020 2020 2066  e,.            f
+0000f8d0: 696c 655f 6368 616e 6765 5f74 696d 653d  ile_change_time=
+0000f8e0: 6669 6c65 5f63 6861 6e67 655f 7469 6d65  file_change_time
+0000f8f0: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
+0000f900: 2020 2020 2023 2041 7373 6572 740a 2020       # Assert.  
+0000f910: 2020 2020 2020 6465 7374 5f70 726f 7020        dest_prop 
+0000f920: 3d20 6177 6169 7420 6669 6c65 5f63 6c69  = await file_cli
+0000f930: 656e 742e 6765 745f 6669 6c65 5f70 726f  ent.get_file_pro
+0000f940: 7065 7274 6965 7328 290a 2020 2020 2020  perties().      
+0000f950: 2020 2320 746f 206d 616b 6520 7375 7265    # to make sure
+0000f960: 2074 6865 2061 7474 7269 6275 7465 7320   the attributes 
+0000f970: 6172 6520 7468 6520 7361 6d65 2061 7320  are the same as 
+0000f980: 7468 6520 7365 7420 6f6e 6573 0a20 2020  the set ones.   
+0000f990: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0000f9a0: 4571 7561 6c28 6669 6c65 5f63 7265 6174  Equal(file_creat
+0000f9b0: 696f 6e5f 7469 6d65 2c20 6465 7374 5f70  ion_time, dest_p
+0000f9c0: 726f 705b 2763 7265 6174 696f 6e5f 7469  rop['creation_ti
+0000f9d0: 6d65 275d 290a 2020 2020 2020 2020 7365  me']).        se
+0000f9e0: 6c66 2e61 7373 6572 7445 7175 616c 2866  lf.assertEqual(f
+0000f9f0: 696c 655f 6c61 7374 5f77 7269 7465 5f74  ile_last_write_t
+0000fa00: 696d 652c 2064 6573 745f 7072 6f70 5b27  ime, dest_prop['
+0000fa10: 6c61 7374 5f77 7269 7465 5f74 696d 6527  last_write_time'
+0000fa20: 5d29 0a20 2020 2020 2020 2073 656c 662e  ]).        self.
+0000fa30: 6173 7365 7274 4571 7561 6c28 6669 6c65  assertEqual(file
+0000fa40: 5f63 6861 6e67 655f 7469 6d65 2c20 6465  _change_time, de
+0000fa50: 7374 5f70 726f 705b 2763 6861 6e67 655f  st_prop['change_
+0000fa60: 7469 6d65 275d 290a 2020 2020 2020 2020  time']).        
+0000fa70: 7365 6c66 2e61 7373 6572 7449 6e28 2754  self.assertIn('T
+0000fa80: 656d 706f 7261 7279 272c 2064 6573 745f  emporary', dest_
+0000fa90: 7072 6f70 5b27 6669 6c65 5f61 7474 7269  prop['file_attri
+0000faa0: 6275 7465 7327 5d29 0a20 2020 2020 2020  butes']).       
+0000fab0: 2073 656c 662e 6173 7365 7274 496e 2827   self.assertIn('
+0000fac0: 4e6f 5363 7275 6244 6174 6127 2c20 6465  NoScrubData', de
+0000fad0: 7374 5f70 726f 705b 2766 696c 655f 6174  st_prop['file_at
+0000fae0: 7472 6962 7574 6573 275d 290a 0a20 2020  tributes'])..   
+0000faf0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0000fb00: 4973 4e6f 744e 6f6e 6528 636f 7079 290a  IsNotNone(copy).
+0000fb10: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000fb20: 6572 7445 7175 616c 2863 6f70 795b 2763  ertEqual(copy['c
+0000fb30: 6f70 795f 7374 6174 7573 275d 2c20 2773  opy_status'], 's
+0000fb40: 7563 6365 7373 2729 0a20 2020 2020 2020  uccess').       
+0000fb50: 2073 656c 662e 6173 7365 7274 4973 4e6f   self.assertIsNo
+0000fb60: 744e 6f6e 6528 636f 7079 5b27 636f 7079  tNone(copy['copy
+0000fb70: 5f69 6427 5d29 0a0a 2020 2020 2020 2020  _id'])..        
+0000fb80: 636f 7079 5f66 696c 6520 3d20 6177 6169  copy_file = awai
+0000fb90: 7420 6669 6c65 5f63 6c69 656e 742e 646f  t file_client.do
+0000fba0: 776e 6c6f 6164 5f66 696c 6528 290a 2020  wnload_file().  
+0000fbb0: 2020 2020 2020 636f 6e74 656e 7420 3d20        content = 
+0000fbc0: 6177 6169 7420 636f 7079 5f66 696c 652e  await copy_file.
+0000fbd0: 7265 6164 616c 6c28 290a 2020 2020 2020  readall().      
+0000fbe0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0000fbf0: 616c 2863 6f6e 7465 6e74 2c20 7365 6c66  al(content, self
+0000fc00: 2e73 686f 7274 5f62 7974 655f 6461 7461  .short_byte_data
+0000fc10: 290a 0a20 2020 2040 4669 6c65 5368 6172  )..    @FileShar
+0000fc20: 6550 7265 7061 7265 7228 290a 2020 2020  ePreparer().    
+0000fc30: 4041 7379 6e63 5374 6f72 6167 6554 6573  @AsyncStorageTes
+0000fc40: 7443 6173 652e 6177 6169 745f 7072 6570  tCase.await_prep
+0000fc50: 6172 6564 5f74 6573 740a 2020 2020 6173  ared_test.    as
+0000fc60: 796e 6320 6465 6620 7465 7374 5f63 6f70  ync def test_cop
+0000fc70: 795f 6669 6c65 5f77 6974 685f 7370 6563  y_file_with_spec
+0000fc80: 6966 7969 6e67 5f61 636c 5f61 6e64 5f61  ifying_acl_and_a
+0000fc90: 7474 7269 6275 7465 735f 6672 6f6d 5f73  ttributes_from_s
+0000fca0: 6f75 7263 655f 6173 796e 6328 7365 6c66  ource_async(self
+0000fcb0: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
+0000fcc0: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
+0000fcd0: 6163 636f 756e 745f 6b65 7929 3a0a 2020  account_key):.  
+0000fce0: 2020 2020 2020 7365 6c66 2e5f 7365 7475        self._setu
+0000fcf0: 7028 7374 6f72 6167 655f 6163 636f 756e  p(storage_accoun
+0000fd00: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
+0000fd10: 6163 636f 756e 745f 6b65 7929 0a20 2020  account_key).   
+0000fd20: 2020 2020 2073 6f75 7263 655f 636c 6965       source_clie
+0000fd30: 6e74 203d 2061 7761 6974 2073 656c 662e  nt = await self.
+0000fd40: 5f63 7265 6174 655f 6669 6c65 2873 746f  _create_file(sto
+0000fd50: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
+0000fd60: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
+0000fd70: 6e74 5f6b 6579 290a 2020 2020 2020 2020  nt_key).        
+0000fd80: 736f 7572 6365 5f70 726f 7020 3d20 6177  source_prop = aw
+0000fd90: 6169 7420 736f 7572 6365 5f63 6c69 656e  ait source_clien
+0000fda0: 742e 6765 745f 6669 6c65 5f70 726f 7065  t.get_file_prope
+0000fdb0: 7274 6965 7328 290a 2020 2020 2020 2020  rties().        
+0000fdc0: 6669 6c65 5f63 6c69 656e 7420 3d20 5368  file_client = Sh
+0000fdd0: 6172 6546 696c 6543 6c69 656e 7428 0a20  areFileClient(. 
+0000fde0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000fdf0: 6163 636f 756e 745f 7572 6c28 7374 6f72  account_url(stor
+0000fe00: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
+0000fe10: 2c20 2266 696c 6522 292c 0a20 2020 2020  , "file"),.     
+0000fe20: 2020 2020 2020 2073 6861 7265 5f6e 616d         share_nam
+0000fe30: 653d 7365 6c66 2e73 6861 7265 5f6e 616d  e=self.share_nam
+0000fe40: 652c 0a20 2020 2020 2020 2020 2020 2066  e,.            f
+0000fe50: 696c 655f 7061 7468 3d27 6669 6c65 3163  ile_path='file1c
+0000fe60: 6f70 7927 2c0a 2020 2020 2020 2020 2020  opy',.          
+0000fe70: 2020 6372 6564 656e 7469 616c 3d73 746f    credential=sto
+0000fe80: 7261 6765 5f61 6363 6f75 6e74 5f6b 6579  rage_account_key
+0000fe90: 2c0a 2020 2020 2020 2020 2020 2020 7472  ,.            tr
+0000fea0: 616e 7370 6f72 743d 4169 6f68 7474 7054  ansport=AiohttpT
+0000feb0: 6573 7454 7261 6e73 706f 7274 2829 290a  estTransport()).
+0000fec0: 0a20 2020 2020 2020 2023 2041 6374 0a20  .        # Act. 
+0000fed0: 2020 2020 2020 2063 6f70 7920 3d20 6177         copy = aw
+0000fee0: 6169 7420 6669 6c65 5f63 6c69 656e 742e  ait file_client.
+0000fef0: 7374 6172 745f 636f 7079 5f66 726f 6d5f  start_copy_from_
+0000ff00: 7572 6c28 0a20 2020 2020 2020 2020 2020  url(.           
+0000ff10: 2073 6f75 7263 655f 636c 6965 6e74 2e75   source_client.u
+0000ff20: 726c 2c0a 2020 2020 2020 2020 2020 2020  rl,.            
+0000ff30: 7065 726d 6973 7369 6f6e 5f6b 6579 3d27  permission_key='
+0000ff40: 736f 7572 6365 270a 2020 2020 2020 2020  source'.        
+0000ff50: 290a 0a20 2020 2020 2020 2023 2041 7373  )..        # Ass
+0000ff60: 6572 740a 2020 2020 2020 2020 6465 7374  ert.        dest
+0000ff70: 5f70 726f 7020 3d20 6177 6169 7420 6669  _prop = await fi
+0000ff80: 6c65 5f63 6c69 656e 742e 6765 745f 6669  le_client.get_fi
+0000ff90: 6c65 5f70 726f 7065 7274 6965 7328 290a  le_properties().
+0000ffa0: 2020 2020 2020 2020 2320 746f 206d 616b          # to mak
+0000ffb0: 6520 7375 7265 2074 6865 2061 636c 2069  e sure the acl i
+0000ffc0: 7320 636f 7069 6564 2066 726f 6d20 736f  s copied from so
+0000ffd0: 7572 6365 0a20 2020 2020 2020 2073 656c  urce.        sel
+0000ffe0: 662e 6173 7365 7274 4571 7561 6c28 736f  f.assertEqual(so
+0000fff0: 7572 6365 5f70 726f 705b 2770 6572 6d69  urce_prop['permi
+00010000: 7373 696f 6e5f 6b65 7927 5d2c 2064 6573  ssion_key'], des
+00010010: 745f 7072 6f70 5b27 7065 726d 6973 7369  t_prop['permissi
+00010020: 6f6e 5f6b 6579 275d 290a 0a20 2020 2020  on_key'])..     
+00010030: 2020 2073 656c 662e 6173 7365 7274 4973     self.assertIs
+00010040: 4e6f 744e 6f6e 6528 636f 7079 290a 2020  NotNone(copy).  
+00010050: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00010060: 7445 7175 616c 2863 6f70 795b 2763 6f70  tEqual(copy['cop
+00010070: 795f 7374 6174 7573 275d 2c20 2773 7563  y_status'], 'suc
+00010080: 6365 7373 2729 0a20 2020 2020 2020 2073  cess').        s
+00010090: 656c 662e 6173 7365 7274 4973 4e6f 744e  elf.assertIsNotN
+000100a0: 6f6e 6528 636f 7079 5b27 636f 7079 5f69  one(copy['copy_i
+000100b0: 6427 5d29 0a0a 2020 2020 2020 2020 636f  d'])..        co
+000100c0: 7079 5f66 696c 6520 3d20 6177 6169 7420  py_file = await 
+000100d0: 6669 6c65 5f63 6c69 656e 742e 646f 776e  file_client.down
+000100e0: 6c6f 6164 5f66 696c 6528 290a 2020 2020  load_file().    
+000100f0: 2020 2020 636f 6e74 656e 7420 3d20 6177      content = aw
+00010100: 6169 7420 636f 7079 5f66 696c 652e 7265  ait copy_file.re
+00010110: 6164 616c 6c28 290a 2020 2020 2020 2020  adall().        
+00010120: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00010130: 2863 6f6e 7465 6e74 2c20 7365 6c66 2e73  (content, self.s
+00010140: 686f 7274 5f62 7974 655f 6461 7461 290a  hort_byte_data).
+00010150: 0a20 2020 2040 4669 6c65 5368 6172 6550  .    @FileShareP
+00010160: 7265 7061 7265 7228 290a 2020 2020 4041  reparer().    @A
+00010170: 7379 6e63 5374 6f72 6167 6554 6573 7443  syncStorageTestC
+00010180: 6173 652e 6177 6169 745f 7072 6570 6172  ase.await_prepar
+00010190: 6564 5f74 6573 740a 2020 2020 6173 796e  ed_test.    asyn
+000101a0: 6320 6465 6620 7465 7374 5f63 6f70 795f  c def test_copy_
+000101b0: 6669 6c65 5f61 7379 6e63 5f70 7269 7661  file_async_priva
+000101c0: 7465 5f66 696c 655f 6173 796e 6328 7365  te_file_async(se
+000101d0: 6c66 2c20 7374 6f72 6167 655f 6163 636f  lf, storage_acco
+000101e0: 756e 745f 6e61 6d65 2c20 7374 6f72 6167  unt_name, storag
+000101f0: 655f 6163 636f 756e 745f 6b65 792c 2073  e_account_key, s
+00010200: 6563 6f6e 6461 7279 5f73 746f 7261 6765  econdary_storage
+00010210: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
+00010220: 6563 6f6e 6461 7279 5f73 746f 7261 6765  econdary_storage
+00010230: 5f61 6363 6f75 6e74 5f6b 6579 293a 0a20  _account_key):. 
+00010240: 2020 2020 2020 2073 656c 662e 5f73 6574         self._set
+00010250: 7570 2873 746f 7261 6765 5f61 6363 6f75  up(storage_accou
+00010260: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
+00010270: 5f61 6363 6f75 6e74 5f6b 6579 2c20 7365  _account_key, se
+00010280: 636f 6e64 6172 795f 7374 6f72 6167 655f  condary_storage_
+00010290: 6163 636f 756e 745f 6e61 6d65 2c20 7365  account_name, se
+000102a0: 636f 6e64 6172 795f 7374 6f72 6167 655f  condary_storage_
+000102b0: 6163 636f 756e 745f 6b65 7929 0a20 2020  account_key).   
+000102c0: 2020 2020 2061 7761 6974 2073 656c 662e       await self.
+000102d0: 5f73 6574 7570 5f73 6861 7265 2873 746f  _setup_share(sto
+000102e0: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
+000102f0: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
+00010300: 6e74 5f6b 6579 290a 2020 2020 2020 2020  nt_key).        
+00010310: 6177 6169 7420 7365 6c66 2e5f 6372 6561  await self._crea
+00010320: 7465 5f72 656d 6f74 655f 7368 6172 6528  te_remote_share(
+00010330: 290a 2020 2020 2020 2020 736f 7572 6365  ).        source
+00010340: 5f66 696c 6520 3d20 6177 6169 7420 7365  _file = await se
+00010350: 6c66 2e5f 6372 6561 7465 5f72 656d 6f74  lf._create_remot
+00010360: 655f 6669 6c65 2829 0a0a 2020 2020 2020  e_file()..      
+00010370: 2020 2320 4163 740a 2020 2020 2020 2020    # Act.        
+00010380: 7461 7267 6574 5f66 696c 655f 6e61 6d65  target_file_name
+00010390: 203d 2027 7461 7267 6574 6669 6c65 270a   = 'targetfile'.
+000103a0: 2020 2020 2020 2020 6669 6c65 5f63 6c69          file_cli
+000103b0: 656e 7420 3d20 5368 6172 6546 696c 6543  ent = ShareFileC
+000103c0: 6c69 656e 7428 0a20 2020 2020 2020 2020  lient(.         
+000103d0: 2020 2073 656c 662e 6163 636f 756e 745f     self.account_
+000103e0: 7572 6c28 7374 6f72 6167 655f 6163 636f  url(storage_acco
+000103f0: 756e 745f 6e61 6d65 2c20 2266 696c 6522  unt_name, "file"
+00010400: 292c 0a20 2020 2020 2020 2020 2020 2073  ),.            s
+00010410: 6861 7265 5f6e 616d 653d 7365 6c66 2e73  hare_name=self.s
+00010420: 6861 7265 5f6e 616d 652c 0a20 2020 2020  hare_name,.     
+00010430: 2020 2020 2020 2066 696c 655f 7061 7468         file_path
+00010440: 3d74 6172 6765 745f 6669 6c65 5f6e 616d  =target_file_nam
+00010450: 652c 0a20 2020 2020 2020 2020 2020 2063  e,.            c
+00010460: 7265 6465 6e74 6961 6c3d 7374 6f72 6167  redential=storag
+00010470: 655f 6163 636f 756e 745f 6b65 792c 0a20  e_account_key,. 
+00010480: 2020 2020 2020 2020 2020 2074 7261 6e73             trans
+00010490: 706f 7274 3d41 696f 6874 7470 5465 7374  port=AiohttpTest
+000104a0: 5472 616e 7370 6f72 7428 2929 0a20 2020  Transport()).   
+000104b0: 2020 2020 2077 6974 6820 7365 6c66 2e61       with self.a
+000104c0: 7373 6572 7452 6169 7365 7328 4874 7470  ssertRaises(Http
+000104d0: 5265 7370 6f6e 7365 4572 726f 7229 2061  ResponseError) a
+000104e0: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
+000104f0: 2061 7761 6974 2066 696c 655f 636c 6965   await file_clie
+00010500: 6e74 2e73 7461 7274 5f63 6f70 795f 6672  nt.start_copy_fr
+00010510: 6f6d 5f75 726c 2873 6f75 7263 655f 6669  om_url(source_fi
+00010520: 6c65 2e75 726c 290a 0a20 2020 2020 2020  le.url)..       
+00010530: 2023 2041 7373 6572 740a 2020 2020 2020   # Assert.      
+00010540: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00010550: 616c 2865 2e65 7863 6570 7469 6f6e 2e65  al(e.exception.e
+00010560: 7272 6f72 5f63 6f64 652c 2053 746f 7261  rror_code, Stora
+00010570: 6765 4572 726f 7243 6f64 652e 6361 6e6e  geErrorCode.cann
+00010580: 6f74 5f76 6572 6966 795f 636f 7079 5f73  ot_verify_copy_s
+00010590: 6f75 7263 6529 0a20 2020 2020 2020 2061  ource).        a
+000105a0: 7761 6974 2073 656c 662e 6673 6332 2e64  wait self.fsc2.d
+000105b0: 656c 6574 655f 7368 6172 6528 7365 6c66  elete_share(self
+000105c0: 2e72 656d 6f74 655f 7368 6172 655f 6e61  .remote_share_na
+000105d0: 6d65 290a 0a20 2020 2040 4669 6c65 5368  me)..    @FileSh
+000105e0: 6172 6550 7265 7061 7265 7228 290a 2020  arePreparer().  
+000105f0: 2020 4041 7379 6e63 5374 6f72 6167 6554    @AsyncStorageT
+00010600: 6573 7443 6173 652e 6177 6169 745f 7072  estCase.await_pr
+00010610: 6570 6172 6564 5f74 6573 740a 2020 2020  epared_test.    
+00010620: 6173 796e 6320 6465 6620 7465 7374 5f63  async def test_c
+00010630: 6f70 795f 6669 6c65 5f61 7379 6e63 5f70  opy_file_async_p
+00010640: 7269 7661 7465 5f66 696c 655f 7769 7468  rivate_file_with
+00010650: 5f73 6173 5f61 7379 6e63 2873 656c 662c  _sas_async(self,
+00010660: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
+00010670: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
+00010680: 6363 6f75 6e74 5f6b 6579 2c20 7365 636f  ccount_key, seco
+00010690: 6e64 6172 795f 7374 6f72 6167 655f 6163  ndary_storage_ac
+000106a0: 636f 756e 745f 6e61 6d65 2c20 7365 636f  count_name, seco
+000106b0: 6e64 6172 795f 7374 6f72 6167 655f 6163  ndary_storage_ac
+000106c0: 636f 756e 745f 6b65 7929 3a0a 2020 2020  count_key):.    
+000106d0: 2020 2020 7365 6c66 2e5f 7365 7475 7028      self._setup(
+000106e0: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
+000106f0: 6e61 6d65 2c20 7374 6f72 6167 655f 6163  name, storage_ac
+00010700: 636f 756e 745f 6b65 792c 2073 6563 6f6e  count_key, secon
+00010710: 6461 7279 5f73 746f 7261 6765 5f61 6363  dary_storage_acc
+00010720: 6f75 6e74 5f6e 616d 652c 2073 6563 6f6e  ount_name, secon
+00010730: 6461 7279 5f73 746f 7261 6765 5f61 6363  dary_storage_acc
+00010740: 6f75 6e74 5f6b 6579 290a 2020 2020 2020  ount_key).      
+00010750: 2020 6461 7461 203d 2062 2731 3233 3435    data = b'12345
+00010760: 3637 3827 202a 2031 3032 3420 2a20 3130  678' * 1024 * 10
+00010770: 3234 0a20 2020 2020 2020 2061 7761 6974  24.        await
+00010780: 2073 656c 662e 5f63 7265 6174 655f 7265   self._create_re
+00010790: 6d6f 7465 5f73 6861 7265 2829 0a20 2020  mote_share().   
+000107a0: 2020 2020 2073 6f75 7263 655f 6669 6c65       source_file
+000107b0: 203d 2061 7761 6974 2073 656c 662e 5f63   = await self._c
+000107c0: 7265 6174 655f 7265 6d6f 7465 5f66 696c  reate_remote_fil
+000107d0: 6528 6669 6c65 5f64 6174 613d 6461 7461  e(file_data=data
+000107e0: 290a 2020 2020 2020 2020 7361 735f 746f  ).        sas_to
+000107f0: 6b65 6e20 3d20 6765 6e65 7261 7465 5f66  ken = generate_f
+00010800: 696c 655f 7361 7328 0a20 2020 2020 2020  ile_sas(.       
+00010810: 2020 2020 2073 6f75 7263 655f 6669 6c65       source_file
+00010820: 2e61 6363 6f75 6e74 5f6e 616d 652c 0a20  .account_name,. 
+00010830: 2020 2020 2020 2020 2020 2073 6f75 7263             sourc
+00010840: 655f 6669 6c65 2e73 6861 7265 5f6e 616d  e_file.share_nam
+00010850: 652c 0a20 2020 2020 2020 2020 2020 2073  e,.            s
+00010860: 6f75 7263 655f 6669 6c65 2e66 696c 655f  ource_file.file_
+00010870: 7061 7468 2c0a 2020 2020 2020 2020 2020  path,.          
+00010880: 2020 736f 7572 6365 5f66 696c 652e 6372    source_file.cr
+00010890: 6564 656e 7469 616c 2e61 6363 6f75 6e74  edential.account
+000108a0: 5f6b 6579 2c0a 2020 2020 2020 2020 2020  _key,.          
+000108b0: 2020 7065 726d 6973 7369 6f6e 3d46 696c    permission=Fil
+000108c0: 6553 6173 5065 726d 6973 7369 6f6e 7328  eSasPermissions(
+000108d0: 7265 6164 3d54 7275 6529 2c0a 2020 2020  read=True),.    
+000108e0: 2020 2020 2020 2020 6578 7069 7279 3d64          expiry=d
+000108f0: 6174 6574 696d 652e 7574 636e 6f77 2829  atetime.utcnow()
+00010900: 202b 2074 696d 6564 656c 7461 2868 6f75   + timedelta(hou
+00010910: 7273 3d31 292c 0a20 2020 2020 2020 2029  rs=1),.        )
+00010920: 0a20 2020 2020 2020 2073 6f75 7263 655f  .        source_
+00010930: 7572 6c20 3d20 736f 7572 6365 5f66 696c  url = source_fil
+00010940: 652e 7572 6c20 2b20 273f 2720 2b20 7361  e.url + '?' + sa
+00010950: 735f 746f 6b65 6e0a 0a20 2020 2020 2020  s_token..       
+00010960: 2023 2041 6374 0a20 2020 2020 2020 2074   # Act.        t
+00010970: 6172 6765 745f 6669 6c65 5f6e 616d 6520  arget_file_name 
+00010980: 3d20 2774 6172 6765 7466 696c 6527 0a20  = 'targetfile'. 
+00010990: 2020 2020 2020 2061 7761 6974 2073 656c         await sel
+000109a0: 662e 5f73 6574 7570 5f73 6861 7265 2873  f._setup_share(s
+000109b0: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
+000109c0: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
+000109d0: 6f75 6e74 5f6b 6579 290a 2020 2020 2020  ount_key).      
+000109e0: 2020 6669 6c65 5f63 6c69 656e 7420 3d20    file_client = 
+000109f0: 5368 6172 6546 696c 6543 6c69 656e 7428  ShareFileClient(
+00010a00: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00010a10: 662e 6163 636f 756e 745f 7572 6c28 7374  f.account_url(st
+00010a20: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
+00010a30: 6d65 2c20 2266 696c 6522 292c 0a20 2020  me, "file"),.   
+00010a40: 2020 2020 2020 2020 2073 6861 7265 5f6e           share_n
+00010a50: 616d 653d 7365 6c66 2e73 6861 7265 5f6e  ame=self.share_n
+00010a60: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
+00010a70: 2066 696c 655f 7061 7468 3d74 6172 6765   file_path=targe
+00010a80: 745f 6669 6c65 5f6e 616d 652c 0a20 2020  t_file_name,.   
+00010a90: 2020 2020 2020 2020 2063 7265 6465 6e74           credent
+00010aa0: 6961 6c3d 7374 6f72 6167 655f 6163 636f  ial=storage_acco
+00010ab0: 756e 745f 6b65 792c 0a20 2020 2020 2020  unt_key,.       
+00010ac0: 2020 2020 2074 7261 6e73 706f 7274 3d41       transport=A
+00010ad0: 696f 6874 7470 5465 7374 5472 616e 7370  iohttpTestTransp
+00010ae0: 6f72 7428 2929 0a20 2020 2020 2020 2063  ort()).        c
+00010af0: 6f70 795f 7265 7370 203d 2061 7761 6974  opy_resp = await
+00010b00: 2066 696c 655f 636c 6965 6e74 2e73 7461   file_client.sta
+00010b10: 7274 5f63 6f70 795f 6672 6f6d 5f75 726c  rt_copy_from_url
+00010b20: 2873 6f75 7263 655f 7572 6c29 0a0a 2020  (source_url)..  
+00010b30: 2020 2020 2020 2320 4173 7365 7274 0a20        # Assert. 
+00010b40: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00010b50: 7274 5472 7565 2863 6f70 795f 7265 7370  rtTrue(copy_resp
+00010b60: 5b27 636f 7079 5f73 7461 7475 7327 5d20  ['copy_status'] 
+00010b70: 696e 205b 2773 7563 6365 7373 272c 2027  in ['success', '
+00010b80: 7065 6e64 696e 6727 5d29 0a20 2020 2020  pending']).     
+00010b90: 2020 2061 7761 6974 2073 656c 662e 5f77     await self._w
+00010ba0: 6169 745f 666f 725f 6173 796e 635f 636f  ait_for_async_co
+00010bb0: 7079 2873 656c 662e 7368 6172 655f 6e61  py(self.share_na
+00010bc0: 6d65 2c20 7461 7267 6574 5f66 696c 655f  me, target_file_
+00010bd0: 6e61 6d65 2920 0a0a 2020 2020 2020 2020  name) ..        
+00010be0: 636f 6e74 656e 7420 3d20 6177 6169 7420  content = await 
+00010bf0: 6669 6c65 5f63 6c69 656e 742e 646f 776e  file_client.down
+00010c00: 6c6f 6164 5f66 696c 6528 290a 2020 2020  load_file().    
+00010c10: 2020 2020 6163 7475 616c 5f64 6174 6120      actual_data 
+00010c20: 3d20 6177 6169 7420 636f 6e74 656e 742e  = await content.
+00010c30: 7265 6164 616c 6c28 290a 2020 2020 2020  readall().      
+00010c40: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00010c50: 616c 2861 6374 7561 6c5f 6461 7461 2c20  al(actual_data, 
+00010c60: 6461 7461 290a 0a20 2020 2040 4669 6c65  data)..    @File
+00010c70: 5368 6172 6550 7265 7061 7265 7228 290a  SharePreparer().
+00010c80: 2020 2020 4041 7379 6e63 5374 6f72 6167      @AsyncStorag
+00010c90: 6554 6573 7443 6173 652e 6177 6169 745f  eTestCase.await_
+00010ca0: 7072 6570 6172 6564 5f74 6573 740a 2020  prepared_test.  
+00010cb0: 2020 6173 796e 6320 6465 6620 7465 7374    async def test
+00010cc0: 5f61 626f 7274 5f63 6f70 795f 6669 6c65  _abort_copy_file
+00010cd0: 5f61 7379 6e63 2873 656c 662c 2073 746f  _async(self, sto
+00010ce0: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
+00010cf0: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
+00010d00: 6e74 5f6b 6579 2c20 7365 636f 6e64 6172  nt_key, secondar
+00010d10: 795f 7374 6f72 6167 655f 6163 636f 756e  y_storage_accoun
+00010d20: 745f 6e61 6d65 2c20 7365 636f 6e64 6172  t_name, secondar
+00010d30: 795f 7374 6f72 6167 655f 6163 636f 756e  y_storage_accoun
+00010d40: 745f 6b65 7929 3a0a 2020 2020 2020 2020  t_key):.        
+00010d50: 7365 6c66 2e5f 7365 7475 7028 7374 6f72  self._setup(stor
+00010d60: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
+00010d70: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
+00010d80: 745f 6b65 792c 2073 6563 6f6e 6461 7279  t_key, secondary
+00010d90: 5f73 746f 7261 6765 5f61 6363 6f75 6e74  _storage_account
+00010da0: 5f6e 616d 652c 2073 6563 6f6e 6461 7279  _name, secondary
+00010db0: 5f73 746f 7261 6765 5f61 6363 6f75 6e74  _storage_account
+00010dc0: 5f6b 6579 290a 2020 2020 2020 2020 6461  _key).        da
+00010dd0: 7461 203d 2062 2731 3233 3435 3637 3827  ta = b'12345678'
+00010de0: 202a 2031 3032 3420 2a20 3130 3234 0a20   * 1024 * 1024. 
+00010df0: 2020 2020 2020 2061 7761 6974 2073 656c         await sel
+00010e00: 662e 5f73 6574 7570 5f73 6861 7265 2873  f._setup_share(s
+00010e10: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
+00010e20: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
+00010e30: 6f75 6e74 5f6b 6579 290a 2020 2020 2020  ount_key).      
+00010e40: 2020 6177 6169 7420 7365 6c66 2e5f 6372    await self._cr
+00010e50: 6561 7465 5f72 656d 6f74 655f 7368 6172  eate_remote_shar
+00010e60: 6528 290a 2020 2020 2020 2020 736f 7572  e().        sour
+00010e70: 6365 5f66 696c 6520 3d20 6177 6169 7420  ce_file = await 
+00010e80: 7365 6c66 2e5f 6372 6561 7465 5f72 656d  self._create_rem
+00010e90: 6f74 655f 6669 6c65 2866 696c 655f 6461  ote_file(file_da
+00010ea0: 7461 3d64 6174 6129 0a20 2020 2020 2020  ta=data).       
+00010eb0: 2073 6173 5f74 6f6b 656e 203d 2067 656e   sas_token = gen
+00010ec0: 6572 6174 655f 6669 6c65 5f73 6173 280a  erate_file_sas(.
+00010ed0: 2020 2020 2020 2020 2020 2020 736f 7572              sour
+00010ee0: 6365 5f66 696c 652e 6163 636f 756e 745f  ce_file.account_
+00010ef0: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
+00010f00: 2020 736f 7572 6365 5f66 696c 652e 7368    source_file.sh
+00010f10: 6172 655f 6e61 6d65 2c0a 2020 2020 2020  are_name,.      
+00010f20: 2020 2020 2020 736f 7572 6365 5f66 696c        source_fil
+00010f30: 652e 6669 6c65 5f70 6174 682c 0a20 2020  e.file_path,.   
+00010f40: 2020 2020 2020 2020 2073 6f75 7263 655f           source_
+00010f50: 6669 6c65 2e63 7265 6465 6e74 6961 6c2e  file.credential.
+00010f60: 6163 636f 756e 745f 6b65 792c 0a20 2020  account_key,.   
+00010f70: 2020 2020 2020 2020 2070 6572 6d69 7373           permiss
+00010f80: 696f 6e3d 4669 6c65 5361 7350 6572 6d69  ion=FileSasPermi
+00010f90: 7373 696f 6e73 2872 6561 643d 5472 7565  ssions(read=True
+00010fa0: 292c 0a20 2020 2020 2020 2020 2020 2065  ),.            e
+00010fb0: 7870 6972 793d 6461 7465 7469 6d65 2e75  xpiry=datetime.u
+00010fc0: 7463 6e6f 7728 2920 2b20 7469 6d65 6465  tcnow() + timede
+00010fd0: 6c74 6128 686f 7572 733d 3129 2c0a 2020  lta(hours=1),.  
+00010fe0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00010ff0: 736f 7572 6365 5f75 726c 203d 2073 6f75  source_url = sou
+00011000: 7263 655f 6669 6c65 2e75 726c 202b 2027  rce_file.url + '
+00011010: 3f27 202b 2073 6173 5f74 6f6b 656e 0a0a  ?' + sas_token..
+00011020: 2020 2020 2020 2020 2320 4163 740a 2020          # Act.  
+00011030: 2020 2020 2020 7461 7267 6574 5f66 696c        target_fil
+00011040: 655f 6e61 6d65 203d 2027 7461 7267 6574  e_name = 'target
+00011050: 6669 6c65 270a 2020 2020 2020 2020 6669  file'.        fi
+00011060: 6c65 5f63 6c69 656e 7420 3d20 5368 6172  le_client = Shar
+00011070: 6546 696c 6543 6c69 656e 7428 0a20 2020  eFileClient(.   
+00011080: 2020 2020 2020 2020 2073 656c 662e 6163           self.ac
+00011090: 636f 756e 745f 7572 6c28 7374 6f72 6167  count_url(storag
+000110a0: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
+000110b0: 2266 696c 6522 292c 0a20 2020 2020 2020  "file"),.       
+000110c0: 2020 2020 2073 6861 7265 5f6e 616d 653d       share_name=
+000110d0: 7365 6c66 2e73 6861 7265 5f6e 616d 652c  self.share_name,
+000110e0: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
+000110f0: 655f 7061 7468 3d74 6172 6765 745f 6669  e_path=target_fi
+00011100: 6c65 5f6e 616d 652c 0a20 2020 2020 2020  le_name,.       
+00011110: 2020 2020 2063 7265 6465 6e74 6961 6c3d       credential=
+00011120: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
+00011130: 6b65 792c 0a20 2020 2020 2020 2020 2020  key,.           
+00011140: 2074 7261 6e73 706f 7274 3d41 696f 6874   transport=Aioht
+00011150: 7470 5465 7374 5472 616e 7370 6f72 7428  tpTestTransport(
+00011160: 2929 0a20 2020 2020 2020 2063 6f70 795f  )).        copy_
+00011170: 7265 7370 203d 2061 7761 6974 2066 696c  resp = await fil
+00011180: 655f 636c 6965 6e74 2e73 7461 7274 5f63  e_client.start_c
+00011190: 6f70 795f 6672 6f6d 5f75 726c 2873 6f75  opy_from_url(sou
+000111a0: 7263 655f 7572 6c29 0a20 2020 2020 2020  rce_url).       
+000111b0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+000111c0: 6c28 636f 7079 5f72 6573 705b 2763 6f70  l(copy_resp['cop
+000111d0: 795f 7374 6174 7573 275d 2c20 2770 656e  y_status'], 'pen
+000111e0: 6469 6e67 2729 0a20 2020 2020 2020 2061  ding').        a
+000111f0: 7761 6974 2066 696c 655f 636c 6965 6e74  wait file_client
+00011200: 2e61 626f 7274 5f63 6f70 7928 636f 7079  .abort_copy(copy
+00011210: 5f72 6573 7029 0a0a 2020 2020 2020 2020  _resp)..        
+00011220: 2320 4173 7365 7274 0a20 2020 2020 2020  # Assert.       
+00011230: 2074 6172 6765 745f 6669 6c65 203d 2061   target_file = a
+00011240: 7761 6974 2066 696c 655f 636c 6965 6e74  wait file_client
+00011250: 2e64 6f77 6e6c 6f61 645f 6669 6c65 2829  .download_file()
+00011260: 0a20 2020 2020 2020 2063 6f6e 7465 6e74  .        content
+00011270: 203d 2061 7761 6974 2074 6172 6765 745f   = await target_
+00011280: 6669 6c65 2e72 6561 6461 6c6c 2829 0a20  file.readall(). 
+00011290: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+000112a0: 7274 4571 7561 6c28 636f 6e74 656e 742c  rtEqual(content,
+000112b0: 2062 2727 290a 2020 2020 2020 2020 7365   b'').        se
+000112c0: 6c66 2e61 7373 6572 7445 7175 616c 2874  lf.assertEqual(t
+000112d0: 6172 6765 745f 6669 6c65 2e70 726f 7065  arget_file.prope
+000112e0: 7274 6965 732e 636f 7079 2e73 7461 7475  rties.copy.statu
+000112f0: 732c 2027 6162 6f72 7465 6427 290a 0a20  s, 'aborted').. 
+00011300: 2020 2040 4669 6c65 5368 6172 6550 7265     @FileSharePre
+00011310: 7061 7265 7228 290a 2020 2020 4041 7379  parer().    @Asy
+00011320: 6e63 5374 6f72 6167 6554 6573 7443 6173  ncStorageTestCas
+00011330: 652e 6177 6169 745f 7072 6570 6172 6564  e.await_prepared
+00011340: 5f74 6573 740a 2020 2020 6173 796e 6320  _test.    async 
+00011350: 6465 6620 7465 7374 5f61 626f 7274 5f63  def test_abort_c
+00011360: 6f70 795f 6669 6c65 5f77 6974 685f 7379  opy_file_with_sy
+00011370: 6e63 6872 6f6e 6f75 735f 636f 7079 5f66  nchronous_copy_f
+00011380: 6169 6c73 5f61 7379 6e63 2873 656c 662c  ails_async(self,
+00011390: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
+000113a0: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
+000113b0: 6363 6f75 6e74 5f6b 6579 293a 0a20 2020  ccount_key):.   
+000113c0: 2020 2020 2073 656c 662e 5f73 6574 7570       self._setup
+000113d0: 2873 746f 7261 6765 5f61 6363 6f75 6e74  (storage_account
+000113e0: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
+000113f0: 6363 6f75 6e74 5f6b 6579 290a 2020 2020  ccount_key).    
+00011400: 2020 2020 736f 7572 6365 5f66 696c 6520      source_file 
+00011410: 3d20 6177 6169 7420 7365 6c66 2e5f 6372  = await self._cr
+00011420: 6561 7465 5f66 696c 6528 7374 6f72 6167  eate_file(storag
+00011430: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
+00011440: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
+00011450: 6b65 7929 0a0a 2020 2020 2020 2020 2320  key)..        # 
+00011460: 4163 740a 2020 2020 2020 2020 7461 7267  Act.        targ
+00011470: 6574 5f66 696c 655f 6e61 6d65 203d 2027  et_file_name = '
+00011480: 7461 7267 6574 6669 6c65 270a 2020 2020  targetfile'.    
+00011490: 2020 2020 6669 6c65 5f63 6c69 656e 7420      file_client 
+000114a0: 3d20 5368 6172 6546 696c 6543 6c69 656e  = ShareFileClien
+000114b0: 7428 0a20 2020 2020 2020 2020 2020 2073  t(.            s
+000114c0: 656c 662e 6163 636f 756e 745f 7572 6c28  elf.account_url(
+000114d0: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
+000114e0: 6e61 6d65 2c20 2266 696c 6522 292c 0a20  name, "file"),. 
+000114f0: 2020 2020 2020 2020 2020 2073 6861 7265             share
+00011500: 5f6e 616d 653d 7365 6c66 2e73 6861 7265  _name=self.share
+00011510: 5f6e 616d 652c 0a20 2020 2020 2020 2020  _name,.         
+00011520: 2020 2066 696c 655f 7061 7468 3d74 6172     file_path=tar
+00011530: 6765 745f 6669 6c65 5f6e 616d 652c 0a20  get_file_name,. 
+00011540: 2020 2020 2020 2020 2020 2063 7265 6465             crede
+00011550: 6e74 6961 6c3d 7374 6f72 6167 655f 6163  ntial=storage_ac
+00011560: 636f 756e 745f 6b65 792c 0a20 2020 2020  count_key,.     
+00011570: 2020 2020 2020 2074 7261 6e73 706f 7274         transport
+00011580: 3d41 696f 6874 7470 5465 7374 5472 616e  =AiohttpTestTran
+00011590: 7370 6f72 7428 2929 0a20 2020 2020 2020  sport()).       
+000115a0: 2063 6f70 795f 7265 7370 203d 2061 7761   copy_resp = awa
+000115b0: 6974 2066 696c 655f 636c 6965 6e74 2e73  it file_client.s
+000115c0: 7461 7274 5f63 6f70 795f 6672 6f6d 5f75  tart_copy_from_u
+000115d0: 726c 2873 6f75 7263 655f 6669 6c65 2e75  rl(source_file.u
+000115e0: 726c 290a 0a20 2020 2020 2020 2077 6974  rl)..        wit
+000115f0: 6820 7365 6c66 2e61 7373 6572 7452 6169  h self.assertRai
+00011600: 7365 7328 4874 7470 5265 7370 6f6e 7365  ses(HttpResponse
+00011610: 4572 726f 7229 3a0a 2020 2020 2020 2020  Error):.        
+00011620: 2020 2020 6177 6169 7420 6669 6c65 5f63      await file_c
+00011630: 6c69 656e 742e 6162 6f72 745f 636f 7079  lient.abort_copy
+00011640: 2863 6f70 795f 7265 7370 290a 0a20 2020  (copy_resp)..   
+00011650: 2020 2020 2023 2041 7373 6572 740a 2020       # Assert.  
+00011660: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00011670: 7445 7175 616c 2863 6f70 795f 7265 7370  tEqual(copy_resp
+00011680: 5b27 636f 7079 5f73 7461 7475 7327 5d2c  ['copy_status'],
+00011690: 2027 7375 6363 6573 7327 290a 0a20 2020   'success')..   
+000116a0: 2040 4669 6c65 5368 6172 6550 7265 7061   @FileSharePrepa
+000116b0: 7265 7228 290a 2020 2020 4041 7379 6e63  rer().    @Async
+000116c0: 5374 6f72 6167 6554 6573 7443 6173 652e  StorageTestCase.
+000116d0: 6177 6169 745f 7072 6570 6172 6564 5f74  await_prepared_t
+000116e0: 6573 740a 2020 2020 6173 796e 6320 6465  est.    async de
+000116f0: 6620 7465 7374 5f75 6e69 636f 6465 5f67  f test_unicode_g
+00011700: 6574 5f66 696c 655f 756e 6963 6f64 655f  et_file_unicode_
+00011710: 6e61 6d65 5f61 7379 6e63 2873 656c 662c  name_async(self,
+00011720: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
+00011730: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
+00011740: 6363 6f75 6e74 5f6b 6579 293a 0a20 2020  ccount_key):.   
+00011750: 2020 2020 2073 656c 662e 5f73 6574 7570       self._setup
+00011760: 2873 746f 7261 6765 5f61 6363 6f75 6e74  (storage_account
+00011770: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
+00011780: 6363 6f75 6e74 5f6b 6579 290a 2020 2020  ccount_key).    
+00011790: 2020 2020 6669 6c65 5f6e 616d 6520 3d20      file_name = 
+000117a0: 27e5 958a e9bd 84e4 b882 e78b 9be7 8b9c  '...............
+000117b0: 270a 2020 2020 2020 2020 6177 6169 7420  '.        await 
+000117c0: 7365 6c66 2e5f 7365 7475 705f 7368 6172  self._setup_shar
+000117d0: 6528 7374 6f72 6167 655f 6163 636f 756e  e(storage_accoun
+000117e0: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
+000117f0: 6163 636f 756e 745f 6b65 7929 0a20 2020  account_key).   
+00011800: 2020 2020 2066 696c 655f 636c 6965 6e74       file_client
+00011810: 203d 2053 6861 7265 4669 6c65 436c 6965   = ShareFileClie
+00011820: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
+00011830: 7365 6c66 2e61 6363 6f75 6e74 5f75 726c  self.account_url
+00011840: 2873 746f 7261 6765 5f61 6363 6f75 6e74  (storage_account
+00011850: 5f6e 616d 652c 2022 6669 6c65 2229 2c0a  _name, "file"),.
+00011860: 2020 2020 2020 2020 2020 2020 7368 6172              shar
+00011870: 655f 6e61 6d65 3d73 656c 662e 7368 6172  e_name=self.shar
+00011880: 655f 6e61 6d65 2c0a 2020 2020 2020 2020  e_name,.        
+00011890: 2020 2020 6669 6c65 5f70 6174 683d 6669      file_path=fi
+000118a0: 6c65 5f6e 616d 652c 0a20 2020 2020 2020  le_name,.       
+000118b0: 2020 2020 2063 7265 6465 6e74 6961 6c3d       credential=
+000118c0: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
+000118d0: 6b65 792c 0a20 2020 2020 2020 2020 2020  key,.           
+000118e0: 2074 7261 6e73 706f 7274 3d41 696f 6874   transport=Aioht
+000118f0: 7470 5465 7374 5472 616e 7370 6f72 7428  tpTestTransport(
+00011900: 2929 0a20 2020 2020 2020 2061 7761 6974  )).        await
+00011910: 2066 696c 655f 636c 6965 6e74 2e75 706c   file_client.upl
+00011920: 6f61 645f 6669 6c65 2862 2768 656c 6c6f  oad_file(b'hello
+00011930: 2077 6f72 6c64 2729 0a0a 2020 2020 2020   world')..      
+00011940: 2020 2320 4163 740a 2020 2020 2020 2020    # Act.        
+00011950: 636f 6e74 656e 7420 3d20 6177 6169 7420  content = await 
+00011960: 6669 6c65 5f63 6c69 656e 742e 646f 776e  file_client.down
+00011970: 6c6f 6164 5f66 696c 6528 290a 2020 2020  load_file().    
+00011980: 2020 2020 636f 6e74 656e 7420 3d20 6177      content = aw
+00011990: 6169 7420 636f 6e74 656e 742e 7265 6164  ait content.read
+000119a0: 616c 6c28 290a 0a20 2020 2020 2020 2023  all()..        #
+000119b0: 2041 7373 6572 740a 2020 2020 2020 2020   Assert.        
+000119c0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+000119d0: 2863 6f6e 7465 6e74 2c20 6227 6865 6c6c  (content, b'hell
+000119e0: 6f20 776f 726c 6427 290a 0a20 2020 2040  o world')..    @
+000119f0: 4669 6c65 5368 6172 6550 7265 7061 7265  FileSharePrepare
+00011a00: 7228 290a 2020 2020 4041 7379 6e63 5374  r().    @AsyncSt
+00011a10: 6f72 6167 6554 6573 7443 6173 652e 6177  orageTestCase.aw
+00011a20: 6169 745f 7072 6570 6172 6564 5f74 6573  ait_prepared_tes
+00011a30: 740a 2020 2020 6173 796e 6320 6465 6620  t.    async def 
+00011a40: 7465 7374 5f75 6e69 636f 6465 5f67 6574  test_unicode_get
+00011a50: 5f66 696c 655f 756e 6963 6f64 655f 6e61  _file_unicode_na
+00011a60: 6d65 5f77 6974 685f 6c65 6173 655f 6173  me_with_lease_as
+00011a70: 796e 6328 7365 6c66 2c20 7374 6f72 6167  ync(self, storag
+00011a80: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
+00011a90: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
+00011aa0: 6b65 7929 3a0a 2020 2020 2020 2020 7365  key):.        se
+00011ab0: 6c66 2e5f 7365 7475 7028 7374 6f72 6167  lf._setup(storag
+00011ac0: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
+00011ad0: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
+00011ae0: 6b65 7929 0a20 2020 2020 2020 2066 696c  key).        fil
+00011af0: 655f 6e61 6d65 203d 2027 e595 8ae9 bd84  e_name = '......
+00011b00: e4b8 82e7 8b9b e78b 9c27 0a20 2020 2020  .........'.     
+00011b10: 2020 2061 7761 6974 2073 656c 662e 5f73     await self._s
+00011b20: 6574 7570 5f73 6861 7265 2873 746f 7261  etup_share(stora
+00011b30: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
+00011b40: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
+00011b50: 5f6b 6579 290a 2020 2020 2020 2020 6669  _key).        fi
+00011b60: 6c65 5f63 6c69 656e 7420 3d20 5368 6172  le_client = Shar
+00011b70: 6546 696c 6543 6c69 656e 7428 0a20 2020  eFileClient(.   
+00011b80: 2020 2020 2020 2020 2073 656c 662e 6163           self.ac
+00011b90: 636f 756e 745f 7572 6c28 7374 6f72 6167  count_url(storag
+00011ba0: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
+00011bb0: 2266 696c 6522 292c 0a20 2020 2020 2020  "file"),.       
+00011bc0: 2020 2020 2073 6861 7265 5f6e 616d 653d       share_name=
+00011bd0: 7365 6c66 2e73 6861 7265 5f6e 616d 652c  self.share_name,
+00011be0: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
+00011bf0: 655f 7061 7468 3d66 696c 655f 6e61 6d65  e_path=file_name
+00011c00: 2c0a 2020 2020 2020 2020 2020 2020 6372  ,.            cr
+00011c10: 6564 656e 7469 616c 3d73 746f 7261 6765  edential=storage
+00011c20: 5f61 6363 6f75 6e74 5f6b 6579 2c0a 2020  _account_key,.  
+00011c30: 2020 2020 2020 2020 2020 7472 616e 7370            transp
+00011c40: 6f72 743d 4169 6f68 7474 7054 6573 7454  ort=AiohttpTestT
+00011c50: 7261 6e73 706f 7274 2829 290a 2020 2020  ransport()).    
+00011c60: 2020 2020 6177 6169 7420 6669 6c65 5f63      await file_c
+00011c70: 6c69 656e 742e 6372 6561 7465 5f66 696c  lient.create_fil
+00011c80: 6528 3130 3234 290a 2020 2020 2020 2020  e(1024).        
+00011c90: 6c65 6173 6520 3d20 6177 6169 7420 6669  lease = await fi
+00011ca0: 6c65 5f63 6c69 656e 742e 6163 7175 6972  le_client.acquir
+00011cb0: 655f 6c65 6173 6528 290a 0a20 2020 2020  e_lease()..     
+00011cc0: 2020 2077 6974 6820 7365 6c66 2e61 7373     with self.ass
+00011cd0: 6572 7452 6169 7365 7328 4874 7470 5265  ertRaises(HttpRe
+00011ce0: 7370 6f6e 7365 4572 726f 7229 3a0a 2020  sponseError):.  
+00011cf0: 2020 2020 2020 2020 2020 6177 6169 7420            await 
+00011d00: 6669 6c65 5f63 6c69 656e 742e 7570 6c6f  file_client.uplo
+00011d10: 6164 5f66 696c 6528 6227 6865 6c6c 6f20  ad_file(b'hello 
+00011d20: 776f 726c 6427 290a 0a20 2020 2020 2020  world')..       
+00011d30: 2061 7761 6974 2066 696c 655f 636c 6965   await file_clie
+00011d40: 6e74 2e75 706c 6f61 645f 6669 6c65 2862  nt.upload_file(b
+00011d50: 2768 656c 6c6f 2077 6f72 6c64 272c 206c  'hello world', l
+00011d60: 6561 7365 3d6c 6561 7365 290a 0a20 2020  ease=lease)..   
+00011d70: 2020 2020 2023 2041 6374 0a20 2020 2020       # Act.     
+00011d80: 2020 2023 2064 6f77 6e6c 6f61 6420 7468     # download th
+00011d90: 6520 6669 6c65 2077 6974 6820 6120 7772  e file with a wr
+00011da0: 6f6e 6720 6c65 6173 6520 6964 2077 696c  ong lease id wil
+00011db0: 6c20 6661 696c 0a20 2020 2020 2020 2077  l fail.        w
+00011dc0: 6974 6820 7365 6c66 2e61 7373 6572 7452  ith self.assertR
+00011dd0: 6169 7365 7328 4874 7470 5265 7370 6f6e  aises(HttpRespon
+00011de0: 7365 4572 726f 7229 3a0a 2020 2020 2020  seError):.      
+00011df0: 2020 2020 2020 6177 6169 7420 6669 6c65        await file
+00011e00: 5f63 6c69 656e 742e 7570 6c6f 6164 5f66  _client.upload_f
+00011e10: 696c 6528 6227 6865 6c6c 6f20 776f 726c  ile(b'hello worl
+00011e20: 6427 2c20 6c65 6173 653d 7374 7228 7575  d', lease=str(uu
+00011e30: 6964 2e75 7569 6434 2829 2929 0a0a 2020  id.uuid4()))..  
+00011e40: 2020 2020 2020 636f 6e74 656e 7420 3d20        content = 
+00011e50: 6177 6169 7420 6669 6c65 5f63 6c69 656e  await file_clien
+00011e60: 742e 646f 776e 6c6f 6164 5f66 696c 6528  t.download_file(
+00011e70: 290a 2020 2020 2020 2020 636f 6e74 656e  ).        conten
+00011e80: 7420 3d20 6177 6169 7420 636f 6e74 656e  t = await conten
+00011e90: 742e 7265 6164 616c 6c28 290a 0a20 2020  t.readall()..   
+00011ea0: 2020 2020 2023 2041 7373 6572 740a 2020       # Assert.  
+00011eb0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00011ec0: 7445 7175 616c 2863 6f6e 7465 6e74 2c20  tEqual(content, 
+00011ed0: 6227 6865 6c6c 6f20 776f 726c 6427 290a  b'hello world').
+00011ee0: 0a20 2020 2040 4669 6c65 5368 6172 6550  .    @FileShareP
+00011ef0: 7265 7061 7265 7228 290a 2020 2020 4041  reparer().    @A
+00011f00: 7379 6e63 5374 6f72 6167 6554 6573 7443  syncStorageTestC
+00011f10: 6173 652e 6177 6169 745f 7072 6570 6172  ase.await_prepar
+00011f20: 6564 5f74 6573 740a 2020 2020 6173 796e  ed_test.    asyn
+00011f30: 6320 6465 6620 7465 7374 5f66 696c 655f  c def test_file_
+00011f40: 756e 6963 6f64 655f 6461 7461 5f61 7379  unicode_data_asy
+00011f50: 6e63 2873 656c 662c 2073 746f 7261 6765  nc(self, storage
+00011f60: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
+00011f70: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
+00011f80: 6579 293a 0a20 2020 2020 2020 2073 656c  ey):.        sel
+00011f90: 662e 5f73 6574 7570 2873 746f 7261 6765  f._setup(storage
+00011fa0: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
+00011fb0: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
+00011fc0: 6579 290a 2020 2020 2020 2020 6669 6c65  ey).        file
+00011fd0: 5f6e 616d 6520 3d20 7365 6c66 2e5f 6765  _name = self._ge
+00011fe0: 745f 6669 6c65 5f72 6566 6572 656e 6365  t_file_reference
+00011ff0: 2829 0a20 2020 2020 2020 2061 7761 6974  ().        await
+00012000: 2073 656c 662e 5f73 6574 7570 5f73 6861   self._setup_sha
+00012010: 7265 2873 746f 7261 6765 5f61 6363 6f75  re(storage_accou
+00012020: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
+00012030: 5f61 6363 6f75 6e74 5f6b 6579 290a 2020  _account_key).  
+00012040: 2020 2020 2020 6669 6c65 5f63 6c69 656e        file_clien
+00012050: 7420 3d20 5368 6172 6546 696c 6543 6c69  t = ShareFileCli
+00012060: 656e 7428 0a20 2020 2020 2020 2020 2020  ent(.           
+00012070: 2073 656c 662e 6163 636f 756e 745f 7572   self.account_ur
+00012080: 6c28 7374 6f72 6167 655f 6163 636f 756e  l(storage_accoun
+00012090: 745f 6e61 6d65 2c20 2266 696c 6522 292c  t_name, "file"),
+000120a0: 0a20 2020 2020 2020 2020 2020 2073 6861  .            sha
+000120b0: 7265 5f6e 616d 653d 7365 6c66 2e73 6861  re_name=self.sha
+000120c0: 7265 5f6e 616d 652c 0a20 2020 2020 2020  re_name,.       
+000120d0: 2020 2020 2066 696c 655f 7061 7468 3d66       file_path=f
+000120e0: 696c 655f 6e61 6d65 2c0a 2020 2020 2020  ile_name,.      
+000120f0: 2020 2020 2020 6372 6564 656e 7469 616c        credential
+00012100: 3d73 746f 7261 6765 5f61 6363 6f75 6e74  =storage_account
+00012110: 5f6b 6579 290a 0a20 2020 2020 2020 2023  _key)..        #
+00012120: 2041 6374 0a20 2020 2020 2020 2064 6174   Act.        dat
+00012130: 6120 3d20 7527 6865 6c6c 6f20 776f 726c  a = u'hello worl
+00012140: 64e5 958a e9bd 84e4 b882 e78b 9be7 8b9c  d...............
+00012150: 272e 656e 636f 6465 2827 7574 662d 3827  '.encode('utf-8'
+00012160: 290a 2020 2020 2020 2020 6177 6169 7420  ).        await 
+00012170: 6669 6c65 5f63 6c69 656e 742e 7570 6c6f  file_client.uplo
+00012180: 6164 5f66 696c 6528 6461 7461 290a 0a20  ad_file(data).. 
+00012190: 2020 2020 2020 2023 2041 7373 6572 740a         # Assert.
+000121a0: 2020 2020 2020 2020 636f 6e74 656e 7420          content 
+000121b0: 3d20 6177 6169 7420 6669 6c65 5f63 6c69  = await file_cli
+000121c0: 656e 742e 646f 776e 6c6f 6164 5f66 696c  ent.download_fil
+000121d0: 6528 290a 2020 2020 2020 2020 636f 6e74  e().        cont
+000121e0: 656e 7420 3d20 6177 6169 7420 636f 6e74  ent = await cont
+000121f0: 656e 742e 7265 6164 616c 6c28 290a 2020  ent.readall().  
+00012200: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00012210: 7445 7175 616c 2863 6f6e 7465 6e74 2c20  tEqual(content, 
+00012220: 6461 7461 290a 0a20 2020 2040 4669 6c65  data)..    @File
+00012230: 5368 6172 6550 7265 7061 7265 7228 290a  SharePreparer().
+00012240: 2020 2020 4041 7379 6e63 5374 6f72 6167      @AsyncStorag
+00012250: 6554 6573 7443 6173 652e 6177 6169 745f  eTestCase.await_
+00012260: 7072 6570 6172 6564 5f74 6573 740a 2020  prepared_test.  
+00012270: 2020 6173 796e 6320 6465 6620 7465 7374    async def test
+00012280: 5f66 696c 655f 756e 6963 6f64 655f 6461  _file_unicode_da
+00012290: 7461 5f61 6e64 5f66 696c 655f 6174 7472  ta_and_file_attr
+000122a0: 6962 7574 6573 2873 656c 662c 2073 746f  ibutes(self, sto
+000122b0: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
+000122c0: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
+000122d0: 6e74 5f6b 6579 293a 0a20 2020 2020 2020  nt_key):.       
+000122e0: 2073 656c 662e 5f73 6574 7570 2873 746f   self._setup(sto
+000122f0: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
+00012300: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
+00012310: 6e74 5f6b 6579 290a 2020 2020 2020 2020  nt_key).        
+00012320: 6669 6c65 5f63 6c69 656e 7420 3d20 6177  file_client = aw
+00012330: 6169 7420 7365 6c66 2e5f 6765 745f 6669  ait self._get_fi
+00012340: 6c65 5f63 6c69 656e 7428 7374 6f72 6167  le_client(storag
+00012350: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
+00012360: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
+00012370: 6b65 7929 0a0a 2020 2020 2020 2020 2320  key)..        # 
+00012380: 4163 740a 2020 2020 2020 2020 6461 7461  Act.        data
+00012390: 203d 2075 2768 656c 6c6f 2077 6f72 6c64   = u'hello world
+000123a0: e595 8ae9 bd84 e4b8 82e7 8b9b e78b 9c27  ...............'
+000123b0: 2e65 6e63 6f64 6528 2775 7466 2d38 2729  .encode('utf-8')
+000123c0: 0a20 2020 2020 2020 2061 7761 6974 2066  .        await f
+000123d0: 696c 655f 636c 6965 6e74 2e75 706c 6f61  ile_client.uploa
+000123e0: 645f 6669 6c65 2864 6174 612c 2066 696c  d_file(data, fil
+000123f0: 655f 6174 7472 6962 7574 6573 3d4e 5446  e_attributes=NTF
+00012400: 5341 7474 7269 6275 7465 7328 7465 6d70  SAttributes(temp
+00012410: 6f72 6172 793d 5472 7565 2929 0a0a 2020  orary=True))..  
+00012420: 2020 2020 2020 2320 4173 7365 7274 0a20        # Assert. 
+00012430: 2020 2020 2020 2063 6f6e 7465 6e74 203d         content =
+00012440: 2061 7761 6974 2066 696c 655f 636c 6965   await file_clie
+00012450: 6e74 2e64 6f77 6e6c 6f61 645f 6669 6c65  nt.download_file
+00012460: 2829 0a20 2020 2020 2020 2074 7261 6e73  ().        trans
+00012470: 666f 726d 6564 5f63 6f6e 7465 6e74 203d  formed_content =
+00012480: 2061 7761 6974 2063 6f6e 7465 6e74 2e72   await content.r
+00012490: 6561 6461 6c6c 2829 0a20 2020 2020 2020  eadall().       
+000124a0: 2070 726f 7065 7274 6965 7320 3d20 6177   properties = aw
+000124b0: 6169 7420 6669 6c65 5f63 6c69 656e 742e  ait file_client.
+000124c0: 6765 745f 6669 6c65 5f70 726f 7065 7274  get_file_propert
+000124d0: 6965 7328 290a 2020 2020 2020 2020 7365  ies().        se
+000124e0: 6c66 2e61 7373 6572 7445 7175 616c 2874  lf.assertEqual(t
+000124f0: 7261 6e73 666f 726d 6564 5f63 6f6e 7465  ransformed_conte
+00012500: 6e74 2c20 6461 7461 290a 2020 2020 2020  nt, data).      
+00012510: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
+00012520: 2754 656d 706f 7261 7279 272c 2070 726f  'Temporary', pro
+00012530: 7065 7274 6965 732e 6669 6c65 5f61 7474  perties.file_att
+00012540: 7269 6275 7465 7329 0a0a 2020 2020 4046  ributes)..    @F
+00012550: 696c 6553 6861 7265 5072 6570 6172 6572  ileSharePreparer
+00012560: 2829 0a20 2020 2040 4173 796e 6353 746f  ().    @AsyncSto
+00012570: 7261 6765 5465 7374 4361 7365 2e61 7761  rageTestCase.awa
+00012580: 6974 5f70 7265 7061 7265 645f 7465 7374  it_prepared_test
+00012590: 0a20 2020 2061 7379 6e63 2064 6566 2074  .    async def t
+000125a0: 6573 745f 756e 6963 6f64 655f 6765 745f  est_unicode_get_
+000125b0: 6669 6c65 5f62 696e 6172 795f 6461 7461  file_binary_data
+000125c0: 5f61 7379 6e63 2873 656c 662c 2073 746f  _async(self, sto
+000125d0: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
+000125e0: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
+000125f0: 6e74 5f6b 6579 293a 0a20 2020 2020 2020  nt_key):.       
+00012600: 2073 656c 662e 5f73 6574 7570 2873 746f   self._setup(sto
+00012610: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
+00012620: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
+00012630: 6e74 5f6b 6579 290a 2020 2020 2020 2020  nt_key).        
+00012640: 6261 7365 3634 5f64 6174 6120 3d20 2741  base64_data = 'A
+00012650: 4145 4341 7751 4642 6763 4943 516f 4c44  AECAwQFBgcICQoLD
+00012660: 4130 4f44 7841 5245 684d 5546 5259 5847  A0ODxAREhMUFRYXG
+00012670: 426b 6147 7877 6448 6838 6749 5349 6a4a  BkaGxwdHh8gISIjJ
+00012680: 4355 6d4a 7967 704b 6973 734c 5334 764d  CUmJygpKissLS4vM
+00012690: 4445 794d 7a51 314e 6a63 344f 546f 3750  DEyMzQ1Njc4OTo7P
+000126a0: 4430 2b50 3042 4251 6b4e 4552 555a 4853  D0+P0BBQkNERUZHS
+000126b0: 456c 4b53 3078 4e54 6b39 5155 564a 5456  ElKS0xNTk9QUVJTV
+000126c0: 4656 5756 3168 5a57 6c74 6358 5635 6659  FVWV1hZWltcXV5fY
+000126d0: 4746 6959 3252 6c5a 6d64 6f61 5770 7262  GFiY2RlZmdoaWprb
+000126e0: 4731 7562 3342 7863 6e4e 3064 585a 3365  G1ub3BxcnN0dXZ3e
+000126f0: 486c 3665 3378 3966 6e2b 4167 594b 4468  Hl6e3x9fn+AgYKDh
+00012700: 4957 4768 3469 4a69 6f75 4d6a 5936 506b  IWGh4iJiouMjY6Pk
+00012710: 4a47 536b 3553 566c 7065 596d 5a71 626e  JGSk5SVlpeYmZqbn
+00012720: 4a32 656e 3643 686f 714f 6b70 6161 6e71  J2en6ChoqOkpaanq
+00012730: 4b6d 7171 3679 7472 712b 7773 624b 7a74  Kmqq6ytrq+wsbKzt
+00012740: 4c57 3274 3769 3575 7275 3876 6236 2f77  LW2t7i5uru8vb6/w
+00012750: 4d48 4377 3854 4678 7366 4979 6372 4c7a  MHCw8TFxsfIycrLz
+00012760: 4d33 4f7a 3944 5230 7450 5531 6462 5832  M3Oz9DR0tPU1dbX2
+00012770: 4e6e 6132 397a 6433 742f 6734 654c 6a35  Nna29zd3t/g4eLj5
+00012780: 4f58 6d35 2b6a 7036 7576 7337 6537 7638  OXm5+jp6uvs7e7v8
+00012790: 5048 7938 2f54 3139 7666 342b 6672 372f  PHy8/T19vf4+fr7/
+000127a0: 5033 2b2f 7741 4241 674d 4542 5159 4843  P3+/wABAgMEBQYHC
+000127b0: 416b 4b43 7777 4e44 6738 5145 5249 5446  AkKCwwNDg8QERITF
+000127c0: 4255 5746 7867 5a47 6873 6348 5234 6649  BUWFxgZGhscHR4fI
+000127d0: 4345 6949 7951 6c4a 6963 6f4b 536f 724c  CEiIyQlJicoKSorL
+000127e0: 4330 754c 7a41 784d 6a4d 304e 5459 334f  C0uLzAxMjM0NTY3O
+000127f0: 446b 364f 7a77 3950 6a39 4151 554a 4452  Dk6Ozw9Pj9AQUJDR
+00012800: 4556 4752 3068 4a53 6b74 4d54 5535 5055  EVGR0hJSktMTU5PU
+00012810: 4646 5355 3152 5656 6c64 5957 5670 6258  FFSU1RVVldYWVpbX
+00012820: 4631 6558 3242 6859 6d4e 6b5a 575a 6e61  F1eX2BhYmNkZWZna
+00012830: 476c 7161 3278 7462 6d39 7763 584a 7a64  Glqa2xtbm9wcXJzd
+00012840: 4856 3264 3368 3565 6e74 3866 5835 2f67  HV2d3h5ent8fX5/g
+00012850: 4947 4367 3453 4668 6f65 4969 5971 4c6a  IGCg4SFhoeIiYqLj
+00012860: 4932 4f6a 3543 526b 704f 556c 5a61 586d  I2Oj5CRkpOUlZaXm
+00012870: 4a6d 616d 3579 646e 702b 676f 614b 6a70  Jmam5ydnp+goaKjp
+00012880: 4b57 6d70 3669 7071 7175 7372 6136 7673  KWmp6ipqqusra6vs
+00012890: 4c47 7973 3753 3174 7265 3475 6271 3776  LGys7S1tre4ubq7v
+000128a0: 4c32 2b76 3844 4277 7350 4578 6362 4879  L2+v8DBwsPExcbHy
+000128b0: 4d6e 4b79 387a 4e7a 732f 5130 644c 5431  MnKy8zNzs/Q0dLT1
+000128c0: 4e58 5731 396a 5a32 7476 6333 6437 6634  NXW19jZ2tvc3d7f4
+000128d0: 4f48 6934 2b54 6c35 7566 6f36 6572 7237  OHi4+Tl5ufo6err7
+000128e0: 4f33 7537 2f44 7838 7650 3039 6662 332b  O3u7/Dx8vP09fb3+
+000128f0: 506e 362b 2f7a 392f 7638 4141 5149 4442  Pn6+/z9/v8AAQIDB
+00012900: 4155 4742 7767 4a43 6773 4d44 5134 5045  AUGBwgJCgsMDQ4PE
+00012910: 4245 5345 7851 5646 6863 5947 526f 6248  BESExQVFhcYGRobH
+00012920: 4230 6548 7941 6849 694d 6b4a 5359 6e4b  B0eHyAhIiMkJSYnK
+00012930: 436b 714b 7977 744c 6938 774d 5449 7a4e  CkqKywtLi8wMTIzN
+00012940: 4455 324e 7a67 354f 6a73 3850 5434 2f51  DU2Nzg5Ojs8PT4/Q
+00012950: 4546 4351 3052 4652 6b64 4953 5570 4c54  EFCQ0RFRkdISUpLT
+00012960: 4531 4f54 3142 5255 6c4e 5556 565a 5857  E1OT1BRUlNUVVZXW
+00012970: 466c 6157 3178 6458 6c39 6759 574a 6a5a  FlaW1xdXl9gYWJjZ
+00012980: 4756 6d5a 3268 7061 6d74 7362 5735 7663  GVmZ2hpamtsbW5vc
+00012990: 4846 7963 3352 3164 6e64 3465 5870 3766  HFyc3R1dnd4eXp7f
+000129a0: 4831 2b66 3443 4267 6f4f 4568 5961 4869  H1+f4CBgoOEhYaHi
+000129b0: 496d 4b69 3479 4e6a 6f2b 516b 5a4b 546c  ImKi4yNjo+QkZKTl
+000129c0: 4a57 576c 3569 5a6d 7075 636e 5a36 666f  JWWl5iZmpucnZ6fo
+000129d0: 4b47 696f 3653 6c70 7165 6f71 6171 7272  KGio6Slpqeoqaqrr
+000129e0: 4b32 7572 3743 7873 724f 3074 6261 3375  K2ur7CxsrO0tba3u
+000129f0: 4c6d 3675 3779 3976 722f 4177 634c 4478  Lm6u7y9vr/AwcLDx
+00012a00: 4d58 4778 386a 4a79 7376 4d7a 6337 5030  MXGx8jJysvMzc7P0
+00012a10: 4e48 5330 3954 5631 7466 5932 6472 6233  NHS09TV1tfY2drb3
+00012a20: 4e33 6533 2b44 6834 7550 6b35 6562 6e36  N3e3+Dh4uPk5ebn6
+00012a30: 4f6e 7136 2b7a 7437 752f 7738 664c 7a39  Onq6+zt7u/w8fLz9
+00012a40: 5058 3239 2f6a 352b 7676 382f 6637 2f41  PX29/j5+vv8/f7/A
+00012a50: 4145 4341 7751 4642 6763 4943 516f 4c44  AECAwQFBgcICQoLD
+00012a60: 4130 4f44 7841 5245 684d 5546 5259 5847  A0ODxAREhMUFRYXG
+00012a70: 426b 6147 7877 6448 6838 6749 5349 6a4a  BkaGxwdHh8gISIjJ
+00012a80: 4355 6d4a 7967 704b 6973 734c 5334 764d  CUmJygpKissLS4vM
+00012a90: 4445 794d 7a51 314e 6a63 344f 546f 3750  DEyMzQ1Njc4OTo7P
+00012aa0: 4430 2b50 3042 4251 6b4e 4552 555a 4853  D0+P0BBQkNERUZHS
+00012ab0: 456c 4b53 3078 4e54 6b39 5155 564a 5456  ElKS0xNTk9QUVJTV
+00012ac0: 4656 5756 3168 5a57 6c74 6358 5635 6659  FVWV1hZWltcXV5fY
+00012ad0: 4746 6959 3252 6c5a 6d64 6f61 5770 7262  GFiY2RlZmdoaWprb
+00012ae0: 4731 7562 3342 7863 6e4e 3064 585a 3365  G1ub3BxcnN0dXZ3e
+00012af0: 486c 3665 3378 3966 6e2b 4167 594b 4468  Hl6e3x9fn+AgYKDh
+00012b00: 4957 4768 3469 4a69 6f75 4d6a 5936 506b  IWGh4iJiouMjY6Pk
+00012b10: 4a47 536b 3553 566c 7065 596d 5a71 626e  JGSk5SVlpeYmZqbn
+00012b20: 4a32 656e 3643 686f 714f 6b70 6161 6e71  J2en6ChoqOkpaanq
+00012b30: 4b6d 7171 3679 7472 712b 7773 624b 7a74  Kmqq6ytrq+wsbKzt
+00012b40: 4c57 3274 3769 3575 7275 3876 6236 2f77  LW2t7i5uru8vb6/w
+00012b50: 4d48 4377 3854 4678 7366 4979 6372 4c7a  MHCw8TFxsfIycrLz
+00012b60: 4d33 4f7a 3944 5230 7450 5531 6462 5832  M3Oz9DR0tPU1dbX2
+00012b70: 4e6e 6132 397a 6433 742f 6734 654c 6a35  Nna29zd3t/g4eLj5
+00012b80: 4f58 6d35 2b6a 7036 7576 7337 6537 7638  OXm5+jp6uvs7e7v8
+00012b90: 5048 7938 2f54 3139 7666 342b 6672 372f  PHy8/T19vf4+fr7/
+00012ba0: 5033 2b2f 773d 3d27 0a20 2020 2020 2020  P3+/w=='.       
+00012bb0: 2062 696e 6172 795f 6461 7461 203d 2062   binary_data = b
+00012bc0: 6173 6536 342e 6236 3464 6563 6f64 6528  ase64.b64decode(
+00012bd0: 6261 7365 3634 5f64 6174 6129 0a20 2020  base64_data).   
+00012be0: 2020 2020 2061 7761 6974 2073 656c 662e       await self.
+00012bf0: 5f73 6574 7570 5f73 6861 7265 2873 746f  _setup_share(sto
+00012c00: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
+00012c10: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
+00012c20: 6e74 5f6b 6579 290a 0a20 2020 2020 2020  nt_key)..       
+00012c30: 2066 696c 655f 6e61 6d65 203d 2073 656c   file_name = sel
+00012c40: 662e 5f67 6574 5f66 696c 655f 7265 6665  f._get_file_refe
+00012c50: 7265 6e63 6528 290a 2020 2020 2020 2020  rence().        
+00012c60: 6669 6c65 5f63 6c69 656e 7420 3d20 5368  file_client = Sh
+00012c70: 6172 6546 696c 6543 6c69 656e 7428 0a20  areFileClient(. 
+00012c80: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00012c90: 6163 636f 756e 745f 7572 6c28 7374 6f72  account_url(stor
+00012ca0: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
+00012cb0: 2c20 2266 696c 6522 292c 0a20 2020 2020  , "file"),.     
+00012cc0: 2020 2020 2020 2073 6861 7265 5f6e 616d         share_nam
+00012cd0: 653d 7365 6c66 2e73 6861 7265 5f6e 616d  e=self.share_nam
+00012ce0: 652c 0a20 2020 2020 2020 2020 2020 2066  e,.            f
+00012cf0: 696c 655f 7061 7468 3d66 696c 655f 6e61  ile_path=file_na
+00012d00: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
+00012d10: 6372 6564 656e 7469 616c 3d73 746f 7261  credential=stora
+00012d20: 6765 5f61 6363 6f75 6e74 5f6b 6579 290a  ge_account_key).
+00012d30: 2020 2020 2020 2020 6177 6169 7420 6669          await fi
+00012d40: 6c65 5f63 6c69 656e 742e 7570 6c6f 6164  le_client.upload
+00012d50: 5f66 696c 6528 6269 6e61 7279 5f64 6174  _file(binary_dat
+00012d60: 6129 0a0a 2020 2020 2020 2020 2320 4163  a)..        # Ac
+00012d70: 740a 2020 2020 2020 2020 636f 6e74 656e  t.        conten
+00012d80: 7420 3d20 6177 6169 7420 6669 6c65 5f63  t = await file_c
+00012d90: 6c69 656e 742e 646f 776e 6c6f 6164 5f66  lient.download_f
+00012da0: 696c 6528 290a 2020 2020 2020 2020 636f  ile().        co
+00012db0: 6e74 656e 7420 3d20 6177 6169 7420 636f  ntent = await co
+00012dc0: 6e74 656e 742e 7265 6164 616c 6c28 290a  ntent.readall().
+00012dd0: 0a20 2020 2020 2020 2023 2041 7373 6572  .        # Asser
+00012de0: 740a 2020 2020 2020 2020 7365 6c66 2e61  t.        self.a
+00012df0: 7373 6572 7445 7175 616c 2863 6f6e 7465  ssertEqual(conte
+00012e00: 6e74 2c20 6269 6e61 7279 5f64 6174 6129  nt, binary_data)
+00012e10: 0a0a 0a20 2020 2040 4669 6c65 5368 6172  ...    @FileShar
+00012e20: 6550 7265 7061 7265 7228 290a 2020 2020  ePreparer().    
+00012e30: 4041 7379 6e63 5374 6f72 6167 6554 6573  @AsyncStorageTes
+00012e40: 7443 6173 652e 6177 6169 745f 7072 6570  tCase.await_prep
+00012e50: 6172 6564 5f74 6573 740a 2020 2020 6173  ared_test.    as
+00012e60: 796e 6320 6465 6620 7465 7374 5f63 7265  ync def test_cre
+00012e70: 6174 655f 6669 6c65 5f66 726f 6d5f 6279  ate_file_from_by
+00012e80: 7465 735f 7769 7468 5f70 726f 6772 6573  tes_with_progres
+00012e90: 735f 6173 796e 6328 7365 6c66 2c20 7374  s_async(self, st
+00012ea0: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
+00012eb0: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
+00012ec0: 756e 745f 6b65 7929 3a0a 2020 2020 2020  unt_key):.      
+00012ed0: 2020 2320 7061 7261 6c6c 656c 2074 6573    # parallel tes
+00012ee0: 7473 2069 6e74 726f 6475 6365 2072 616e  ts introduce ran
+00012ef0: 646f 6d20 6f72 6465 7220 6f66 2072 6571  dom order of req
+00012f00: 7565 7374 732c 2063 616e 206f 6e6c 7920  uests, can only 
+00012f10: 7275 6e20 6c69 7665 0a20 2020 2020 2020  run live.       
+00012f20: 2069 6620 6e6f 7420 7365 6c66 2e69 735f   if not self.is_
+00012f30: 6c69 7665 3a0a 2020 2020 2020 2020 2020  live:.          
+00012f40: 2020 7265 7475 726e 0a0a 2020 2020 2020    return..      
+00012f50: 2020 7365 6c66 2e5f 7365 7475 7028 7374    self._setup(st
+00012f60: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
+00012f70: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
+00012f80: 756e 745f 6b65 7929 0a20 2020 2020 2020  unt_key).       
+00012f90: 2061 7761 6974 2073 656c 662e 5f73 6574   await self._set
+00012fa0: 7570 5f73 6861 7265 2873 746f 7261 6765  up_share(storage
+00012fb0: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
+00012fc0: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
+00012fd0: 6579 290a 2020 2020 2020 2020 6669 6c65  ey).        file
+00012fe0: 5f6e 616d 6520 3d20 7365 6c66 2e5f 6765  _name = self._ge
+00012ff0: 745f 6669 6c65 5f72 6566 6572 656e 6365  t_file_reference
+00013000: 2829 0a20 2020 2020 2020 2064 6174 6120  ().        data 
+00013010: 3d20 7365 6c66 2e67 6574 5f72 616e 646f  = self.get_rando
+00013020: 6d5f 6279 7465 7328 4c41 5247 455f 4649  m_bytes(LARGE_FI
+00013030: 4c45 5f53 495a 4529 0a20 2020 2020 2020  LE_SIZE).       
+00013040: 2066 696c 655f 636c 6965 6e74 203d 2053   file_client = S
+00013050: 6861 7265 4669 6c65 436c 6965 6e74 280a  hareFileClient(.
+00013060: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00013070: 2e61 6363 6f75 6e74 5f75 726c 2873 746f  .account_url(sto
+00013080: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
+00013090: 652c 2022 6669 6c65 2229 2c0a 2020 2020  e, "file"),.    
+000130a0: 2020 2020 2020 2020 7368 6172 655f 6e61          share_na
+000130b0: 6d65 3d73 656c 662e 7368 6172 655f 6e61  me=self.share_na
+000130c0: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
+000130d0: 6669 6c65 5f70 6174 683d 6669 6c65 5f6e  file_path=file_n
+000130e0: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
+000130f0: 2063 7265 6465 6e74 6961 6c3d 7374 6f72   credential=stor
+00013100: 6167 655f 6163 636f 756e 745f 6b65 792c  age_account_key,
+00013110: 0a20 2020 2020 2020 2020 2020 206d 6178  .            max
+00013120: 5f72 616e 6765 5f73 697a 653d 3420 2a20  _range_size=4 * 
+00013130: 3130 3234 290a 0a20 2020 2020 2020 2023  1024)..        #
+00013140: 2041 6374 0a20 2020 2020 2020 2070 726f   Act.        pro
+00013150: 6772 6573 7320 3d20 5b5d 0a20 2020 2020  gress = [].     
+00013160: 2020 2064 6566 2063 616c 6c62 6163 6b28     def callback(
+00013170: 7265 7370 6f6e 7365 293a 0a20 2020 2020  response):.     
+00013180: 2020 2020 2020 2063 7572 7265 6e74 203d         current =
+00013190: 2072 6573 706f 6e73 652e 636f 6e74 6578   response.contex
+000131a0: 745b 2775 706c 6f61 645f 7374 7265 616d  t['upload_stream
+000131b0: 5f63 7572 7265 6e74 275d 0a20 2020 2020  _current'].     
+000131c0: 2020 2020 2020 2074 6f74 616c 203d 2072         total = r
+000131d0: 6573 706f 6e73 652e 636f 6e74 6578 745b  esponse.context[
+000131e0: 2764 6174 615f 7374 7265 616d 5f74 6f74  'data_stream_tot
+000131f0: 616c 275d 0a20 2020 2020 2020 2020 2020  al'].           
+00013200: 2069 6620 6375 7272 656e 7420 6973 206e   if current is n
+00013210: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00013220: 2020 2020 2020 2020 2070 726f 6772 6573           progres
+00013230: 732e 6170 7065 6e64 2828 6375 7272 656e  s.append((curren
+00013240: 742c 2074 6f74 616c 2929 0a0a 2020 2020  t, total))..    
+00013250: 2020 2020 6177 6169 7420 6669 6c65 5f63      await file_c
+00013260: 6c69 656e 742e 7570 6c6f 6164 5f66 696c  lient.upload_fil
+00013270: 6528 6461 7461 2c20 6d61 785f 636f 6e63  e(data, max_conc
+00013280: 7572 7265 6e63 793d 322c 2072 6177 5f72  urrency=2, raw_r
+00013290: 6573 706f 6e73 655f 686f 6f6b 3d63 616c  esponse_hook=cal
+000132a0: 6c62 6163 6b29 0a0a 2020 2020 2020 2020  lback)..        
+000132b0: 2320 4173 7365 7274 0a20 2020 2020 2020  # Assert.       
+000132c0: 2061 7761 6974 2073 656c 662e 6173 7365   await self.asse
+000132d0: 7274 4669 6c65 4571 7561 6c28 6669 6c65  rtFileEqual(file
+000132e0: 5f63 6c69 656e 742c 2064 6174 6129 0a0a  _client, data)..
+000132f0: 2020 2020 4046 696c 6553 6861 7265 5072      @FileSharePr
+00013300: 6570 6172 6572 2829 0a20 2020 2040 4173  eparer().    @As
+00013310: 796e 6353 746f 7261 6765 5465 7374 4361  yncStorageTestCa
+00013320: 7365 2e61 7761 6974 5f70 7265 7061 7265  se.await_prepare
+00013330: 645f 7465 7374 0a20 2020 2061 7379 6e63  d_test.    async
+00013340: 2064 6566 2074 6573 745f 6372 6561 7465   def test_create
+00013350: 5f66 696c 655f 6672 6f6d 5f62 7974 6573  _file_from_bytes
+00013360: 5f77 6974 685f 696e 6465 785f 6173 796e  _with_index_asyn
+00013370: 6328 7365 6c66 2c20 7374 6f72 6167 655f  c(self, storage_
+00013380: 6163 636f 756e 745f 6e61 6d65 2c20 7374  account_name, st
+00013390: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
+000133a0: 7929 3a0a 2020 2020 2020 2020 2320 7061  y):.        # pa
+000133b0: 7261 6c6c 656c 2074 6573 7473 2069 6e74  rallel tests int
+000133c0: 726f 6475 6365 2072 616e 646f 6d20 6f72  roduce random or
+000133d0: 6465 7220 6f66 2072 6571 7565 7374 732c  der of requests,
+000133e0: 2063 616e 206f 6e6c 7920 7275 6e20 6c69   can only run li
+000133f0: 7665 0a20 2020 2020 2020 2069 6620 6e6f  ve.        if no
+00013400: 7420 7365 6c66 2e69 735f 6c69 7665 3a0a  t self.is_live:.
+00013410: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00013420: 726e 0a0a 2020 2020 2020 2020 7365 6c66  rn..        self
+00013430: 2e5f 7365 7475 7028 7374 6f72 6167 655f  ._setup(storage_
+00013440: 6163 636f 756e 745f 6e61 6d65 2c20 7374  account_name, st
+00013450: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
+00013460: 7929 0a20 2020 2020 2020 2066 696c 655f  y).        file_
+00013470: 6e61 6d65 203d 2073 656c 662e 5f67 6574  name = self._get
+00013480: 5f66 696c 655f 7265 6665 7265 6e63 6528  _file_reference(
+00013490: 290a 2020 2020 2020 2020 6177 6169 7420  ).        await 
+000134a0: 7365 6c66 2e5f 7365 7475 705f 7368 6172  self._setup_shar
+000134b0: 6528 7374 6f72 6167 655f 6163 636f 756e  e(storage_accoun
+000134c0: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
+000134d0: 6163 636f 756e 745f 6b65 7929 0a20 2020  account_key).   
+000134e0: 2020 2020 2064 6174 6120 3d20 7365 6c66       data = self
+000134f0: 2e67 6574 5f72 616e 646f 6d5f 6279 7465  .get_random_byte
+00013500: 7328 4c41 5247 455f 4649 4c45 5f53 495a  s(LARGE_FILE_SIZ
+00013510: 4529 0a20 2020 2020 2020 2069 6e64 6578  E).        index
+00013520: 203d 2031 3032 340a 2020 2020 2020 2020   = 1024.        
+00013530: 6669 6c65 5f63 6c69 656e 7420 3d20 5368  file_client = Sh
+00013540: 6172 6546 696c 6543 6c69 656e 7428 0a20  areFileClient(. 
+00013550: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00013560: 6163 636f 756e 745f 7572 6c28 7374 6f72  account_url(stor
+00013570: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
+00013580: 2c20 2266 696c 6522 292c 0a20 2020 2020  , "file"),.     
+00013590: 2020 2020 2020 2073 6861 7265 5f6e 616d         share_nam
+000135a0: 653d 7365 6c66 2e73 6861 7265 5f6e 616d  e=self.share_nam
+000135b0: 652c 0a20 2020 2020 2020 2020 2020 2066  e,.            f
+000135c0: 696c 655f 7061 7468 3d66 696c 655f 6e61  ile_path=file_na
+000135d0: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
+000135e0: 6372 6564 656e 7469 616c 3d73 746f 7261  credential=stora
+000135f0: 6765 5f61 6363 6f75 6e74 5f6b 6579 2c0a  ge_account_key,.
+00013600: 2020 2020 2020 2020 2020 2020 6d61 785f              max_
+00013610: 7261 6e67 655f 7369 7a65 3d34 202a 2031  range_size=4 * 1
+00013620: 3032 3429 0a0a 2020 2020 2020 2020 2320  024)..        # 
+00013630: 4163 740a 2020 2020 2020 2020 7265 7370  Act.        resp
+00013640: 6f6e 7365 203d 2061 7761 6974 2066 696c  onse = await fil
+00013650: 655f 636c 6965 6e74 2e75 706c 6f61 645f  e_client.upload_
+00013660: 6669 6c65 2864 6174 615b 696e 6465 783a  file(data[index:
+00013670: 5d2c 206d 6178 5f63 6f6e 6375 7272 656e  ], max_concurren
+00013680: 6379 3d32 290a 2020 2020 2020 2020 6173  cy=2).        as
+00013690: 7365 7274 2069 7369 6e73 7461 6e63 6528  sert isinstance(
+000136a0: 7265 7370 6f6e 7365 2c20 6469 6374 290a  response, dict).
+000136b0: 2020 2020 2020 2020 6173 7365 7274 2027          assert '
+000136c0: 6c61 7374 5f6d 6f64 6966 6965 6427 2069  last_modified' i
+000136d0: 6e20 7265 7370 6f6e 7365 0a20 2020 2020  n response.     
+000136e0: 2020 2061 7373 6572 7420 2765 7461 6727     assert 'etag'
+000136f0: 2069 6e20 7265 7370 6f6e 7365 0a0a 2020   in response..  
+00013700: 2020 2020 2020 2320 4173 7365 7274 0a20        # Assert. 
+00013710: 2020 2020 2020 2061 7761 6974 2073 656c         await sel
+00013720: 662e 6173 7365 7274 4669 6c65 4571 7561  f.assertFileEqua
+00013730: 6c28 6669 6c65 5f63 6c69 656e 742c 2064  l(file_client, d
+00013740: 6174 615b 3130 3234 3a5d 290a 0a20 2020  ata[1024:])..   
+00013750: 2040 4669 6c65 5368 6172 6550 7265 7061   @FileSharePrepa
+00013760: 7265 7228 290a 2020 2020 4041 7379 6e63  rer().    @Async
+00013770: 5374 6f72 6167 6554 6573 7443 6173 652e  StorageTestCase.
+00013780: 6177 6169 745f 7072 6570 6172 6564 5f74  await_prepared_t
+00013790: 6573 740a 2020 2020 6173 796e 6320 6465  est.    async de
+000137a0: 6620 7465 7374 5f63 7265 6174 655f 6669  f test_create_fi
+000137b0: 6c65 5f66 726f 6d5f 6279 7465 735f 7769  le_from_bytes_wi
+000137c0: 7468 5f69 6e64 6578 5f61 6e64 5f63 6f75  th_index_and_cou
+000137d0: 6e74 5f61 7379 6e63 2873 656c 662c 2073  nt_async(self, s
+000137e0: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
+000137f0: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
+00013800: 6f75 6e74 5f6b 6579 293a 0a20 2020 2020  ount_key):.     
+00013810: 2020 2023 2070 6172 616c 6c65 6c20 7465     # parallel te
+00013820: 7374 7320 696e 7472 6f64 7563 6520 7261  sts introduce ra
+00013830: 6e64 6f6d 206f 7264 6572 206f 6620 7265  ndom order of re
+00013840: 7175 6573 7473 2c20 6361 6e20 6f6e 6c79  quests, can only
+00013850: 2072 756e 206c 6976 650a 2020 2020 2020   run live.      
+00013860: 2020 6966 206e 6f74 2073 656c 662e 6973    if not self.is
+00013870: 5f6c 6976 653a 0a20 2020 2020 2020 2020  _live:.         
+00013880: 2020 2072 6574 7572 6e0a 0a20 2020 2020     return..     
+00013890: 2020 2073 656c 662e 5f73 6574 7570 2873     self._setup(s
+000138a0: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
+000138b0: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
+000138c0: 6f75 6e74 5f6b 6579 290a 2020 2020 2020  ount_key).      
+000138d0: 2020 6669 6c65 5f6e 616d 6520 3d20 7365    file_name = se
+000138e0: 6c66 2e5f 6765 745f 6669 6c65 5f72 6566  lf._get_file_ref
+000138f0: 6572 656e 6365 2829 0a20 2020 2020 2020  erence().       
+00013900: 2061 7761 6974 2073 656c 662e 5f73 6574   await self._set
+00013910: 7570 5f73 6861 7265 2873 746f 7261 6765  up_share(storage
+00013920: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
+00013930: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
+00013940: 6579 290a 2020 2020 2020 2020 6461 7461  ey).        data
+00013950: 203d 2073 656c 662e 6765 745f 7261 6e64   = self.get_rand
+00013960: 6f6d 5f62 7974 6573 284c 4152 4745 5f46  om_bytes(LARGE_F
+00013970: 494c 455f 5349 5a45 290a 2020 2020 2020  ILE_SIZE).      
+00013980: 2020 696e 6465 7820 3d20 3531 320a 2020    index = 512.  
+00013990: 2020 2020 2020 636f 756e 7420 3d20 3130        count = 10
+000139a0: 3234 0a20 2020 2020 2020 2066 696c 655f  24.        file_
+000139b0: 636c 6965 6e74 203d 2053 6861 7265 4669  client = ShareFi
+000139c0: 6c65 436c 6965 6e74 280a 2020 2020 2020  leClient(.      
+000139d0: 2020 2020 2020 7365 6c66 2e61 6363 6f75        self.accou
+000139e0: 6e74 5f75 726c 2873 746f 7261 6765 5f61  nt_url(storage_a
+000139f0: 6363 6f75 6e74 5f6e 616d 652c 2022 6669  ccount_name, "fi
+00013a00: 6c65 2229 2c0a 2020 2020 2020 2020 2020  le"),.          
+00013a10: 2020 7368 6172 655f 6e61 6d65 3d73 656c    share_name=sel
+00013a20: 662e 7368 6172 655f 6e61 6d65 2c0a 2020  f.share_name,.  
+00013a30: 2020 2020 2020 2020 2020 6669 6c65 5f70            file_p
+00013a40: 6174 683d 6669 6c65 5f6e 616d 652c 0a20  ath=file_name,. 
+00013a50: 2020 2020 2020 2020 2020 2063 7265 6465             crede
+00013a60: 6e74 6961 6c3d 7374 6f72 6167 655f 6163  ntial=storage_ac
+00013a70: 636f 756e 745f 6b65 792c 0a20 2020 2020  count_key,.     
+00013a80: 2020 2020 2020 206d 6178 5f72 616e 6765         max_range
+00013a90: 5f73 697a 653d 3420 2a20 3130 3234 290a  _size=4 * 1024).
+00013aa0: 0a20 2020 2020 2020 2023 2041 6374 0a20  .        # Act. 
+00013ab0: 2020 2020 2020 2072 6573 706f 6e73 6520         response 
+00013ac0: 3d20 6177 6169 7420 6669 6c65 5f63 6c69  = await file_cli
+00013ad0: 656e 742e 7570 6c6f 6164 5f66 696c 6528  ent.upload_file(
+00013ae0: 6461 7461 5b69 6e64 6578 3a5d 2c20 6c65  data[index:], le
+00013af0: 6e67 7468 3d63 6f75 6e74 2c20 6d61 785f  ngth=count, max_
+00013b00: 636f 6e63 7572 7265 6e63 793d 3229 0a20  concurrency=2). 
+00013b10: 2020 2020 2020 2061 7373 6572 7420 6973         assert is
+00013b20: 696e 7374 616e 6365 2872 6573 706f 6e73  instance(respons
+00013b30: 652c 2064 6963 7429 0a20 2020 2020 2020  e, dict).       
+00013b40: 2061 7373 6572 7420 276c 6173 745f 6d6f   assert 'last_mo
+00013b50: 6469 6669 6564 2720 696e 2072 6573 706f  dified' in respo
+00013b60: 6e73 650a 2020 2020 2020 2020 6173 7365  nse.        asse
+00013b70: 7274 2027 6574 6167 2720 696e 2072 6573  rt 'etag' in res
+00013b80: 706f 6e73 650a 0a20 2020 2020 2020 2023  ponse..        #
+00013b90: 2041 7373 6572 740a 2020 2020 2020 2020   Assert.        
+00013ba0: 6177 6169 7420 7365 6c66 2e61 7373 6572  await self.asser
+00013bb0: 7446 696c 6545 7175 616c 2866 696c 655f  tFileEqual(file_
+00013bc0: 636c 6965 6e74 2c20 6461 7461 5b69 6e64  client, data[ind
+00013bd0: 6578 3a69 6e64 6578 202b 2063 6f75 6e74  ex:index + count
+00013be0: 5d29 0a0a 2020 2020 4046 696c 6553 6861  ])..    @FileSha
+00013bf0: 7265 5072 6570 6172 6572 2829 0a20 2020  rePreparer().   
+00013c00: 2040 4173 796e 6353 746f 7261 6765 5465   @AsyncStorageTe
+00013c10: 7374 4361 7365 2e61 7761 6974 5f70 7265  stCase.await_pre
+00013c20: 7061 7265 645f 7465 7374 0a20 2020 2061  pared_test.    a
+00013c30: 7379 6e63 2064 6566 2074 6573 745f 6372  sync def test_cr
+00013c40: 6561 7465 5f66 696c 655f 6672 6f6d 5f70  eate_file_from_p
+00013c50: 6174 685f 6173 796e 6328 7365 6c66 2c20  ath_async(self, 
+00013c60: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
+00013c70: 6e61 6d65 2c20 7374 6f72 6167 655f 6163  name, storage_ac
+00013c80: 636f 756e 745f 6b65 7929 3a0a 2020 2020  count_key):.    
+00013c90: 2020 2020 2320 7061 7261 6c6c 656c 2074      # parallel t
+00013ca0: 6573 7473 2069 6e74 726f 6475 6365 2072  ests introduce r
+00013cb0: 616e 646f 6d20 6f72 6465 7220 6f66 2072  andom order of r
+00013cc0: 6571 7565 7374 732c 2063 616e 206f 6e6c  equests, can onl
+00013cd0: 7920 7275 6e20 6c69 7665 0a20 2020 2020  y run live.     
+00013ce0: 2020 2069 6620 6e6f 7420 7365 6c66 2e69     if not self.i
+00013cf0: 735f 6c69 7665 3a0a 2020 2020 2020 2020  s_live:.        
+00013d00: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
+00013d10: 2020 2020 7365 6c66 2e5f 7365 7475 7028      self._setup(
+00013d20: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
+00013d30: 6e61 6d65 2c20 7374 6f72 6167 655f 6163  name, storage_ac
+00013d40: 636f 756e 745f 6b65 7929 0a20 2020 2020  count_key).     
+00013d50: 2020 2066 696c 655f 6e61 6d65 203d 2073     file_name = s
+00013d60: 656c 662e 5f67 6574 5f66 696c 655f 7265  elf._get_file_re
+00013d70: 6665 7265 6e63 6528 290a 2020 2020 2020  ference().      
+00013d80: 2020 6177 6169 7420 7365 6c66 2e5f 7365    await self._se
+00013d90: 7475 705f 7368 6172 6528 7374 6f72 6167  tup_share(storag
+00013da0: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
+00013db0: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
+00013dc0: 6b65 7929 0a20 2020 2020 2020 2064 6174  key).        dat
+00013dd0: 6120 3d20 7365 6c66 2e67 6574 5f72 616e  a = self.get_ran
+00013de0: 646f 6d5f 6279 7465 7328 4c41 5247 455f  dom_bytes(LARGE_
+00013df0: 4649 4c45 5f53 495a 4529 0a20 2020 2020  FILE_SIZE).     
+00013e00: 2020 2077 6974 6820 6f70 656e 2849 4e50     with open(INP
+00013e10: 5554 5f46 494c 455f 5041 5448 2c20 2777  UT_FILE_PATH, 'w
+00013e20: 6227 2920 6173 2073 7472 6561 6d3a 0a20  b') as stream:. 
+00013e30: 2020 2020 2020 2020 2020 2073 7472 6561             strea
+00013e40: 6d2e 7772 6974 6528 6461 7461 290a 2020  m.write(data).  
+00013e50: 2020 2020 2020 6669 6c65 5f63 6c69 656e        file_clien
+00013e60: 7420 3d20 5368 6172 6546 696c 6543 6c69  t = ShareFileCli
+00013e70: 656e 7428 0a20 2020 2020 2020 2020 2020  ent(.           
+00013e80: 2073 656c 662e 6163 636f 756e 745f 7572   self.account_ur
+00013e90: 6c28 7374 6f72 6167 655f 6163 636f 756e  l(storage_accoun
+00013ea0: 745f 6e61 6d65 2c20 2266 696c 6522 292c  t_name, "file"),
+00013eb0: 0a20 2020 2020 2020 2020 2020 2073 6861  .            sha
+00013ec0: 7265 5f6e 616d 653d 7365 6c66 2e73 6861  re_name=self.sha
+00013ed0: 7265 5f6e 616d 652c 0a20 2020 2020 2020  re_name,.       
+00013ee0: 2020 2020 2066 696c 655f 7061 7468 3d66       file_path=f
+00013ef0: 696c 655f 6e61 6d65 2c0a 2020 2020 2020  ile_name,.      
+00013f00: 2020 2020 2020 6372 6564 656e 7469 616c        credential
+00013f10: 3d73 746f 7261 6765 5f61 6363 6f75 6e74  =storage_account
+00013f20: 5f6b 6579 2c0a 2020 2020 2020 2020 2020  _key,.          
+00013f30: 2020 6d61 785f 7261 6e67 655f 7369 7a65    max_range_size
+00013f40: 3d34 202a 2031 3032 3429 0a0a 2020 2020  =4 * 1024)..    
+00013f50: 2020 2020 2320 4163 740a 2020 2020 2020      # Act.      
+00013f60: 2020 7769 7468 206f 7065 6e28 494e 5055    with open(INPU
+00013f70: 545f 4649 4c45 5f50 4154 482c 2027 7262  T_FILE_PATH, 'rb
+00013f80: 2729 2061 7320 7374 7265 616d 3a0a 2020  ') as stream:.  
+00013f90: 2020 2020 2020 2020 2020 7265 7370 6f6e            respon
+00013fa0: 7365 203d 2061 7761 6974 2066 696c 655f  se = await file_
+00013fb0: 636c 6965 6e74 2e75 706c 6f61 645f 6669  client.upload_fi
+00013fc0: 6c65 2873 7472 6561 6d2c 206d 6178 5f63  le(stream, max_c
+00013fd0: 6f6e 6375 7272 656e 6379 3d32 290a 2020  oncurrency=2).  
+00013fe0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+00013ff0: 2069 7369 6e73 7461 6e63 6528 7265 7370   isinstance(resp
+00014000: 6f6e 7365 2c20 6469 6374 290a 2020 2020  onse, dict).    
+00014010: 2020 2020 2020 2020 6173 7365 7274 2027          assert '
+00014020: 6c61 7374 5f6d 6f64 6966 6965 6427 2069  last_modified' i
+00014030: 6e20 7265 7370 6f6e 7365 0a20 2020 2020  n response.     
+00014040: 2020 2020 2020 2061 7373 6572 7420 2765         assert 'e
+00014050: 7461 6727 2069 6e20 7265 7370 6f6e 7365  tag' in response
+00014060: 0a0a 2020 2020 2020 2020 2320 4173 7365  ..        # Asse
+00014070: 7274 0a20 2020 2020 2020 2061 7761 6974  rt.        await
+00014080: 2073 656c 662e 6173 7365 7274 4669 6c65   self.assertFile
+00014090: 4571 7561 6c28 6669 6c65 5f63 6c69 656e  Equal(file_clien
+000140a0: 742c 2064 6174 6129 0a20 2020 2020 2020  t, data).       
+000140b0: 2073 656c 662e 5f74 6561 7264 6f77 6e28   self._teardown(
+000140c0: 494e 5055 545f 4649 4c45 5f50 4154 4829  INPUT_FILE_PATH)
+000140d0: 0a0a 2020 2020 4046 696c 6553 6861 7265  ..    @FileShare
+000140e0: 5072 6570 6172 6572 2829 0a20 2020 2040  Preparer().    @
+000140f0: 4173 796e 6353 746f 7261 6765 5465 7374  AsyncStorageTest
+00014100: 4361 7365 2e61 7761 6974 5f70 7265 7061  Case.await_prepa
+00014110: 7265 645f 7465 7374 0a20 2020 2061 7379  red_test.    asy
+00014120: 6e63 2064 6566 2074 6573 745f 6372 6561  nc def test_crea
+00014130: 7465 5f66 696c 655f 6672 6f6d 5f70 6174  te_file_from_pat
+00014140: 685f 7769 7468 5f70 726f 6772 6573 735f  h_with_progress_
+00014150: 6173 796e 6328 7365 6c66 2c20 7374 6f72  async(self, stor
+00014160: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
+00014170: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
+00014180: 745f 6b65 7929 3a0a 2020 2020 2020 2020  t_key):.        
+00014190: 2320 7061 7261 6c6c 656c 2074 6573 7473  # parallel tests
+000141a0: 2069 6e74 726f 6475 6365 2072 616e 646f   introduce rando
+000141b0: 6d20 6f72 6465 7220 6f66 2072 6571 7565  m order of reque
+000141c0: 7374 732c 2063 616e 206f 6e6c 7920 7275  sts, can only ru
+000141d0: 6e20 6c69 7665 0a20 2020 2020 2020 2069  n live.        i
+000141e0: 6620 6e6f 7420 7365 6c66 2e69 735f 6c69  f not self.is_li
+000141f0: 7665 3a0a 2020 2020 2020 2020 2020 2020  ve:.            
+00014200: 7265 7475 726e 0a0a 2020 2020 2020 2020  return..        
+00014210: 7365 6c66 2e5f 7365 7475 7028 7374 6f72  self._setup(stor
+00014220: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
+00014230: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
+00014240: 745f 6b65 7929 0a20 2020 2020 2020 2066  t_key).        f
+00014250: 696c 655f 6e61 6d65 203d 2073 656c 662e  ile_name = self.
+00014260: 5f67 6574 5f66 696c 655f 7265 6665 7265  _get_file_refere
+00014270: 6e63 6528 290a 2020 2020 2020 2020 6177  nce().        aw
+00014280: 6169 7420 7365 6c66 2e5f 7365 7475 705f  ait self._setup_
+00014290: 7368 6172 6528 7374 6f72 6167 655f 6163  share(storage_ac
+000142a0: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
+000142b0: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
+000142c0: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
+000142d0: 7365 6c66 2e67 6574 5f72 616e 646f 6d5f  self.get_random_
+000142e0: 6279 7465 7328 4c41 5247 455f 4649 4c45  bytes(LARGE_FILE
+000142f0: 5f53 495a 4529 0a20 2020 2020 2020 2077  _SIZE).        w
+00014300: 6974 6820 6f70 656e 2849 4e50 5554 5f46  ith open(INPUT_F
+00014310: 494c 455f 5041 5448 2c20 2777 6227 2920  ILE_PATH, 'wb') 
+00014320: 6173 2073 7472 6561 6d3a 0a20 2020 2020  as stream:.     
+00014330: 2020 2020 2020 2073 7472 6561 6d2e 7772         stream.wr
+00014340: 6974 6528 6461 7461 290a 2020 2020 2020  ite(data).      
+00014350: 2020 6669 6c65 5f63 6c69 656e 7420 3d20    file_client = 
+00014360: 5368 6172 6546 696c 6543 6c69 656e 7428  ShareFileClient(
+00014370: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00014380: 662e 6163 636f 756e 745f 7572 6c28 7374  f.account_url(st
+00014390: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
+000143a0: 6d65 2c20 2266 696c 6522 292c 0a20 2020  me, "file"),.   
+000143b0: 2020 2020 2020 2020 2073 6861 7265 5f6e           share_n
+000143c0: 616d 653d 7365 6c66 2e73 6861 7265 5f6e  ame=self.share_n
+000143d0: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
+000143e0: 2066 696c 655f 7061 7468 3d66 696c 655f   file_path=file_
+000143f0: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
+00014400: 2020 6372 6564 656e 7469 616c 3d73 746f    credential=sto
+00014410: 7261 6765 5f61 6363 6f75 6e74 5f6b 6579  rage_account_key
+00014420: 2c0a 2020 2020 2020 2020 2020 2020 6d61  ,.            ma
+00014430: 785f 7261 6e67 655f 7369 7a65 3d34 202a  x_range_size=4 *
+00014440: 2031 3032 3429 0a0a 2020 2020 2020 2020   1024)..        
+00014450: 2320 4163 740a 2020 2020 2020 2020 7072  # Act.        pr
+00014460: 6f67 7265 7373 203d 205b 5d0a 2020 2020  ogress = [].    
+00014470: 2020 2020 6465 6620 6361 6c6c 6261 636b      def callback
+00014480: 2872 6573 706f 6e73 6529 3a0a 2020 2020  (response):.    
+00014490: 2020 2020 2020 2020 6375 7272 656e 7420          current 
+000144a0: 3d20 7265 7370 6f6e 7365 2e63 6f6e 7465  = response.conte
+000144b0: 7874 5b27 7570 6c6f 6164 5f73 7472 6561  xt['upload_strea
+000144c0: 6d5f 6375 7272 656e 7427 5d0a 2020 2020  m_current'].    
+000144d0: 2020 2020 2020 2020 746f 7461 6c20 3d20          total = 
+000144e0: 7265 7370 6f6e 7365 2e63 6f6e 7465 7874  response.context
+000144f0: 5b27 6461 7461 5f73 7472 6561 6d5f 746f  ['data_stream_to
+00014500: 7461 6c27 5d0a 2020 2020 2020 2020 2020  tal'].          
+00014510: 2020 6966 2063 7572 7265 6e74 2069 7320    if current is 
+00014520: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00014530: 2020 2020 2020 2020 2020 7072 6f67 7265            progre
+00014540: 7373 2e61 7070 656e 6428 2863 7572 7265  ss.append((curre
+00014550: 6e74 2c20 746f 7461 6c29 290a 0a20 2020  nt, total))..   
+00014560: 2020 2020 2077 6974 6820 6f70 656e 2849       with open(I
+00014570: 4e50 5554 5f46 494c 455f 5041 5448 2c20  NPUT_FILE_PATH, 
+00014580: 2772 6227 2920 6173 2073 7472 6561 6d3a  'rb') as stream:
+00014590: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+000145a0: 706f 6e73 6520 3d20 6177 6169 7420 6669  ponse = await fi
+000145b0: 6c65 5f63 6c69 656e 742e 7570 6c6f 6164  le_client.upload
+000145c0: 5f66 696c 6528 7374 7265 616d 2c20 6d61  _file(stream, ma
+000145d0: 785f 636f 6e63 7572 7265 6e63 793d 322c  x_concurrency=2,
+000145e0: 2072 6177 5f72 6573 706f 6e73 655f 686f   raw_response_ho
+000145f0: 6f6b 3d63 616c 6c62 6163 6b29 0a20 2020  ok=callback).   
+00014600: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
+00014610: 6973 696e 7374 616e 6365 2872 6573 706f  isinstance(respo
+00014620: 6e73 652c 2064 6963 7429 0a20 2020 2020  nse, dict).     
+00014630: 2020 2020 2020 2061 7373 6572 7420 276c         assert 'l
+00014640: 6173 745f 6d6f 6469 6669 6564 2720 696e  ast_modified' in
+00014650: 2072 6573 706f 6e73 650a 2020 2020 2020   response.      
+00014660: 2020 2020 2020 6173 7365 7274 2027 6574        assert 'et
+00014670: 6167 2720 696e 2072 6573 706f 6e73 650a  ag' in response.
+00014680: 0a20 2020 2020 2020 2023 2041 7373 6572  .        # Asser
+00014690: 740a 2020 2020 2020 2020 6177 6169 7420  t.        await 
+000146a0: 7365 6c66 2e61 7373 6572 7446 696c 6545  self.assertFileE
+000146b0: 7175 616c 2866 696c 655f 636c 6965 6e74  qual(file_client
+000146c0: 2c20 6461 7461 290a 2020 2020 2020 2020  , data).        
+000146d0: 7365 6c66 2e61 7373 6572 745f 7570 6c6f  self.assert_uplo
+000146e0: 6164 5f70 726f 6772 6573 7328 0a20 2020  ad_progress(.   
+000146f0: 2020 2020 2020 2020 206c 656e 2864 6174           len(dat
+00014700: 6129 2c0a 2020 2020 2020 2020 2020 2020  a),.            
+00014710: 7365 6c66 2e66 7363 2e5f 636f 6e66 6967  self.fsc._config
+00014720: 2e6d 6178 5f72 616e 6765 5f73 697a 652c  .max_range_size,
+00014730: 0a20 2020 2020 2020 2020 2020 2070 726f  .            pro
+00014740: 6772 6573 732c 2075 6e6b 6e6f 776e 5f73  gress, unknown_s
+00014750: 697a 653d 4661 6c73 6529 0a20 2020 2020  ize=False).     
+00014760: 2020 2073 656c 662e 5f74 6561 7264 6f77     self._teardow
+00014770: 6e28 494e 5055 545f 4649 4c45 5f50 4154  n(INPUT_FILE_PAT
+00014780: 4829 0a0a 2020 2020 4046 696c 6553 6861  H)..    @FileSha
+00014790: 7265 5072 6570 6172 6572 2829 0a20 2020  rePreparer().   
+000147a0: 2040 4173 796e 6353 746f 7261 6765 5465   @AsyncStorageTe
+000147b0: 7374 4361 7365 2e61 7761 6974 5f70 7265  stCase.await_pre
+000147c0: 7061 7265 645f 7465 7374 0a20 2020 2061  pared_test.    a
+000147d0: 7379 6e63 2064 6566 2074 6573 745f 6372  sync def test_cr
+000147e0: 6561 7465 5f66 696c 655f 6672 6f6d 5f73  eate_file_from_s
+000147f0: 7472 6561 6d5f 6173 796e 6328 7365 6c66  tream_async(self
+00014800: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
+00014810: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
+00014820: 6163 636f 756e 745f 6b65 7929 3a0a 2020  account_key):.  
+00014830: 2020 2020 2020 2320 7061 7261 6c6c 656c        # parallel
+00014840: 2074 6573 7473 2069 6e74 726f 6475 6365   tests introduce
+00014850: 2072 616e 646f 6d20 6f72 6465 7220 6f66   random order of
+00014860: 2072 6571 7565 7374 732c 2063 616e 206f   requests, can o
+00014870: 6e6c 7920 7275 6e20 6c69 7665 0a20 2020  nly run live.   
+00014880: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
+00014890: 2e69 735f 6c69 7665 3a0a 2020 2020 2020  .is_live:.      
+000148a0: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
+000148b0: 2020 2020 2020 7365 6c66 2e5f 7365 7475        self._setu
+000148c0: 7028 7374 6f72 6167 655f 6163 636f 756e  p(storage_accoun
+000148d0: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
+000148e0: 6163 636f 756e 745f 6b65 7929 0a20 2020  account_key).   
+000148f0: 2020 2020 2066 696c 655f 6e61 6d65 203d       file_name =
+00014900: 2073 656c 662e 5f67 6574 5f66 696c 655f   self._get_file_
+00014910: 7265 6665 7265 6e63 6528 290a 2020 2020  reference().    
+00014920: 2020 2020 6177 6169 7420 7365 6c66 2e5f      await self._
+00014930: 7365 7475 705f 7368 6172 6528 7374 6f72  setup_share(stor
+00014940: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
+00014950: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
+00014960: 745f 6b65 7929 0a20 2020 2020 2020 2064  t_key).        d
+00014970: 6174 6120 3d20 7365 6c66 2e67 6574 5f72  ata = self.get_r
+00014980: 616e 646f 6d5f 6279 7465 7328 4c41 5247  andom_bytes(LARG
+00014990: 455f 4649 4c45 5f53 495a 4529 0a20 2020  E_FILE_SIZE).   
+000149a0: 2020 2020 2077 6974 6820 6f70 656e 2849       with open(I
+000149b0: 4e50 5554 5f46 494c 455f 5041 5448 2c20  NPUT_FILE_PATH, 
+000149c0: 2777 6227 2920 6173 2073 7472 6561 6d3a  'wb') as stream:
+000149d0: 0a20 2020 2020 2020 2020 2020 2073 7472  .            str
+000149e0: 6561 6d2e 7772 6974 6528 6461 7461 290a  eam.write(data).
+000149f0: 2020 2020 2020 2020 6669 6c65 5f63 6c69          file_cli
+00014a00: 656e 7420 3d20 5368 6172 6546 696c 6543  ent = ShareFileC
+00014a10: 6c69 656e 7428 0a20 2020 2020 2020 2020  lient(.         
+00014a20: 2020 2073 656c 662e 6163 636f 756e 745f     self.account_
+00014a30: 7572 6c28 7374 6f72 6167 655f 6163 636f  url(storage_acco
+00014a40: 756e 745f 6e61 6d65 2c20 2266 696c 6522  unt_name, "file"
+00014a50: 292c 0a20 2020 2020 2020 2020 2020 2073  ),.            s
+00014a60: 6861 7265 5f6e 616d 653d 7365 6c66 2e73  hare_name=self.s
+00014a70: 6861 7265 5f6e 616d 652c 0a20 2020 2020  hare_name,.     
+00014a80: 2020 2020 2020 2066 696c 655f 7061 7468         file_path
+00014a90: 3d66 696c 655f 6e61 6d65 2c0a 2020 2020  =file_name,.    
+00014aa0: 2020 2020 2020 2020 6372 6564 656e 7469          credenti
+00014ab0: 616c 3d73 746f 7261 6765 5f61 6363 6f75  al=storage_accou
+00014ac0: 6e74 5f6b 6579 2c0a 2020 2020 2020 2020  nt_key,.        
+00014ad0: 2020 2020 6d61 785f 7261 6e67 655f 7369      max_range_si
+00014ae0: 7a65 3d34 202a 2031 3032 3429 0a0a 2020  ze=4 * 1024)..  
+00014af0: 2020 2020 2020 2320 4163 740a 2020 2020        # Act.    
+00014b00: 2020 2020 6669 6c65 5f73 697a 6520 3d20      file_size = 
+00014b10: 6c65 6e28 6461 7461 290a 2020 2020 2020  len(data).      
+00014b20: 2020 7769 7468 206f 7065 6e28 494e 5055    with open(INPU
+00014b30: 545f 4649 4c45 5f50 4154 482c 2027 7262  T_FILE_PATH, 'rb
+00014b40: 2729 2061 7320 7374 7265 616d 3a0a 2020  ') as stream:.  
+00014b50: 2020 2020 2020 2020 2020 7265 7370 6f6e            respon
+00014b60: 7365 203d 2061 7761 6974 2066 696c 655f  se = await file_
+00014b70: 636c 6965 6e74 2e75 706c 6f61 645f 6669  client.upload_fi
+00014b80: 6c65 2873 7472 6561 6d2c 206d 6178 5f63  le(stream, max_c
+00014b90: 6f6e 6375 7272 656e 6379 3d32 290a 2020  oncurrency=2).  
+00014ba0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+00014bb0: 2069 7369 6e73 7461 6e63 6528 7265 7370   isinstance(resp
+00014bc0: 6f6e 7365 2c20 6469 6374 290a 2020 2020  onse, dict).    
+00014bd0: 2020 2020 2020 2020 6173 7365 7274 2027          assert '
+00014be0: 6c61 7374 5f6d 6f64 6966 6965 6427 2069  last_modified' i
+00014bf0: 6e20 7265 7370 6f6e 7365 0a20 2020 2020  n response.     
+00014c00: 2020 2020 2020 2061 7373 6572 7420 2765         assert 'e
+00014c10: 7461 6727 2069 6e20 7265 7370 6f6e 7365  tag' in response
+00014c20: 0a0a 2020 2020 2020 2020 2320 4173 7365  ..        # Asse
+00014c30: 7274 0a20 2020 2020 2020 2061 7761 6974  rt.        await
+00014c40: 2073 656c 662e 6173 7365 7274 4669 6c65   self.assertFile
+00014c50: 4571 7561 6c28 6669 6c65 5f63 6c69 656e  Equal(file_clien
+00014c60: 742c 2064 6174 615b 3a66 696c 655f 7369  t, data[:file_si
+00014c70: 7a65 5d29 0a20 2020 2020 2020 2073 656c  ze]).        sel
+00014c80: 662e 5f74 6561 7264 6f77 6e28 494e 5055  f._teardown(INPU
+00014c90: 545f 4649 4c45 5f50 4154 4829 0a0a 2020  T_FILE_PATH)..  
+00014ca0: 2020 4046 696c 6553 6861 7265 5072 6570    @FileSharePrep
+00014cb0: 6172 6572 2829 0a20 2020 2040 4173 796e  arer().    @Asyn
+00014cc0: 6353 746f 7261 6765 5465 7374 4361 7365  cStorageTestCase
+00014cd0: 2e61 7761 6974 5f70 7265 7061 7265 645f  .await_prepared_
+00014ce0: 7465 7374 0a20 2020 2061 7379 6e63 2064  test.    async d
+00014cf0: 6566 2074 6573 745f 6372 6561 7465 5f66  ef test_create_f
+00014d00: 696c 655f 6672 6f6d 5f73 7472 6561 6d5f  ile_from_stream_
+00014d10: 6e6f 6e5f 7365 656b 6162 6c65 5f61 7379  non_seekable_asy
+00014d20: 6e63 2873 656c 662c 2073 746f 7261 6765  nc(self, storage
+00014d30: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
+00014d40: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
+00014d50: 6579 293a 0a20 2020 2020 2020 2023 2070  ey):.        # p
+00014d60: 6172 616c 6c65 6c20 7465 7374 7320 696e  arallel tests in
+00014d70: 7472 6f64 7563 6520 7261 6e64 6f6d 206f  troduce random o
+00014d80: 7264 6572 206f 6620 7265 7175 6573 7473  rder of requests
+00014d90: 2c20 6361 6e20 6f6e 6c79 2072 756e 206c  , can only run l
+00014da0: 6976 650a 2020 2020 2020 2020 6966 206e  ive.        if n
+00014db0: 6f74 2073 656c 662e 6973 5f6c 6976 653a  ot self.is_live:
+00014dc0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00014dd0: 7572 6e0a 0a20 2020 2020 2020 2073 656c  urn..        sel
+00014de0: 662e 5f73 6574 7570 2873 746f 7261 6765  f._setup(storage
+00014df0: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
+00014e00: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
+00014e10: 6579 290a 2020 2020 2020 2020 6669 6c65  ey).        file
+00014e20: 5f6e 616d 6520 3d20 7365 6c66 2e5f 6765  _name = self._ge
+00014e30: 745f 6669 6c65 5f72 6566 6572 656e 6365  t_file_reference
+00014e40: 2829 0a20 2020 2020 2020 2061 7761 6974  ().        await
+00014e50: 2073 656c 662e 5f73 6574 7570 5f73 6861   self._setup_sha
+00014e60: 7265 2873 746f 7261 6765 5f61 6363 6f75  re(storage_accou
+00014e70: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
+00014e80: 5f61 6363 6f75 6e74 5f6b 6579 290a 2020  _account_key).  
+00014e90: 2020 2020 2020 6461 7461 203d 2073 656c        data = sel
+00014ea0: 662e 6765 745f 7261 6e64 6f6d 5f62 7974  f.get_random_byt
+00014eb0: 6573 284c 4152 4745 5f46 494c 455f 5349  es(LARGE_FILE_SI
+00014ec0: 5a45 290a 2020 2020 2020 2020 7769 7468  ZE).        with
+00014ed0: 206f 7065 6e28 494e 5055 545f 4649 4c45   open(INPUT_FILE
+00014ee0: 5f50 4154 482c 2027 7762 2729 2061 7320  _PATH, 'wb') as 
+00014ef0: 7374 7265 616d 3a0a 2020 2020 2020 2020  stream:.        
+00014f00: 2020 2020 7374 7265 616d 2e77 7269 7465      stream.write
+00014f10: 2864 6174 6129 0a20 2020 2020 2020 2066  (data).        f
+00014f20: 696c 655f 636c 6965 6e74 203d 2053 6861  ile_client = Sha
+00014f30: 7265 4669 6c65 436c 6965 6e74 280a 2020  reFileClient(.  
+00014f40: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00014f50: 6363 6f75 6e74 5f75 726c 2873 746f 7261  ccount_url(stora
+00014f60: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
+00014f70: 2022 6669 6c65 2229 2c0a 2020 2020 2020   "file"),.      
+00014f80: 2020 2020 2020 7368 6172 655f 6e61 6d65        share_name
+00014f90: 3d73 656c 662e 7368 6172 655f 6e61 6d65  =self.share_name
+00014fa0: 2c0a 2020 2020 2020 2020 2020 2020 6669  ,.            fi
+00014fb0: 6c65 5f70 6174 683d 6669 6c65 5f6e 616d  le_path=file_nam
+00014fc0: 652c 0a20 2020 2020 2020 2020 2020 2063  e,.            c
+00014fd0: 7265 6465 6e74 6961 6c3d 7374 6f72 6167  redential=storag
+00014fe0: 655f 6163 636f 756e 745f 6b65 792c 0a20  e_account_key,. 
+00014ff0: 2020 2020 2020 2020 2020 206d 6178 5f72             max_r
+00015000: 616e 6765 5f73 697a 653d 3420 2a20 3130  ange_size=4 * 10
+00015010: 3234 290a 0a20 2020 2020 2020 2023 2041  24)..        # A
+00015020: 6374 0a20 2020 2020 2020 2066 696c 655f  ct.        file_
+00015030: 7369 7a65 203d 206c 656e 2864 6174 6129  size = len(data)
+00015040: 0a20 2020 2020 2020 2077 6974 6820 6f70  .        with op
+00015050: 656e 2849 4e50 5554 5f46 494c 455f 5041  en(INPUT_FILE_PA
+00015060: 5448 2c20 2772 6227 2920 6173 2073 7472  TH, 'rb') as str
+00015070: 6561 6d3a 0a20 2020 2020 2020 2020 2020  eam:.           
+00015080: 206e 6f6e 5f73 6565 6b61 626c 655f 6669   non_seekable_fi
+00015090: 6c65 203d 2053 746f 7261 6765 4669 6c65  le = StorageFile
+000150a0: 4173 796e 6354 6573 742e 4e6f 6e53 6565  AsyncTest.NonSee
+000150b0: 6b61 626c 6546 696c 6528 7374 7265 616d  kableFile(stream
+000150c0: 290a 2020 2020 2020 2020 2020 2020 6177  ).            aw
+000150d0: 6169 7420 6669 6c65 5f63 6c69 656e 742e  ait file_client.
+000150e0: 7570 6c6f 6164 5f66 696c 6528 6e6f 6e5f  upload_file(non_
+000150f0: 7365 656b 6162 6c65 5f66 696c 652c 206c  seekable_file, l
+00015100: 656e 6774 683d 6669 6c65 5f73 697a 652c  ength=file_size,
+00015110: 206d 6178 5f63 6f6e 6375 7272 656e 6379   max_concurrency
+00015120: 3d31 290a 0a20 2020 2020 2020 2023 2041  =1)..        # A
+00015130: 7373 6572 740a 2020 2020 2020 2020 6177  ssert.        aw
+00015140: 6169 7420 7365 6c66 2e61 7373 6572 7446  ait self.assertF
+00015150: 696c 6545 7175 616c 2866 696c 655f 636c  ileEqual(file_cl
+00015160: 6965 6e74 2c20 6461 7461 5b3a 6669 6c65  ient, data[:file
+00015170: 5f73 697a 655d 290a 2020 2020 2020 2020  _size]).        
+00015180: 7365 6c66 2e5f 7465 6172 646f 776e 2849  self._teardown(I
+00015190: 4e50 5554 5f46 494c 455f 5041 5448 290a  NPUT_FILE_PATH).
+000151a0: 0a20 2020 2040 4669 6c65 5368 6172 6550  .    @FileShareP
+000151b0: 7265 7061 7265 7228 290a 2020 2020 4041  reparer().    @A
+000151c0: 7379 6e63 5374 6f72 6167 6554 6573 7443  syncStorageTestC
+000151d0: 6173 652e 6177 6169 745f 7072 6570 6172  ase.await_prepar
+000151e0: 6564 5f74 6573 740a 2020 2020 6173 796e  ed_test.    asyn
+000151f0: 6320 6465 6620 7465 7374 5f63 7265 6174  c def test_creat
+00015200: 655f 6669 6c65 5f66 726f 6d5f 7374 7265  e_file_from_stre
+00015210: 616d 5f77 6974 685f 7072 6f67 7265 7373  am_with_progress
+00015220: 5f61 7379 6e63 2873 656c 662c 2073 746f  _async(self, sto
+00015230: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
+00015240: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
+00015250: 6e74 5f6b 6579 293a 0a20 2020 2020 2020  nt_key):.       
+00015260: 2023 2070 6172 616c 6c65 6c20 7465 7374   # parallel test
+00015270: 7320 696e 7472 6f64 7563 6520 7261 6e64  s introduce rand
+00015280: 6f6d 206f 7264 6572 206f 6620 7265 7175  om order of requ
+00015290: 6573 7473 2c20 6361 6e20 6f6e 6c79 2072  ests, can only r
+000152a0: 756e 206c 6976 650a 2020 2020 2020 2020  un live.        
+000152b0: 6966 206e 6f74 2073 656c 662e 6973 5f6c  if not self.is_l
+000152c0: 6976 653a 0a20 2020 2020 2020 2020 2020  ive:.           
+000152d0: 2072 6574 7572 6e0a 0a20 2020 2020 2020   return..       
+000152e0: 2073 656c 662e 5f73 6574 7570 2873 746f   self._setup(sto
+000152f0: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
+00015300: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
+00015310: 6e74 5f6b 6579 290a 2020 2020 2020 2020  nt_key).        
+00015320: 6669 6c65 5f6e 616d 6520 3d20 7365 6c66  file_name = self
+00015330: 2e5f 6765 745f 6669 6c65 5f72 6566 6572  ._get_file_refer
+00015340: 656e 6365 2829 0a20 2020 2020 2020 2061  ence().        a
+00015350: 7761 6974 2073 656c 662e 5f73 6574 7570  wait self._setup
+00015360: 5f73 6861 7265 2873 746f 7261 6765 5f61  _share(storage_a
+00015370: 6363 6f75 6e74 5f6e 616d 652c 2073 746f  ccount_name, sto
+00015380: 7261 6765 5f61 6363 6f75 6e74 5f6b 6579  rage_account_key
+00015390: 290a 2020 2020 2020 2020 6461 7461 203d  ).        data =
+000153a0: 2073 656c 662e 6765 745f 7261 6e64 6f6d   self.get_random
+000153b0: 5f62 7974 6573 284c 4152 4745 5f46 494c  _bytes(LARGE_FIL
+000153c0: 455f 5349 5a45 290a 2020 2020 2020 2020  E_SIZE).        
+000153d0: 7769 7468 206f 7065 6e28 494e 5055 545f  with open(INPUT_
+000153e0: 4649 4c45 5f50 4154 482c 2027 7762 2729  FILE_PATH, 'wb')
+000153f0: 2061 7320 7374 7265 616d 3a0a 2020 2020   as stream:.    
+00015400: 2020 2020 2020 2020 7374 7265 616d 2e77          stream.w
+00015410: 7269 7465 2864 6174 6129 0a20 2020 2020  rite(data).     
+00015420: 2020 2066 696c 655f 636c 6965 6e74 203d     file_client =
+00015430: 2053 6861 7265 4669 6c65 436c 6965 6e74   ShareFileClient
+00015440: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
+00015450: 6c66 2e61 6363 6f75 6e74 5f75 726c 2873  lf.account_url(s
+00015460: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
+00015470: 616d 652c 2022 6669 6c65 2229 2c0a 2020  ame, "file"),.  
+00015480: 2020 2020 2020 2020 2020 7368 6172 655f            share_
+00015490: 6e61 6d65 3d73 656c 662e 7368 6172 655f  name=self.share_
+000154a0: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
+000154b0: 2020 6669 6c65 5f70 6174 683d 6669 6c65    file_path=file
+000154c0: 5f6e 616d 652c 0a20 2020 2020 2020 2020  _name,.         
+000154d0: 2020 2063 7265 6465 6e74 6961 6c3d 7374     credential=st
+000154e0: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
+000154f0: 792c 0a20 2020 2020 2020 2020 2020 206d  y,.            m
+00015500: 6178 5f72 616e 6765 5f73 697a 653d 3420  ax_range_size=4 
+00015510: 2a20 3130 3234 290a 0a20 2020 2020 2020  * 1024)..       
+00015520: 2023 2041 6374 0a20 2020 2020 2020 2070   # Act.        p
+00015530: 726f 6772 6573 7320 3d20 5b5d 0a20 2020  rogress = [].   
+00015540: 2020 2020 2064 6566 2063 616c 6c62 6163       def callbac
+00015550: 6b28 7265 7370 6f6e 7365 293a 0a20 2020  k(response):.   
+00015560: 2020 2020 2020 2020 2063 7572 7265 6e74           current
+00015570: 203d 2072 6573 706f 6e73 652e 636f 6e74   = response.cont
+00015580: 6578 745b 2775 706c 6f61 645f 7374 7265  ext['upload_stre
+00015590: 616d 5f63 7572 7265 6e74 275d 0a20 2020  am_current'].   
+000155a0: 2020 2020 2020 2020 2074 6f74 616c 203d           total =
+000155b0: 2072 6573 706f 6e73 652e 636f 6e74 6578   response.contex
+000155c0: 745b 2764 6174 615f 7374 7265 616d 5f74  t['data_stream_t
+000155d0: 6f74 616c 275d 0a20 2020 2020 2020 2020  otal'].         
+000155e0: 2020 2069 6620 6375 7272 656e 7420 6973     if current is
+000155f0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+00015600: 2020 2020 2020 2020 2020 2070 726f 6772             progr
+00015610: 6573 732e 6170 7065 6e64 2828 6375 7272  ess.append((curr
+00015620: 656e 742c 2074 6f74 616c 2929 0a0a 2020  ent, total))..  
+00015630: 2020 2020 2020 6669 6c65 5f73 697a 6520        file_size 
+00015640: 3d20 6c65 6e28 6461 7461 290a 2020 2020  = len(data).    
+00015650: 2020 2020 7769 7468 206f 7065 6e28 494e      with open(IN
+00015660: 5055 545f 4649 4c45 5f50 4154 482c 2027  PUT_FILE_PATH, '
+00015670: 7262 2729 2061 7320 7374 7265 616d 3a0a  rb') as stream:.
+00015680: 2020 2020 2020 2020 2020 2020 6177 6169              awai
+00015690: 7420 6669 6c65 5f63 6c69 656e 742e 7570  t file_client.up
+000156a0: 6c6f 6164 5f66 696c 6528 7374 7265 616d  load_file(stream
+000156b0: 2c20 6d61 785f 636f 6e63 7572 7265 6e63  , max_concurrenc
+000156c0: 793d 322c 2072 6177 5f72 6573 706f 6e73  y=2, raw_respons
+000156d0: 655f 686f 6f6b 3d63 616c 6c62 6163 6b29  e_hook=callback)
+000156e0: 0a0a 2020 2020 2020 2020 2320 4173 7365  ..        # Asse
+000156f0: 7274 0a20 2020 2020 2020 2061 7761 6974  rt.        await
+00015700: 2073 656c 662e 6173 7365 7274 4669 6c65   self.assertFile
+00015710: 4571 7561 6c28 6669 6c65 5f63 6c69 656e  Equal(file_clien
+00015720: 742c 2064 6174 615b 3a66 696c 655f 7369  t, data[:file_si
+00015730: 7a65 5d29 0a20 2020 2020 2020 2073 656c  ze]).        sel
+00015740: 662e 6173 7365 7274 5f75 706c 6f61 645f  f.assert_upload_
+00015750: 7072 6f67 7265 7373 280a 2020 2020 2020  progress(.      
+00015760: 2020 2020 2020 6c65 6e28 6461 7461 292c        len(data),
+00015770: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00015780: 662e 6673 632e 5f63 6f6e 6669 672e 6d61  f.fsc._config.ma
+00015790: 785f 7261 6e67 655f 7369 7a65 2c0a 2020  x_range_size,.  
+000157a0: 2020 2020 2020 2020 2020 7072 6f67 7265            progre
+000157b0: 7373 2c20 756e 6b6e 6f77 6e5f 7369 7a65  ss, unknown_size
+000157c0: 3d46 616c 7365 290a 2020 2020 2020 2020  =False).        
+000157d0: 7365 6c66 2e5f 7465 6172 646f 776e 2849  self._teardown(I
+000157e0: 4e50 5554 5f46 494c 455f 5041 5448 290a  NPUT_FILE_PATH).
+000157f0: 0a20 2020 2040 4669 6c65 5368 6172 6550  .    @FileShareP
+00015800: 7265 7061 7265 7228 290a 2020 2020 4041  reparer().    @A
+00015810: 7379 6e63 5374 6f72 6167 6554 6573 7443  syncStorageTestC
+00015820: 6173 652e 6177 6169 745f 7072 6570 6172  ase.await_prepar
+00015830: 6564 5f74 6573 740a 2020 2020 6173 796e  ed_test.    asyn
+00015840: 6320 6465 6620 7465 7374 5f63 7265 6174  c def test_creat
+00015850: 655f 6669 6c65 5f66 726f 6d5f 7374 7265  e_file_from_stre
+00015860: 616d 5f74 7275 6e63 6174 6564 5f61 7379  am_truncated_asy
+00015870: 6e63 2873 656c 662c 2073 746f 7261 6765  nc(self, storage
+00015880: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
+00015890: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
+000158a0: 6579 293a 0a20 2020 2020 2020 2023 2070  ey):.        # p
+000158b0: 6172 616c 6c65 6c20 7465 7374 7320 696e  arallel tests in
+000158c0: 7472 6f64 7563 6520 7261 6e64 6f6d 206f  troduce random o
+000158d0: 7264 6572 206f 6620 7265 7175 6573 7473  rder of requests
+000158e0: 2c20 6361 6e20 6f6e 6c79 2072 756e 206c  , can only run l
+000158f0: 6976 650a 2020 2020 2020 2020 6966 206e  ive.        if n
+00015900: 6f74 2073 656c 662e 6973 5f6c 6976 653a  ot self.is_live:
+00015910: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00015920: 7572 6e0a 0a20 2020 2020 2020 2073 656c  urn..        sel
+00015930: 662e 5f73 6574 7570 2873 746f 7261 6765  f._setup(storage
+00015940: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
+00015950: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
+00015960: 6579 290a 2020 2020 2020 2020 6669 6c65  ey).        file
+00015970: 5f6e 616d 6520 3d20 7365 6c66 2e5f 6765  _name = self._ge
+00015980: 745f 6669 6c65 5f72 6566 6572 656e 6365  t_file_reference
+00015990: 2829 0a20 2020 2020 2020 2061 7761 6974  ().        await
+000159a0: 2073 656c 662e 5f73 6574 7570 5f73 6861   self._setup_sha
+000159b0: 7265 2873 746f 7261 6765 5f61 6363 6f75  re(storage_accou
+000159c0: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
+000159d0: 5f61 6363 6f75 6e74 5f6b 6579 290a 2020  _account_key).  
+000159e0: 2020 2020 2020 6461 7461 203d 2073 656c        data = sel
+000159f0: 662e 6765 745f 7261 6e64 6f6d 5f62 7974  f.get_random_byt
+00015a00: 6573 284c 4152 4745 5f46 494c 455f 5349  es(LARGE_FILE_SI
+00015a10: 5a45 290a 2020 2020 2020 2020 7769 7468  ZE).        with
+00015a20: 206f 7065 6e28 494e 5055 545f 4649 4c45   open(INPUT_FILE
+00015a30: 5f50 4154 482c 2027 7762 2729 2061 7320  _PATH, 'wb') as 
+00015a40: 7374 7265 616d 3a0a 2020 2020 2020 2020  stream:.        
+00015a50: 2020 2020 7374 7265 616d 2e77 7269 7465      stream.write
+00015a60: 2864 6174 6129 0a20 2020 2020 2020 2066  (data).        f
+00015a70: 696c 655f 636c 6965 6e74 203d 2053 6861  ile_client = Sha
+00015a80: 7265 4669 6c65 436c 6965 6e74 280a 2020  reFileClient(.  
+00015a90: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00015aa0: 6363 6f75 6e74 5f75 726c 2873 746f 7261  ccount_url(stora
+00015ab0: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
+00015ac0: 2022 6669 6c65 2229 2c0a 2020 2020 2020   "file"),.      
+00015ad0: 2020 2020 2020 7368 6172 655f 6e61 6d65        share_name
+00015ae0: 3d73 656c 662e 7368 6172 655f 6e61 6d65  =self.share_name
+00015af0: 2c0a 2020 2020 2020 2020 2020 2020 6669  ,.            fi
+00015b00: 6c65 5f70 6174 683d 6669 6c65 5f6e 616d  le_path=file_nam
+00015b10: 652c 0a20 2020 2020 2020 2020 2020 2063  e,.            c
+00015b20: 7265 6465 6e74 6961 6c3d 7374 6f72 6167  redential=storag
+00015b30: 655f 6163 636f 756e 745f 6b65 792c 0a20  e_account_key,. 
+00015b40: 2020 2020 2020 2020 2020 206d 6178 5f72             max_r
+00015b50: 616e 6765 5f73 697a 653d 3420 2a20 3130  ange_size=4 * 10
+00015b60: 3234 290a 0a20 2020 2020 2020 2023 2041  24)..        # A
+00015b70: 6374 0a20 2020 2020 2020 2066 696c 655f  ct.        file_
+00015b80: 7369 7a65 203d 206c 656e 2864 6174 6129  size = len(data)
+00015b90: 202d 2035 3132 0a20 2020 2020 2020 2077   - 512.        w
+00015ba0: 6974 6820 6f70 656e 2849 4e50 5554 5f46  ith open(INPUT_F
+00015bb0: 494c 455f 5041 5448 2c20 2772 6227 2920  ILE_PATH, 'rb') 
+00015bc0: 6173 2073 7472 6561 6d3a 0a20 2020 2020  as stream:.     
+00015bd0: 2020 2020 2020 2061 7761 6974 2066 696c         await fil
+00015be0: 655f 636c 6965 6e74 2e75 706c 6f61 645f  e_client.upload_
+00015bf0: 6669 6c65 2873 7472 6561 6d2c 206c 656e  file(stream, len
+00015c00: 6774 683d 6669 6c65 5f73 697a 652c 206d  gth=file_size, m
+00015c10: 6178 5f63 6f6e 6375 7272 656e 6379 3d34  ax_concurrency=4
+00015c20: 290a 0a20 2020 2020 2020 2023 2041 7373  )..        # Ass
+00015c30: 6572 740a 2020 2020 2020 2020 6177 6169  ert.        awai
+00015c40: 7420 7365 6c66 2e61 7373 6572 7446 696c  t self.assertFil
+00015c50: 6545 7175 616c 2866 696c 655f 636c 6965  eEqual(file_clie
+00015c60: 6e74 2c20 6461 7461 5b3a 6669 6c65 5f73  nt, data[:file_s
+00015c70: 697a 655d 290a 2020 2020 2020 2020 7365  ize]).        se
+00015c80: 6c66 2e5f 7465 6172 646f 776e 2849 4e50  lf._teardown(INP
+00015c90: 5554 5f46 494c 455f 5041 5448 290a 0a20  UT_FILE_PATH).. 
+00015ca0: 2020 2040 4669 6c65 5368 6172 6550 7265     @FileSharePre
+00015cb0: 7061 7265 7228 290a 2020 2020 4041 7379  parer().    @Asy
+00015cc0: 6e63 5374 6f72 6167 6554 6573 7443 6173  ncStorageTestCas
+00015cd0: 652e 6177 6169 745f 7072 6570 6172 6564  e.await_prepared
+00015ce0: 5f74 6573 740a 2020 2020 6173 796e 6320  _test.    async 
+00015cf0: 6465 6620 7465 7374 5f63 7265 6174 655f  def test_create_
+00015d00: 6669 6c65 5f66 726f 6d5f 7374 7265 616d  file_from_stream
+00015d10: 5f77 6974 685f 7072 6f67 7265 7373 5f74  _with_progress_t
+00015d20: 7275 6e63 6174 6564 5f61 7379 6e63 2873  runcated_async(s
+00015d30: 656c 662c 2073 746f 7261 6765 5f61 6363  elf, storage_acc
+00015d40: 6f75 6e74 5f6e 616d 652c 2073 746f 7261  ount_name, stora
+00015d50: 6765 5f61 6363 6f75 6e74 5f6b 6579 293a  ge_account_key):
+00015d60: 0a20 2020 2020 2020 2023 2070 6172 616c  .        # paral
+00015d70: 6c65 6c20 7465 7374 7320 696e 7472 6f64  lel tests introd
+00015d80: 7563 6520 7261 6e64 6f6d 206f 7264 6572  uce random order
+00015d90: 206f 6620 7265 7175 6573 7473 2c20 6361   of requests, ca
+00015da0: 6e20 6f6e 6c79 2072 756e 206c 6976 650a  n only run live.
+00015db0: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+00015dc0: 656c 662e 6973 5f6c 6976 653a 0a20 2020  elf.is_live:.   
+00015dd0: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+00015de0: 0a20 2020 2020 2020 2073 656c 662e 5f73  .        self._s
+00015df0: 6574 7570 2873 746f 7261 6765 5f61 6363  etup(storage_acc
+00015e00: 6f75 6e74 5f6e 616d 652c 2073 746f 7261  ount_name, stora
+00015e10: 6765 5f61 6363 6f75 6e74 5f6b 6579 290a  ge_account_key).
+00015e20: 2020 2020 2020 2020 6669 6c65 5f6e 616d          file_nam
+00015e30: 6520 3d20 7365 6c66 2e5f 6765 745f 6669  e = self._get_fi
+00015e40: 6c65 5f72 6566 6572 656e 6365 2829 0a20  le_reference(). 
+00015e50: 2020 2020 2020 2061 7761 6974 2073 656c         await sel
+00015e60: 662e 5f73 6574 7570 5f73 6861 7265 2873  f._setup_share(s
+00015e70: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
+00015e80: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
+00015e90: 6f75 6e74 5f6b 6579 290a 2020 2020 2020  ount_key).      
+00015ea0: 2020 6461 7461 203d 2073 656c 662e 6765    data = self.ge
+00015eb0: 745f 7261 6e64 6f6d 5f62 7974 6573 284c  t_random_bytes(L
+00015ec0: 4152 4745 5f46 494c 455f 5349 5a45 290a  ARGE_FILE_SIZE).
+00015ed0: 2020 2020 2020 2020 7769 7468 206f 7065          with ope
+00015ee0: 6e28 494e 5055 545f 4649 4c45 5f50 4154  n(INPUT_FILE_PAT
+00015ef0: 482c 2027 7762 2729 2061 7320 7374 7265  H, 'wb') as stre
+00015f00: 616d 3a0a 2020 2020 2020 2020 2020 2020  am:.            
+00015f10: 7374 7265 616d 2e77 7269 7465 2864 6174  stream.write(dat
+00015f20: 6129 0a20 2020 2020 2020 2066 696c 655f  a).        file_
+00015f30: 636c 6965 6e74 203d 2053 6861 7265 4669  client = ShareFi
+00015f40: 6c65 436c 6965 6e74 280a 2020 2020 2020  leClient(.      
+00015f50: 2020 2020 2020 7365 6c66 2e61 6363 6f75        self.accou
+00015f60: 6e74 5f75 726c 2873 746f 7261 6765 5f61  nt_url(storage_a
+00015f70: 6363 6f75 6e74 5f6e 616d 652c 2022 6669  ccount_name, "fi
+00015f80: 6c65 2229 2c0a 2020 2020 2020 2020 2020  le"),.          
+00015f90: 2020 7368 6172 655f 6e61 6d65 3d73 656c    share_name=sel
+00015fa0: 662e 7368 6172 655f 6e61 6d65 2c0a 2020  f.share_name,.  
+00015fb0: 2020 2020 2020 2020 2020 6669 6c65 5f70            file_p
+00015fc0: 6174 683d 6669 6c65 5f6e 616d 652c 0a20  ath=file_name,. 
+00015fd0: 2020 2020 2020 2020 2020 2063 7265 6465             crede
+00015fe0: 6e74 6961 6c3d 7374 6f72 6167 655f 6163  ntial=storage_ac
+00015ff0: 636f 756e 745f 6b65 792c 0a20 2020 2020  count_key,.     
+00016000: 2020 2020 2020 206d 6178 5f72 616e 6765         max_range
+00016010: 5f73 697a 653d 3420 2a20 3130 3234 290a  _size=4 * 1024).
+00016020: 0a20 2020 2020 2020 2023 2041 6374 0a20  .        # Act. 
+00016030: 2020 2020 2020 2070 726f 6772 6573 7320         progress 
+00016040: 3d20 5b5d 0a20 2020 2020 2020 2064 6566  = [].        def
+00016050: 2063 616c 6c62 6163 6b28 7265 7370 6f6e   callback(respon
+00016060: 7365 293a 0a20 2020 2020 2020 2020 2020  se):.           
+00016070: 2063 7572 7265 6e74 203d 2072 6573 706f   current = respo
+00016080: 6e73 652e 636f 6e74 6578 745b 2775 706c  nse.context['upl
+00016090: 6f61 645f 7374 7265 616d 5f63 7572 7265  oad_stream_curre
+000160a0: 6e74 275d 0a20 2020 2020 2020 2020 2020  nt'].           
+000160b0: 2074 6f74 616c 203d 2072 6573 706f 6e73   total = respons
+000160c0: 652e 636f 6e74 6578 745b 2764 6174 615f  e.context['data_
+000160d0: 7374 7265 616d 5f74 6f74 616c 275d 0a20  stream_total']. 
+000160e0: 2020 2020 2020 2020 2020 2069 6620 6375             if cu
+000160f0: 7272 656e 7420 6973 206e 6f74 204e 6f6e  rrent is not Non
+00016100: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00016110: 2020 2070 726f 6772 6573 732e 6170 7065     progress.appe
+00016120: 6e64 2828 6375 7272 656e 742c 2074 6f74  nd((current, tot
+00016130: 616c 2929 0a0a 2020 2020 2020 2020 6669  al))..        fi
+00016140: 6c65 5f73 697a 6520 3d20 6c65 6e28 6461  le_size = len(da
+00016150: 7461 2920 2d20 350a 2020 2020 2020 2020  ta) - 5.        
+00016160: 7769 7468 206f 7065 6e28 494e 5055 545f  with open(INPUT_
+00016170: 4649 4c45 5f50 4154 482c 2027 7262 2729  FILE_PATH, 'rb')
+00016180: 2061 7320 7374 7265 616d 3a0a 2020 2020   as stream:.    
+00016190: 2020 2020 2020 2020 6177 6169 7420 6669          await fi
+000161a0: 6c65 5f63 6c69 656e 742e 7570 6c6f 6164  le_client.upload
+000161b0: 5f66 696c 6528 7374 7265 616d 2c20 6c65  _file(stream, le
+000161c0: 6e67 7468 3d66 696c 655f 7369 7a65 2c20  ngth=file_size, 
+000161d0: 6d61 785f 636f 6e63 7572 7265 6e63 793d  max_concurrency=
+000161e0: 322c 2072 6177 5f72 6573 706f 6e73 655f  2, raw_response_
+000161f0: 686f 6f6b 3d63 616c 6c62 6163 6b29 0a0a  hook=callback)..
+00016200: 0a20 2020 2020 2020 2023 2041 7373 6572  .        # Asser
+00016210: 740a 2020 2020 2020 2020 6177 6169 7420  t.        await 
+00016220: 7365 6c66 2e61 7373 6572 7446 696c 6545  self.assertFileE
+00016230: 7175 616c 2866 696c 655f 636c 6965 6e74  qual(file_client
+00016240: 2c20 6461 7461 5b3a 6669 6c65 5f73 697a  , data[:file_siz
+00016250: 655d 290a 2020 2020 2020 2020 7365 6c66  e]).        self
+00016260: 2e61 7373 6572 745f 7570 6c6f 6164 5f70  .assert_upload_p
+00016270: 726f 6772 6573 7328 0a20 2020 2020 2020  rogress(.       
+00016280: 2020 2020 2066 696c 655f 7369 7a65 2c0a       file_size,.
+00016290: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000162a0: 2e66 7363 2e5f 636f 6e66 6967 2e6d 6178  .fsc._config.max
+000162b0: 5f72 616e 6765 5f73 697a 652c 0a20 2020  _range_size,.   
+000162c0: 2020 2020 2020 2020 2070 726f 6772 6573           progres
+000162d0: 732c 2075 6e6b 6e6f 776e 5f73 697a 653d  s, unknown_size=
+000162e0: 4661 6c73 6529 0a20 2020 2020 2020 2073  False).        s
+000162f0: 656c 662e 5f74 6561 7264 6f77 6e28 494e  elf._teardown(IN
+00016300: 5055 545f 4649 4c45 5f50 4154 4829 0a0a  PUT_FILE_PATH)..
+00016310: 2020 2020 4046 696c 6553 6861 7265 5072      @FileSharePr
+00016320: 6570 6172 6572 2829 0a20 2020 2040 4173  eparer().    @As
+00016330: 796e 6353 746f 7261 6765 5465 7374 4361  yncStorageTestCa
+00016340: 7365 2e61 7761 6974 5f70 7265 7061 7265  se.await_prepare
+00016350: 645f 7465 7374 0a20 2020 2061 7379 6e63  d_test.    async
+00016360: 2064 6566 2074 6573 745f 6372 6561 7465   def test_create
+00016370: 5f66 696c 655f 6672 6f6d 5f74 6578 745f  _file_from_text_
+00016380: 6173 796e 6328 7365 6c66 2c20 7374 6f72  async(self, stor
+00016390: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
+000163a0: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
+000163b0: 745f 6b65 7929 3a0a 2020 2020 2020 2020  t_key):.        
+000163c0: 7365 6c66 2e5f 7365 7475 7028 7374 6f72  self._setup(stor
+000163d0: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
+000163e0: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
+000163f0: 745f 6b65 7929 0a20 2020 2020 2020 2066  t_key).        f
+00016400: 696c 655f 6e61 6d65 203d 2073 656c 662e  ile_name = self.
+00016410: 5f67 6574 5f66 696c 655f 7265 6665 7265  _get_file_refere
+00016420: 6e63 6528 290a 2020 2020 2020 2020 6177  nce().        aw
+00016430: 6169 7420 7365 6c66 2e5f 7365 7475 705f  ait self._setup_
+00016440: 7368 6172 6528 7374 6f72 6167 655f 6163  share(storage_ac
+00016450: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
+00016460: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
+00016470: 0a20 2020 2020 2020 2074 6578 7420 3d20  .        text = 
+00016480: 7527 6865 6c6c 6f20 e595 8ae9 bd84 e4b8  u'hello ........
+00016490: 82e7 8b9b e78b 9c20 776f 726c 6427 0a20  ....... world'. 
+000164a0: 2020 2020 2020 2064 6174 6120 3d20 7465         data = te
+000164b0: 7874 2e65 6e63 6f64 6528 2775 7466 2d38  xt.encode('utf-8
+000164c0: 2729 0a20 2020 2020 2020 2066 696c 655f  ').        file_
+000164d0: 636c 6965 6e74 203d 2053 6861 7265 4669  client = ShareFi
+000164e0: 6c65 436c 6965 6e74 280a 2020 2020 2020  leClient(.      
+000164f0: 2020 2020 2020 7365 6c66 2e61 6363 6f75        self.accou
+00016500: 6e74 5f75 726c 2873 746f 7261 6765 5f61  nt_url(storage_a
+00016510: 6363 6f75 6e74 5f6e 616d 652c 2022 6669  ccount_name, "fi
+00016520: 6c65 2229 2c0a 2020 2020 2020 2020 2020  le"),.          
+00016530: 2020 7368 6172 655f 6e61 6d65 3d73 656c    share_name=sel
+00016540: 662e 7368 6172 655f 6e61 6d65 2c0a 2020  f.share_name,.  
+00016550: 2020 2020 2020 2020 2020 6669 6c65 5f70            file_p
+00016560: 6174 683d 6669 6c65 5f6e 616d 652c 0a20  ath=file_name,. 
+00016570: 2020 2020 2020 2020 2020 2063 7265 6465             crede
+00016580: 6e74 6961 6c3d 7374 6f72 6167 655f 6163  ntial=storage_ac
+00016590: 636f 756e 745f 6b65 792c 0a20 2020 2020  count_key,.     
+000165a0: 2020 2020 2020 206d 6178 5f72 616e 6765         max_range
+000165b0: 5f73 697a 653d 3420 2a20 3130 3234 290a  _size=4 * 1024).
+000165c0: 0a20 2020 2020 2020 2023 2041 6374 0a20  .        # Act. 
+000165d0: 2020 2020 2020 2061 7761 6974 2066 696c         await fil
+000165e0: 655f 636c 6965 6e74 2e75 706c 6f61 645f  e_client.upload_
+000165f0: 6669 6c65 2874 6578 7429 0a0a 2020 2020  file(text)..    
+00016600: 2020 2020 2320 4173 7365 7274 0a20 2020      # Assert.   
+00016610: 2020 2020 2061 7761 6974 2073 656c 662e       await self.
+00016620: 6173 7365 7274 4669 6c65 4571 7561 6c28  assertFileEqual(
+00016630: 6669 6c65 5f63 6c69 656e 742c 2064 6174  file_client, dat
+00016640: 6129 0a0a 2020 2020 4046 696c 6553 6861  a)..    @FileSha
+00016650: 7265 5072 6570 6172 6572 2829 0a20 2020  rePreparer().   
+00016660: 2040 4173 796e 6353 746f 7261 6765 5465   @AsyncStorageTe
+00016670: 7374 4361 7365 2e61 7761 6974 5f70 7265  stCase.await_pre
+00016680: 7061 7265 645f 7465 7374 0a20 2020 2061  pared_test.    a
+00016690: 7379 6e63 2064 6566 2074 6573 745f 6372  sync def test_cr
+000166a0: 6561 7465 5f66 696c 655f 6672 6f6d 5f74  eate_file_from_t
+000166b0: 6578 745f 7769 7468 5f65 6e63 6f64 696e  ext_with_encodin
+000166c0: 675f 6173 796e 6328 7365 6c66 2c20 7374  g_async(self, st
+000166d0: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
+000166e0: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
+000166f0: 756e 745f 6b65 7929 3a0a 2020 2020 2020  unt_key):.      
+00016700: 2020 7365 6c66 2e5f 7365 7475 7028 7374    self._setup(st
+00016710: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
+00016720: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
+00016730: 756e 745f 6b65 7929 0a20 2020 2020 2020  unt_key).       
+00016740: 2066 696c 655f 6e61 6d65 203d 2073 656c   file_name = sel
+00016750: 662e 5f67 6574 5f66 696c 655f 7265 6665  f._get_file_refe
+00016760: 7265 6e63 6528 290a 2020 2020 2020 2020  rence().        
+00016770: 6177 6169 7420 7365 6c66 2e5f 7365 7475  await self._setu
+00016780: 705f 7368 6172 6528 7374 6f72 6167 655f  p_share(storage_
+00016790: 6163 636f 756e 745f 6e61 6d65 2c20 7374  account_name, st
+000167a0: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
+000167b0: 7929 0a20 2020 2020 2020 2074 6578 7420  y).        text 
+000167c0: 3d20 7527 6865 6c6c 6f20 e595 8ae9 bd84  = u'hello ......
+000167d0: e4b8 82e7 8b9b e78b 9c20 776f 726c 6427  ......... world'
+000167e0: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
+000167f0: 7465 7874 2e65 6e63 6f64 6528 2775 7466  text.encode('utf
+00016800: 2d31 3627 290a 2020 2020 2020 2020 6669  -16').        fi
+00016810: 6c65 5f63 6c69 656e 7420 3d20 5368 6172  le_client = Shar
+00016820: 6546 696c 6543 6c69 656e 7428 0a20 2020  eFileClient(.   
+00016830: 2020 2020 2020 2020 2073 656c 662e 6163           self.ac
+00016840: 636f 756e 745f 7572 6c28 7374 6f72 6167  count_url(storag
+00016850: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
+00016860: 2266 696c 6522 292c 0a20 2020 2020 2020  "file"),.       
+00016870: 2020 2020 2073 6861 7265 5f6e 616d 653d       share_name=
+00016880: 7365 6c66 2e73 6861 7265 5f6e 616d 652c  self.share_name,
+00016890: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
+000168a0: 655f 7061 7468 3d66 696c 655f 6e61 6d65  e_path=file_name
+000168b0: 2c0a 2020 2020 2020 2020 2020 2020 6372  ,.            cr
+000168c0: 6564 656e 7469 616c 3d73 746f 7261 6765  edential=storage
+000168d0: 5f61 6363 6f75 6e74 5f6b 6579 2c0a 2020  _account_key,.  
+000168e0: 2020 2020 2020 2020 2020 6d61 785f 7261            max_ra
+000168f0: 6e67 655f 7369 7a65 3d34 202a 2031 3032  nge_size=4 * 102
+00016900: 3429 0a0a 2020 2020 2020 2020 2320 4163  4)..        # Ac
+00016910: 740a 2020 2020 2020 2020 6177 6169 7420  t.        await 
+00016920: 6669 6c65 5f63 6c69 656e 742e 7570 6c6f  file_client.uplo
+00016930: 6164 5f66 696c 6528 7465 7874 2c20 656e  ad_file(text, en
+00016940: 636f 6469 6e67 3d27 5554 462d 3136 2729  coding='UTF-16')
+00016950: 0a0a 2020 2020 2020 2020 2320 4173 7365  ..        # Asse
+00016960: 7274 0a20 2020 2020 2020 2061 7761 6974  rt.        await
+00016970: 2073 656c 662e 6173 7365 7274 4669 6c65   self.assertFile
+00016980: 4571 7561 6c28 6669 6c65 5f63 6c69 656e  Equal(file_clien
+00016990: 742c 2064 6174 6129 0a20 2020 2020 2020  t, data).       
+000169a0: 2073 656c 662e 5f74 6561 7264 6f77 6e28   self._teardown(
+000169b0: 6669 6c65 5f6e 616d 6529 0a0a 2020 2020  file_name)..    
+000169c0: 4046 696c 6553 6861 7265 5072 6570 6172  @FileSharePrepar
+000169d0: 6572 2829 0a20 2020 2040 4173 796e 6353  er().    @AsyncS
+000169e0: 746f 7261 6765 5465 7374 4361 7365 2e61  torageTestCase.a
+000169f0: 7761 6974 5f70 7265 7061 7265 645f 7465  wait_prepared_te
+00016a00: 7374 0a20 2020 2061 7379 6e63 2064 6566  st.    async def
+00016a10: 2074 6573 745f 6372 6561 7465 5f66 696c   test_create_fil
+00016a20: 655f 6672 6f6d 5f74 6578 745f 6368 756e  e_from_text_chun
+00016a30: 6b65 645f 7570 6c6f 6164 5f61 7379 6e63  ked_upload_async
+00016a40: 2873 656c 662c 2073 746f 7261 6765 5f61  (self, storage_a
+00016a50: 6363 6f75 6e74 5f6e 616d 652c 2073 746f  ccount_name, sto
+00016a60: 7261 6765 5f61 6363 6f75 6e74 5f6b 6579  rage_account_key
+00016a70: 293a 0a20 2020 2020 2020 2023 2070 6172  ):.        # par
+00016a80: 616c 6c65 6c20 7465 7374 7320 696e 7472  allel tests intr
+00016a90: 6f64 7563 6520 7261 6e64 6f6d 206f 7264  oduce random ord
+00016aa0: 6572 206f 6620 7265 7175 6573 7473 2c20  er of requests, 
+00016ab0: 6361 6e20 6f6e 6c79 2072 756e 206c 6976  can only run liv
+00016ac0: 650a 2020 2020 2020 2020 6966 206e 6f74  e.        if not
+00016ad0: 2073 656c 662e 6973 5f6c 6976 653a 0a20   self.is_live:. 
+00016ae0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00016af0: 6e0a 0a20 2020 2020 2020 2073 656c 662e  n..        self.
+00016b00: 5f73 6574 7570 2873 746f 7261 6765 5f61  _setup(storage_a
+00016b10: 6363 6f75 6e74 5f6e 616d 652c 2073 746f  ccount_name, sto
+00016b20: 7261 6765 5f61 6363 6f75 6e74 5f6b 6579  rage_account_key
+00016b30: 290a 2020 2020 2020 2020 6669 6c65 5f6e  ).        file_n
+00016b40: 616d 6520 3d20 7365 6c66 2e5f 6765 745f  ame = self._get_
+00016b50: 6669 6c65 5f72 6566 6572 656e 6365 2829  file_reference()
+00016b60: 0a20 2020 2020 2020 2061 7761 6974 2073  .        await s
+00016b70: 656c 662e 5f73 6574 7570 5f73 6861 7265  elf._setup_share
+00016b80: 2873 746f 7261 6765 5f61 6363 6f75 6e74  (storage_account
+00016b90: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
+00016ba0: 6363 6f75 6e74 5f6b 6579 290a 2020 2020  ccount_key).    
+00016bb0: 2020 2020 6461 7461 203d 2073 656c 662e      data = self.
+00016bc0: 6765 745f 7261 6e64 6f6d 5f74 6578 745f  get_random_text_
+00016bd0: 6461 7461 284c 4152 4745 5f46 494c 455f  data(LARGE_FILE_
+00016be0: 5349 5a45 290a 2020 2020 2020 2020 656e  SIZE).        en
+00016bf0: 636f 6465 645f 6461 7461 203d 2064 6174  coded_data = dat
+00016c00: 612e 656e 636f 6465 2827 7574 662d 3827  a.encode('utf-8'
+00016c10: 290a 2020 2020 2020 2020 6669 6c65 5f63  ).        file_c
+00016c20: 6c69 656e 7420 3d20 5368 6172 6546 696c  lient = ShareFil
+00016c30: 6543 6c69 656e 7428 0a20 2020 2020 2020  eClient(.       
+00016c40: 2020 2020 2073 656c 662e 6163 636f 756e       self.accoun
+00016c50: 745f 7572 6c28 7374 6f72 6167 655f 6163  t_url(storage_ac
+00016c60: 636f 756e 745f 6e61 6d65 2c20 2266 696c  count_name, "fil
+00016c70: 6522 292c 0a20 2020 2020 2020 2020 2020  e"),.           
+00016c80: 2073 6861 7265 5f6e 616d 653d 7365 6c66   share_name=self
+00016c90: 2e73 6861 7265 5f6e 616d 652c 0a20 2020  .share_name,.   
+00016ca0: 2020 2020 2020 2020 2066 696c 655f 7061           file_pa
+00016cb0: 7468 3d66 696c 655f 6e61 6d65 2c0a 2020  th=file_name,.  
+00016cc0: 2020 2020 2020 2020 2020 6372 6564 656e            creden
+00016cd0: 7469 616c 3d73 746f 7261 6765 5f61 6363  tial=storage_acc
+00016ce0: 6f75 6e74 5f6b 6579 2c0a 2020 2020 2020  ount_key,.      
+00016cf0: 2020 2020 2020 6d61 785f 7261 6e67 655f        max_range_
+00016d00: 7369 7a65 3d34 202a 2031 3032 3429 0a0a  size=4 * 1024)..
+00016d10: 2020 2020 2020 2020 2320 4163 740a 2020          # Act.  
+00016d20: 2020 2020 2020 6177 6169 7420 6669 6c65        await file
+00016d30: 5f63 6c69 656e 742e 7570 6c6f 6164 5f66  _client.upload_f
+00016d40: 696c 6528 6461 7461 290a 0a20 2020 2020  ile(data)..     
+00016d50: 2020 2023 2041 7373 6572 740a 2020 2020     # Assert.    
+00016d60: 2020 2020 6177 6169 7420 7365 6c66 2e61      await self.a
+00016d70: 7373 6572 7446 696c 6545 7175 616c 2866  ssertFileEqual(f
+00016d80: 696c 655f 636c 6965 6e74 2c20 656e 636f  ile_client, enco
+00016d90: 6465 645f 6461 7461 290a 2020 2020 2020  ded_data).      
+00016da0: 2020 7365 6c66 2e5f 7465 6172 646f 776e    self._teardown
+00016db0: 2866 696c 655f 6e61 6d65 290a 0a20 2020  (file_name)..   
+00016dc0: 2040 4669 6c65 5368 6172 6550 7265 7061   @FileSharePrepa
+00016dd0: 7265 7228 290a 2020 2020 4041 7379 6e63  rer().    @Async
+00016de0: 5374 6f72 6167 6554 6573 7443 6173 652e  StorageTestCase.
+00016df0: 6177 6169 745f 7072 6570 6172 6564 5f74  await_prepared_t
+00016e00: 6573 740a 2020 2020 6173 796e 6320 6465  est.    async de
+00016e10: 6620 7465 7374 5f63 7265 6174 655f 6669  f test_create_fi
+00016e20: 6c65 5f77 6974 685f 6d64 355f 736d 616c  le_with_md5_smal
+00016e30: 6c5f 6173 796e 6328 7365 6c66 2c20 7374  l_async(self, st
+00016e40: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
+00016e50: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
+00016e60: 756e 745f 6b65 7929 3a0a 2020 2020 2020  unt_key):.      
+00016e70: 2020 7365 6c66 2e5f 7365 7475 7028 7374    self._setup(st
+00016e80: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
+00016e90: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
+00016ea0: 756e 745f 6b65 7929 0a20 2020 2020 2020  unt_key).       
+00016eb0: 2066 696c 655f 6e61 6d65 203d 2073 656c   file_name = sel
+00016ec0: 662e 5f67 6574 5f66 696c 655f 7265 6665  f._get_file_refe
+00016ed0: 7265 6e63 6528 290a 2020 2020 2020 2020  rence().        
+00016ee0: 6177 6169 7420 7365 6c66 2e5f 7365 7475  await self._setu
+00016ef0: 705f 7368 6172 6528 7374 6f72 6167 655f  p_share(storage_
+00016f00: 6163 636f 756e 745f 6e61 6d65 2c20 7374  account_name, st
+00016f10: 6f72 6167 655f 6163 636f 756e 745f 6b65  orage_account_ke
+00016f20: 7929 0a20 2020 2020 2020 2064 6174 6120  y).        data 
+00016f30: 3d20 7365 6c66 2e67 6574 5f72 616e 646f  = self.get_rando
+00016f40: 6d5f 6279 7465 7328 3531 3229 0a20 2020  m_bytes(512).   
+00016f50: 2020 2020 2066 696c 655f 636c 6965 6e74       file_client
+00016f60: 203d 2053 6861 7265 4669 6c65 436c 6965   = ShareFileClie
+00016f70: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
+00016f80: 7365 6c66 2e61 6363 6f75 6e74 5f75 726c  self.account_url
+00016f90: 2873 746f 7261 6765 5f61 6363 6f75 6e74  (storage_account
+00016fa0: 5f6e 616d 652c 2022 6669 6c65 2229 2c0a  _name, "file"),.
+00016fb0: 2020 2020 2020 2020 2020 2020 7368 6172              shar
+00016fc0: 655f 6e61 6d65 3d73 656c 662e 7368 6172  e_name=self.shar
+00016fd0: 655f 6e61 6d65 2c0a 2020 2020 2020 2020  e_name,.        
+00016fe0: 2020 2020 6669 6c65 5f70 6174 683d 6669      file_path=fi
+00016ff0: 6c65 5f6e 616d 652c 0a20 2020 2020 2020  le_name,.       
+00017000: 2020 2020 2063 7265 6465 6e74 6961 6c3d       credential=
+00017010: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
+00017020: 6b65 792c 0a20 2020 2020 2020 2020 2020  key,.           
+00017030: 206d 6178 5f72 616e 6765 5f73 697a 653d   max_range_size=
+00017040: 3420 2a20 3130 3234 290a 0a20 2020 2020  4 * 1024)..     
+00017050: 2020 2023 2041 6374 0a20 2020 2020 2020     # Act.       
+00017060: 2061 7761 6974 2066 696c 655f 636c 6965   await file_clie
+00017070: 6e74 2e75 706c 6f61 645f 6669 6c65 2864  nt.upload_file(d
+00017080: 6174 612c 2076 616c 6964 6174 655f 636f  ata, validate_co
+00017090: 6e74 656e 743d 5472 7565 290a 2020 2020  ntent=True).    
+000170a0: 2020 2020 7365 6c66 2e5f 7465 6172 646f      self._teardo
+000170b0: 776e 2866 696c 655f 6e61 6d65 290a 2020  wn(file_name).  
+000170c0: 2020 2020 2020 2320 4173 7365 7274 0a0a        # Assert..
+000170d0: 2020 2020 4046 696c 6553 6861 7265 5072      @FileSharePr
+000170e0: 6570 6172 6572 2829 0a20 2020 2040 4173  eparer().    @As
+000170f0: 796e 6353 746f 7261 6765 5465 7374 4361  yncStorageTestCa
+00017100: 7365 2e61 7761 6974 5f70 7265 7061 7265  se.await_prepare
+00017110: 645f 7465 7374 0a20 2020 2061 7379 6e63  d_test.    async
+00017120: 2064 6566 2074 6573 745f 6372 6561 7465   def test_create
+00017130: 5f66 696c 655f 7769 7468 5f6d 6435 5f6c  _file_with_md5_l
+00017140: 6172 6765 5f61 7379 6e63 2873 656c 662c  arge_async(self,
+00017150: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
+00017160: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
+00017170: 6363 6f75 6e74 5f6b 6579 293a 0a20 2020  ccount_key):.   
+00017180: 2020 2020 2023 2070 6172 616c 6c65 6c20       # parallel 
+00017190: 7465 7374 7320 696e 7472 6f64 7563 6520  tests introduce 
+000171a0: 7261 6e64 6f6d 206f 7264 6572 206f 6620  random order of 
+000171b0: 7265 7175 6573 7473 2c20 6361 6e20 6f6e  requests, can on
+000171c0: 6c79 2072 756e 206c 6976 650a 2020 2020  ly run live.    
+000171d0: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
+000171e0: 6973 5f6c 6976 653a 0a20 2020 2020 2020  is_live:.       
+000171f0: 2020 2020 2072 6574 7572 6e0a 0a20 2020       return..   
+00017200: 2020 2020 2073 656c 662e 5f73 6574 7570       self._setup
+00017210: 2873 746f 7261 6765 5f61 6363 6f75 6e74  (storage_account
+00017220: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
+00017230: 6363 6f75 6e74 5f6b 6579 290a 2020 2020  ccount_key).    
+00017240: 2020 2020 6669 6c65 5f6e 616d 6520 3d20      file_name = 
+00017250: 7365 6c66 2e5f 6765 745f 6669 6c65 5f72  self._get_file_r
+00017260: 6566 6572 656e 6365 2829 0a20 2020 2020  eference().     
+00017270: 2020 2061 7761 6974 2073 656c 662e 5f73     await self._s
+00017280: 6574 7570 5f73 6861 7265 2873 746f 7261  etup_share(stora
+00017290: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
+000172a0: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
+000172b0: 5f6b 6579 290a 2020 2020 2020 2020 6461  _key).        da
+000172c0: 7461 203d 2073 656c 662e 6765 745f 7261  ta = self.get_ra
+000172d0: 6e64 6f6d 5f62 7974 6573 284c 4152 4745  ndom_bytes(LARGE
+000172e0: 5f46 494c 455f 5349 5a45 290a 2020 2020  _FILE_SIZE).    
+000172f0: 2020 2020 6669 6c65 5f63 6c69 656e 7420      file_client 
+00017300: 3d20 5368 6172 6546 696c 6543 6c69 656e  = ShareFileClien
+00017310: 7428 0a20 2020 2020 2020 2020 2020 2073  t(.            s
+00017320: 656c 662e 6163 636f 756e 745f 7572 6c28  elf.account_url(
+00017330: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
+00017340: 6e61 6d65 2c20 2266 696c 6522 292c 0a20  name, "file"),. 
+00017350: 2020 2020 2020 2020 2020 2073 6861 7265             share
+00017360: 5f6e 616d 653d 7365 6c66 2e73 6861 7265  _name=self.share
+00017370: 5f6e 616d 652c 0a20 2020 2020 2020 2020  _name,.         
+00017380: 2020 2066 696c 655f 7061 7468 3d66 696c     file_path=fil
+00017390: 655f 6e61 6d65 2c0a 2020 2020 2020 2020  e_name,.        
+000173a0: 2020 2020 6372 6564 656e 7469 616c 3d73      credential=s
+000173b0: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
+000173c0: 6579 2c0a 2020 2020 2020 2020 2020 2020  ey,.            
+000173d0: 6d61 785f 7261 6e67 655f 7369 7a65 3d34  max_range_size=4
+000173e0: 202a 2031 3032 3429 0a0a 2020 2020 2020   * 1024)..      
+000173f0: 2020 2320 4163 740a 2020 2020 2020 2020    # Act.        
+00017400: 6177 6169 7420 6669 6c65 5f63 6c69 656e  await file_clien
+00017410: 742e 7570 6c6f 6164 5f66 696c 6528 6461  t.upload_file(da
+00017420: 7461 2c20 7661 6c69 6461 7465 5f63 6f6e  ta, validate_con
+00017430: 7465 6e74 3d54 7275 652c 206d 6178 5f63  tent=True, max_c
+00017440: 6f6e 6375 7272 656e 6379 3d32 290a 2020  oncurrency=2).  
+00017450: 2020 2020 2020 7365 6c66 2e5f 7465 6172        self._tear
+00017460: 646f 776e 2866 696c 655f 6e61 6d65 290a  down(file_name).
+00017470: 2020 2020 2020 2020 2320 4173 7365 7274          # Assert
+00017480: 0a0a 2020 2020 2320 2d2d 5465 7374 2063  ..    # --Test c
+00017490: 6173 6573 2066 6f72 2073 6173 2026 2061  ases for sas & a
+000174a0: 636c 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  cl -------------
+000174b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000174c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000174d0: 2d2d 2d0a 2020 2020 4046 696c 6553 6861  ---.    @FileSha
+000174e0: 7265 5072 6570 6172 6572 2829 0a20 2020  rePreparer().   
+000174f0: 2040 4173 796e 6353 746f 7261 6765 5465   @AsyncStorageTe
+00017500: 7374 4361 7365 2e61 7761 6974 5f70 7265  stCase.await_pre
+00017510: 7061 7265 645f 7465 7374 0a20 2020 2061  pared_test.    a
+00017520: 7379 6e63 2064 6566 2074 6573 745f 7361  sync def test_sa
+00017530: 735f 6163 6365 7373 5f66 696c 655f 6173  s_access_file_as
+00017540: 796e 6328 7365 6c66 2c20 7374 6f72 6167  ync(self, storag
+00017550: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
+00017560: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
+00017570: 6b65 7929 3a0a 2020 2020 2020 2020 2320  key):.        # 
+00017580: 5341 5320 5552 4c20 6973 2063 616c 6375  SAS URL is calcu
+00017590: 6c61 7465 6420 6672 6f6d 2073 746f 7261  lated from stora
+000175a0: 6765 206b 6579 2c20 736f 2074 6869 7320  ge key, so this 
+000175b0: 7465 7374 2072 756e 7320 6c69 7665 206f  test runs live o
+000175c0: 6e6c 790a 2020 2020 2020 2020 6966 206e  nly.        if n
+000175d0: 6f74 2073 656c 662e 6973 5f6c 6976 653a  ot self.is_live:
+000175e0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000175f0: 7572 6e0a 0a20 2020 2020 2020 2073 656c  urn..        sel
+00017600: 662e 5f73 6574 7570 2873 746f 7261 6765  f._setup(storage
+00017610: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
+00017620: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
+00017630: 6579 290a 2020 2020 2020 2020 6669 6c65  ey).        file
+00017640: 5f63 6c69 656e 7420 3d20 6177 6169 7420  _client = await 
+00017650: 7365 6c66 2e5f 6372 6561 7465 5f66 696c  self._create_fil
+00017660: 6528 7374 6f72 6167 655f 6163 636f 756e  e(storage_accoun
+00017670: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
+00017680: 6163 636f 756e 745f 6b65 7929 0a20 2020  account_key).   
+00017690: 2020 2020 2074 6f6b 656e 203d 2067 656e       token = gen
+000176a0: 6572 6174 655f 6669 6c65 5f73 6173 280a  erate_file_sas(.
+000176b0: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+000176c0: 5f63 6c69 656e 742e 6163 636f 756e 745f  _client.account_
+000176d0: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
+000176e0: 2020 6669 6c65 5f63 6c69 656e 742e 7368    file_client.sh
+000176f0: 6172 655f 6e61 6d65 2c0a 2020 2020 2020  are_name,.      
+00017700: 2020 2020 2020 6669 6c65 5f63 6c69 656e        file_clien
+00017710: 742e 6669 6c65 5f70 6174 682c 0a20 2020  t.file_path,.   
+00017720: 2020 2020 2020 2020 2066 696c 655f 636c           file_cl
+00017730: 6965 6e74 2e63 7265 6465 6e74 6961 6c2e  ient.credential.
+00017740: 6163 636f 756e 745f 6b65 792c 0a20 2020  account_key,.   
+00017750: 2020 2020 2020 2020 2070 6572 6d69 7373           permiss
+00017760: 696f 6e3d 4669 6c65 5361 7350 6572 6d69  ion=FileSasPermi
+00017770: 7373 696f 6e73 2872 6561 643d 5472 7565  ssions(read=True
+00017780: 292c 0a20 2020 2020 2020 2020 2020 2065  ),.            e
+00017790: 7870 6972 793d 6461 7465 7469 6d65 2e75  xpiry=datetime.u
+000177a0: 7463 6e6f 7728 2920 2b20 7469 6d65 6465  tcnow() + timede
+000177b0: 6c74 6128 686f 7572 733d 3129 2c0a 2020  lta(hours=1),.  
+000177c0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+000177d0: 2023 2041 6374 0a20 2020 2020 2020 2066   # Act.        f
+000177e0: 696c 655f 636c 6965 6e74 203d 2053 6861  ile_client = Sha
+000177f0: 7265 4669 6c65 436c 6965 6e74 280a 2020  reFileClient(.  
+00017800: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00017810: 6363 6f75 6e74 5f75 726c 2873 746f 7261  ccount_url(stora
+00017820: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
+00017830: 2022 6669 6c65 2229 2c0a 2020 2020 2020   "file"),.      
+00017840: 2020 2020 2020 7368 6172 655f 6e61 6d65        share_name
+00017850: 3d73 656c 662e 7368 6172 655f 6e61 6d65  =self.share_name
+00017860: 2c0a 2020 2020 2020 2020 2020 2020 6669  ,.            fi
+00017870: 6c65 5f70 6174 683d 6669 6c65 5f63 6c69  le_path=file_cli
+00017880: 656e 742e 6669 6c65 5f6e 616d 652c 0a20  ent.file_name,. 
+00017890: 2020 2020 2020 2020 2020 2063 7265 6465             crede
+000178a0: 6e74 6961 6c3d 746f 6b65 6e29 0a20 2020  ntial=token).   
+000178b0: 2020 2020 2063 6f6e 7465 6e74 203d 2061       content = a
+000178c0: 7761 6974 2066 696c 655f 636c 6965 6e74  wait file_client
+000178d0: 2e64 6f77 6e6c 6f61 645f 6669 6c65 2829  .download_file()
+000178e0: 0a20 2020 2020 2020 2063 6f6e 7465 6e74  .        content
+000178f0: 203d 2061 7761 6974 2063 6f6e 7465 6e74   = await content
+00017900: 2e72 6561 6461 6c6c 2829 0a0a 2020 2020  .readall()..    
+00017910: 2020 2020 2320 4173 7365 7274 0a20 2020      # Assert.   
+00017920: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00017930: 4571 7561 6c28 7365 6c66 2e73 686f 7274  Equal(self.short
+00017940: 5f62 7974 655f 6461 7461 2c20 636f 6e74  _byte_data, cont
+00017950: 656e 7429 0a0a 2020 2020 4046 696c 6553  ent)..    @FileS
+00017960: 6861 7265 5072 6570 6172 6572 2829 0a20  harePreparer(). 
+00017970: 2020 2040 4173 796e 6353 746f 7261 6765     @AsyncStorage
+00017980: 5465 7374 4361 7365 2e61 7761 6974 5f70  TestCase.await_p
+00017990: 7265 7061 7265 645f 7465 7374 0a20 2020  repared_test.   
+000179a0: 2061 7379 6e63 2064 6566 2074 6573 745f   async def test_
+000179b0: 7361 735f 7369 676e 6564 5f69 6465 6e74  sas_signed_ident
+000179c0: 6966 6965 725f 6173 796e 6328 7365 6c66  ifier_async(self
+000179d0: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
+000179e0: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
+000179f0: 6163 636f 756e 745f 6b65 7929 3a0a 2020  account_key):.  
+00017a00: 2020 2020 2020 2320 5341 5320 5552 4c20        # SAS URL 
+00017a10: 6973 2063 616c 6375 6c61 7465 6420 6672  is calculated fr
+00017a20: 6f6d 2073 746f 7261 6765 206b 6579 2c20  om storage key, 
+00017a30: 736f 2074 6869 7320 7465 7374 2072 756e  so this test run
+00017a40: 7320 6c69 7665 206f 6e6c 790a 2020 2020  s live only.    
+00017a50: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
+00017a60: 6973 5f6c 6976 653a 0a20 2020 2020 2020  is_live:.       
+00017a70: 2020 2020 2072 6574 7572 6e0a 0a20 2020       return..   
+00017a80: 2020 2020 2073 656c 662e 5f73 6574 7570       self._setup
+00017a90: 2873 746f 7261 6765 5f61 6363 6f75 6e74  (storage_account
+00017aa0: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
+00017ab0: 6363 6f75 6e74 5f6b 6579 290a 2020 2020  ccount_key).    
+00017ac0: 2020 2020 6669 6c65 5f63 6c69 656e 7420      file_client 
+00017ad0: 3d20 6177 6169 7420 7365 6c66 2e5f 6372  = await self._cr
+00017ae0: 6561 7465 5f66 696c 6528 7374 6f72 6167  eate_file(storag
+00017af0: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
+00017b00: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
+00017b10: 6b65 7929 0a20 2020 2020 2020 2073 6861  key).        sha
+00017b20: 7265 5f63 6c69 656e 7420 3d20 7365 6c66  re_client = self
+00017b30: 2e66 7363 2e67 6574 5f73 6861 7265 5f63  .fsc.get_share_c
+00017b40: 6c69 656e 7428 7365 6c66 2e73 6861 7265  lient(self.share
+00017b50: 5f6e 616d 6529 0a0a 2020 2020 2020 2020  _name)..        
+00017b60: 6163 6365 7373 5f70 6f6c 6963 7920 3d20  access_policy = 
+00017b70: 4163 6365 7373 506f 6c69 6379 2829 0a20  AccessPolicy(). 
+00017b80: 2020 2020 2020 2061 6363 6573 735f 706f         access_po
+00017b90: 6c69 6379 2e73 7461 7274 203d 2064 6174  licy.start = dat
+00017ba0: 6574 696d 652e 7574 636e 6f77 2829 202d  etime.utcnow() -
+00017bb0: 2074 696d 6564 656c 7461 2868 6f75 7273   timedelta(hours
+00017bc0: 3d31 290a 2020 2020 2020 2020 6163 6365  =1).        acce
+00017bd0: 7373 5f70 6f6c 6963 792e 6578 7069 7279  ss_policy.expiry
+00017be0: 203d 2064 6174 6574 696d 652e 7574 636e   = datetime.utcn
+00017bf0: 6f77 2829 202b 2074 696d 6564 656c 7461  ow() + timedelta
+00017c00: 2868 6f75 7273 3d31 290a 2020 2020 2020  (hours=1).      
+00017c10: 2020 6163 6365 7373 5f70 6f6c 6963 792e    access_policy.
+00017c20: 7065 726d 6973 7369 6f6e 203d 2046 696c  permission = Fil
+00017c30: 6553 6173 5065 726d 6973 7369 6f6e 7328  eSasPermissions(
+00017c40: 7265 6164 3d54 7275 6529 0a20 2020 2020  read=True).     
+00017c50: 2020 2069 6465 6e74 6966 6965 7273 203d     identifiers =
+00017c60: 207b 2774 6573 7469 6427 3a20 6163 6365   {'testid': acce
+00017c70: 7373 5f70 6f6c 6963 797d 0a20 2020 2020  ss_policy}.     
+00017c80: 2020 2061 7761 6974 2073 6861 7265 5f63     await share_c
+00017c90: 6c69 656e 742e 7365 745f 7368 6172 655f  lient.set_share_
+00017ca0: 6163 6365 7373 5f70 6f6c 6963 7928 6964  access_policy(id
+00017cb0: 656e 7469 6669 6572 7329 0a0a 2020 2020  entifiers)..    
+00017cc0: 2020 2020 746f 6b65 6e20 3d20 6765 6e65      token = gene
+00017cd0: 7261 7465 5f66 696c 655f 7361 7328 0a20  rate_file_sas(. 
+00017ce0: 2020 2020 2020 2020 2020 2066 696c 655f             file_
+00017cf0: 636c 6965 6e74 2e61 6363 6f75 6e74 5f6e  client.account_n
+00017d00: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
+00017d10: 2066 696c 655f 636c 6965 6e74 2e73 6861   file_client.sha
+00017d20: 7265 5f6e 616d 652c 0a20 2020 2020 2020  re_name,.       
+00017d30: 2020 2020 2066 696c 655f 636c 6965 6e74       file_client
+00017d40: 2e66 696c 655f 7061 7468 2c0a 2020 2020  .file_path,.    
+00017d50: 2020 2020 2020 2020 6669 6c65 5f63 6c69          file_cli
+00017d60: 656e 742e 6372 6564 656e 7469 616c 2e61  ent.credential.a
+00017d70: 6363 6f75 6e74 5f6b 6579 2c0a 2020 2020  ccount_key,.    
+00017d80: 2020 2020 2020 2020 706f 6c69 6379 5f69          policy_i
+00017d90: 643d 2774 6573 7469 6427 290a 0a20 2020  d='testid')..   
+00017da0: 2020 2020 2023 2041 6374 0a20 2020 2020       # Act.     
+00017db0: 2020 2073 6173 5f66 696c 6520 3d20 5368     sas_file = Sh
+00017dc0: 6172 6546 696c 6543 6c69 656e 742e 6672  areFileClient.fr
+00017dd0: 6f6d 5f66 696c 655f 7572 6c28 0a20 2020  om_file_url(.   
+00017de0: 2020 2020 2020 2020 2066 696c 655f 636c           file_cl
+00017df0: 6965 6e74 2e75 726c 2c0a 2020 2020 2020  ient.url,.      
+00017e00: 2020 2020 2020 6372 6564 656e 7469 616c        credential
+00017e10: 3d74 6f6b 656e 290a 0a20 2020 2020 2020  =token)..       
+00017e20: 2063 6f6e 7465 6e74 203d 2061 7761 6974   content = await
+00017e30: 2066 696c 655f 636c 6965 6e74 2e64 6f77   file_client.dow
+00017e40: 6e6c 6f61 645f 6669 6c65 2829 0a20 2020  nload_file().   
+00017e50: 2020 2020 2063 6f6e 7465 6e74 203d 2061       content = a
+00017e60: 7761 6974 2063 6f6e 7465 6e74 2e72 6561  wait content.rea
+00017e70: 6461 6c6c 2829 0a0a 2020 2020 2020 2020  dall()..        
+00017e80: 2320 4173 7365 7274 0a20 2020 2020 2020  # Assert.       
+00017e90: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00017ea0: 6c28 7365 6c66 2e73 686f 7274 5f62 7974  l(self.short_byt
+00017eb0: 655f 6461 7461 2c20 636f 6e74 656e 7429  e_data, content)
+00017ec0: 0a0a 2020 2020 4046 696c 6553 6861 7265  ..    @FileShare
+00017ed0: 5072 6570 6172 6572 2829 0a20 2020 2040  Preparer().    @
+00017ee0: 4173 796e 6353 746f 7261 6765 5465 7374  AsyncStorageTest
+00017ef0: 4361 7365 2e61 7761 6974 5f70 7265 7061  Case.await_prepa
+00017f00: 7265 645f 7465 7374 0a20 2020 2061 7379  red_test.    asy
+00017f10: 6e63 2064 6566 2074 6573 745f 6163 636f  nc def test_acco
+00017f20: 756e 745f 7361 735f 6173 796e 6328 7365  unt_sas_async(se
+00017f30: 6c66 2c20 7374 6f72 6167 655f 6163 636f  lf, storage_acco
+00017f40: 756e 745f 6e61 6d65 2c20 7374 6f72 6167  unt_name, storag
+00017f50: 655f 6163 636f 756e 745f 6b65 7929 3a0a  e_account_key):.
+00017f60: 2020 2020 2020 2020 2320 5341 5320 5552          # SAS UR
+00017f70: 4c20 6973 2063 616c 6375 6c61 7465 6420  L is calculated 
+00017f80: 6672 6f6d 2073 746f 7261 6765 206b 6579  from storage key
+00017f90: 2c20 736f 2074 6869 7320 7465 7374 2072  , so this test r
+00017fa0: 756e 7320 6c69 7665 206f 6e6c 790a 2020  uns live only.  
+00017fb0: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
+00017fc0: 662e 6973 5f6c 6976 653a 0a20 2020 2020  f.is_live:.     
+00017fd0: 2020 2020 2020 2072 6574 7572 6e0a 0a20         return.. 
+00017fe0: 2020 2020 2020 2073 656c 662e 5f73 6574         self._set
+00017ff0: 7570 2873 746f 7261 6765 5f61 6363 6f75  up(storage_accou
+00018000: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
+00018010: 5f61 6363 6f75 6e74 5f6b 6579 290a 2020  _account_key).  
+00018020: 2020 2020 2020 6669 6c65 5f63 6c69 656e        file_clien
+00018030: 7420 3d20 6177 6169 7420 7365 6c66 2e5f  t = await self._
+00018040: 6372 6561 7465 5f66 696c 6528 7374 6f72  create_file(stor
+00018050: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
+00018060: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
+00018070: 745f 6b65 7929 0a20 2020 2020 2020 2074  t_key).        t
+00018080: 6f6b 656e 203d 2067 656e 6572 6174 655f  oken = generate_
+00018090: 6163 636f 756e 745f 7361 7328 0a20 2020  account_sas(.   
+000180a0: 2020 2020 2020 2020 2073 656c 662e 6673           self.fs
+000180b0: 632e 6163 636f 756e 745f 6e61 6d65 2c0a  c.account_name,.
+000180c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000180d0: 2e66 7363 2e63 7265 6465 6e74 6961 6c2e  .fsc.credential.
+000180e0: 6163 636f 756e 745f 6b65 792c 0a20 2020  account_key,.   
+000180f0: 2020 2020 2020 2020 2052 6573 6f75 7263           Resourc
+00018100: 6554 7970 6573 286f 626a 6563 743d 5472  eTypes(object=Tr
+00018110: 7565 292c 0a20 2020 2020 2020 2020 2020  ue),.           
+00018120: 2041 6363 6f75 6e74 5361 7350 6572 6d69   AccountSasPermi
+00018130: 7373 696f 6e73 2872 6561 643d 5472 7565  ssions(read=True
+00018140: 292c 0a20 2020 2020 2020 2020 2020 2064  ),.            d
+00018150: 6174 6574 696d 652e 7574 636e 6f77 2829  atetime.utcnow()
+00018160: 202b 2074 696d 6564 656c 7461 2868 6f75   + timedelta(hou
+00018170: 7273 3d31 292c 0a20 2020 2020 2020 2029  rs=1),.        )
+00018180: 0a0a 2020 2020 2020 2020 2320 4163 740a  ..        # Act.
+00018190: 2020 2020 2020 2020 6669 6c65 5f63 6c69          file_cli
+000181a0: 656e 7420 3d20 5368 6172 6546 696c 6543  ent = ShareFileC
+000181b0: 6c69 656e 7428 0a20 2020 2020 2020 2020  lient(.         
+000181c0: 2020 2073 656c 662e 6163 636f 756e 745f     self.account_
+000181d0: 7572 6c28 7374 6f72 6167 655f 6163 636f  url(storage_acco
+000181e0: 756e 745f 6e61 6d65 2c20 2266 696c 6522  unt_name, "file"
+000181f0: 292c 0a20 2020 2020 2020 2020 2020 2073  ),.            s
+00018200: 6861 7265 5f6e 616d 653d 7365 6c66 2e73  hare_name=self.s
+00018210: 6861 7265 5f6e 616d 652c 0a20 2020 2020  hare_name,.     
+00018220: 2020 2020 2020 2066 696c 655f 7061 7468         file_path
+00018230: 3d66 696c 655f 636c 6965 6e74 2e66 696c  =file_client.fil
+00018240: 655f 6e61 6d65 2c0a 2020 2020 2020 2020  e_name,.        
+00018250: 2020 2020 6372 6564 656e 7469 616c 3d74      credential=t
+00018260: 6f6b 656e 290a 0a20 2020 2020 2020 2072  oken)..        r
+00018270: 6573 706f 6e73 6520 3d20 7265 7175 6573  esponse = reques
+00018280: 7473 2e67 6574 2866 696c 655f 636c 6965  ts.get(file_clie
+00018290: 6e74 2e75 726c 290a 0a20 2020 2020 2020  nt.url)..       
+000182a0: 2023 2041 7373 6572 740a 2020 2020 2020   # Assert.      
+000182b0: 2020 7365 6c66 2e61 7373 6572 7454 7275    self.assertTru
+000182c0: 6528 7265 7370 6f6e 7365 2e6f 6b29 0a20  e(response.ok). 
+000182d0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+000182e0: 7274 4571 7561 6c28 7365 6c66 2e73 686f  rtEqual(self.sho
+000182f0: 7274 5f62 7974 655f 6461 7461 2c20 7265  rt_byte_data, re
+00018300: 7370 6f6e 7365 2e63 6f6e 7465 6e74 290a  sponse.content).
+00018310: 0a20 2020 2040 4669 6c65 5368 6172 6550  .    @FileShareP
+00018320: 7265 7061 7265 7228 290a 2020 2020 4041  reparer().    @A
+00018330: 7379 6e63 5374 6f72 6167 6554 6573 7443  syncStorageTestC
+00018340: 6173 652e 6177 6169 745f 7072 6570 6172  ase.await_prepar
+00018350: 6564 5f74 6573 740a 2020 2020 6173 796e  ed_test.    asyn
+00018360: 6320 6465 6620 7465 7374 5f61 6363 6f75  c def test_accou
+00018370: 6e74 5f73 6173 5f63 7265 6465 6e74 6961  nt_sas_credentia
+00018380: 6c5f 6173 796e 6328 7365 6c66 2c20 7374  l_async(self, st
+00018390: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
+000183a0: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
+000183b0: 756e 745f 6b65 7929 3a0a 2020 2020 2020  unt_key):.      
+000183c0: 2020 2320 5341 5320 5552 4c20 6973 2063    # SAS URL is c
+000183d0: 616c 6375 6c61 7465 6420 6672 6f6d 2073  alculated from s
+000183e0: 746f 7261 6765 206b 6579 2c20 736f 2074  torage key, so t
+000183f0: 6869 7320 7465 7374 2072 756e 7320 6c69  his test runs li
+00018400: 7665 206f 6e6c 790a 2020 2020 2020 2020  ve only.        
+00018410: 6966 206e 6f74 2073 656c 662e 6973 5f6c  if not self.is_l
+00018420: 6976 653a 0a20 2020 2020 2020 2020 2020  ive:.           
+00018430: 2072 6574 7572 6e0a 0a20 2020 2020 2020   return..       
+00018440: 2073 656c 662e 5f73 6574 7570 2873 746f   self._setup(sto
+00018450: 7261 6765 5f61 6363 6f75 6e74 5f6e 616d  rage_account_nam
+00018460: 652c 2073 746f 7261 6765 5f61 6363 6f75  e, storage_accou
+00018470: 6e74 5f6b 6579 290a 2020 2020 2020 2020  nt_key).        
+00018480: 6669 6c65 5f63 6c69 656e 7420 3d20 6177  file_client = aw
+00018490: 6169 7420 7365 6c66 2e5f 6372 6561 7465  ait self._create
+000184a0: 5f66 696c 6528 7374 6f72 6167 655f 6163  _file(storage_ac
+000184b0: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
+000184c0: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
+000184d0: 0a20 2020 2020 2020 2074 6f6b 656e 203d  .        token =
+000184e0: 2067 656e 6572 6174 655f 6163 636f 756e   generate_accoun
+000184f0: 745f 7361 7328 0a20 2020 2020 2020 2020  t_sas(.         
+00018500: 2020 2073 656c 662e 6673 632e 6163 636f     self.fsc.acco
+00018510: 756e 745f 6e61 6d65 2c0a 2020 2020 2020  unt_name,.      
+00018520: 2020 2020 2020 7365 6c66 2e66 7363 2e63        self.fsc.c
+00018530: 7265 6465 6e74 6961 6c2e 6163 636f 756e  redential.accoun
+00018540: 745f 6b65 792c 0a20 2020 2020 2020 2020  t_key,.         
+00018550: 2020 2052 6573 6f75 7263 6554 7970 6573     ResourceTypes
+00018560: 286f 626a 6563 743d 5472 7565 292c 0a20  (object=True),. 
+00018570: 2020 2020 2020 2020 2020 2041 6363 6f75             Accou
+00018580: 6e74 5361 7350 6572 6d69 7373 696f 6e73  ntSasPermissions
+00018590: 2872 6561 643d 5472 7565 292c 0a20 2020  (read=True),.   
+000185a0: 2020 2020 2020 2020 2064 6174 6574 696d           datetim
+000185b0: 652e 7574 636e 6f77 2829 202b 2074 696d  e.utcnow() + tim
+000185c0: 6564 656c 7461 2868 6f75 7273 3d31 292c  edelta(hours=1),
+000185d0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+000185e0: 2020 2020 2320 4163 740a 2020 2020 2020      # Act.      
+000185f0: 2020 6669 6c65 5f63 6c69 656e 7420 3d20    file_client = 
+00018600: 5368 6172 6546 696c 6543 6c69 656e 7428  ShareFileClient(
+00018610: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00018620: 662e 6163 636f 756e 745f 7572 6c28 7374  f.account_url(st
+00018630: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
+00018640: 6d65 2c20 2266 696c 6522 292c 0a20 2020  me, "file"),.   
+00018650: 2020 2020 2020 2020 2073 6861 7265 5f6e           share_n
+00018660: 616d 653d 7365 6c66 2e73 6861 7265 5f6e  ame=self.share_n
+00018670: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
+00018680: 2066 696c 655f 7061 7468 3d66 696c 655f   file_path=file_
+00018690: 636c 6965 6e74 2e66 696c 655f 6e61 6d65  client.file_name
+000186a0: 2c0a 2020 2020 2020 2020 2020 2020 6372  ,.            cr
+000186b0: 6564 656e 7469 616c 3d41 7a75 7265 5361  edential=AzureSa
+000186c0: 7343 7265 6465 6e74 6961 6c28 746f 6b65  sCredential(toke
+000186d0: 6e29 290a 0a20 2020 2020 2020 2070 726f  n))..        pro
+000186e0: 7065 7274 6965 7320 3d20 6177 6169 7420  perties = await 
+000186f0: 6669 6c65 5f63 6c69 656e 742e 6765 745f  file_client.get_
+00018700: 6669 6c65 5f70 726f 7065 7274 6965 7328  file_properties(
+00018710: 290a 0a20 2020 2020 2020 2023 2041 7373  )..        # Ass
+00018720: 6572 740a 2020 2020 2020 2020 7365 6c66  ert.        self
+00018730: 2e61 7373 6572 7449 734e 6f74 4e6f 6e65  .assertIsNotNone
+00018740: 2870 726f 7065 7274 6965 7329 0a0a 2020  (properties)..  
+00018750: 2020 4046 696c 6553 6861 7265 5072 6570    @FileSharePrep
+00018760: 6172 6572 2829 0a20 2020 2064 6566 2074  arer().    def t
+00018770: 6573 745f 6163 636f 756e 745f 7361 735f  est_account_sas_
+00018780: 7261 6973 6573 5f69 665f 7361 735f 616c  raises_if_sas_al
+00018790: 7265 6164 795f 696e 5f75 7269 2873 656c  ready_in_uri(sel
+000187a0: 662c 2073 746f 7261 6765 5f61 6363 6f75  f, storage_accou
+000187b0: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
+000187c0: 5f61 6363 6f75 6e74 5f6b 6579 293a 0a20  _account_key):. 
+000187d0: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
+000187e0: 2e61 7373 6572 7452 6169 7365 7328 5661  .assertRaises(Va
+000187f0: 6c75 6545 7272 6f72 293a 0a20 2020 2020  lueError):.     
+00018800: 2020 2020 2020 2053 6861 7265 4669 6c65         ShareFile
+00018810: 436c 6965 6e74 280a 2020 2020 2020 2020  Client(.        
+00018820: 2020 2020 2020 2020 7365 6c66 2e61 6363          self.acc
+00018830: 6f75 6e74 5f75 726c 2873 746f 7261 6765  ount_url(storage
+00018840: 5f61 6363 6f75 6e74 5f6e 616d 652c 2022  _account_name, "
+00018850: 6669 6c65 2229 202b 2022 3f73 6967 3d66  file") + "?sig=f
+00018860: 6f6f 222c 0a20 2020 2020 2020 2020 2020  oo",.           
+00018870: 2020 2020 2073 6861 7265 5f6e 616d 653d       share_name=
+00018880: 2266 6f6f 222c 0a20 2020 2020 2020 2020  "foo",.         
+00018890: 2020 2020 2020 2066 696c 655f 7061 7468         file_path
+000188a0: 3d22 666f 6f22 2c0a 2020 2020 2020 2020  ="foo",.        
+000188b0: 2020 2020 2020 2020 6372 6564 656e 7469          credenti
+000188c0: 616c 3d41 7a75 7265 5361 7343 7265 6465  al=AzureSasCrede
+000188d0: 6e74 6961 6c28 223f 666f 6f3d 6261 7222  ntial("?foo=bar"
+000188e0: 2929 0a0a 2020 2020 4046 696c 6553 6861  ))..    @FileSha
+000188f0: 7265 5072 6570 6172 6572 2829 0a20 2020  rePreparer().   
+00018900: 2040 4173 796e 6353 746f 7261 6765 5465   @AsyncStorageTe
+00018910: 7374 4361 7365 2e61 7761 6974 5f70 7265  stCase.await_pre
+00018920: 7061 7265 645f 7465 7374 0a20 2020 2061  pared_test.    a
+00018930: 7379 6e63 2064 6566 2074 6573 745f 7368  sync def test_sh
+00018940: 6172 6564 5f72 6561 645f 6163 6365 7373  ared_read_access
+00018950: 5f66 696c 655f 6173 796e 6328 7365 6c66  _file_async(self
+00018960: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
+00018970: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
+00018980: 6163 636f 756e 745f 6b65 7929 3a0a 2020  account_key):.  
+00018990: 2020 2020 2020 2320 5341 5320 5552 4c20        # SAS URL 
+000189a0: 6973 2063 616c 6375 6c61 7465 6420 6672  is calculated fr
+000189b0: 6f6d 2073 746f 7261 6765 206b 6579 2c20  om storage key, 
+000189c0: 736f 2074 6869 7320 7465 7374 2072 756e  so this test run
+000189d0: 7320 6c69 7665 206f 6e6c 790a 2020 2020  s live only.    
+000189e0: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
+000189f0: 6973 5f6c 6976 653a 0a20 2020 2020 2020  is_live:.       
+00018a00: 2020 2020 2072 6574 7572 6e0a 0a20 2020       return..   
+00018a10: 2020 2020 2073 656c 662e 5f73 6574 7570       self._setup
+00018a20: 2873 746f 7261 6765 5f61 6363 6f75 6e74  (storage_account
+00018a30: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
+00018a40: 6363 6f75 6e74 5f6b 6579 290a 2020 2020  ccount_key).    
+00018a50: 2020 2020 6669 6c65 5f63 6c69 656e 7420      file_client 
+00018a60: 3d20 6177 6169 7420 7365 6c66 2e5f 6372  = await self._cr
+00018a70: 6561 7465 5f66 696c 6528 7374 6f72 6167  eate_file(storag
+00018a80: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
+00018a90: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
+00018aa0: 6b65 7929 0a20 2020 2020 2020 2074 6f6b  key).        tok
+00018ab0: 656e 203d 2067 656e 6572 6174 655f 6669  en = generate_fi
+00018ac0: 6c65 5f73 6173 280a 2020 2020 2020 2020  le_sas(.        
+00018ad0: 2020 2020 6669 6c65 5f63 6c69 656e 742e      file_client.
+00018ae0: 6163 636f 756e 745f 6e61 6d65 2c0a 2020  account_name,.  
+00018af0: 2020 2020 2020 2020 2020 6669 6c65 5f63            file_c
+00018b00: 6c69 656e 742e 7368 6172 655f 6e61 6d65  lient.share_name
+00018b10: 2c0a 2020 2020 2020 2020 2020 2020 6669  ,.            fi
+00018b20: 6c65 5f63 6c69 656e 742e 6669 6c65 5f70  le_client.file_p
+00018b30: 6174 682c 0a20 2020 2020 2020 2020 2020  ath,.           
+00018b40: 2066 696c 655f 636c 6965 6e74 2e63 7265   file_client.cre
+00018b50: 6465 6e74 6961 6c2e 6163 636f 756e 745f  dential.account_
+00018b60: 6b65 792c 0a20 2020 2020 2020 2020 2020  key,.           
+00018b70: 2070 6572 6d69 7373 696f 6e3d 4669 6c65   permission=File
+00018b80: 5361 7350 6572 6d69 7373 696f 6e73 2872  SasPermissions(r
+00018b90: 6561 643d 5472 7565 292c 0a20 2020 2020  ead=True),.     
+00018ba0: 2020 2020 2020 2065 7870 6972 793d 6461         expiry=da
+00018bb0: 7465 7469 6d65 2e75 7463 6e6f 7728 2920  tetime.utcnow() 
+00018bc0: 2b20 7469 6d65 6465 6c74 6128 686f 7572  + timedelta(hour
+00018bd0: 733d 3129 2c0a 2020 2020 2020 2020 290a  s=1),.        ).
+00018be0: 0a20 2020 2020 2020 2023 2041 6374 0a20  .        # Act. 
+00018bf0: 2020 2020 2020 2066 696c 655f 636c 6965         file_clie
+00018c00: 6e74 203d 2053 6861 7265 4669 6c65 436c  nt = ShareFileCl
+00018c10: 6965 6e74 280a 2020 2020 2020 2020 2020  ient(.          
+00018c20: 2020 7365 6c66 2e61 6363 6f75 6e74 5f75    self.account_u
+00018c30: 726c 2873 746f 7261 6765 5f61 6363 6f75  rl(storage_accou
+00018c40: 6e74 5f6e 616d 652c 2022 6669 6c65 2229  nt_name, "file")
+00018c50: 2c0a 2020 2020 2020 2020 2020 2020 7368  ,.            sh
+00018c60: 6172 655f 6e61 6d65 3d73 656c 662e 7368  are_name=self.sh
+00018c70: 6172 655f 6e61 6d65 2c0a 2020 2020 2020  are_name,.      
+00018c80: 2020 2020 2020 6669 6c65 5f70 6174 683d        file_path=
+00018c90: 6669 6c65 5f63 6c69 656e 742e 6669 6c65  file_client.file
+00018ca0: 5f6e 616d 652c 0a20 2020 2020 2020 2020  _name,.         
+00018cb0: 2020 2063 7265 6465 6e74 6961 6c3d 746f     credential=to
+00018cc0: 6b65 6e29 0a20 2020 2020 2020 2072 6573  ken).        res
+00018cd0: 706f 6e73 6520 3d20 7265 7175 6573 7473  ponse = requests
+00018ce0: 2e67 6574 2866 696c 655f 636c 6965 6e74  .get(file_client
+00018cf0: 2e75 726c 290a 0a20 2020 2020 2020 2023  .url)..        #
+00018d00: 2041 7373 6572 740a 2020 2020 2020 2020   Assert.        
+00018d10: 7365 6c66 2e61 7373 6572 7454 7275 6528  self.assertTrue(
+00018d20: 7265 7370 6f6e 7365 2e6f 6b29 0a20 2020  response.ok).   
+00018d30: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00018d40: 4571 7561 6c28 7365 6c66 2e73 686f 7274  Equal(self.short
+00018d50: 5f62 7974 655f 6461 7461 2c20 7265 7370  _byte_data, resp
+00018d60: 6f6e 7365 2e63 6f6e 7465 6e74 290a 0a20  onse.content).. 
+00018d70: 2020 2040 4669 6c65 5368 6172 6550 7265     @FileSharePre
+00018d80: 7061 7265 7228 290a 2020 2020 4041 7379  parer().    @Asy
+00018d90: 6e63 5374 6f72 6167 6554 6573 7443 6173  ncStorageTestCas
+00018da0: 652e 6177 6169 745f 7072 6570 6172 6564  e.await_prepared
+00018db0: 5f74 6573 740a 2020 2020 6173 796e 6320  _test.    async 
+00018dc0: 6465 6620 7465 7374 5f73 6861 7265 645f  def test_shared_
+00018dd0: 7265 6164 5f61 6363 6573 735f 6669 6c65  read_access_file
+00018de0: 5f77 6974 685f 636f 6e74 656e 745f 7175  _with_content_qu
+00018df0: 6572 795f 7061 7261 6d73 5f61 7379 6e63  ery_params_async
+00018e00: 2873 656c 662c 2073 746f 7261 6765 5f61  (self, storage_a
+00018e10: 6363 6f75 6e74 5f6e 616d 652c 2073 746f  ccount_name, sto
+00018e20: 7261 6765 5f61 6363 6f75 6e74 5f6b 6579  rage_account_key
+00018e30: 293a 0a20 2020 2020 2020 2023 2053 4153  ):.        # SAS
+00018e40: 2055 524c 2069 7320 6361 6c63 756c 6174   URL is calculat
+00018e50: 6564 2066 726f 6d20 7374 6f72 6167 6520  ed from storage 
+00018e60: 6b65 792c 2073 6f20 7468 6973 2074 6573  key, so this tes
+00018e70: 7420 7275 6e73 206c 6976 6520 6f6e 6c79  t runs live only
+00018e80: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00018e90: 7365 6c66 2e69 735f 6c69 7665 3a0a 2020  self.is_live:.  
+00018ea0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00018eb0: 0a0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
+00018ec0: 7365 7475 7028 7374 6f72 6167 655f 6163  setup(storage_ac
+00018ed0: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
+00018ee0: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
+00018ef0: 0a20 2020 2020 2020 2066 696c 655f 636c  .        file_cl
+00018f00: 6965 6e74 203d 2061 7761 6974 2073 656c  ient = await sel
+00018f10: 662e 5f63 7265 6174 655f 6669 6c65 2873  f._create_file(s
+00018f20: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
+00018f30: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
+00018f40: 6f75 6e74 5f6b 6579 290a 2020 2020 2020  ount_key).      
+00018f50: 2020 746f 6b65 6e20 3d20 6765 6e65 7261    token = genera
+00018f60: 7465 5f66 696c 655f 7361 7328 0a20 2020  te_file_sas(.   
+00018f70: 2020 2020 2020 2020 2066 696c 655f 636c           file_cl
+00018f80: 6965 6e74 2e61 6363 6f75 6e74 5f6e 616d  ient.account_nam
+00018f90: 652c 0a20 2020 2020 2020 2020 2020 2066  e,.            f
+00018fa0: 696c 655f 636c 6965 6e74 2e73 6861 7265  ile_client.share
+00018fb0: 5f6e 616d 652c 0a20 2020 2020 2020 2020  _name,.         
+00018fc0: 2020 2066 696c 655f 636c 6965 6e74 2e66     file_client.f
+00018fd0: 696c 655f 7061 7468 2c0a 2020 2020 2020  ile_path,.      
+00018fe0: 2020 2020 2020 6669 6c65 5f63 6c69 656e        file_clien
+00018ff0: 742e 6372 6564 656e 7469 616c 2e61 6363  t.credential.acc
+00019000: 6f75 6e74 5f6b 6579 2c0a 2020 2020 2020  ount_key,.      
+00019010: 2020 2020 2020 7065 726d 6973 7369 6f6e        permission
+00019020: 3d46 696c 6553 6173 5065 726d 6973 7369  =FileSasPermissi
+00019030: 6f6e 7328 7265 6164 3d54 7275 6529 2c0a  ons(read=True),.
+00019040: 2020 2020 2020 2020 2020 2020 6578 7069              expi
+00019050: 7279 3d64 6174 6574 696d 652e 7574 636e  ry=datetime.utcn
+00019060: 6f77 2829 202b 2074 696d 6564 656c 7461  ow() + timedelta
+00019070: 2868 6f75 7273 3d31 292c 0a20 2020 2020  (hours=1),.     
+00019080: 2020 2020 2020 2063 6163 6865 5f63 6f6e         cache_con
+00019090: 7472 6f6c 3d27 6e6f 2d63 6163 6865 272c  trol='no-cache',
+000190a0: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+000190b0: 7465 6e74 5f64 6973 706f 7369 7469 6f6e  tent_disposition
+000190c0: 3d27 696e 6c69 6e65 272c 0a20 2020 2020  ='inline',.     
+000190d0: 2020 2020 2020 2063 6f6e 7465 6e74 5f65         content_e
+000190e0: 6e63 6f64 696e 673d 2775 7466 2d38 272c  ncoding='utf-8',
+000190f0: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+00019100: 7465 6e74 5f6c 616e 6775 6167 653d 2766  tent_language='f
+00019110: 7227 2c0a 2020 2020 2020 2020 2020 2020  r',.            
+00019120: 636f 6e74 656e 745f 7479 7065 3d27 7465  content_type='te
+00019130: 7874 272c 0a20 2020 2020 2020 2029 0a0a  xt',.        )..
+00019140: 2020 2020 2020 2020 2320 4163 740a 2020          # Act.  
+00019150: 2020 2020 2020 6669 6c65 5f63 6c69 656e        file_clien
+00019160: 7420 3d20 5368 6172 6546 696c 6543 6c69  t = ShareFileCli
+00019170: 656e 7428 0a20 2020 2020 2020 2020 2020  ent(.           
+00019180: 2073 656c 662e 6163 636f 756e 745f 7572   self.account_ur
+00019190: 6c28 7374 6f72 6167 655f 6163 636f 756e  l(storage_accoun
+000191a0: 745f 6e61 6d65 2c20 2266 696c 6522 292c  t_name, "file"),
+000191b0: 0a20 2020 2020 2020 2020 2020 2073 6861  .            sha
+000191c0: 7265 5f6e 616d 653d 7365 6c66 2e73 6861  re_name=self.sha
+000191d0: 7265 5f6e 616d 652c 0a20 2020 2020 2020  re_name,.       
+000191e0: 2020 2020 2066 696c 655f 7061 7468 3d66       file_path=f
+000191f0: 696c 655f 636c 6965 6e74 2e66 696c 655f  ile_client.file_
+00019200: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
+00019210: 2020 6372 6564 656e 7469 616c 3d74 6f6b    credential=tok
+00019220: 656e 290a 2020 2020 2020 2020 7265 7370  en).        resp
+00019230: 6f6e 7365 203d 2072 6571 7565 7374 732e  onse = requests.
+00019240: 6765 7428 6669 6c65 5f63 6c69 656e 742e  get(file_client.
+00019250: 7572 6c29 0a0a 2020 2020 2020 2020 2320  url)..        # 
+00019260: 4173 7365 7274 0a20 2020 2020 2020 2073  Assert.        s
+00019270: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00019280: 7365 6c66 2e73 686f 7274 5f62 7974 655f  self.short_byte_
+00019290: 6461 7461 2c20 7265 7370 6f6e 7365 2e63  data, response.c
+000192a0: 6f6e 7465 6e74 290a 2020 2020 2020 2020  ontent).        
+000192b0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+000192c0: 2872 6573 706f 6e73 652e 6865 6164 6572  (response.header
+000192d0: 735b 2763 6163 6865 2d63 6f6e 7472 6f6c  s['cache-control
+000192e0: 275d 2c20 276e 6f2d 6361 6368 6527 290a  '], 'no-cache').
+000192f0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00019300: 6572 7445 7175 616c 2872 6573 706f 6e73  ertEqual(respons
+00019310: 652e 6865 6164 6572 735b 2763 6f6e 7465  e.headers['conte
+00019320: 6e74 2d64 6973 706f 7369 7469 6f6e 275d  nt-disposition']
+00019330: 2c20 2769 6e6c 696e 6527 290a 2020 2020  , 'inline').    
+00019340: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00019350: 7175 616c 2872 6573 706f 6e73 652e 6865  qual(response.he
+00019360: 6164 6572 735b 2763 6f6e 7465 6e74 2d65  aders['content-e
+00019370: 6e63 6f64 696e 6727 5d2c 2027 7574 662d  ncoding'], 'utf-
+00019380: 3827 290a 2020 2020 2020 2020 7365 6c66  8').        self
+00019390: 2e61 7373 6572 7445 7175 616c 2872 6573  .assertEqual(res
+000193a0: 706f 6e73 652e 6865 6164 6572 735b 2763  ponse.headers['c
+000193b0: 6f6e 7465 6e74 2d6c 616e 6775 6167 6527  ontent-language'
+000193c0: 5d2c 2027 6672 2729 0a20 2020 2020 2020  ], 'fr').       
+000193d0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+000193e0: 6c28 7265 7370 6f6e 7365 2e68 6561 6465  l(response.heade
+000193f0: 7273 5b27 636f 6e74 656e 742d 7479 7065  rs['content-type
+00019400: 275d 2c20 2774 6578 7427 290a 0a20 2020  '], 'text')..   
+00019410: 2040 4669 6c65 5368 6172 6550 7265 7061   @FileSharePrepa
+00019420: 7265 7228 290a 2020 2020 4041 7379 6e63  rer().    @Async
+00019430: 5374 6f72 6167 6554 6573 7443 6173 652e  StorageTestCase.
+00019440: 6177 6169 745f 7072 6570 6172 6564 5f74  await_prepared_t
+00019450: 6573 740a 2020 2020 6173 796e 6320 6465  est.    async de
+00019460: 6620 7465 7374 5f73 6861 7265 645f 7772  f test_shared_wr
+00019470: 6974 655f 6163 6365 7373 5f66 696c 655f  ite_access_file_
+00019480: 6173 796e 6328 7365 6c66 2c20 7374 6f72  async(self, stor
+00019490: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
+000194a0: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
+000194b0: 745f 6b65 7929 3a0a 2020 2020 2020 2020  t_key):.        
+000194c0: 2320 5341 5320 5552 4c20 6973 2063 616c  # SAS URL is cal
+000194d0: 6375 6c61 7465 6420 6672 6f6d 2073 746f  culated from sto
+000194e0: 7261 6765 206b 6579 2c20 736f 2074 6869  rage key, so thi
+000194f0: 7320 7465 7374 2072 756e 7320 6c69 7665  s test runs live
+00019500: 206f 6e6c 790a 2020 2020 2020 2020 6966   only.        if
+00019510: 206e 6f74 2073 656c 662e 6973 5f6c 6976   not self.is_liv
+00019520: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+00019530: 6574 7572 6e0a 0a20 2020 2020 2020 2073  eturn..        s
+00019540: 656c 662e 5f73 6574 7570 2873 746f 7261  elf._setup(stora
+00019550: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
+00019560: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
+00019570: 5f6b 6579 290a 2020 2020 2020 2020 7570  _key).        up
+00019580: 6461 7465 645f 6461 7461 203d 2062 2775  dated_data = b'u
+00019590: 7064 6174 6564 2066 696c 6520 6461 7461  pdated file data
+000195a0: 270a 2020 2020 2020 2020 6669 6c65 5f63  '.        file_c
+000195b0: 6c69 656e 745f 6164 6d69 6e20 3d20 6177  lient_admin = aw
+000195c0: 6169 7420 7365 6c66 2e5f 6372 6561 7465  ait self._create
+000195d0: 5f66 696c 6528 7374 6f72 6167 655f 6163  _file(storage_ac
+000195e0: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
+000195f0: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
+00019600: 0a20 2020 2020 2020 2074 6f6b 656e 203d  .        token =
+00019610: 2067 656e 6572 6174 655f 6669 6c65 5f73   generate_file_s
+00019620: 6173 280a 2020 2020 2020 2020 2020 2020  as(.            
+00019630: 6669 6c65 5f63 6c69 656e 745f 6164 6d69  file_client_admi
+00019640: 6e2e 6163 636f 756e 745f 6e61 6d65 2c0a  n.account_name,.
+00019650: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+00019660: 5f63 6c69 656e 745f 6164 6d69 6e2e 7368  _client_admin.sh
+00019670: 6172 655f 6e61 6d65 2c0a 2020 2020 2020  are_name,.      
+00019680: 2020 2020 2020 6669 6c65 5f63 6c69 656e        file_clien
+00019690: 745f 6164 6d69 6e2e 6669 6c65 5f70 6174  t_admin.file_pat
+000196a0: 682c 0a20 2020 2020 2020 2020 2020 2066  h,.            f
+000196b0: 696c 655f 636c 6965 6e74 5f61 646d 696e  ile_client_admin
+000196c0: 2e63 7265 6465 6e74 6961 6c2e 6163 636f  .credential.acco
+000196d0: 756e 745f 6b65 792c 0a20 2020 2020 2020  unt_key,.       
+000196e0: 2020 2020 2070 6572 6d69 7373 696f 6e3d       permission=
+000196f0: 4669 6c65 5361 7350 6572 6d69 7373 696f  FileSasPermissio
+00019700: 6e73 2877 7269 7465 3d54 7275 6529 2c0a  ns(write=True),.
+00019710: 2020 2020 2020 2020 2020 2020 6578 7069              expi
+00019720: 7279 3d64 6174 6574 696d 652e 7574 636e  ry=datetime.utcn
+00019730: 6f77 2829 202b 2074 696d 6564 656c 7461  ow() + timedelta
+00019740: 2868 6f75 7273 3d31 292c 0a20 2020 2020  (hours=1),.     
+00019750: 2020 2029 0a20 2020 2020 2020 2066 696c     ).        fil
+00019760: 655f 636c 6965 6e74 203d 2053 6861 7265  e_client = Share
+00019770: 4669 6c65 436c 6965 6e74 280a 2020 2020  FileClient(.    
+00019780: 2020 2020 2020 2020 7365 6c66 2e61 6363          self.acc
+00019790: 6f75 6e74 5f75 726c 2873 746f 7261 6765  ount_url(storage
+000197a0: 5f61 6363 6f75 6e74 5f6e 616d 652c 2022  _account_name, "
+000197b0: 6669 6c65 2229 2c0a 2020 2020 2020 2020  file"),.        
+000197c0: 2020 2020 7368 6172 655f 6e61 6d65 3d73      share_name=s
+000197d0: 656c 662e 7368 6172 655f 6e61 6d65 2c0a  elf.share_name,.
+000197e0: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+000197f0: 5f70 6174 683d 6669 6c65 5f63 6c69 656e  _path=file_clien
+00019800: 745f 6164 6d69 6e2e 6669 6c65 5f6e 616d  t_admin.file_nam
+00019810: 652c 0a20 2020 2020 2020 2020 2020 2063  e,.            c
+00019820: 7265 6465 6e74 6961 6c3d 746f 6b65 6e29  redential=token)
+00019830: 0a0a 2020 2020 2020 2020 2320 4163 740a  ..        # Act.
+00019840: 2020 2020 2020 2020 6865 6164 6572 7320          headers 
+00019850: 3d20 7b27 782d 6d73 2d72 616e 6765 273a  = {'x-ms-range':
+00019860: 2027 6279 7465 733d 302d 3136 272c 2027   'bytes=0-16', '
+00019870: 782d 6d73 2d77 7269 7465 273a 2027 7570  x-ms-write': 'up
+00019880: 6461 7465 277d 0a20 2020 2020 2020 2072  date'}.        r
+00019890: 6573 706f 6e73 6520 3d20 7265 7175 6573  esponse = reques
+000198a0: 7473 2e70 7574 2866 696c 655f 636c 6965  ts.put(file_clie
+000198b0: 6e74 2e75 726c 202b 2027 2663 6f6d 703d  nt.url + '&comp=
+000198c0: 7261 6e67 6527 2c20 6865 6164 6572 733d  range', headers=
+000198d0: 6865 6164 6572 732c 2064 6174 613d 7570  headers, data=up
+000198e0: 6461 7465 645f 6461 7461 290a 0a20 2020  dated_data)..   
+000198f0: 2020 2020 2023 2041 7373 6572 740a 2020       # Assert.  
+00019900: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00019910: 7454 7275 6528 7265 7370 6f6e 7365 2e6f  tTrue(response.o
+00019920: 6b29 0a20 2020 2020 2020 2066 696c 655f  k).        file_
+00019930: 636f 6e74 656e 7420 3d20 6177 6169 7420  content = await 
+00019940: 6669 6c65 5f63 6c69 656e 745f 6164 6d69  file_client_admi
+00019950: 6e2e 646f 776e 6c6f 6164 5f66 696c 6528  n.download_file(
+00019960: 290a 2020 2020 2020 2020 6669 6c65 5f63  ).        file_c
+00019970: 6f6e 7465 6e74 203d 2061 7761 6974 2066  ontent = await f
+00019980: 696c 655f 636f 6e74 656e 742e 7265 6164  ile_content.read
+00019990: 616c 6c28 290a 2020 2020 2020 2020 7365  all().        se
+000199a0: 6c66 2e61 7373 6572 7445 7175 616c 2875  lf.assertEqual(u
+000199b0: 7064 6174 6564 5f64 6174 612c 2066 696c  pdated_data, fil
+000199c0: 655f 636f 6e74 656e 745b 3a6c 656e 2875  e_content[:len(u
+000199d0: 7064 6174 6564 5f64 6174 6129 5d29 0a0a  pdated_data)])..
+000199e0: 2020 2020 4046 696c 6553 6861 7265 5072      @FileSharePr
+000199f0: 6570 6172 6572 2829 0a20 2020 2040 4173  eparer().    @As
+00019a00: 796e 6353 746f 7261 6765 5465 7374 4361  yncStorageTestCa
+00019a10: 7365 2e61 7761 6974 5f70 7265 7061 7265  se.await_prepare
+00019a20: 645f 7465 7374 0a20 2020 2061 7379 6e63  d_test.    async
+00019a30: 2064 6566 2074 6573 745f 7368 6172 6564   def test_shared
+00019a40: 5f64 656c 6574 655f 6163 6365 7373 5f66  _delete_access_f
+00019a50: 696c 655f 6173 796e 6328 7365 6c66 2c20  ile_async(self, 
+00019a60: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
+00019a70: 6e61 6d65 2c20 7374 6f72 6167 655f 6163  name, storage_ac
+00019a80: 636f 756e 745f 6b65 7929 3a0a 2020 2020  count_key):.    
+00019a90: 2020 2020 2320 5341 5320 5552 4c20 6973      # SAS URL is
+00019aa0: 2063 616c 6375 6c61 7465 6420 6672 6f6d   calculated from
+00019ab0: 2073 746f 7261 6765 206b 6579 2c20 736f   storage key, so
+00019ac0: 2074 6869 7320 7465 7374 2072 756e 7320   this test runs 
+00019ad0: 6c69 7665 206f 6e6c 790a 2020 2020 2020  live only.      
+00019ae0: 2020 6966 206e 6f74 2073 656c 662e 6973    if not self.is
+00019af0: 5f6c 6976 653a 0a20 2020 2020 2020 2020  _live:.         
+00019b00: 2020 2072 6574 7572 6e0a 0a20 2020 2020     return..     
+00019b10: 2020 2073 656c 662e 5f73 6574 7570 2873     self._setup(s
+00019b20: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
+00019b30: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
+00019b40: 6f75 6e74 5f6b 6579 290a 2020 2020 2020  ount_key).      
+00019b50: 2020 6669 6c65 5f63 6c69 656e 745f 6164    file_client_ad
+00019b60: 6d69 6e20 3d20 6177 6169 7420 7365 6c66  min = await self
+00019b70: 2e5f 6372 6561 7465 5f66 696c 6528 7374  ._create_file(st
+00019b80: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
+00019b90: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
+00019ba0: 756e 745f 6b65 7929 0a20 2020 2020 2020  unt_key).       
+00019bb0: 2074 6f6b 656e 203d 2067 656e 6572 6174   token = generat
+00019bc0: 655f 6669 6c65 5f73 6173 280a 2020 2020  e_file_sas(.    
+00019bd0: 2020 2020 2020 2020 6669 6c65 5f63 6c69          file_cli
+00019be0: 656e 745f 6164 6d69 6e2e 6163 636f 756e  ent_admin.accoun
+00019bf0: 745f 6e61 6d65 2c0a 2020 2020 2020 2020  t_name,.        
+00019c00: 2020 2020 6669 6c65 5f63 6c69 656e 745f      file_client_
+00019c10: 6164 6d69 6e2e 7368 6172 655f 6e61 6d65  admin.share_name
+00019c20: 2c0a 2020 2020 2020 2020 2020 2020 6669  ,.            fi
+00019c30: 6c65 5f63 6c69 656e 745f 6164 6d69 6e2e  le_client_admin.
+00019c40: 6669 6c65 5f70 6174 682c 0a20 2020 2020  file_path,.     
+00019c50: 2020 2020 2020 2066 696c 655f 636c 6965         file_clie
+00019c60: 6e74 5f61 646d 696e 2e63 7265 6465 6e74  nt_admin.credent
+00019c70: 6961 6c2e 6163 636f 756e 745f 6b65 792c  ial.account_key,
+00019c80: 0a20 2020 2020 2020 2020 2020 2070 6572  .            per
+00019c90: 6d69 7373 696f 6e3d 4669 6c65 5361 7350  mission=FileSasP
+00019ca0: 6572 6d69 7373 696f 6e73 2864 656c 6574  ermissions(delet
+00019cb0: 653d 5472 7565 292c 0a20 2020 2020 2020  e=True),.       
+00019cc0: 2020 2020 2065 7870 6972 793d 6461 7465       expiry=date
+00019cd0: 7469 6d65 2e75 7463 6e6f 7728 2920 2b20  time.utcnow() + 
+00019ce0: 7469 6d65 6465 6c74 6128 686f 7572 733d  timedelta(hours=
+00019cf0: 3129 2c0a 2020 2020 2020 2020 290a 2020  1),.        ).  
+00019d00: 2020 2020 2020 6669 6c65 5f63 6c69 656e        file_clien
+00019d10: 7420 3d20 5368 6172 6546 696c 6543 6c69  t = ShareFileCli
+00019d20: 656e 7428 0a20 2020 2020 2020 2020 2020  ent(.           
+00019d30: 2073 656c 662e 6163 636f 756e 745f 7572   self.account_ur
+00019d40: 6c28 7374 6f72 6167 655f 6163 636f 756e  l(storage_accoun
+00019d50: 745f 6e61 6d65 2c20 2266 696c 6522 292c  t_name, "file"),
+00019d60: 0a20 2020 2020 2020 2020 2020 2073 6861  .            sha
+00019d70: 7265 5f6e 616d 653d 7365 6c66 2e73 6861  re_name=self.sha
+00019d80: 7265 5f6e 616d 652c 0a20 2020 2020 2020  re_name,.       
+00019d90: 2020 2020 2066 696c 655f 7061 7468 3d66       file_path=f
+00019da0: 696c 655f 636c 6965 6e74 5f61 646d 696e  ile_client_admin
+00019db0: 2e66 696c 655f 6e61 6d65 2c0a 2020 2020  .file_name,.    
+00019dc0: 2020 2020 2020 2020 6372 6564 656e 7469          credenti
+00019dd0: 616c 3d74 6f6b 656e 290a 0a20 2020 2020  al=token)..     
+00019de0: 2020 2023 2041 6374 0a20 2020 2020 2020     # Act.       
+00019df0: 2072 6573 706f 6e73 6520 3d20 7265 7175   response = requ
+00019e00: 6573 7473 2e64 656c 6574 6528 6669 6c65  ests.delete(file
+00019e10: 5f63 6c69 656e 742e 7572 6c29 0a0a 2020  _client.url)..  
+00019e20: 2020 2020 2020 2320 4173 7365 7274 0a20        # Assert. 
+00019e30: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00019e40: 7274 5472 7565 2872 6573 706f 6e73 652e  rtTrue(response.
+00019e50: 6f6b 290a 2020 2020 2020 2020 7769 7468  ok).        with
+00019e60: 2073 656c 662e 6173 7365 7274 5261 6973   self.assertRais
+00019e70: 6573 2852 6573 6f75 7263 654e 6f74 466f  es(ResourceNotFo
+00019e80: 756e 6445 7272 6f72 293a 0a20 2020 2020  undError):.     
+00019e90: 2020 2020 2020 2061 7761 6974 2066 696c         await fil
+00019ea0: 655f 636c 6965 6e74 5f61 646d 696e 2e64  e_client_admin.d
+00019eb0: 6f77 6e6c 6f61 645f 6669 6c65 2829 0a0a  ownload_file()..
+00019ec0: 2020 2020 4046 696c 6553 6861 7265 5072      @FileSharePr
+00019ed0: 6570 6172 6572 2829 0a20 2020 2040 4173  eparer().    @As
+00019ee0: 796e 6353 746f 7261 6765 5465 7374 4361  yncStorageTestCa
+00019ef0: 7365 2e61 7761 6974 5f70 7265 7061 7265  se.await_prepare
+00019f00: 645f 7465 7374 0a20 2020 2061 7379 6e63  d_test.    async
+00019f10: 2064 6566 2074 6573 745f 7265 6e61 6d65   def test_rename
+00019f20: 5f66 696c 6528 7365 6c66 2c20 7374 6f72  _file(self, stor
+00019f30: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
+00019f40: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
+00019f50: 745f 6b65 7929 3a0a 2020 2020 2020 2020  t_key):.        
+00019f60: 7365 6c66 2e5f 7365 7475 7028 7374 6f72  self._setup(stor
+00019f70: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
+00019f80: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
+00019f90: 745f 6b65 7929 0a20 2020 2020 2020 2073  t_key).        s
+00019fa0: 6f75 7263 655f 6669 6c65 203d 2061 7761  ource_file = awa
+00019fb0: 6974 2073 656c 662e 5f63 7265 6174 655f  it self._create_
+00019fc0: 6669 6c65 2873 746f 7261 6765 5f61 6363  file(storage_acc
+00019fd0: 6f75 6e74 5f6e 616d 652c 2073 746f 7261  ount_name, stora
+00019fe0: 6765 5f61 6363 6f75 6e74 5f6b 6579 2c20  ge_account_key, 
+00019ff0: 2766 696c 6531 2729 0a0a 2020 2020 2020  'file1')..      
+0001a000: 2020 2320 4163 740a 2020 2020 2020 2020    # Act.        
+0001a010: 6e65 775f 6669 6c65 203d 2061 7761 6974  new_file = await
+0001a020: 2073 6f75 7263 655f 6669 6c65 2e72 656e   source_file.ren
+0001a030: 616d 655f 6669 6c65 2827 6669 6c65 3227  ame_file('file2'
+0001a040: 290a 0a20 2020 2020 2020 2023 2041 7373  )..        # Ass
+0001a050: 6572 740a 2020 2020 2020 2020 7365 6c66  ert.        self
+0001a060: 2e61 7373 6572 7445 7175 616c 2827 6669  .assertEqual('fi
+0001a070: 6c65 3227 2c20 6e65 775f 6669 6c65 2e66  le2', new_file.f
+0001a080: 696c 655f 6e61 6d65 290a 2020 2020 2020  ile_name).      
+0001a090: 2020 7072 6f70 7320 3d20 6177 6169 7420    props = await 
+0001a0a0: 6e65 775f 6669 6c65 2e67 6574 5f66 696c  new_file.get_fil
+0001a0b0: 655f 7072 6f70 6572 7469 6573 2829 0a20  e_properties(). 
+0001a0c0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+0001a0d0: 7274 4973 4e6f 744e 6f6e 6528 7072 6f70  rtIsNotNone(prop
+0001a0e0: 7329 0a0a 2020 2020 4046 696c 6553 6861  s)..    @FileSha
+0001a0f0: 7265 5072 6570 6172 6572 2829 0a20 2020  rePreparer().   
+0001a100: 2040 4173 796e 6353 746f 7261 6765 5465   @AsyncStorageTe
+0001a110: 7374 4361 7365 2e61 7761 6974 5f70 7265  stCase.await_pre
+0001a120: 7061 7265 645f 7465 7374 0a20 2020 2061  pared_test.    a
+0001a130: 7379 6e63 2064 6566 2074 6573 745f 7265  sync def test_re
+0001a140: 6e61 6d65 5f66 696c 655f 6469 6666 6572  name_file_differ
+0001a150: 656e 745f 6469 7265 6374 6f72 7928 7365  ent_directory(se
+0001a160: 6c66 2c20 7374 6f72 6167 655f 6163 636f  lf, storage_acco
 0001a170: 756e 745f 6e61 6d65 2c20 7374 6f72 6167  unt_name, storag
-0001a180: 655f 6163 636f 756e 745f 6b65 7929 0a20  e_account_key). 
-0001a190: 2020 2020 2020 2066 696c 655f 636c 6965         file_clie
-0001a1a0: 6e74 5f61 646d 696e 203d 2061 7761 6974  nt_admin = await
-0001a1b0: 2073 656c 662e 5f63 7265 6174 655f 6669   self._create_fi
-0001a1c0: 6c65 2873 746f 7261 6765 5f61 6363 6f75  le(storage_accou
-0001a1d0: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
-0001a1e0: 5f61 6363 6f75 6e74 5f6b 6579 290a 2020  _account_key).  
-0001a1f0: 2020 2020 2020 746f 6b65 6e20 3d20 6765        token = ge
-0001a200: 6e65 7261 7465 5f66 696c 655f 7361 7328  nerate_file_sas(
-0001a210: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
-0001a220: 655f 636c 6965 6e74 5f61 646d 696e 2e61  e_client_admin.a
-0001a230: 6363 6f75 6e74 5f6e 616d 652c 0a20 2020  ccount_name,.   
-0001a240: 2020 2020 2020 2020 2066 696c 655f 636c           file_cl
-0001a250: 6965 6e74 5f61 646d 696e 2e73 6861 7265  ient_admin.share
-0001a260: 5f6e 616d 652c 0a20 2020 2020 2020 2020  _name,.         
-0001a270: 2020 2066 696c 655f 636c 6965 6e74 5f61     file_client_a
-0001a280: 646d 696e 2e66 696c 655f 7061 7468 2c0a  dmin.file_path,.
-0001a290: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-0001a2a0: 5f63 6c69 656e 745f 6164 6d69 6e2e 6372  _client_admin.cr
-0001a2b0: 6564 656e 7469 616c 2e61 6363 6f75 6e74  edential.account
-0001a2c0: 5f6b 6579 2c0a 2020 2020 2020 2020 2020  _key,.          
-0001a2d0: 2020 7065 726d 6973 7369 6f6e 3d46 696c    permission=Fil
-0001a2e0: 6553 6173 5065 726d 6973 7369 6f6e 7328  eSasPermissions(
-0001a2f0: 6465 6c65 7465 3d54 7275 6529 2c0a 2020  delete=True),.  
-0001a300: 2020 2020 2020 2020 2020 6578 7069 7279            expiry
-0001a310: 3d64 6174 6574 696d 652e 7574 636e 6f77  =datetime.utcnow
-0001a320: 2829 202b 2074 696d 6564 656c 7461 2868  () + timedelta(h
-0001a330: 6f75 7273 3d31 292c 0a20 2020 2020 2020  ours=1),.       
-0001a340: 2029 0a20 2020 2020 2020 2066 696c 655f   ).        file_
-0001a350: 636c 6965 6e74 203d 2053 6861 7265 4669  client = ShareFi
-0001a360: 6c65 436c 6965 6e74 280a 2020 2020 2020  leClient(.      
-0001a370: 2020 2020 2020 7365 6c66 2e61 6363 6f75        self.accou
-0001a380: 6e74 5f75 726c 2873 746f 7261 6765 5f61  nt_url(storage_a
-0001a390: 6363 6f75 6e74 5f6e 616d 652c 2022 6669  ccount_name, "fi
-0001a3a0: 6c65 2229 2c0a 2020 2020 2020 2020 2020  le"),.          
-0001a3b0: 2020 7368 6172 655f 6e61 6d65 3d73 656c    share_name=sel
-0001a3c0: 662e 7368 6172 655f 6e61 6d65 2c0a 2020  f.share_name,.  
-0001a3d0: 2020 2020 2020 2020 2020 6669 6c65 5f70            file_p
-0001a3e0: 6174 683d 6669 6c65 5f63 6c69 656e 745f  ath=file_client_
-0001a3f0: 6164 6d69 6e2e 6669 6c65 5f6e 616d 652c  admin.file_name,
-0001a400: 0a20 2020 2020 2020 2020 2020 2063 7265  .            cre
-0001a410: 6465 6e74 6961 6c3d 746f 6b65 6e29 0a0a  dential=token)..
-0001a420: 2020 2020 2020 2020 2320 4163 740a 2020          # Act.  
-0001a430: 2020 2020 2020 7265 7370 6f6e 7365 203d        response =
-0001a440: 2072 6571 7565 7374 732e 6465 6c65 7465   requests.delete
-0001a450: 2866 696c 655f 636c 6965 6e74 2e75 726c  (file_client.url
-0001a460: 290a 0a20 2020 2020 2020 2023 2041 7373  )..        # Ass
-0001a470: 6572 740a 2020 2020 2020 2020 7365 6c66  ert.        self
-0001a480: 2e61 7373 6572 7454 7275 6528 7265 7370  .assertTrue(resp
-0001a490: 6f6e 7365 2e6f 6b29 0a20 2020 2020 2020  onse.ok).       
-0001a4a0: 2077 6974 6820 7365 6c66 2e61 7373 6572   with self.asser
-0001a4b0: 7452 6169 7365 7328 5265 736f 7572 6365  tRaises(Resource
-0001a4c0: 4e6f 7446 6f75 6e64 4572 726f 7229 3a0a  NotFoundError):.
-0001a4d0: 2020 2020 2020 2020 2020 2020 6177 6169              awai
-0001a4e0: 7420 6669 6c65 5f63 6c69 656e 745f 6164  t file_client_ad
-0001a4f0: 6d69 6e2e 646f 776e 6c6f 6164 5f66 696c  min.download_fil
-0001a500: 6528 290a 0a20 2020 2040 4669 6c65 5368  e()..    @FileSh
-0001a510: 6172 6550 7265 7061 7265 7228 290a 2020  arePreparer().  
-0001a520: 2020 4041 7379 6e63 5374 6f72 6167 6554    @AsyncStorageT
-0001a530: 6573 7443 6173 652e 6177 6169 745f 7072  estCase.await_pr
-0001a540: 6570 6172 6564 5f74 6573 740a 2020 2020  epared_test.    
-0001a550: 6173 796e 6320 6465 6620 7465 7374 5f72  async def test_r
-0001a560: 656e 616d 655f 6669 6c65 2873 656c 662c  ename_file(self,
-0001a570: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
-0001a580: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
-0001a590: 6363 6f75 6e74 5f6b 6579 293a 0a20 2020  ccount_key):.   
-0001a5a0: 2020 2020 2073 656c 662e 5f73 6574 7570       self._setup
-0001a5b0: 2873 746f 7261 6765 5f61 6363 6f75 6e74  (storage_account
-0001a5c0: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
-0001a5d0: 6363 6f75 6e74 5f6b 6579 290a 2020 2020  ccount_key).    
-0001a5e0: 2020 2020 736f 7572 6365 5f66 696c 6520      source_file 
-0001a5f0: 3d20 6177 6169 7420 7365 6c66 2e5f 6372  = await self._cr
-0001a600: 6561 7465 5f66 696c 6528 7374 6f72 6167  eate_file(storag
-0001a610: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
-0001a620: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-0001a630: 6b65 792c 2027 6669 6c65 3127 290a 0a20  key, 'file1').. 
-0001a640: 2020 2020 2020 2023 2041 6374 0a20 2020         # Act.   
-0001a650: 2020 2020 206e 6577 5f66 696c 6520 3d20       new_file = 
-0001a660: 6177 6169 7420 736f 7572 6365 5f66 696c  await source_fil
-0001a670: 652e 7265 6e61 6d65 5f66 696c 6528 2766  e.rename_file('f
-0001a680: 696c 6532 2729 0a0a 2020 2020 2020 2020  ile2')..        
-0001a690: 2320 4173 7365 7274 0a20 2020 2020 2020  # Assert.       
-0001a6a0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-0001a6b0: 6c28 2766 696c 6532 272c 206e 6577 5f66  l('file2', new_f
-0001a6c0: 696c 652e 6669 6c65 5f6e 616d 6529 0a20  ile.file_name). 
-0001a6d0: 2020 2020 2020 2070 726f 7073 203d 2061         props = a
-0001a6e0: 7761 6974 206e 6577 5f66 696c 652e 6765  wait new_file.ge
-0001a6f0: 745f 6669 6c65 5f70 726f 7065 7274 6965  t_file_propertie
-0001a700: 7328 290a 2020 2020 2020 2020 7365 6c66  s().        self
-0001a710: 2e61 7373 6572 7449 734e 6f74 4e6f 6e65  .assertIsNotNone
-0001a720: 2870 726f 7073 290a 0a20 2020 2040 4669  (props)..    @Fi
-0001a730: 6c65 5368 6172 6550 7265 7061 7265 7228  leSharePreparer(
-0001a740: 290a 2020 2020 4041 7379 6e63 5374 6f72  ).    @AsyncStor
-0001a750: 6167 6554 6573 7443 6173 652e 6177 6169  ageTestCase.awai
-0001a760: 745f 7072 6570 6172 6564 5f74 6573 740a  t_prepared_test.
-0001a770: 2020 2020 6173 796e 6320 6465 6620 7465      async def te
-0001a780: 7374 5f72 656e 616d 655f 6669 6c65 5f64  st_rename_file_d
-0001a790: 6966 6665 7265 6e74 5f64 6972 6563 746f  ifferent_directo
-0001a7a0: 7279 2873 656c 662c 2073 746f 7261 6765  ry(self, storage
-0001a7b0: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
-0001a7c0: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
-0001a7d0: 6579 293a 0a20 2020 2020 2020 2073 656c  ey):.        sel
-0001a7e0: 662e 5f73 6574 7570 2873 746f 7261 6765  f._setup(storage
-0001a7f0: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
-0001a800: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
-0001a810: 6579 290a 2020 2020 2020 2020 6177 6169  ey).        awai
-0001a820: 7420 7365 6c66 2e5f 7365 7475 705f 7368  t self._setup_sh
-0001a830: 6172 6528 7374 6f72 6167 655f 6163 636f  are(storage_acco
-0001a840: 756e 745f 6e61 6d65 2c20 7374 6f72 6167  unt_name, storag
-0001a850: 655f 6163 636f 756e 745f 6b65 7929 0a20  e_account_key). 
-0001a860: 2020 2020 2020 2073 6861 7265 5f63 6c69         share_cli
-0001a870: 656e 7420 3d20 7365 6c66 2e66 7363 2e67  ent = self.fsc.g
-0001a880: 6574 5f73 6861 7265 5f63 6c69 656e 7428  et_share_client(
-0001a890: 7365 6c66 2e73 6861 7265 5f6e 616d 6529  self.share_name)
-0001a8a0: 0a0a 2020 2020 2020 2020 736f 7572 6365  ..        source
-0001a8b0: 5f64 6972 6563 746f 7279 203d 2061 7761  _directory = awa
-0001a8c0: 6974 2073 6861 7265 5f63 6c69 656e 742e  it share_client.
-0001a8d0: 6372 6561 7465 5f64 6972 6563 746f 7279  create_directory
-0001a8e0: 2827 6469 7231 2729 0a20 2020 2020 2020  ('dir1').       
-0001a8f0: 2064 6573 745f 6469 7265 6374 6f72 7920   dest_directory 
-0001a900: 3d20 6177 6169 7420 7368 6172 655f 636c  = await share_cl
-0001a910: 6965 6e74 2e63 7265 6174 655f 6469 7265  ient.create_dire
-0001a920: 6374 6f72 7928 2764 6972 3227 290a 2020  ctory('dir2').  
-0001a930: 2020 2020 2020 736f 7572 6365 5f66 696c        source_fil
-0001a940: 6520 3d20 6177 6169 7420 736f 7572 6365  e = await source
-0001a950: 5f64 6972 6563 746f 7279 2e75 706c 6f61  _directory.uploa
-0001a960: 645f 6669 6c65 2827 6669 6c65 3127 2c20  d_file('file1', 
-0001a970: 7365 6c66 2e73 686f 7274 5f62 7974 655f  self.short_byte_
-0001a980: 6461 7461 290a 0a20 2020 2020 2020 2023  data)..        #
-0001a990: 2041 6374 0a20 2020 2020 2020 206e 6577   Act.        new
-0001a9a0: 5f66 696c 6520 3d20 6177 6169 7420 736f  _file = await so
-0001a9b0: 7572 6365 5f66 696c 652e 7265 6e61 6d65  urce_file.rename
-0001a9c0: 5f66 696c 6528 6465 7374 5f64 6972 6563  _file(dest_direc
-0001a9d0: 746f 7279 2e64 6972 6563 746f 7279 5f70  tory.directory_p
-0001a9e0: 6174 6820 2b20 272f 2720 2b20 736f 7572  ath + '/' + sour
-0001a9f0: 6365 5f66 696c 652e 6669 6c65 5f6e 616d  ce_file.file_nam
-0001aa00: 6529 0a0a 2020 2020 2020 2020 2320 4173  e)..        # As
-0001aa10: 7365 7274 0a20 2020 2020 2020 2073 656c  sert.        sel
-0001aa20: 662e 6173 7365 7274 5472 7565 2827 6469  f.assertTrue('di
-0001aa30: 7232 2720 696e 206e 6577 5f66 696c 652e  r2' in new_file.
-0001aa40: 6669 6c65 5f70 6174 6829 0a20 2020 2020  file_path).     
-0001aa50: 2020 2070 726f 7073 203d 2061 7761 6974     props = await
-0001aa60: 206e 6577 5f66 696c 652e 6765 745f 6669   new_file.get_fi
-0001aa70: 6c65 5f70 726f 7065 7274 6965 7328 290a  le_properties().
-0001aa80: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0001aa90: 6572 7449 734e 6f74 4e6f 6e65 2870 726f  ertIsNotNone(pro
-0001aaa0: 7073 290a 0a20 2020 2040 4669 6c65 5368  ps)..    @FileSh
-0001aab0: 6172 6550 7265 7061 7265 7228 290a 2020  arePreparer().  
-0001aac0: 2020 4041 7379 6e63 5374 6f72 6167 6554    @AsyncStorageT
-0001aad0: 6573 7443 6173 652e 6177 6169 745f 7072  estCase.await_pr
-0001aae0: 6570 6172 6564 5f74 6573 740a 2020 2020  epared_test.    
-0001aaf0: 6173 796e 6320 6465 6620 7465 7374 5f72  async def test_r
-0001ab00: 656e 616d 655f 6669 6c65 5f69 676e 6f72  ename_file_ignor
-0001ab10: 655f 7265 6164 6f6e 6c79 2873 656c 662c  e_readonly(self,
-0001ab20: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
-0001ab30: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
-0001ab40: 6363 6f75 6e74 5f6b 6579 293a 0a20 2020  ccount_key):.   
-0001ab50: 2020 2020 2073 656c 662e 5f73 6574 7570       self._setup
-0001ab60: 2873 746f 7261 6765 5f61 6363 6f75 6e74  (storage_account
-0001ab70: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
-0001ab80: 6363 6f75 6e74 5f6b 6579 290a 2020 2020  ccount_key).    
-0001ab90: 2020 2020 6177 6169 7420 7365 6c66 2e5f      await self._
-0001aba0: 7365 7475 705f 7368 6172 6528 7374 6f72  setup_share(stor
-0001abb0: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
-0001abc0: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
-0001abd0: 745f 6b65 7929 0a20 2020 2020 2020 2073  t_key).        s
-0001abe0: 6861 7265 5f63 6c69 656e 7420 3d20 7365  hare_client = se
-0001abf0: 6c66 2e66 7363 2e67 6574 5f73 6861 7265  lf.fsc.get_share
-0001ac00: 5f63 6c69 656e 7428 7365 6c66 2e73 6861  _client(self.sha
-0001ac10: 7265 5f6e 616d 6529 0a0a 2020 2020 2020  re_name)..      
-0001ac20: 2020 736f 7572 6365 5f66 696c 6520 3d20    source_file = 
-0001ac30: 7368 6172 655f 636c 6965 6e74 2e67 6574  share_client.get
-0001ac40: 5f66 696c 655f 636c 6965 6e74 2827 6669  _file_client('fi
-0001ac50: 6c65 3127 290a 2020 2020 2020 2020 6177  le1').        aw
-0001ac60: 6169 7420 736f 7572 6365 5f66 696c 652e  ait source_file.
-0001ac70: 6372 6561 7465 5f66 696c 6528 3130 3234  create_file(1024
-0001ac80: 290a 2020 2020 2020 2020 6465 7374 5f66  ).        dest_f
-0001ac90: 696c 6520 3d20 7368 6172 655f 636c 6965  ile = share_clie
-0001aca0: 6e74 2e67 6574 5f66 696c 655f 636c 6965  nt.get_file_clie
-0001acb0: 6e74 2827 6669 6c65 3227 290a 0a20 2020  nt('file2')..   
-0001acc0: 2020 2020 2066 696c 655f 6174 7472 6962       file_attrib
-0001acd0: 7574 6573 203d 204e 5446 5341 7474 7269  utes = NTFSAttri
-0001ace0: 6275 7465 7328 7265 6164 5f6f 6e6c 793d  butes(read_only=
-0001acf0: 5472 7565 290a 2020 2020 2020 2020 6177  True).        aw
-0001ad00: 6169 7420 6465 7374 5f66 696c 652e 6372  ait dest_file.cr
-0001ad10: 6561 7465 5f66 696c 6528 3130 3234 2c20  eate_file(1024, 
-0001ad20: 6669 6c65 5f61 7474 7269 6275 7465 733d  file_attributes=
-0001ad30: 6669 6c65 5f61 7474 7269 6275 7465 7329  file_attributes)
-0001ad40: 0a0a 2020 2020 2020 2020 2320 4163 740a  ..        # Act.
-0001ad50: 2020 2020 2020 2020 6e65 775f 6669 6c65          new_file
-0001ad60: 203d 2061 7761 6974 2073 6f75 7263 655f   = await source_
-0001ad70: 6669 6c65 2e72 656e 616d 655f 6669 6c65  file.rename_file
-0001ad80: 2864 6573 745f 6669 6c65 2e66 696c 655f  (dest_file.file_
-0001ad90: 6e61 6d65 2c20 6f76 6572 7772 6974 653d  name, overwrite=
-0001ada0: 5472 7565 2c20 6967 6e6f 7265 5f72 6561  True, ignore_rea
-0001adb0: 645f 6f6e 6c79 3d54 7275 6529 0a0a 2020  d_only=True)..  
-0001adc0: 2020 2020 2020 2320 4173 7365 7274 0a20        # Assert. 
-0001add0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0001ade0: 7274 4571 7561 6c28 2766 696c 6532 272c  rtEqual('file2',
-0001adf0: 206e 6577 5f66 696c 652e 6669 6c65 5f6e   new_file.file_n
-0001ae00: 616d 6529 0a20 2020 2020 2020 2070 726f  ame).        pro
-0001ae10: 7073 203d 2061 7761 6974 206e 6577 5f66  ps = await new_f
-0001ae20: 696c 652e 6765 745f 6669 6c65 5f70 726f  ile.get_file_pro
-0001ae30: 7065 7274 6965 7328 290a 2020 2020 2020  perties().      
-0001ae40: 2020 7365 6c66 2e61 7373 6572 7449 734e    self.assertIsN
-0001ae50: 6f74 4e6f 6e65 2870 726f 7073 290a 0a20  otNone(props).. 
-0001ae60: 2020 2040 4669 6c65 5368 6172 6550 7265     @FileSharePre
-0001ae70: 7061 7265 7228 290a 2020 2020 4041 7379  parer().    @Asy
-0001ae80: 6e63 5374 6f72 6167 6554 6573 7443 6173  ncStorageTestCas
-0001ae90: 652e 6177 6169 745f 7072 6570 6172 6564  e.await_prepared
-0001aea0: 5f74 6573 740a 2020 2020 6173 796e 6320  _test.    async 
-0001aeb0: 6465 6620 7465 7374 5f72 656e 616d 655f  def test_rename_
-0001aec0: 6669 6c65 5f66 696c 655f 7065 726d 6973  file_file_permis
-0001aed0: 7369 6f6e 2873 656c 662c 2073 746f 7261  sion(self, stora
-0001aee0: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
-0001aef0: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
-0001af00: 5f6b 6579 293a 0a20 2020 2020 2020 2073  _key):.        s
-0001af10: 656c 662e 5f73 6574 7570 2873 746f 7261  elf._setup(stora
-0001af20: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
-0001af30: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
-0001af40: 5f6b 6579 290a 2020 2020 2020 2020 6177  _key).        aw
-0001af50: 6169 7420 7365 6c66 2e5f 7365 7475 705f  ait self._setup_
-0001af60: 7368 6172 6528 7374 6f72 6167 655f 6163  share(storage_ac
-0001af70: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
-0001af80: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
-0001af90: 0a20 2020 2020 2020 2073 6861 7265 5f63  .        share_c
-0001afa0: 6c69 656e 7420 3d20 7365 6c66 2e66 7363  lient = self.fsc
-0001afb0: 2e67 6574 5f73 6861 7265 5f63 6c69 656e  .get_share_clien
-0001afc0: 7428 7365 6c66 2e73 6861 7265 5f6e 616d  t(self.share_nam
-0001afd0: 6529 0a20 2020 2020 2020 2066 696c 655f  e).        file_
-0001afe0: 7065 726d 6973 7369 6f6e 5f6b 6579 203d  permission_key =
-0001aff0: 2061 7761 6974 2073 6861 7265 5f63 6c69   await share_cli
-0001b000: 656e 742e 6372 6561 7465 5f70 6572 6d69  ent.create_permi
-0001b010: 7373 696f 6e5f 666f 725f 7368 6172 6528  ssion_for_share(
-0001b020: 5445 5354 5f46 494c 455f 5045 524d 4953  TEST_FILE_PERMIS
-0001b030: 5349 4f4e 5329 0a0a 2020 2020 2020 2020  SIONS)..        
-0001b040: 736f 7572 6365 5f66 696c 6520 3d20 7368  source_file = sh
-0001b050: 6172 655f 636c 6965 6e74 2e67 6574 5f66  are_client.get_f
-0001b060: 696c 655f 636c 6965 6e74 2827 6669 6c65  ile_client('file
-0001b070: 3127 290a 2020 2020 2020 2020 6177 6169  1').        awai
-0001b080: 7420 736f 7572 6365 5f66 696c 652e 6372  t source_file.cr
-0001b090: 6561 7465 5f66 696c 6528 3130 3234 290a  eate_file(1024).
-0001b0a0: 0a20 2020 2020 2020 2023 2041 6374 0a20  .        # Act. 
-0001b0b0: 2020 2020 2020 206e 6577 5f66 696c 6520         new_file 
-0001b0c0: 3d20 6177 6169 7420 736f 7572 6365 5f66  = await source_f
-0001b0d0: 696c 652e 7265 6e61 6d65 5f66 696c 6528  ile.rename_file(
-0001b0e0: 2766 696c 6532 272c 2066 696c 655f 7065  'file2', file_pe
-0001b0f0: 726d 6973 7369 6f6e 3d54 4553 545f 4649  rmission=TEST_FI
-0001b100: 4c45 5f50 4552 4d49 5353 494f 4e53 290a  LE_PERMISSIONS).
-0001b110: 0a20 2020 2020 2020 2023 2041 7373 6572  .        # Asser
-0001b120: 740a 2020 2020 2020 2020 7072 6f70 7320  t.        props 
-0001b130: 3d20 6177 6169 7420 6e65 775f 6669 6c65  = await new_file
-0001b140: 2e67 6574 5f66 696c 655f 7072 6f70 6572  .get_file_proper
-0001b150: 7469 6573 2829 0a20 2020 2020 2020 2073  ties().        s
-0001b160: 656c 662e 6173 7365 7274 4973 4e6f 744e  elf.assertIsNotN
-0001b170: 6f6e 6528 7072 6f70 7329 0a20 2020 2020  one(props).     
-0001b180: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-0001b190: 7561 6c28 6669 6c65 5f70 6572 6d69 7373  ual(file_permiss
-0001b1a0: 696f 6e5f 6b65 792c 2070 726f 7073 2e70  ion_key, props.p
-0001b1b0: 6572 6d69 7373 696f 6e5f 6b65 7929 0a0a  ermission_key)..
-0001b1c0: 2020 2020 4046 696c 6553 6861 7265 5072      @FileSharePr
-0001b1d0: 6570 6172 6572 2829 0a20 2020 2040 4173  eparer().    @As
-0001b1e0: 796e 6353 746f 7261 6765 5465 7374 4361  yncStorageTestCa
-0001b1f0: 7365 2e61 7761 6974 5f70 7265 7061 7265  se.await_prepare
-0001b200: 645f 7465 7374 0a20 2020 2061 7379 6e63  d_test.    async
-0001b210: 2064 6566 2074 6573 745f 7265 6e61 6d65   def test_rename
-0001b220: 5f66 696c 655f 7072 6573 6572 7665 5f70  _file_preserve_p
-0001b230: 6572 6d69 7373 696f 6e28 7365 6c66 2c20  ermission(self, 
-0001b240: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-0001b250: 6e61 6d65 2c20 7374 6f72 6167 655f 6163  name, storage_ac
-0001b260: 636f 756e 745f 6b65 7929 3a0a 2020 2020  count_key):.    
-0001b270: 2020 2020 7365 6c66 2e5f 7365 7475 7028      self._setup(
-0001b280: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
-0001b290: 6e61 6d65 2c20 7374 6f72 6167 655f 6163  name, storage_ac
-0001b2a0: 636f 756e 745f 6b65 7929 0a20 2020 2020  count_key).     
-0001b2b0: 2020 2061 7761 6974 2073 656c 662e 5f73     await self._s
-0001b2c0: 6574 7570 5f73 6861 7265 2873 746f 7261  etup_share(stora
-0001b2d0: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
-0001b2e0: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
-0001b2f0: 5f6b 6579 290a 2020 2020 2020 2020 7368  _key).        sh
-0001b300: 6172 655f 636c 6965 6e74 203d 2073 656c  are_client = sel
-0001b310: 662e 6673 632e 6765 745f 7368 6172 655f  f.fsc.get_share_
-0001b320: 636c 6965 6e74 2873 656c 662e 7368 6172  client(self.shar
-0001b330: 655f 6e61 6d65 290a 0a20 2020 2020 2020  e_name)..       
-0001b340: 2073 6f75 7263 655f 6669 6c65 203d 2073   source_file = s
-0001b350: 6861 7265 5f63 6c69 656e 742e 6765 745f  hare_client.get_
-0001b360: 6669 6c65 5f63 6c69 656e 7428 2766 696c  file_client('fil
-0001b370: 6531 2729 0a20 2020 2020 2020 2061 7761  e1').        awa
-0001b380: 6974 2073 6f75 7263 655f 6669 6c65 2e63  it source_file.c
-0001b390: 7265 6174 655f 6669 6c65 2831 3032 342c  reate_file(1024,
-0001b3a0: 2066 696c 655f 7065 726d 6973 7369 6f6e   file_permission
-0001b3b0: 3d54 4553 545f 4649 4c45 5f50 4552 4d49  =TEST_FILE_PERMI
-0001b3c0: 5353 494f 4e53 290a 0a20 2020 2020 2020  SSIONS)..       
-0001b3d0: 2073 6f75 7263 655f 7072 6f70 7320 3d20   source_props = 
-0001b3e0: 6177 6169 7420 736f 7572 6365 5f66 696c  await source_fil
-0001b3f0: 652e 6765 745f 6669 6c65 5f70 726f 7065  e.get_file_prope
-0001b400: 7274 6965 7328 290a 2020 2020 2020 2020  rties().        
-0001b410: 736f 7572 6365 5f70 6572 6d69 7373 696f  source_permissio
-0001b420: 6e5f 6b65 7920 3d20 736f 7572 6365 5f70  n_key = source_p
-0001b430: 726f 7073 2e70 6572 6d69 7373 696f 6e5f  rops.permission_
-0001b440: 6b65 790a 0a20 2020 2020 2020 2023 2041  key..        # A
-0001b450: 6374 0a20 2020 2020 2020 206e 6577 5f66  ct.        new_f
-0001b460: 696c 6520 3d20 6177 6169 7420 736f 7572  ile = await sour
-0001b470: 6365 5f66 696c 652e 7265 6e61 6d65 5f66  ce_file.rename_f
-0001b480: 696c 6528 2766 696c 6532 272c 2066 696c  ile('file2', fil
-0001b490: 655f 7065 726d 6973 7369 6f6e 3d27 7072  e_permission='pr
-0001b4a0: 6573 6572 7665 2729 0a0a 2020 2020 2020  eserve')..      
-0001b4b0: 2020 2320 4173 7365 7274 0a20 2020 2020    # Assert.     
-0001b4c0: 2020 2070 726f 7073 203d 2061 7761 6974     props = await
-0001b4d0: 206e 6577 5f66 696c 652e 6765 745f 6669   new_file.get_fi
-0001b4e0: 6c65 5f70 726f 7065 7274 6965 7328 290a  le_properties().
-0001b4f0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0001b500: 6572 7449 734e 6f74 4e6f 6e65 2870 726f  ertIsNotNone(pro
-0001b510: 7073 290a 2020 2020 2020 2020 7365 6c66  ps).        self
-0001b520: 2e61 7373 6572 7445 7175 616c 2873 6f75  .assertEqual(sou
-0001b530: 7263 655f 7065 726d 6973 7369 6f6e 5f6b  rce_permission_k
-0001b540: 6579 2c20 7072 6f70 732e 7065 726d 6973  ey, props.permis
-0001b550: 7369 6f6e 5f6b 6579 290a 0a20 2020 2040  sion_key)..    @
-0001b560: 4669 6c65 5368 6172 6550 7265 7061 7265  FileSharePrepare
-0001b570: 7228 290a 2020 2020 4041 7379 6e63 5374  r().    @AsyncSt
-0001b580: 6f72 6167 6554 6573 7443 6173 652e 6177  orageTestCase.aw
-0001b590: 6169 745f 7072 6570 6172 6564 5f74 6573  ait_prepared_tes
-0001b5a0: 740a 2020 2020 6173 796e 6320 6465 6620  t.    async def 
-0001b5b0: 7465 7374 5f72 656e 616d 655f 6669 6c65  test_rename_file
-0001b5c0: 5f73 6d62 5f70 726f 7065 7274 6965 7328  _smb_properties(
-0001b5d0: 7365 6c66 2c20 7374 6f72 6167 655f 6163  self, storage_ac
-0001b5e0: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
-0001b5f0: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
-0001b600: 3a0a 2020 2020 2020 2020 7365 6c66 2e5f  :.        self._
-0001b610: 7365 7475 7028 7374 6f72 6167 655f 6163  setup(storage_ac
-0001b620: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
-0001b630: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
-0001b640: 0a20 2020 2020 2020 2073 6f75 7263 655f  .        source_
-0001b650: 6669 6c65 203d 2061 7761 6974 2073 656c  file = await sel
-0001b660: 662e 5f63 7265 6174 655f 6669 6c65 2873  f._create_file(s
-0001b670: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
-0001b680: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
-0001b690: 6f75 6e74 5f6b 6579 2c20 2766 696c 6531  ount_key, 'file1
-0001b6a0: 2729 0a0a 2020 2020 2020 2020 6669 6c65  ')..        file
-0001b6b0: 5f61 7474 7269 6275 7465 7320 3d20 4e54  _attributes = NT
-0001b6c0: 4653 4174 7472 6962 7574 6573 2872 6561  FSAttributes(rea
-0001b6d0: 645f 6f6e 6c79 3d54 7275 652c 2061 7263  d_only=True, arc
-0001b6e0: 6869 7665 3d54 7275 6529 0a20 2020 2020  hive=True).     
-0001b6f0: 2020 2066 696c 655f 6372 6561 7469 6f6e     file_creation
-0001b700: 5f74 696d 6520 3d20 6461 7465 7469 6d65  _time = datetime
-0001b710: 2832 3032 322c 2031 2c20 3236 2c20 3130  (2022, 1, 26, 10
-0001b720: 2c20 392c 2033 302c 2035 3030 3030 3029  , 9, 30, 500000)
-0001b730: 0a20 2020 2020 2020 2066 696c 655f 6c61  .        file_la
-0001b740: 7374 5f77 7269 7465 5f74 696d 6520 3d20  st_write_time = 
-0001b750: 6461 7465 7469 6d65 2832 3032 322c 2031  datetime(2022, 1
-0001b760: 2c20 3236 2c20 3130 2c20 3134 2c20 3330  , 26, 10, 14, 30
-0001b770: 2c20 3530 3030 3030 290a 2020 2020 2020  , 500000).      
-0001b780: 2020 6669 6c65 5f63 6861 6e67 655f 7469    file_change_ti
-0001b790: 6d65 203d 2064 6174 6574 696d 6528 3230  me = datetime(20
-0001b7a0: 3232 2c20 332c 2037 2c20 3130 2c20 3134  22, 3, 7, 10, 14
-0001b7b0: 2c20 3330 2c20 3530 3030 3030 290a 0a20  , 30, 500000).. 
-0001b7c0: 2020 2020 2020 2023 2041 6374 0a20 2020         # Act.   
-0001b7d0: 2020 2020 206e 6577 5f66 696c 6520 3d20       new_file = 
-0001b7e0: 6177 6169 7420 736f 7572 6365 5f66 696c  await source_fil
-0001b7f0: 652e 7265 6e61 6d65 5f66 696c 6528 0a20  e.rename_file(. 
-0001b800: 2020 2020 2020 2020 2020 2027 6669 6c65             'file
-0001b810: 3227 2c0a 2020 2020 2020 2020 2020 2020  2',.            
-0001b820: 6669 6c65 5f61 7474 7269 6275 7465 733d  file_attributes=
-0001b830: 6669 6c65 5f61 7474 7269 6275 7465 732c  file_attributes,
-0001b840: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
-0001b850: 655f 6372 6561 7469 6f6e 5f74 696d 653d  e_creation_time=
-0001b860: 6669 6c65 5f63 7265 6174 696f 6e5f 7469  file_creation_ti
-0001b870: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
-0001b880: 6669 6c65 5f6c 6173 745f 7772 6974 655f  file_last_write_
-0001b890: 7469 6d65 3d66 696c 655f 6c61 7374 5f77  time=file_last_w
-0001b8a0: 7269 7465 5f74 696d 652c 0a20 2020 2020  rite_time,.     
-0001b8b0: 2020 2020 2020 2066 696c 655f 6368 616e         file_chan
-0001b8c0: 6765 5f74 696d 653d 6669 6c65 5f63 6861  ge_time=file_cha
-0001b8d0: 6e67 655f 7469 6d65 290a 0a20 2020 2020  nge_time)..     
-0001b8e0: 2020 2023 2041 7373 6572 740a 2020 2020     # Assert.    
-0001b8f0: 2020 2020 7072 6f70 7320 3d20 6177 6169      props = awai
-0001b900: 7420 6e65 775f 6669 6c65 2e67 6574 5f66  t new_file.get_f
-0001b910: 696c 655f 7072 6f70 6572 7469 6573 2829  ile_properties()
-0001b920: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-0001b930: 7365 7274 4973 4e6f 744e 6f6e 6528 7072  sertIsNotNone(pr
-0001b940: 6f70 7329 0a20 2020 2020 2020 2073 656c  ops).        sel
-0001b950: 662e 6173 7365 7274 4571 7561 6c28 7374  f.assertEqual(st
-0001b960: 7228 6669 6c65 5f61 7474 7269 6275 7465  r(file_attribute
-0001b970: 7329 2c20 7072 6f70 732e 6669 6c65 5f61  s), props.file_a
-0001b980: 7474 7269 6275 7465 732e 7265 706c 6163  ttributes.replac
-0001b990: 6528 2720 272c 2027 2729 290a 2020 2020  e(' ', '')).    
-0001b9a0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-0001b9b0: 7175 616c 2866 696c 655f 6372 6561 7469  qual(file_creati
-0001b9c0: 6f6e 5f74 696d 652c 2070 726f 7073 2e63  on_time, props.c
-0001b9d0: 7265 6174 696f 6e5f 7469 6d65 290a 2020  reation_time).  
-0001b9e0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0001b9f0: 7445 7175 616c 2866 696c 655f 6c61 7374  tEqual(file_last
-0001ba00: 5f77 7269 7465 5f74 696d 652c 2070 726f  _write_time, pro
-0001ba10: 7073 2e6c 6173 745f 7772 6974 655f 7469  ps.last_write_ti
-0001ba20: 6d65 290a 2020 2020 2020 2020 7365 6c66  me).        self
-0001ba30: 2e61 7373 6572 7445 7175 616c 2866 696c  .assertEqual(fil
-0001ba40: 655f 6368 616e 6765 5f74 696d 652c 2070  e_change_time, p
-0001ba50: 726f 7073 2e63 6861 6e67 655f 7469 6d65  rops.change_time
-0001ba60: 290a 0a20 2020 2040 4669 6c65 5368 6172  )..    @FileShar
-0001ba70: 6550 7265 7061 7265 7228 290a 2020 2020  ePreparer().    
-0001ba80: 4041 7379 6e63 5374 6f72 6167 6554 6573  @AsyncStorageTes
-0001ba90: 7443 6173 652e 6177 6169 745f 7072 6570  tCase.await_prep
-0001baa0: 6172 6564 5f74 6573 740a 2020 2020 6173  ared_test.    as
-0001bab0: 796e 6320 6465 6620 7465 7374 5f72 656e  ync def test_ren
-0001bac0: 616d 655f 6669 6c65 5f63 6f6e 7465 6e74  ame_file_content
-0001bad0: 5f74 7970 6528 7365 6c66 2c20 7374 6f72  _type(self, stor
-0001bae0: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
-0001baf0: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
-0001bb00: 745f 6b65 7929 3a0a 2020 2020 2020 2020  t_key):.        
-0001bb10: 7365 6c66 2e5f 7365 7475 7028 7374 6f72  self._setup(stor
-0001bb20: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
-0001bb30: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
-0001bb40: 745f 6b65 7929 0a20 2020 2020 2020 2073  t_key).        s
-0001bb50: 6f75 7263 655f 6669 6c65 203d 2061 7761  ource_file = awa
-0001bb60: 6974 2073 656c 662e 5f63 7265 6174 655f  it self._create_
-0001bb70: 6669 6c65 2873 746f 7261 6765 5f61 6363  file(storage_acc
-0001bb80: 6f75 6e74 5f6e 616d 652c 2073 746f 7261  ount_name, stora
-0001bb90: 6765 5f61 6363 6f75 6e74 5f6b 6579 2c20  ge_account_key, 
-0001bba0: 2766 696c 6531 2729 0a20 2020 2020 2020  'file1').       
-0001bbb0: 2063 6f6e 7465 6e74 5f74 7970 6520 3d20   content_type = 
-0001bbc0: 2774 6578 742f 706c 6169 6e27 0a0a 2020  'text/plain'..  
-0001bbd0: 2020 2020 2020 2320 4163 740a 2020 2020        # Act.    
-0001bbe0: 2020 2020 6e65 775f 6669 6c65 203d 2061      new_file = a
-0001bbf0: 7761 6974 2073 6f75 7263 655f 6669 6c65  wait source_file
-0001bc00: 2e72 656e 616d 655f 6669 6c65 280a 2020  .rename_file(.  
-0001bc10: 2020 2020 2020 2020 2020 2766 696c 6532            'file2
-0001bc20: 272c 0a20 2020 2020 2020 2020 2020 2063  ',.            c
-0001bc30: 6f6e 7465 6e74 5f74 7970 653d 636f 6e74  ontent_type=cont
-0001bc40: 656e 745f 7479 7065 290a 0a20 2020 2020  ent_type)..     
-0001bc50: 2020 2023 2041 7373 6572 740a 2020 2020     # Assert.    
-0001bc60: 2020 2020 7072 6f70 7320 3d20 6177 6169      props = awai
-0001bc70: 7420 6e65 775f 6669 6c65 2e67 6574 5f66  t new_file.get_f
-0001bc80: 696c 655f 7072 6f70 6572 7469 6573 2829  ile_properties()
-0001bc90: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-0001bca0: 7365 7274 4973 4e6f 744e 6f6e 6528 7072  sertIsNotNone(pr
-0001bcb0: 6f70 7329 0a20 2020 2020 2020 2073 656c  ops).        sel
-0001bcc0: 662e 6173 7365 7274 4571 7561 6c28 636f  f.assertEqual(co
-0001bcd0: 6e74 656e 745f 7479 7065 2c20 7072 6f70  ntent_type, prop
-0001bce0: 732e 636f 6e74 656e 745f 7365 7474 696e  s.content_settin
-0001bcf0: 6773 2e63 6f6e 7465 6e74 5f74 7970 6529  gs.content_type)
-0001bd00: 0a0a 2020 2020 4046 696c 6553 6861 7265  ..    @FileShare
-0001bd10: 5072 6570 6172 6572 2829 0a20 2020 2040  Preparer().    @
-0001bd20: 4173 796e 6353 746f 7261 6765 5465 7374  AsyncStorageTest
-0001bd30: 4361 7365 2e61 7761 6974 5f70 7265 7061  Case.await_prepa
-0001bd40: 7265 645f 7465 7374 0a20 2020 2061 7379  red_test.    asy
-0001bd50: 6e63 2064 6566 2074 6573 745f 7265 6e61  nc def test_rena
-0001bd60: 6d65 5f66 696c 655f 7769 7468 5f6c 6561  me_file_with_lea
-0001bd70: 7365 2873 656c 662c 2073 746f 7261 6765  se(self, storage
-0001bd80: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
-0001bd90: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
-0001bda0: 6579 293a 0a20 2020 2020 2020 2073 656c  ey):.        sel
-0001bdb0: 662e 5f73 6574 7570 2873 746f 7261 6765  f._setup(storage
-0001bdc0: 5f61 6363 6f75 6e74 5f6e 616d 652c 2073  _account_name, s
-0001bdd0: 746f 7261 6765 5f61 6363 6f75 6e74 5f6b  torage_account_k
-0001bde0: 6579 290a 0a20 2020 2020 2020 2073 6f75  ey)..        sou
-0001bdf0: 7263 655f 6669 6c65 203d 2061 7761 6974  rce_file = await
-0001be00: 2073 656c 662e 5f63 7265 6174 655f 6669   self._create_fi
-0001be10: 6c65 2873 746f 7261 6765 5f61 6363 6f75  le(storage_accou
-0001be20: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
-0001be30: 5f61 6363 6f75 6e74 5f6b 6579 2c20 2766  _account_key, 'f
-0001be40: 696c 6531 2729 0a20 2020 2020 2020 2064  ile1').        d
-0001be50: 6573 745f 6669 6c65 203d 2061 7761 6974  est_file = await
-0001be60: 2073 656c 662e 5f63 7265 6174 655f 6669   self._create_fi
-0001be70: 6c65 2873 746f 7261 6765 5f61 6363 6f75  le(storage_accou
-0001be80: 6e74 5f6e 616d 652c 2073 746f 7261 6765  nt_name, storage
-0001be90: 5f61 6363 6f75 6e74 5f6b 6579 2c20 2766  _account_key, 'f
-0001bea0: 696c 6532 2729 0a20 2020 2020 2020 2073  ile2').        s
-0001beb0: 6f75 7263 655f 6c65 6173 6520 3d20 6177  ource_lease = aw
-0001bec0: 6169 7420 736f 7572 6365 5f66 696c 652e  ait source_file.
-0001bed0: 6163 7175 6972 655f 6c65 6173 6528 290a  acquire_lease().
-0001bee0: 2020 2020 2020 2020 6465 7374 5f6c 6561          dest_lea
-0001bef0: 7365 203d 2061 7761 6974 2064 6573 745f  se = await dest_
-0001bf00: 6669 6c65 2e61 6371 7569 7265 5f6c 6561  file.acquire_lea
-0001bf10: 7365 2829 0a0a 2020 2020 2020 2020 2320  se()..        # 
-0001bf20: 4163 740a 2020 2020 2020 2020 6e65 775f  Act.        new_
-0001bf30: 6669 6c65 203d 2061 7761 6974 2073 6f75  file = await sou
-0001bf40: 7263 655f 6669 6c65 2e72 656e 616d 655f  rce_file.rename_
-0001bf50: 6669 6c65 280a 2020 2020 2020 2020 2020  file(.          
-0001bf60: 2020 6465 7374 5f66 696c 652e 6669 6c65    dest_file.file
-0001bf70: 5f6e 616d 652c 0a20 2020 2020 2020 2020  _name,.         
-0001bf80: 2020 206f 7665 7277 7269 7465 3d54 7275     overwrite=Tru
-0001bf90: 652c 0a20 2020 2020 2020 2020 2020 2073  e,.            s
-0001bfa0: 6f75 7263 655f 6c65 6173 653d 736f 7572  ource_lease=sour
-0001bfb0: 6365 5f6c 6561 7365 2c0a 2020 2020 2020  ce_lease,.      
-0001bfc0: 2020 2020 2020 6465 7374 696e 6174 696f        destinatio
-0001bfd0: 6e5f 6c65 6173 653d 6465 7374 5f6c 6561  n_lease=dest_lea
-0001bfe0: 7365 290a 0a20 2020 2020 2020 2023 2041  se)..        # A
-0001bff0: 7373 6572 740a 2020 2020 2020 2020 7365  ssert.        se
-0001c000: 6c66 2e61 7373 6572 7445 7175 616c 2827  lf.assertEqual('
-0001c010: 6669 6c65 3227 2c20 6e65 775f 6669 6c65  file2', new_file
-0001c020: 2e66 696c 655f 6e61 6d65 290a 2020 2020  .file_name).    
-0001c030: 2020 2020 7072 6f70 7320 3d20 6177 6169      props = awai
-0001c040: 7420 6e65 775f 6669 6c65 2e67 6574 5f66  t new_file.get_f
-0001c050: 696c 655f 7072 6f70 6572 7469 6573 2829  ile_properties()
-0001c060: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-0001c070: 7365 7274 4973 4e6f 744e 6f6e 6528 7072  sertIsNotNone(pr
-0001c080: 6f70 7329 0a0a 2020 2020 4070 7974 6573  ops)..    @pytes
-0001c090: 742e 6d61 726b 2e6c 6976 655f 7465 7374  t.mark.live_test
-0001c0a0: 5f6f 6e6c 790a 2020 2020 4046 696c 6553  _only.    @FileS
-0001c0b0: 6861 7265 5072 6570 6172 6572 2829 0a20  harePreparer(). 
-0001c0c0: 2020 2040 4173 796e 6353 746f 7261 6765     @AsyncStorage
-0001c0d0: 5465 7374 4361 7365 2e61 7761 6974 5f70  TestCase.await_p
-0001c0e0: 7265 7061 7265 645f 7465 7374 0a20 2020  repared_test.   
-0001c0f0: 2061 7379 6e63 2064 6566 2074 6573 745f   async def test_
-0001c100: 7265 6e61 6d65 5f66 696c 655f 7368 6172  rename_file_shar
-0001c110: 655f 7361 7328 7365 6c66 2c20 7374 6f72  e_sas(self, stor
-0001c120: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
-0001c130: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
-0001c140: 745f 6b65 7929 3a0a 2020 2020 2020 2020  t_key):.        
-0001c150: 7365 6c66 2e5f 7365 7475 7028 7374 6f72  self._setup(stor
-0001c160: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
-0001c170: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
-0001c180: 745f 6b65 7929 0a20 2020 2020 2020 2061  t_key).        a
-0001c190: 7761 6974 2073 656c 662e 5f73 6574 7570  wait self._setup
-0001c1a0: 5f73 6861 7265 2873 746f 7261 6765 5f61  _share(storage_a
-0001c1b0: 6363 6f75 6e74 5f6e 616d 652c 2073 746f  ccount_name, sto
-0001c1c0: 7261 6765 5f61 6363 6f75 6e74 5f6b 6579  rage_account_key
-0001c1d0: 290a 2020 2020 2020 2020 7368 6172 655f  ).        share_
-0001c1e0: 636c 6965 6e74 203d 2073 656c 662e 6673  client = self.fs
-0001c1f0: 632e 6765 745f 7368 6172 655f 636c 6965  c.get_share_clie
-0001c200: 6e74 2873 656c 662e 7368 6172 655f 6e61  nt(self.share_na
-0001c210: 6d65 290a 0a20 2020 2020 2020 2074 6f6b  me)..        tok
-0001c220: 656e 203d 2067 656e 6572 6174 655f 7368  en = generate_sh
-0001c230: 6172 655f 7361 7328 0a20 2020 2020 2020  are_sas(.       
-0001c240: 2020 2020 2073 6861 7265 5f63 6c69 656e       share_clien
-0001c250: 742e 6163 636f 756e 745f 6e61 6d65 2c0a  t.account_name,.
-0001c260: 2020 2020 2020 2020 2020 2020 7368 6172              shar
-0001c270: 655f 636c 6965 6e74 2e73 6861 7265 5f6e  e_client.share_n
-0001c280: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
-0001c290: 2073 6861 7265 5f63 6c69 656e 742e 6372   share_client.cr
-0001c2a0: 6564 656e 7469 616c 2e61 6363 6f75 6e74  edential.account
-0001c2b0: 5f6b 6579 2c0a 2020 2020 2020 2020 2020  _key,.          
-0001c2c0: 2020 6578 7069 7279 3d64 6174 6574 696d    expiry=datetim
-0001c2d0: 652e 7574 636e 6f77 2829 202b 2074 696d  e.utcnow() + tim
-0001c2e0: 6564 656c 7461 2868 6f75 7273 3d31 292c  edelta(hours=1),
-0001c2f0: 0a20 2020 2020 2020 2020 2020 2070 6572  .            per
-0001c300: 6d69 7373 696f 6e3d 5368 6172 6553 6173  mission=ShareSas
-0001c310: 5065 726d 6973 7369 6f6e 7328 7265 6164  Permissions(read
-0001c320: 3d54 7275 652c 2077 7269 7465 3d54 7275  =True, write=Tru
-0001c330: 6529 290a 0a20 2020 2020 2020 2073 6f75  e))..        sou
-0001c340: 7263 655f 6669 6c65 203d 2053 6861 7265  rce_file = Share
-0001c350: 4669 6c65 436c 6965 6e74 280a 2020 2020  FileClient(.    
-0001c360: 2020 2020 2020 2020 7365 6c66 2e61 6363          self.acc
-0001c370: 6f75 6e74 5f75 726c 2873 746f 7261 6765  ount_url(storage
-0001c380: 5f61 6363 6f75 6e74 5f6e 616d 652c 2027  _account_name, '
-0001c390: 6669 6c65 2729 2c0a 2020 2020 2020 2020  file'),.        
-0001c3a0: 2020 2020 7368 6172 655f 636c 6965 6e74      share_client
-0001c3b0: 2e73 6861 7265 5f6e 616d 652c 2027 6669  .share_name, 'fi
-0001c3c0: 6c65 3127 2c0a 2020 2020 2020 2020 2020  le1',.          
-0001c3d0: 2020 6372 6564 656e 7469 616c 3d74 6f6b    credential=tok
-0001c3e0: 656e 290a 2020 2020 2020 2020 6177 6169  en).        awai
-0001c3f0: 7420 736f 7572 6365 5f66 696c 652e 6372  t source_file.cr
-0001c400: 6561 7465 5f66 696c 6528 3130 3234 290a  eate_file(1024).
-0001c410: 0a20 2020 2020 2020 2023 2041 6374 0a20  .        # Act. 
-0001c420: 2020 2020 2020 206e 6577 5f66 696c 6520         new_file 
-0001c430: 3d20 6177 6169 7420 736f 7572 6365 5f66  = await source_f
-0001c440: 696c 652e 7265 6e61 6d65 5f66 696c 6528  ile.rename_file(
-0001c450: 2766 696c 6532 2720 2b20 273f 2720 2b20  'file2' + '?' + 
-0001c460: 746f 6b65 6e29 0a0a 2020 2020 2020 2020  token)..        
-0001c470: 2320 4173 7365 7274 0a20 2020 2020 2020  # Assert.       
-0001c480: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-0001c490: 6c28 2766 696c 6532 272c 206e 6577 5f66  l('file2', new_f
-0001c4a0: 696c 652e 6669 6c65 5f6e 616d 6529 0a20  ile.file_name). 
-0001c4b0: 2020 2020 2020 2070 726f 7073 203d 2061         props = a
-0001c4c0: 7761 6974 206e 6577 5f66 696c 652e 6765  wait new_file.ge
-0001c4d0: 745f 6669 6c65 5f70 726f 7065 7274 6965  t_file_propertie
-0001c4e0: 7328 290a 2020 2020 2020 2020 7365 6c66  s().        self
-0001c4f0: 2e61 7373 6572 7449 734e 6f74 4e6f 6e65  .assertIsNotNone
-0001c500: 2870 726f 7073 290a                      (props).
+0001a180: 655f 6163 636f 756e 745f 6b65 7929 3a0a  e_account_key):.
+0001a190: 2020 2020 2020 2020 7365 6c66 2e5f 7365          self._se
+0001a1a0: 7475 7028 7374 6f72 6167 655f 6163 636f  tup(storage_acco
+0001a1b0: 756e 745f 6e61 6d65 2c20 7374 6f72 6167  unt_name, storag
+0001a1c0: 655f 6163 636f 756e 745f 6b65 7929 0a20  e_account_key). 
+0001a1d0: 2020 2020 2020 2061 7761 6974 2073 656c         await sel
+0001a1e0: 662e 5f73 6574 7570 5f73 6861 7265 2873  f._setup_share(s
+0001a1f0: 746f 7261 6765 5f61 6363 6f75 6e74 5f6e  torage_account_n
+0001a200: 616d 652c 2073 746f 7261 6765 5f61 6363  ame, storage_acc
+0001a210: 6f75 6e74 5f6b 6579 290a 2020 2020 2020  ount_key).      
+0001a220: 2020 7368 6172 655f 636c 6965 6e74 203d    share_client =
+0001a230: 2073 656c 662e 6673 632e 6765 745f 7368   self.fsc.get_sh
+0001a240: 6172 655f 636c 6965 6e74 2873 656c 662e  are_client(self.
+0001a250: 7368 6172 655f 6e61 6d65 290a 0a20 2020  share_name)..   
+0001a260: 2020 2020 2073 6f75 7263 655f 6469 7265       source_dire
+0001a270: 6374 6f72 7920 3d20 6177 6169 7420 7368  ctory = await sh
+0001a280: 6172 655f 636c 6965 6e74 2e63 7265 6174  are_client.creat
+0001a290: 655f 6469 7265 6374 6f72 7928 2764 6972  e_directory('dir
+0001a2a0: 3127 290a 2020 2020 2020 2020 6465 7374  1').        dest
+0001a2b0: 5f64 6972 6563 746f 7279 203d 2061 7761  _directory = awa
+0001a2c0: 6974 2073 6861 7265 5f63 6c69 656e 742e  it share_client.
+0001a2d0: 6372 6561 7465 5f64 6972 6563 746f 7279  create_directory
+0001a2e0: 2827 6469 7232 2729 0a20 2020 2020 2020  ('dir2').       
+0001a2f0: 2073 6f75 7263 655f 6669 6c65 203d 2061   source_file = a
+0001a300: 7761 6974 2073 6f75 7263 655f 6469 7265  wait source_dire
+0001a310: 6374 6f72 792e 7570 6c6f 6164 5f66 696c  ctory.upload_fil
+0001a320: 6528 2766 696c 6531 272c 2073 656c 662e  e('file1', self.
+0001a330: 7368 6f72 745f 6279 7465 5f64 6174 6129  short_byte_data)
+0001a340: 0a0a 2020 2020 2020 2020 2320 4163 740a  ..        # Act.
+0001a350: 2020 2020 2020 2020 6e65 775f 6669 6c65          new_file
+0001a360: 203d 2061 7761 6974 2073 6f75 7263 655f   = await source_
+0001a370: 6669 6c65 2e72 656e 616d 655f 6669 6c65  file.rename_file
+0001a380: 2864 6573 745f 6469 7265 6374 6f72 792e  (dest_directory.
+0001a390: 6469 7265 6374 6f72 795f 7061 7468 202b  directory_path +
+0001a3a0: 2027 2f27 202b 2073 6f75 7263 655f 6669   '/' + source_fi
+0001a3b0: 6c65 2e66 696c 655f 6e61 6d65 290a 0a20  le.file_name).. 
+0001a3c0: 2020 2020 2020 2023 2041 7373 6572 740a         # Assert.
+0001a3d0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0001a3e0: 6572 7454 7275 6528 2764 6972 3227 2069  ertTrue('dir2' i
+0001a3f0: 6e20 6e65 775f 6669 6c65 2e66 696c 655f  n new_file.file_
+0001a400: 7061 7468 290a 2020 2020 2020 2020 7072  path).        pr
+0001a410: 6f70 7320 3d20 6177 6169 7420 6e65 775f  ops = await new_
+0001a420: 6669 6c65 2e67 6574 5f66 696c 655f 7072  file.get_file_pr
+0001a430: 6f70 6572 7469 6573 2829 0a20 2020 2020  operties().     
+0001a440: 2020 2073 656c 662e 6173 7365 7274 4973     self.assertIs
+0001a450: 4e6f 744e 6f6e 6528 7072 6f70 7329 0a0a  NotNone(props)..
+0001a460: 2020 2020 4046 696c 6553 6861 7265 5072      @FileSharePr
+0001a470: 6570 6172 6572 2829 0a20 2020 2040 4173  eparer().    @As
+0001a480: 796e 6353 746f 7261 6765 5465 7374 4361  yncStorageTestCa
+0001a490: 7365 2e61 7761 6974 5f70 7265 7061 7265  se.await_prepare
+0001a4a0: 645f 7465 7374 0a20 2020 2061 7379 6e63  d_test.    async
+0001a4b0: 2064 6566 2074 6573 745f 7265 6e61 6d65   def test_rename
+0001a4c0: 5f66 696c 655f 6967 6e6f 7265 5f72 6561  _file_ignore_rea
+0001a4d0: 646f 6e6c 7928 7365 6c66 2c20 7374 6f72  donly(self, stor
+0001a4e0: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
+0001a4f0: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
+0001a500: 745f 6b65 7929 3a0a 2020 2020 2020 2020  t_key):.        
+0001a510: 7365 6c66 2e5f 7365 7475 7028 7374 6f72  self._setup(stor
+0001a520: 6167 655f 6163 636f 756e 745f 6e61 6d65  age_account_name
+0001a530: 2c20 7374 6f72 6167 655f 6163 636f 756e  , storage_accoun
+0001a540: 745f 6b65 7929 0a20 2020 2020 2020 2061  t_key).        a
+0001a550: 7761 6974 2073 656c 662e 5f73 6574 7570  wait self._setup
+0001a560: 5f73 6861 7265 2873 746f 7261 6765 5f61  _share(storage_a
+0001a570: 6363 6f75 6e74 5f6e 616d 652c 2073 746f  ccount_name, sto
+0001a580: 7261 6765 5f61 6363 6f75 6e74 5f6b 6579  rage_account_key
+0001a590: 290a 2020 2020 2020 2020 7368 6172 655f  ).        share_
+0001a5a0: 636c 6965 6e74 203d 2073 656c 662e 6673  client = self.fs
+0001a5b0: 632e 6765 745f 7368 6172 655f 636c 6965  c.get_share_clie
+0001a5c0: 6e74 2873 656c 662e 7368 6172 655f 6e61  nt(self.share_na
+0001a5d0: 6d65 290a 0a20 2020 2020 2020 2073 6f75  me)..        sou
+0001a5e0: 7263 655f 6669 6c65 203d 2073 6861 7265  rce_file = share
+0001a5f0: 5f63 6c69 656e 742e 6765 745f 6669 6c65  _client.get_file
+0001a600: 5f63 6c69 656e 7428 2766 696c 6531 2729  _client('file1')
+0001a610: 0a20 2020 2020 2020 2061 7761 6974 2073  .        await s
+0001a620: 6f75 7263 655f 6669 6c65 2e63 7265 6174  ource_file.creat
+0001a630: 655f 6669 6c65 2831 3032 3429 0a20 2020  e_file(1024).   
+0001a640: 2020 2020 2064 6573 745f 6669 6c65 203d       dest_file =
+0001a650: 2073 6861 7265 5f63 6c69 656e 742e 6765   share_client.ge
+0001a660: 745f 6669 6c65 5f63 6c69 656e 7428 2766  t_file_client('f
+0001a670: 696c 6532 2729 0a0a 2020 2020 2020 2020  ile2')..        
+0001a680: 6669 6c65 5f61 7474 7269 6275 7465 7320  file_attributes 
+0001a690: 3d20 4e54 4653 4174 7472 6962 7574 6573  = NTFSAttributes
+0001a6a0: 2872 6561 645f 6f6e 6c79 3d54 7275 6529  (read_only=True)
+0001a6b0: 0a20 2020 2020 2020 2061 7761 6974 2064  .        await d
+0001a6c0: 6573 745f 6669 6c65 2e63 7265 6174 655f  est_file.create_
+0001a6d0: 6669 6c65 2831 3032 342c 2066 696c 655f  file(1024, file_
+0001a6e0: 6174 7472 6962 7574 6573 3d66 696c 655f  attributes=file_
+0001a6f0: 6174 7472 6962 7574 6573 290a 0a20 2020  attributes)..   
+0001a700: 2020 2020 2023 2041 6374 0a20 2020 2020       # Act.     
+0001a710: 2020 206e 6577 5f66 696c 6520 3d20 6177     new_file = aw
+0001a720: 6169 7420 736f 7572 6365 5f66 696c 652e  ait source_file.
+0001a730: 7265 6e61 6d65 5f66 696c 6528 6465 7374  rename_file(dest
+0001a740: 5f66 696c 652e 6669 6c65 5f6e 616d 652c  _file.file_name,
+0001a750: 206f 7665 7277 7269 7465 3d54 7275 652c   overwrite=True,
+0001a760: 2069 676e 6f72 655f 7265 6164 5f6f 6e6c   ignore_read_onl
+0001a770: 793d 5472 7565 290a 0a20 2020 2020 2020  y=True)..       
+0001a780: 2023 2041 7373 6572 740a 2020 2020 2020   # Assert.      
+0001a790: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0001a7a0: 616c 2827 6669 6c65 3227 2c20 6e65 775f  al('file2', new_
+0001a7b0: 6669 6c65 2e66 696c 655f 6e61 6d65 290a  file.file_name).
+0001a7c0: 2020 2020 2020 2020 7072 6f70 7320 3d20          props = 
+0001a7d0: 6177 6169 7420 6e65 775f 6669 6c65 2e67  await new_file.g
+0001a7e0: 6574 5f66 696c 655f 7072 6f70 6572 7469  et_file_properti
+0001a7f0: 6573 2829 0a20 2020 2020 2020 2073 656c  es().        sel
+0001a800: 662e 6173 7365 7274 4973 4e6f 744e 6f6e  f.assertIsNotNon
+0001a810: 6528 7072 6f70 7329 0a0a 2020 2020 4046  e(props)..    @F
+0001a820: 696c 6553 6861 7265 5072 6570 6172 6572  ileSharePreparer
+0001a830: 2829 0a20 2020 2040 4173 796e 6353 746f  ().    @AsyncSto
+0001a840: 7261 6765 5465 7374 4361 7365 2e61 7761  rageTestCase.awa
+0001a850: 6974 5f70 7265 7061 7265 645f 7465 7374  it_prepared_test
+0001a860: 0a20 2020 2061 7379 6e63 2064 6566 2074  .    async def t
+0001a870: 6573 745f 7265 6e61 6d65 5f66 696c 655f  est_rename_file_
+0001a880: 6669 6c65 5f70 6572 6d69 7373 696f 6e28  file_permission(
+0001a890: 7365 6c66 2c20 7374 6f72 6167 655f 6163  self, storage_ac
+0001a8a0: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
+0001a8b0: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
+0001a8c0: 3a0a 2020 2020 2020 2020 7365 6c66 2e5f  :.        self._
+0001a8d0: 7365 7475 7028 7374 6f72 6167 655f 6163  setup(storage_ac
+0001a8e0: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
+0001a8f0: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
+0001a900: 0a20 2020 2020 2020 2061 7761 6974 2073  .        await s
+0001a910: 656c 662e 5f73 6574 7570 5f73 6861 7265  elf._setup_share
+0001a920: 2873 746f 7261 6765 5f61 6363 6f75 6e74  (storage_account
+0001a930: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
+0001a940: 6363 6f75 6e74 5f6b 6579 290a 2020 2020  ccount_key).    
+0001a950: 2020 2020 7368 6172 655f 636c 6965 6e74      share_client
+0001a960: 203d 2073 656c 662e 6673 632e 6765 745f   = self.fsc.get_
+0001a970: 7368 6172 655f 636c 6965 6e74 2873 656c  share_client(sel
+0001a980: 662e 7368 6172 655f 6e61 6d65 290a 2020  f.share_name).  
+0001a990: 2020 2020 2020 6669 6c65 5f70 6572 6d69        file_permi
+0001a9a0: 7373 696f 6e5f 6b65 7920 3d20 6177 6169  ssion_key = awai
+0001a9b0: 7420 7368 6172 655f 636c 6965 6e74 2e63  t share_client.c
+0001a9c0: 7265 6174 655f 7065 726d 6973 7369 6f6e  reate_permission
+0001a9d0: 5f66 6f72 5f73 6861 7265 2854 4553 545f  _for_share(TEST_
+0001a9e0: 4649 4c45 5f50 4552 4d49 5353 494f 4e53  FILE_PERMISSIONS
+0001a9f0: 290a 0a20 2020 2020 2020 2073 6f75 7263  )..        sourc
+0001aa00: 655f 6669 6c65 203d 2073 6861 7265 5f63  e_file = share_c
+0001aa10: 6c69 656e 742e 6765 745f 6669 6c65 5f63  lient.get_file_c
+0001aa20: 6c69 656e 7428 2766 696c 6531 2729 0a20  lient('file1'). 
+0001aa30: 2020 2020 2020 2061 7761 6974 2073 6f75         await sou
+0001aa40: 7263 655f 6669 6c65 2e63 7265 6174 655f  rce_file.create_
+0001aa50: 6669 6c65 2831 3032 3429 0a0a 2020 2020  file(1024)..    
+0001aa60: 2020 2020 2320 4163 740a 2020 2020 2020      # Act.      
+0001aa70: 2020 6e65 775f 6669 6c65 203d 2061 7761    new_file = awa
+0001aa80: 6974 2073 6f75 7263 655f 6669 6c65 2e72  it source_file.r
+0001aa90: 656e 616d 655f 6669 6c65 2827 6669 6c65  ename_file('file
+0001aaa0: 3227 2c20 6669 6c65 5f70 6572 6d69 7373  2', file_permiss
+0001aab0: 696f 6e3d 5445 5354 5f46 494c 455f 5045  ion=TEST_FILE_PE
+0001aac0: 524d 4953 5349 4f4e 5329 0a0a 2020 2020  RMISSIONS)..    
+0001aad0: 2020 2020 2320 4173 7365 7274 0a20 2020      # Assert.   
+0001aae0: 2020 2020 2070 726f 7073 203d 2061 7761       props = awa
+0001aaf0: 6974 206e 6577 5f66 696c 652e 6765 745f  it new_file.get_
+0001ab00: 6669 6c65 5f70 726f 7065 7274 6965 7328  file_properties(
+0001ab10: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0001ab20: 7373 6572 7449 734e 6f74 4e6f 6e65 2870  ssertIsNotNone(p
+0001ab30: 726f 7073 290a 2020 2020 2020 2020 7365  rops).        se
+0001ab40: 6c66 2e61 7373 6572 7445 7175 616c 2866  lf.assertEqual(f
+0001ab50: 696c 655f 7065 726d 6973 7369 6f6e 5f6b  ile_permission_k
+0001ab60: 6579 2c20 7072 6f70 732e 7065 726d 6973  ey, props.permis
+0001ab70: 7369 6f6e 5f6b 6579 290a 0a20 2020 2040  sion_key)..    @
+0001ab80: 4669 6c65 5368 6172 6550 7265 7061 7265  FileSharePrepare
+0001ab90: 7228 290a 2020 2020 4041 7379 6e63 5374  r().    @AsyncSt
+0001aba0: 6f72 6167 6554 6573 7443 6173 652e 6177  orageTestCase.aw
+0001abb0: 6169 745f 7072 6570 6172 6564 5f74 6573  ait_prepared_tes
+0001abc0: 740a 2020 2020 6173 796e 6320 6465 6620  t.    async def 
+0001abd0: 7465 7374 5f72 656e 616d 655f 6669 6c65  test_rename_file
+0001abe0: 5f70 7265 7365 7276 655f 7065 726d 6973  _preserve_permis
+0001abf0: 7369 6f6e 2873 656c 662c 2073 746f 7261  sion(self, stora
+0001ac00: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
+0001ac10: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
+0001ac20: 5f6b 6579 293a 0a20 2020 2020 2020 2073  _key):.        s
+0001ac30: 656c 662e 5f73 6574 7570 2873 746f 7261  elf._setup(stora
+0001ac40: 6765 5f61 6363 6f75 6e74 5f6e 616d 652c  ge_account_name,
+0001ac50: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
+0001ac60: 5f6b 6579 290a 2020 2020 2020 2020 6177  _key).        aw
+0001ac70: 6169 7420 7365 6c66 2e5f 7365 7475 705f  ait self._setup_
+0001ac80: 7368 6172 6528 7374 6f72 6167 655f 6163  share(storage_ac
+0001ac90: 636f 756e 745f 6e61 6d65 2c20 7374 6f72  count_name, stor
+0001aca0: 6167 655f 6163 636f 756e 745f 6b65 7929  age_account_key)
+0001acb0: 0a20 2020 2020 2020 2073 6861 7265 5f63  .        share_c
+0001acc0: 6c69 656e 7420 3d20 7365 6c66 2e66 7363  lient = self.fsc
+0001acd0: 2e67 6574 5f73 6861 7265 5f63 6c69 656e  .get_share_clien
+0001ace0: 7428 7365 6c66 2e73 6861 7265 5f6e 616d  t(self.share_nam
+0001acf0: 6529 0a0a 2020 2020 2020 2020 736f 7572  e)..        sour
+0001ad00: 6365 5f66 696c 6520 3d20 7368 6172 655f  ce_file = share_
+0001ad10: 636c 6965 6e74 2e67 6574 5f66 696c 655f  client.get_file_
+0001ad20: 636c 6965 6e74 2827 6669 6c65 3127 290a  client('file1').
+0001ad30: 2020 2020 2020 2020 6177 6169 7420 736f          await so
+0001ad40: 7572 6365 5f66 696c 652e 6372 6561 7465  urce_file.create
+0001ad50: 5f66 696c 6528 3130 3234 2c20 6669 6c65  _file(1024, file
+0001ad60: 5f70 6572 6d69 7373 696f 6e3d 5445 5354  _permission=TEST
+0001ad70: 5f46 494c 455f 5045 524d 4953 5349 4f4e  _FILE_PERMISSION
+0001ad80: 5329 0a0a 2020 2020 2020 2020 736f 7572  S)..        sour
+0001ad90: 6365 5f70 726f 7073 203d 2061 7761 6974  ce_props = await
+0001ada0: 2073 6f75 7263 655f 6669 6c65 2e67 6574   source_file.get
+0001adb0: 5f66 696c 655f 7072 6f70 6572 7469 6573  _file_properties
+0001adc0: 2829 0a20 2020 2020 2020 2073 6f75 7263  ().        sourc
+0001add0: 655f 7065 726d 6973 7369 6f6e 5f6b 6579  e_permission_key
+0001ade0: 203d 2073 6f75 7263 655f 7072 6f70 732e   = source_props.
+0001adf0: 7065 726d 6973 7369 6f6e 5f6b 6579 0a0a  permission_key..
+0001ae00: 2020 2020 2020 2020 2320 4163 740a 2020          # Act.  
+0001ae10: 2020 2020 2020 6e65 775f 6669 6c65 203d        new_file =
+0001ae20: 2061 7761 6974 2073 6f75 7263 655f 6669   await source_fi
+0001ae30: 6c65 2e72 656e 616d 655f 6669 6c65 2827  le.rename_file('
+0001ae40: 6669 6c65 3227 2c20 6669 6c65 5f70 6572  file2', file_per
+0001ae50: 6d69 7373 696f 6e3d 2770 7265 7365 7276  mission='preserv
+0001ae60: 6527 290a 0a20 2020 2020 2020 2023 2041  e')..        # A
+0001ae70: 7373 6572 740a 2020 2020 2020 2020 7072  ssert.        pr
+0001ae80: 6f70 7320 3d20 6177 6169 7420 6e65 775f  ops = await new_
+0001ae90: 6669 6c65 2e67 6574 5f66 696c 655f 7072  file.get_file_pr
+0001aea0: 6f70 6572 7469 6573 2829 0a20 2020 2020  operties().     
+0001aeb0: 2020 2073 656c 662e 6173 7365 7274 4973     self.assertIs
+0001aec0: 4e6f 744e 6f6e 6528 7072 6f70 7329 0a20  NotNone(props). 
+0001aed0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+0001aee0: 7274 4571 7561 6c28 736f 7572 6365 5f70  rtEqual(source_p
+0001aef0: 6572 6d69 7373 696f 6e5f 6b65 792c 2070  ermission_key, p
+0001af00: 726f 7073 2e70 6572 6d69 7373 696f 6e5f  rops.permission_
+0001af10: 6b65 7929 0a0a 2020 2020 4046 696c 6553  key)..    @FileS
+0001af20: 6861 7265 5072 6570 6172 6572 2829 0a20  harePreparer(). 
+0001af30: 2020 2040 4173 796e 6353 746f 7261 6765     @AsyncStorage
+0001af40: 5465 7374 4361 7365 2e61 7761 6974 5f70  TestCase.await_p
+0001af50: 7265 7061 7265 645f 7465 7374 0a20 2020  repared_test.   
+0001af60: 2061 7379 6e63 2064 6566 2074 6573 745f   async def test_
+0001af70: 7265 6e61 6d65 5f66 696c 655f 736d 625f  rename_file_smb_
+0001af80: 7072 6f70 6572 7469 6573 2873 656c 662c  properties(self,
+0001af90: 2073 746f 7261 6765 5f61 6363 6f75 6e74   storage_account
+0001afa0: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
+0001afb0: 6363 6f75 6e74 5f6b 6579 293a 0a20 2020  ccount_key):.   
+0001afc0: 2020 2020 2073 656c 662e 5f73 6574 7570       self._setup
+0001afd0: 2873 746f 7261 6765 5f61 6363 6f75 6e74  (storage_account
+0001afe0: 5f6e 616d 652c 2073 746f 7261 6765 5f61  _name, storage_a
+0001aff0: 6363 6f75 6e74 5f6b 6579 290a 2020 2020  ccount_key).    
+0001b000: 2020 2020 736f 7572 6365 5f66 696c 6520      source_file 
+0001b010: 3d20 6177 6169 7420 7365 6c66 2e5f 6372  = await self._cr
+0001b020: 6561 7465 5f66 696c 6528 7374 6f72 6167  eate_file(storag
+0001b030: 655f 6163 636f 756e 745f 6e61 6d65 2c20  e_account_name, 
+0001b040: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
+0001b050: 6b65 792c 2027 6669 6c65 3127 290a 0a20  key, 'file1').. 
+0001b060: 2020 2020 2020 2066 696c 655f 6174 7472         file_attr
+0001b070: 6962 7574 6573 203d 204e 5446 5341 7474  ibutes = NTFSAtt
+0001b080: 7269 6275 7465 7328 7265 6164 5f6f 6e6c  ributes(read_onl
+0001b090: 793d 5472 7565 2c20 6172 6368 6976 653d  y=True, archive=
+0001b0a0: 5472 7565 290a 2020 2020 2020 2020 6669  True).        fi
+0001b0b0: 6c65 5f63 7265 6174 696f 6e5f 7469 6d65  le_creation_time
+0001b0c0: 203d 2064 6174 6574 696d 6528 3230 3232   = datetime(2022
+0001b0d0: 2c20 312c 2032 362c 2031 302c 2039 2c20  , 1, 26, 10, 9, 
+0001b0e0: 3330 2c20 3530 3030 3030 290a 2020 2020  30, 500000).    
+0001b0f0: 2020 2020 6669 6c65 5f6c 6173 745f 7772      file_last_wr
+0001b100: 6974 655f 7469 6d65 203d 2064 6174 6574  ite_time = datet
+0001b110: 696d 6528 3230 3232 2c20 312c 2032 362c  ime(2022, 1, 26,
+0001b120: 2031 302c 2031 342c 2033 302c 2035 3030   10, 14, 30, 500
+0001b130: 3030 3029 0a20 2020 2020 2020 2066 696c  000).        fil
+0001b140: 655f 6368 616e 6765 5f74 696d 6520 3d20  e_change_time = 
+0001b150: 6461 7465 7469 6d65 2832 3032 322c 2033  datetime(2022, 3
+0001b160: 2c20 372c 2031 302c 2031 342c 2033 302c  , 7, 10, 14, 30,
+0001b170: 2035 3030 3030 3029 0a0a 2020 2020 2020   500000)..      
+0001b180: 2020 2320 4163 740a 2020 2020 2020 2020    # Act.        
+0001b190: 6e65 775f 6669 6c65 203d 2061 7761 6974  new_file = await
+0001b1a0: 2073 6f75 7263 655f 6669 6c65 2e72 656e   source_file.ren
+0001b1b0: 616d 655f 6669 6c65 280a 2020 2020 2020  ame_file(.      
+0001b1c0: 2020 2020 2020 2766 696c 6532 272c 0a20        'file2',. 
+0001b1d0: 2020 2020 2020 2020 2020 2066 696c 655f             file_
+0001b1e0: 6174 7472 6962 7574 6573 3d66 696c 655f  attributes=file_
+0001b1f0: 6174 7472 6962 7574 6573 2c0a 2020 2020  attributes,.    
+0001b200: 2020 2020 2020 2020 6669 6c65 5f63 7265          file_cre
+0001b210: 6174 696f 6e5f 7469 6d65 3d66 696c 655f  ation_time=file_
+0001b220: 6372 6561 7469 6f6e 5f74 696d 652c 0a20  creation_time,. 
+0001b230: 2020 2020 2020 2020 2020 2066 696c 655f             file_
+0001b240: 6c61 7374 5f77 7269 7465 5f74 696d 653d  last_write_time=
+0001b250: 6669 6c65 5f6c 6173 745f 7772 6974 655f  file_last_write_
+0001b260: 7469 6d65 2c0a 2020 2020 2020 2020 2020  time,.          
+0001b270: 2020 6669 6c65 5f63 6861 6e67 655f 7469    file_change_ti
+0001b280: 6d65 3d66 696c 655f 6368 616e 6765 5f74  me=file_change_t
+0001b290: 696d 6529 0a0a 2020 2020 2020 2020 2320  ime)..        # 
+0001b2a0: 4173 7365 7274 0a20 2020 2020 2020 2070  Assert.        p
+0001b2b0: 726f 7073 203d 2061 7761 6974 206e 6577  rops = await new
+0001b2c0: 5f66 696c 652e 6765 745f 6669 6c65 5f70  _file.get_file_p
+0001b2d0: 726f 7065 7274 6965 7328 290a 2020 2020  roperties().    
+0001b2e0: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
+0001b2f0: 734e 6f74 4e6f 6e65 2870 726f 7073 290a  sNotNone(props).
+0001b300: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0001b310: 6572 7445 7175 616c 2873 7472 2866 696c  ertEqual(str(fil
+0001b320: 655f 6174 7472 6962 7574 6573 292c 2070  e_attributes), p
+0001b330: 726f 7073 2e66 696c 655f 6174 7472 6962  rops.file_attrib
+0001b340: 7574 6573 2e72 6570 6c61 6365 2827 2027  utes.replace(' '
+0001b350: 2c20 2727 2929 0a20 2020 2020 2020 2073  , '')).        s
+0001b360: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0001b370: 6669 6c65 5f63 7265 6174 696f 6e5f 7469  file_creation_ti
+0001b380: 6d65 2c20 7072 6f70 732e 6372 6561 7469  me, props.creati
+0001b390: 6f6e 5f74 696d 6529 0a20 2020 2020 2020  on_time).       
+0001b3a0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+0001b3b0: 6c28 6669 6c65 5f6c 6173 745f 7772 6974  l(file_last_writ
+0001b3c0: 655f 7469 6d65 2c20 7072 6f70 732e 6c61  e_time, props.la
+0001b3d0: 7374 5f77 7269 7465 5f74 696d 6529 0a20  st_write_time). 
+0001b3e0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+0001b3f0: 7274 4571 7561 6c28 6669 6c65 5f63 6861  rtEqual(file_cha
+0001b400: 6e67 655f 7469 6d65 2c20 7072 6f70 732e  nge_time, props.
+0001b410: 6368 616e 6765 5f74 696d 6529 0a0a 2020  change_time)..  
+0001b420: 2020 4046 696c 6553 6861 7265 5072 6570    @FileSharePrep
+0001b430: 6172 6572 2829 0a20 2020 2040 4173 796e  arer().    @Asyn
+0001b440: 6353 746f 7261 6765 5465 7374 4361 7365  cStorageTestCase
+0001b450: 2e61 7761 6974 5f70 7265 7061 7265 645f  .await_prepared_
+0001b460: 7465 7374 0a20 2020 2061 7379 6e63 2064  test.    async d
+0001b470: 6566 2074 6573 745f 7265 6e61 6d65 5f66  ef test_rename_f
+0001b480: 696c 655f 636f 6e74 656e 745f 7479 7065  ile_content_type
+0001b490: 2873 656c 662c 2073 746f 7261 6765 5f61  (self, storage_a
+0001b4a0: 6363 6f75 6e74 5f6e 616d 652c 2073 746f  ccount_name, sto
+0001b4b0: 7261 6765 5f61 6363 6f75 6e74 5f6b 6579  rage_account_key
+0001b4c0: 293a 0a20 2020 2020 2020 2073 656c 662e  ):.        self.
+0001b4d0: 5f73 6574 7570 2873 746f 7261 6765 5f61  _setup(storage_a
+0001b4e0: 6363 6f75 6e74 5f6e 616d 652c 2073 746f  ccount_name, sto
+0001b4f0: 7261 6765 5f61 6363 6f75 6e74 5f6b 6579  rage_account_key
+0001b500: 290a 2020 2020 2020 2020 736f 7572 6365  ).        source
+0001b510: 5f66 696c 6520 3d20 6177 6169 7420 7365  _file = await se
+0001b520: 6c66 2e5f 6372 6561 7465 5f66 696c 6528  lf._create_file(
+0001b530: 7374 6f72 6167 655f 6163 636f 756e 745f  storage_account_
+0001b540: 6e61 6d65 2c20 7374 6f72 6167 655f 6163  name, storage_ac
+0001b550: 636f 756e 745f 6b65 792c 2027 6669 6c65  count_key, 'file
+0001b560: 3127 290a 2020 2020 2020 2020 636f 6e74  1').        cont
+0001b570: 656e 745f 7479 7065 203d 2027 7465 7874  ent_type = 'text
+0001b580: 2f70 6c61 696e 270a 0a20 2020 2020 2020  /plain'..       
+0001b590: 2023 2041 6374 0a20 2020 2020 2020 206e   # Act.        n
+0001b5a0: 6577 5f66 696c 6520 3d20 6177 6169 7420  ew_file = await 
+0001b5b0: 736f 7572 6365 5f66 696c 652e 7265 6e61  source_file.rena
+0001b5c0: 6d65 5f66 696c 6528 0a20 2020 2020 2020  me_file(.       
+0001b5d0: 2020 2020 2027 6669 6c65 3227 2c0a 2020       'file2',.  
+0001b5e0: 2020 2020 2020 2020 2020 636f 6e74 656e            conten
+0001b5f0: 745f 7479 7065 3d63 6f6e 7465 6e74 5f74  t_type=content_t
+0001b600: 7970 6529 0a0a 2020 2020 2020 2020 2320  ype)..        # 
+0001b610: 4173 7365 7274 0a20 2020 2020 2020 2070  Assert.        p
+0001b620: 726f 7073 203d 2061 7761 6974 206e 6577  rops = await new
+0001b630: 5f66 696c 652e 6765 745f 6669 6c65 5f70  _file.get_file_p
+0001b640: 726f 7065 7274 6965 7328 290a 2020 2020  roperties().    
+0001b650: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
+0001b660: 734e 6f74 4e6f 6e65 2870 726f 7073 290a  sNotNone(props).
+0001b670: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0001b680: 6572 7445 7175 616c 2863 6f6e 7465 6e74  ertEqual(content
+0001b690: 5f74 7970 652c 2070 726f 7073 2e63 6f6e  _type, props.con
+0001b6a0: 7465 6e74 5f73 6574 7469 6e67 732e 636f  tent_settings.co
+0001b6b0: 6e74 656e 745f 7479 7065 290a 0a20 2020  ntent_type)..   
+0001b6c0: 2040 4669 6c65 5368 6172 6550 7265 7061   @FileSharePrepa
+0001b6d0: 7265 7228 290a 2020 2020 4041 7379 6e63  rer().    @Async
+0001b6e0: 5374 6f72 6167 6554 6573 7443 6173 652e  StorageTestCase.
+0001b6f0: 6177 6169 745f 7072 6570 6172 6564 5f74  await_prepared_t
+0001b700: 6573 740a 2020 2020 6173 796e 6320 6465  est.    async de
+0001b710: 6620 7465 7374 5f72 656e 616d 655f 6669  f test_rename_fi
+0001b720: 6c65 5f77 6974 685f 6c65 6173 6528 7365  le_with_lease(se
+0001b730: 6c66 2c20 7374 6f72 6167 655f 6163 636f  lf, storage_acco
+0001b740: 756e 745f 6e61 6d65 2c20 7374 6f72 6167  unt_name, storag
+0001b750: 655f 6163 636f 756e 745f 6b65 7929 3a0a  e_account_key):.
+0001b760: 2020 2020 2020 2020 7365 6c66 2e5f 7365          self._se
+0001b770: 7475 7028 7374 6f72 6167 655f 6163 636f  tup(storage_acco
+0001b780: 756e 745f 6e61 6d65 2c20 7374 6f72 6167  unt_name, storag
+0001b790: 655f 6163 636f 756e 745f 6b65 7929 0a0a  e_account_key)..
+0001b7a0: 2020 2020 2020 2020 736f 7572 6365 5f66          source_f
+0001b7b0: 696c 6520 3d20 6177 6169 7420 7365 6c66  ile = await self
+0001b7c0: 2e5f 6372 6561 7465 5f66 696c 6528 7374  ._create_file(st
+0001b7d0: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
+0001b7e0: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
+0001b7f0: 756e 745f 6b65 792c 2027 6669 6c65 3127  unt_key, 'file1'
+0001b800: 290a 2020 2020 2020 2020 6465 7374 5f66  ).        dest_f
+0001b810: 696c 6520 3d20 6177 6169 7420 7365 6c66  ile = await self
+0001b820: 2e5f 6372 6561 7465 5f66 696c 6528 7374  ._create_file(st
+0001b830: 6f72 6167 655f 6163 636f 756e 745f 6e61  orage_account_na
+0001b840: 6d65 2c20 7374 6f72 6167 655f 6163 636f  me, storage_acco
+0001b850: 756e 745f 6b65 792c 2027 6669 6c65 3227  unt_key, 'file2'
+0001b860: 290a 2020 2020 2020 2020 736f 7572 6365  ).        source
+0001b870: 5f6c 6561 7365 203d 2061 7761 6974 2073  _lease = await s
+0001b880: 6f75 7263 655f 6669 6c65 2e61 6371 7569  ource_file.acqui
+0001b890: 7265 5f6c 6561 7365 2829 0a20 2020 2020  re_lease().     
+0001b8a0: 2020 2064 6573 745f 6c65 6173 6520 3d20     dest_lease = 
+0001b8b0: 6177 6169 7420 6465 7374 5f66 696c 652e  await dest_file.
+0001b8c0: 6163 7175 6972 655f 6c65 6173 6528 290a  acquire_lease().
+0001b8d0: 0a20 2020 2020 2020 2023 2041 6374 0a20  .        # Act. 
+0001b8e0: 2020 2020 2020 206e 6577 5f66 696c 6520         new_file 
+0001b8f0: 3d20 6177 6169 7420 736f 7572 6365 5f66  = await source_f
+0001b900: 696c 652e 7265 6e61 6d65 5f66 696c 6528  ile.rename_file(
+0001b910: 0a20 2020 2020 2020 2020 2020 2064 6573  .            des
+0001b920: 745f 6669 6c65 2e66 696c 655f 6e61 6d65  t_file.file_name
+0001b930: 2c0a 2020 2020 2020 2020 2020 2020 6f76  ,.            ov
+0001b940: 6572 7772 6974 653d 5472 7565 2c0a 2020  erwrite=True,.  
+0001b950: 2020 2020 2020 2020 2020 736f 7572 6365            source
+0001b960: 5f6c 6561 7365 3d73 6f75 7263 655f 6c65  _lease=source_le
+0001b970: 6173 652c 0a20 2020 2020 2020 2020 2020  ase,.           
+0001b980: 2064 6573 7469 6e61 7469 6f6e 5f6c 6561   destination_lea
+0001b990: 7365 3d64 6573 745f 6c65 6173 6529 0a0a  se=dest_lease)..
+0001b9a0: 2020 2020 2020 2020 2320 4173 7365 7274          # Assert
+0001b9b0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+0001b9c0: 7365 7274 4571 7561 6c28 2766 696c 6532  sertEqual('file2
+0001b9d0: 272c 206e 6577 5f66 696c 652e 6669 6c65  ', new_file.file
+0001b9e0: 5f6e 616d 6529 0a20 2020 2020 2020 2070  _name).        p
+0001b9f0: 726f 7073 203d 2061 7761 6974 206e 6577  rops = await new
+0001ba00: 5f66 696c 652e 6765 745f 6669 6c65 5f70  _file.get_file_p
+0001ba10: 726f 7065 7274 6965 7328 290a 2020 2020  roperties().    
+0001ba20: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
+0001ba30: 734e 6f74 4e6f 6e65 2870 726f 7073 290a  sNotNone(props).
+0001ba40: 0a20 2020 2040 7079 7465 7374 2e6d 6172  .    @pytest.mar
+0001ba50: 6b2e 6c69 7665 5f74 6573 745f 6f6e 6c79  k.live_test_only
+0001ba60: 0a20 2020 2040 4669 6c65 5368 6172 6550  .    @FileShareP
+0001ba70: 7265 7061 7265 7228 290a 2020 2020 4041  reparer().    @A
+0001ba80: 7379 6e63 5374 6f72 6167 6554 6573 7443  syncStorageTestC
+0001ba90: 6173 652e 6177 6169 745f 7072 6570 6172  ase.await_prepar
+0001baa0: 6564 5f74 6573 740a 2020 2020 6173 796e  ed_test.    asyn
+0001bab0: 6320 6465 6620 7465 7374 5f72 656e 616d  c def test_renam
+0001bac0: 655f 6669 6c65 5f73 6861 7265 5f73 6173  e_file_share_sas
+0001bad0: 2873 656c 662c 2073 746f 7261 6765 5f61  (self, storage_a
+0001bae0: 6363 6f75 6e74 5f6e 616d 652c 2073 746f  ccount_name, sto
+0001baf0: 7261 6765 5f61 6363 6f75 6e74 5f6b 6579  rage_account_key
+0001bb00: 293a 0a20 2020 2020 2020 2073 656c 662e  ):.        self.
+0001bb10: 5f73 6574 7570 2873 746f 7261 6765 5f61  _setup(storage_a
+0001bb20: 6363 6f75 6e74 5f6e 616d 652c 2073 746f  ccount_name, sto
+0001bb30: 7261 6765 5f61 6363 6f75 6e74 5f6b 6579  rage_account_key
+0001bb40: 290a 2020 2020 2020 2020 6177 6169 7420  ).        await 
+0001bb50: 7365 6c66 2e5f 7365 7475 705f 7368 6172  self._setup_shar
+0001bb60: 6528 7374 6f72 6167 655f 6163 636f 756e  e(storage_accoun
+0001bb70: 745f 6e61 6d65 2c20 7374 6f72 6167 655f  t_name, storage_
+0001bb80: 6163 636f 756e 745f 6b65 7929 0a20 2020  account_key).   
+0001bb90: 2020 2020 2073 6861 7265 5f63 6c69 656e       share_clien
+0001bba0: 7420 3d20 7365 6c66 2e66 7363 2e67 6574  t = self.fsc.get
+0001bbb0: 5f73 6861 7265 5f63 6c69 656e 7428 7365  _share_client(se
+0001bbc0: 6c66 2e73 6861 7265 5f6e 616d 6529 0a0a  lf.share_name)..
+0001bbd0: 2020 2020 2020 2020 746f 6b65 6e20 3d20          token = 
+0001bbe0: 6765 6e65 7261 7465 5f73 6861 7265 5f73  generate_share_s
+0001bbf0: 6173 280a 2020 2020 2020 2020 2020 2020  as(.            
+0001bc00: 7368 6172 655f 636c 6965 6e74 2e61 6363  share_client.acc
+0001bc10: 6f75 6e74 5f6e 616d 652c 0a20 2020 2020  ount_name,.     
+0001bc20: 2020 2020 2020 2073 6861 7265 5f63 6c69         share_cli
+0001bc30: 656e 742e 7368 6172 655f 6e61 6d65 2c0a  ent.share_name,.
+0001bc40: 2020 2020 2020 2020 2020 2020 7368 6172              shar
+0001bc50: 655f 636c 6965 6e74 2e63 7265 6465 6e74  e_client.credent
+0001bc60: 6961 6c2e 6163 636f 756e 745f 6b65 792c  ial.account_key,
+0001bc70: 0a20 2020 2020 2020 2020 2020 2065 7870  .            exp
+0001bc80: 6972 793d 6461 7465 7469 6d65 2e75 7463  iry=datetime.utc
+0001bc90: 6e6f 7728 2920 2b20 7469 6d65 6465 6c74  now() + timedelt
+0001bca0: 6128 686f 7572 733d 3129 2c0a 2020 2020  a(hours=1),.    
+0001bcb0: 2020 2020 2020 2020 7065 726d 6973 7369          permissi
+0001bcc0: 6f6e 3d53 6861 7265 5361 7350 6572 6d69  on=ShareSasPermi
+0001bcd0: 7373 696f 6e73 2872 6561 643d 5472 7565  ssions(read=True
+0001bce0: 2c20 7772 6974 653d 5472 7565 2929 0a0a  , write=True))..
+0001bcf0: 2020 2020 2020 2020 736f 7572 6365 5f66          source_f
+0001bd00: 696c 6520 3d20 5368 6172 6546 696c 6543  ile = ShareFileC
+0001bd10: 6c69 656e 7428 0a20 2020 2020 2020 2020  lient(.         
+0001bd20: 2020 2073 656c 662e 6163 636f 756e 745f     self.account_
+0001bd30: 7572 6c28 7374 6f72 6167 655f 6163 636f  url(storage_acco
+0001bd40: 756e 745f 6e61 6d65 2c20 2766 696c 6527  unt_name, 'file'
+0001bd50: 292c 0a20 2020 2020 2020 2020 2020 2073  ),.            s
+0001bd60: 6861 7265 5f63 6c69 656e 742e 7368 6172  hare_client.shar
+0001bd70: 655f 6e61 6d65 2c20 2766 696c 6531 272c  e_name, 'file1',
+0001bd80: 0a20 2020 2020 2020 2020 2020 2063 7265  .            cre
+0001bd90: 6465 6e74 6961 6c3d 746f 6b65 6e29 0a20  dential=token). 
+0001bda0: 2020 2020 2020 2061 7761 6974 2073 6f75         await sou
+0001bdb0: 7263 655f 6669 6c65 2e63 7265 6174 655f  rce_file.create_
+0001bdc0: 6669 6c65 2831 3032 3429 0a0a 2020 2020  file(1024)..    
+0001bdd0: 2020 2020 2320 4163 740a 2020 2020 2020      # Act.      
+0001bde0: 2020 6e65 775f 6669 6c65 203d 2061 7761    new_file = awa
+0001bdf0: 6974 2073 6f75 7263 655f 6669 6c65 2e72  it source_file.r
+0001be00: 656e 616d 655f 6669 6c65 2827 6669 6c65  ename_file('file
+0001be10: 3227 202b 2027 3f27 202b 2074 6f6b 656e  2' + '?' + token
+0001be20: 290a 0a20 2020 2020 2020 2023 2041 7373  )..        # Ass
+0001be30: 6572 740a 2020 2020 2020 2020 7365 6c66  ert.        self
+0001be40: 2e61 7373 6572 7445 7175 616c 2827 6669  .assertEqual('fi
+0001be50: 6c65 3227 2c20 6e65 775f 6669 6c65 2e66  le2', new_file.f
+0001be60: 696c 655f 6e61 6d65 290a 2020 2020 2020  ile_name).      
+0001be70: 2020 7072 6f70 7320 3d20 6177 6169 7420    props = await 
+0001be80: 6e65 775f 6669 6c65 2e67 6574 5f66 696c  new_file.get_fil
+0001be90: 655f 7072 6f70 6572 7469 6573 2829 0a20  e_properties(). 
+0001bea0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+0001beb0: 7274 4973 4e6f 744e 6f6e 6528 7072 6f70  rtIsNotNone(prop
+0001bec0: 7329 0a                                  s).
```

## Comparing `azure-storage-file-share-12.9.0/tests/test_file_api_version.py` & `azure-storage-file-share-12.9.0b1/tests/test_file_api_version.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/tests/settings/testcase.py` & `azure-storage-file-share-12.9.0b1/tests/settings/testcase.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/tests/settings/settings_fake.py` & `azure-storage-file-share-12.9.0b1/tests/settings/settings_fake.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/tests/perfstress_tests/upload.py` & `azure-storage-file-share-12.9.0b1/tests/perfstress_tests/upload.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/tests/perfstress_tests/download_to_file.py` & `azure-storage-file-share-12.9.0b1/tests/perfstress_tests/download_to_file.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/tests/perfstress_tests/download.py` & `azure-storage-file-share-12.9.0b1/tests/perfstress_tests/download.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/tests/perfstress_tests/_test_base.py` & `azure-storage-file-share-12.9.0b1/tests/perfstress_tests/_test_base.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/tests/perfstress_tests/upload_from_file.py` & `azure-storage-file-share-12.9.0b1/tests/perfstress_tests/upload_from_file.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/tests/perfstress_tests/T1_legacy_tests/upload.py` & `azure-storage-file-share-12.9.0b1/tests/perfstress_tests/T1_legacy_tests/upload.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/tests/perfstress_tests/T1_legacy_tests/download_to_file.py` & `azure-storage-file-share-12.9.0b1/tests/perfstress_tests/T1_legacy_tests/download_to_file.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/tests/perfstress_tests/T1_legacy_tests/download.py` & `azure-storage-file-share-12.9.0b1/tests/perfstress_tests/T1_legacy_tests/download.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/tests/perfstress_tests/T1_legacy_tests/_test_base.py` & `azure-storage-file-share-12.9.0b1/tests/perfstress_tests/T1_legacy_tests/_test_base.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/tests/perfstress_tests/T1_legacy_tests/upload_from_file.py` & `azure-storage-file-share-12.9.0b1/tests/perfstress_tests/T1_legacy_tests/upload_from_file.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/azure_storage_file_share.egg-info/SOURCES.txt` & `azure-storage-file-share-12.9.0b1/azure_storage_file_share.egg-info/SOURCES.txt`

 * *Files 2% similar despite different names*

```diff
@@ -43,14 +43,15 @@
 azure/storage/fileshare/_generated/operations/_service_operations.py
 azure/storage/fileshare/_generated/operations/_share_operations.py
 azure/storage/fileshare/_shared/__init__.py
 azure/storage/fileshare/_shared/authentication.py
 azure/storage/fileshare/_shared/base_client.py
 azure/storage/fileshare/_shared/base_client_async.py
 azure/storage/fileshare/_shared/constants.py
+azure/storage/fileshare/_shared/encryption.py
 azure/storage/fileshare/_shared/models.py
 azure/storage/fileshare/_shared/parser.py
 azure/storage/fileshare/_shared/policies.py
 azure/storage/fileshare/_shared/policies_async.py
 azure/storage/fileshare/_shared/request_handlers.py
 azure/storage/fileshare/_shared/response_handlers.py
 azure/storage/fileshare/_shared/shared_access_signature.py
@@ -95,16 +96,14 @@
 tests/test_file_client_async.py
 tests/test_file_service_properties.py
 tests/test_file_service_properties_async.py
 tests/test_get_file.py
 tests/test_get_file_async.py
 tests/test_handle.py
 tests/test_handle_async.py
-tests/test_helpers.py
-tests/test_helpers_async.py
 tests/test_share.py
 tests/test_share_async.py
 tests/perfstress_tests/__init__.py
 tests/perfstress_tests/_test_base.py
 tests/perfstress_tests/download.py
 tests/perfstress_tests/download_to_file.py
 tests/perfstress_tests/upload.py
```

## Comparing `azure-storage-file-share-12.9.0/azure_storage_file_share.egg-info/PKG-INFO` & `azure-storage-file-share-12.9.0b1/azure_storage_file_share.egg-info/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: azure-storage-file-share
-Version: 12.9.0
+Version: 12.9.0b1
 Summary: Microsoft Azure Azure File Share Storage Client Library for Python
 Home-page: https://github.com/Azure/azure-sdk-for-python/tree/main/sdk/storage/azure-storage-file-share
 Author: Microsoft Corporation
 Author-email: ascl@microsoft.com
 License: MIT License
 Description: # Azure Storage File Share client library for Python
         Azure File Share storage offers fully managed file shares in the cloud that are accessible via the industry standard [Server Message Block (SMB) protocol](https://docs.microsoft.com/windows/desktop/FileIO/microsoft-smb-protocol-and-cifs-protocol-overview). Azure file shares can be mounted concurrently by cloud or on-premises deployments of Windows, Linux, and macOS. Additionally, Azure file shares can be cached on Windows Servers with Azure File Sync for fast access near where the data is being used.
@@ -390,20 +390,14 @@
         When you submit a pull request, a CLA-bot will automatically determine whether you need to provide a CLA and decorate the PR appropriately (e.g., label, comment). Simply follow the instructions provided by the bot. You will only need to do this once across all repos using our CLA.
         
         This project has adopted the [Microsoft Open Source Code of Conduct](https://opensource.microsoft.com/codeofconduct/). For more information see the [Code of Conduct FAQ](https://opensource.microsoft.com/codeofconduct/faq/) or contact [opencode@microsoft.com](mailto:opencode@microsoft.com) with any additional questions or comments.
         
         
         # Release History
         
-        ## 12.9.0 (2022-07-07)
-        
-        ### Features Added
-        - Stable release of features from 12.9.0b1.
-        - Added support for progress tracking to `upload_file()` and `download_file()` via a new optional callback, `progress_hook`.
-        
         ## 12.9.0b1 (2022-06-15)
         
         ### Features Added
         - Added support for `file_change_time` to `start_copy_from_url` API
         
         ## 12.8.0 (2022-05-09)
```

## Comparing `azure-storage-file-share-12.9.0/samples/file_samples_authentication_async.py` & `azure-storage-file-share-12.9.0b1/samples/file_samples_authentication_async.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/samples/file_samples_hello_world_async.py` & `azure-storage-file-share-12.9.0b1/samples/file_samples_hello_world_async.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/samples/file_samples_service.py` & `azure-storage-file-share-12.9.0b1/samples/file_samples_service.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/samples/file_samples_service_async.py` & `azure-storage-file-share-12.9.0b1/samples/file_samples_service_async.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/samples/file_samples_share.py` & `azure-storage-file-share-12.9.0b1/samples/file_samples_share.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/samples/file_samples_client.py` & `azure-storage-file-share-12.9.0b1/samples/file_samples_client.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/samples/file_samples_hello_world.py` & `azure-storage-file-share-12.9.0b1/samples/file_samples_hello_world.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/samples/file_samples_client_async.py` & `azure-storage-file-share-12.9.0b1/samples/file_samples_client_async.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/samples/file_samples_share_async.py` & `azure-storage-file-share-12.9.0b1/samples/file_samples_share_async.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/samples/README.md` & `azure-storage-file-share-12.9.0b1/samples/README.md`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/samples/file_samples_directory_async.py` & `azure-storage-file-share-12.9.0b1/samples/file_samples_directory_async.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/samples/file_samples_directory.py` & `azure-storage-file-share-12.9.0b1/samples/file_samples_directory.py`

 * *Files identical despite different names*

## Comparing `azure-storage-file-share-12.9.0/samples/file_samples_authentication.py` & `azure-storage-file-share-12.9.0b1/samples/file_samples_authentication.py`

 * *Files identical despite different names*

